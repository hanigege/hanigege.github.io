[{"categories":["freebsd"],"contents":"è„šæœ¬åªèƒ½æ˜¯rootç”¨æˆ·è¿è¡Œï½ ä¸€é”®æ‰§è¡Œå‘½ä»¤ï¼ˆFreeBSDï¼‰ curl -fsSL https://raw.githubusercontent.com/hanigege/scripts/main/freebsd_ssh_key_manage.sh \\ -o freebsd_ssh_key_manage.sh \\ \u0026amp;\u0026amp; chmod +x freebsd_ssh_key_manage.sh \\ \u0026amp;\u0026amp; sh freebsd_ssh_key_manage.sh ğŸ’¡ å¦‚æœä½ æƒ³å¢åŠ å®‰å…¨æ£€æŸ¥ï¼ˆå¯é€‰ï¼‰ ä½ ä¹Ÿå¯ä»¥åœ¨æ‰§è¡Œå‰å¼ºåˆ¶æ£€æŸ¥æ˜¯å¦ä¸º rootï¼š\ncurl -fsSL https://raw.githubusercontent.com/hanigege/scripts/main/freebsd_ssh_key_manage.sh \\ -o freebsd_ssh_key_manage.sh \\ \u0026amp;\u0026amp; chmod +x freebsd_ssh_key_manage.sh \\ \u0026amp;\u0026amp; [ \u0026#34;$(id -u)\u0026#34; -eq 0 ] \\ \u0026amp;\u0026amp; sh freebsd_ssh_key_manage.sh è¿™æ ·å¯ä»¥ç¡®ä¿åªæœ‰ root æ‰èƒ½è¿è¡Œã€‚\n","permalink":"https://hanigege.github.io/posts/freebsd/freebsd%E4%B8%93%E7%94%A8%E7%89%88%E6%8B%89%E5%8F%96github%E5%85%AC%E9%92%A5%E5%81%9A%E4%B8%BA%E8%87%AA%E5%B7%B1%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%85%AC%E9%92%A5%E7%9A%84%E8%84%9A%E6%9C%AC/","tags":null,"title":"Freebsdä¸“ç”¨ç‰ˆæ‹‰å–githubå…¬é’¥åšä¸ºè‡ªå·±æœåŠ¡å™¨çš„å…¬é’¥çš„è„šæœ¬"},{"categories":["linux"],"contents":"é€‚ç”¨äºubuntu\u0026amp;debian\u0026amp;alpine,è¯·å¯¹åº”å®‰è£… è¯´æ˜ï¼š æå¤§ç®€åŒ–äº†æœåŠ¡å™¨å®‰è£…sshå¯†é’¥çš„å·¥ä½œï¼Œä¸€é”®å¯¼å…¥ï¼Œå¯¼å…¥åï¼Œè„šæœ¬ä¼šè‡ªåŠ¨ä¿®æ”¹sshd_configçš„é…ç½®å‚æ•°ï¼Œçœå¿ƒçœåŠ›ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥ç”Ÿæˆæ–°è¯ä¹¦ä½¿ç”¨ã€‚\nâœ… Ubuntuï¼šubuntu_ssh_key_manage.shï¼ˆä¸€é”®ï¼‰ curl -fsSL https://raw.githubusercontent.com/hanigege/scripts/main/ubuntu_ssh_key_manage.sh \\ -o ubuntu_ssh_key_manage.sh \\ \u0026amp;\u0026amp; chmod +x ubuntu_ssh_key_manage.sh \\ \u0026amp;\u0026amp; bash ubuntu_ssh_key_manage.sh âœ… Alpineï¼ˆrootï¼‰ï¼šalpine_root_ssh_key_manage.shï¼ˆä¸€é”®ï¼‰ curl -fsSL https://raw.githubusercontent.com/hanigege/scripts/main/alpine_root_ssh_key_manage.sh \\ -o alpine_root_ssh_key_manage.sh \\ \u0026amp;\u0026amp; chmod +x alpine_root_ssh_key_manage.sh \\ \u0026amp;\u0026amp; sh alpine_root_ssh_key_manage.sh âœ… Alpineï¼ˆæ™®é€šç”¨æˆ·ï¼‰ï¼šalpine_user_ssh_key_manage.shï¼ˆä¸€é”®ï¼‰ curl -fsSL https://raw.githubusercontent.com/hanigege/scripts/main/alpine_user_ssh_key_manage.sh \\ -o alpine_user_ssh_key_manage.sh \\ \u0026amp;\u0026amp; chmod +x alpine_user_ssh_key_manage.sh \\ \u0026amp;\u0026amp; sh alpine_user_ssh_key_manage.sh ","permalink":"https://hanigege.github.io/posts/linux/%E6%8B%89%E5%8F%96github%E5%85%AC%E9%92%A5%E5%81%9A%E4%B8%BA%E8%87%AA%E5%B7%B1%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%85%AC%E9%92%A5%E7%9A%84%E8%84%9A%E6%9C%AC/","tags":null,"title":"æ‹‰å–githubå…¬é’¥åšä¸ºè‡ªå·±æœåŠ¡å™¨çš„å…¬é’¥çš„è„šæœ¬"},{"categories":["freebsd"],"contents":"ç¬¬ä¸€æ­¥ï¼šå®‰è£…ç³»ç»Ÿä¾èµ–ä¸æºç ç¼–è¯‘ Neovim 0.10+ FreeBSD ä½¿ç”¨ pkg ç®¡ç†äºŒè¿›åˆ¶åŒ…ï¼Œç¼–è¯‘ Neovim éœ€è¦é¢å¤–çš„ gmakeã€‚\n# 1. å®‰è£…ç¼–è¯‘æ‰€éœ€çš„å·¥å…·å’Œä¾èµ– # æ³¨æ„ï¼šFreeBSD ä¸‹ç¼–è¯‘ Neovim å»ºè®®ä½¿ç”¨ gmake # å¼ºåˆ¶åŒæ­¥å¹¶æ›´æ–°æ‰€æœ‰è½¯ä»¶åŒ…ï¼Œè¿™æ˜¯è§£å†³ ld-elf.so.1 é”™è¯¯æœ€ç›´æ¥çš„æ–¹æ³•ï¼Œç¡®ä¿æ‰€æœ‰ä¾èµ–åº“ç‰ˆæœ¬ä¸€è‡´ã€‚ pkg update -f pkg upgrade -y pkg install -y ninja cmake gettext-tools gmake unzip curl git gcc # 2. æ‹‰å– Neovim æºç  git clone https://github.com/neovim/neovim.git ~/neovim-src cd ~/neovim-src git checkout stable # 3. ç¼–è¯‘å¹¶å…¨å±€å®‰è£… # FreeBSD ç¯å¢ƒä¸‹å¿…é¡»æ˜ç¡®ä½¿ç”¨ gmake gmake CMAKE_BUILD_TYPE=Release -j$(sysctl -n hw.ncpu) sudo gmake install # 4. éªŒè¯ç‰ˆæœ¬ hash -r nvim -v ç¬¬äºŒæ­¥ï¼šå®‰è£…æ ¼å¼åŒ–æ‰€éœ€çš„ç¯å¢ƒä¾èµ– FreeBSD çš„ Node.js åŒ…åé€šå¸¸å¸¦æœ‰ç‰ˆæœ¬å·ï¼Œæˆ‘ä»¬é€‰æ‹©ä¸»æµçš„ LTS ç‰ˆæœ¬ã€‚\n# å®‰è£… Node.js å’Œ npm pkg install -y node20 npm-node20 # å…¨å±€å®‰è£… Prettier npm install -g prettier ç¬¬ä¸‰æ­¥ï¼šéƒ¨ç½²å®Œæ•´çš„ Lua é…ç½® ç”±äº FreeBSD çš„ç”¨æˆ·ç›®å½•ç»“æ„ä¸ Linux ä¸€è‡´ï¼Œ~/.config/nvim è·¯å¾„ä¿æŒä¸å˜ã€‚\n# 1. æ¸…ç†æ—§ç¯å¢ƒ rm -rf ~/.config/nvim ~/.local/share/nvim ~/.local/state/nvim ~/.cache/nvim mkdir -p ~/.config/nvim # 2. å†™å…¥é…ç½® cat \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; \u0026gt; ~/.config/nvim/init.lua -- [åŸºç¡€è®¾ç½®] vim.g.mapleader = \u0026#34;;\u0026#34; local opt = vim.opt opt.number = true opt.relativenumber = true opt.cursorline = true opt.termguicolors = true opt.encoding = \u0026#34;utf-8\u0026#34; opt.mouse = \u0026#34;a\u0026#34; opt.timeoutlen = 300 opt.splitright = true opt.splitbelow = true -- [å®‰è£… lazy.nvim] local lazypath = vim.fn.stdpath(\u0026#34;data\u0026#34;) .. \u0026#34;/lazy/lazy.nvim\u0026#34; if not vim.loop.fs_stat(lazypath) then vim.fn.system({ \u0026#34;git\u0026#34;, \u0026#34;clone\u0026#34;, \u0026#34;--filter=blob:none\u0026#34;, \u0026#34;https://github.com/folke/lazy.nvim.git\u0026#34;, \u0026#34;--branch=stable\u0026#34;, lazypath, }) end vim.opt.rtp:prepend(lazypath) -- [æ’ä»¶é…ç½®] require(\u0026#34;lazy\u0026#34;).setup({ -- 1. ä¸»é¢˜ (Onedark) { \u0026#34;navarasu/onedark.nvim\u0026#34;, lazy = false, priority = 1000, config = function() require(\u0026#34;onedark\u0026#34;).setup({ style = \u0026#39;dark\u0026#39; }) require(\u0026#34;onedark\u0026#34;).load() -- æŠ¤çœ¼æ¨¡å¼ä¿®å¤ local hl = vim.api.nvim_set_hl hl(0, \u0026#34;Normal\u0026#34;, { bg = \u0026#34;#1e2127\u0026#34;, fg = \u0026#34;#abb2bf\u0026#34; }) hl(0, \u0026#34;CursorLine\u0026#34;, { bg = \u0026#34;#2c313a\u0026#34; }) end }, -- 2. æ–‡ä»¶æ ‘ (NvimTree) { \u0026#34;nvim-tree/nvim-tree.lua\u0026#34;, dependencies = { \u0026#34;nvim-tree/nvim-web-devicons\u0026#34; }, config = function() require(\u0026#34;nvim-tree\u0026#34;).setup({ view = { width = 30 }, renderer = { indent_markers = { enable = true } } }) end }, -- 3. è¿œç¨‹å¤åˆ¶ (OSC 52) { \u0026#34;ojroques/nvim-osc52\u0026#34;, config = function() require(\u0026#39;osc52\u0026#39;).setup() vim.api.nvim_create_autocmd(\u0026#34;TextYankPost\u0026#34;, { callback = function() if vim.v.event.operator == \u0026#34;y\u0026#34; and vim.v.event.regname == \u0026#34;\u0026#34; then require(\u0026#39;osc52\u0026#39;).copy_register(\u0026#34;\u0026#34;) end end, }) end }, -- 4. ä»£ç æ ¼å¼åŒ– (Conform) { \u0026#34;stevearc/conform.nvim\u0026#34;, config = function() require(\u0026#34;conform\u0026#34;).setup({ formatters_by_ft = { json = { \u0026#34;prettier\u0026#34; }, yaml = { \u0026#34;prettier\u0026#34; }, html = { \u0026#34;prettier\u0026#34; }, css = { \u0026#34;prettier\u0026#34; }, javascript = { \u0026#34;prettier\u0026#34; }, typescript = { \u0026#34;prettier\u0026#34; }, }, format_on_save = { timeout_ms = 1000, lsp_fallback = true }, }) end } }) -- [å¿«æ·é”®æ˜ å°„] local map = vim.keymap.set -- åŸºç¡€åŠŸèƒ½ map(\u0026#34;n\u0026#34;, \u0026#34;\u0026lt;leader\u0026gt;w\u0026#34;, \u0026#34;:w\u0026lt;CR\u0026gt;\u0026#34;, { silent = true }) map(\u0026#34;n\u0026#34;, \u0026#34;\u0026lt;leader\u0026gt;q\u0026#34;, \u0026#34;:q\u0026lt;CR\u0026gt;\u0026#34;, { silent = true }) map(\u0026#34;n\u0026#34;, \u0026#34;\u0026lt;CR\u0026gt;\u0026#34;, \u0026#34;:noh\u0026lt;CR\u0026gt;\u0026lt;CR\u0026gt;\u0026#34;, { silent = true }) -- æ™ºèƒ½æ–‡ä»¶æ ‘æ¥å›åˆ‡æ¢ (;t) map(\u0026#34;n\u0026#34;, \u0026#34;\u0026lt;leader\u0026gt;t\u0026#34;, function() local view = require(\u0026#34;nvim-tree.view\u0026#34;) if view.is_visible() then if vim.api.nvim_get_current_win() == view.get_winnr() then vim.cmd(\u0026#34;wincmd p\u0026#34;) else vim.cmd(\u0026#34;NvimTreeFocus\u0026#34;) end else vim.cmd(\u0026#34;NvimTreeToggle\u0026#34;) end end, { silent = true }) -- æ ¼å¼åŒ– (;f) map({ \u0026#34;n\u0026#34;, \u0026#34;v\u0026#34; }, \u0026#34;\u0026lt;leader\u0026gt;f\u0026#34;, function() require(\u0026#34;conform\u0026#34;).format({ lsp_fallback = true, timeout_ms = 1000 }) print(\u0026#34;âœ¨ Format executed\u0026#34;) end, { silent = true }) -- çª—å£å¯¼èˆª map(\u0026#34;n\u0026#34;, \u0026#34;\u0026lt;C-h\u0026gt;\u0026#34;, \u0026#34;\u0026lt;C-w\u0026gt;h\u0026#34;) map(\u0026#34;n\u0026#34;, \u0026#34;\u0026lt;C-l\u0026gt;\u0026#34;, \u0026#34;\u0026lt;C-w\u0026gt;l\u0026#34;) map(\u0026#34;n\u0026#34;, \u0026#34;\u0026lt;C-j\u0026gt;\u0026#34;, \u0026#34;\u0026lt;C-w\u0026gt;j\u0026#34;) map(\u0026#34;n\u0026#34;, \u0026#34;\u0026lt;C-k\u0026gt;\u0026#34;, \u0026#34;\u0026lt;C-w\u0026gt;k\u0026#34;) EOF é…ç½®å®Œæˆåï¼Œè¾“å…¥ nvim å¯åŠ¨ï¼ŒæŒ‰å›è½¦è®©å®ƒè‡ªåŠ¨ä¸‹è½½å¹¶éƒ¨ç½²æ‰€æœ‰æ’ä»¶å³å¯ã€‚\næ ¸å¿ƒç‰¹æ€§ æ™ºèƒ½åˆ‡æ¢ï¼šä½¿ç”¨ ;t åœ¨æ–‡ä»¶æ ‘ä¸ä»£ç ä¹‹é—´æ¥å›è·³è½¬ æ ¼å¼åŒ–ï¼š;f æ‰‹åŠ¨æ ¼å¼åŒ–ï¼Œ;w ä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–ï¼Œ;q é€€å‡º å…¶å®ƒï¼šå’Œ vim å‘½ä»¤æ— å¼‚ï¼Œæ”¯æŒè·¨ç»ˆç«¯å¤åˆ¶ç²˜è´´ï¼Œy å¤åˆ¶ ","permalink":"https://hanigege.github.io/posts/freebsd/freebsd15%E7%8E%B0%E4%BB%A3%E5%8C%96neovim%E7%94%9F%E4%BA%A7%E5%8A%9B%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/","tags":null,"title":"FreeBSD15ç°ä»£åŒ–Neovimç”Ÿäº§åŠ›ç¯å¢ƒéƒ¨ç½²æŒ‡å—"},{"categories":["routers"],"contents":"å†…ç½‘çš„dst-natè¦åŠ å¤–ç½‘æ¥å£å¦‚pppoe-out1 1. ä¸ºä»€ä¹ˆéœ€è¦å›æµï¼Ÿ å½“ä½ ä»å†…ç½‘è¯·æ±‚å…¬ç½‘ IP æ—¶ï¼ŒROS æ”¶åˆ°åŒ…åè½¬å‘ç»™å†…ç½‘æœåŠ¡å™¨ï¼Œä½†æœåŠ¡å™¨å‘ç°è¯·æ±‚æ–¹å’Œè‡ªå·±åœ¨åŒä¸€ä¸ªç½‘æ®µï¼Œä¼šç›´æ¥æŠŠå›åŒ…ä¼ ç»™æ‰‹æœºã€‚æ‰‹æœºå‘ç°è‡ªå·±å‘ç»™å…¬ç½‘ IP çš„è¯·æ±‚å´æ”¶åˆ°äº†æ¥è‡ªå†…ç½‘ç§æœ‰ IP çš„å“åº”ï¼Œä¼šå› ä¸ºå®‰å…¨æœºåˆ¶ç›´æ¥ä¸¢å¼ƒè¯¥åŒ…ã€‚å›æµè§„åˆ™é€šè¿‡è®© ROS ä¸­è½¬è¿™ä¸ªâ€œå›å¤´åŒ…â€æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\n2. å®Œæ•´çš„ ROS NAT è„šæœ¬ï¼ˆåŒ…å« Web å›æµï¼‰ è¯·æ ¹æ®ä½ çš„å®é™…ç«¯å£ä¿®æ”¹ 12335 (Web) å’Œ 21 (FTP) ç­‰ã€‚ /ip firewall nat # --- åŸºç¡€è§„åˆ™ --- # 1. æ ¸å¿ƒä¸Šç½‘ä¼ªè£…ï¼ˆå¿…é¡»é™åˆ¶åœ¨ WAN å£ï¼Œé˜²æ­¢å¹²æ‰°å…¶ä»–è½¬å‘ï¼‰ add chain=srcnat action=masquerade out-interface=pppoe-out1 comment=\u0026#34;Standard Internet Access\u0026#34; # --- ç«¯å£è½¬å‘ (DST-NAT) --- # 2. DERP è½¬å‘ add chain=dstnat protocol=tcp dst-port=12340 action=dst-nat to-addresses=10.20.20.4 to-ports=12340 comment=\u0026#34;DERP TCP\u0026#34; add chain=dstnat protocol=udp dst-port=3478 action=dst-nat to-addresses=10.20.20.4 to-ports=3478 comment=\u0026#34;DERP STUN\u0026#34; # 3. Web æœåŠ¡è½¬å‘ (ç¤ºä¾‹) add chain=dstnat protocol=tcp dst-port=12335 action=dst-nat to-addresses=10.20.20.x to-ports=12335 comment=\u0026#34;web\u0026#34; # 4. FTP æœåŠ¡è½¬å‘ (ç¤ºä¾‹) add chain=dstnat protocol=tcp dst-port=21 action=dst-nat to-addresses=10.20.20.x to-ports=21 comment=\u0026#34;vsftpd\u0026#34; # --- å›æµè§„åˆ™ (Hairpin NAT) --- # åªæœ‰å½“å†…ç½‘è®¿é—®å†…ç½‘æœåŠ¡å™¨æ—¶æ‰è§¦å‘ã€‚å»ºè®®å°†æ‰€æœ‰å†…ç½‘æœåŠ¡å™¨æ”¾åœ¨ä¸€ä¸ªè§„åˆ™é‡Œï¼Œæˆ–è€…é€ä¸ªæ·»åŠ ã€‚ # ç»™ DERP æ·»åŠ å›æµ add chain=srcnat src-address=10.20.20.0/24 dst-address=10.20.20.4 protocol=tcp dst-port=12340 action=masquerade comment=\u0026#34;Hairpin DERP TCP\u0026#34; add chain=srcnat src-address=10.20.20.0/24 dst-address=10.20.20.4 protocol=udp dst-port=3478 action=masquerade comment=\u0026#34;Hairpin DERP STUN\u0026#34; # ç»™ Web æœåŠ¡æ·»åŠ å›æµ (å‡è®¾å†…ç½‘ IP ä¸º 10.20.20.5) add chain=srcnat src-address=10.20.20.0/24 dst-address=10.20.20.5 protocol=tcp dst-port=12335 action=masquerade comment=\u0026#34;Hairpin Web\u0026#34; 3. æ“ä½œå»ºè®®ï¼šä½¿ç”¨â€œåœ°å€åˆ—è¡¨â€ç®€åŒ–å›æµ å¦‚æœä½ æœ‰å¾ˆå¤šå†…ç½‘æœåŠ¡å™¨éœ€è¦å›æµï¼Œä¸€æ¡æ¡åŠ  srcnat å¾ˆéº»çƒ¦ã€‚ä½ å¯ä»¥è¿™æ ·åšï¼š\nåœ¨ IP -\u0026gt; Firewall -\u0026gt; Address Lists é‡Œï¼ŒæŠŠæ‰€æœ‰å†…ç½‘æœåŠ¡å™¨ IP åŠ åˆ°ä¸€ä¸ªå« Internal_Servers çš„åˆ—è¡¨ã€‚\næ“ä½œæ­¥éª¤ è¯·åœ¨ WinBox ä¸­æŒ‰ç…§ä»¥ä¸‹ä¸¤æ­¥é…ç½®ï¼š\nç¬¬ä¸€æ­¥ï¼šå»ºç«‹æœåŠ¡å™¨åœ°å€åˆ—è¡¨\nåœ¨ IP -\u0026gt; Firewall -\u0026gt; Address Lists ä¸­ï¼Œå°†ä½ æ‰€æœ‰éœ€è¦ä»å†…ç½‘è®¿é—®çš„æœåŠ¡å™¨ IP åŠ å…¥åˆ—è¡¨ï¼š\nName: Internal_Servers | Address: 10.20.20.4 (DERP æœåŠ¡å™¨) Name: Internal_Servers | Address: 10.20.20.5 (Web æœåŠ¡å™¨) (ä¾æ­¤ç±»æ¨ï¼Œå°†æ‰€æœ‰æœ‰ç«¯å£è½¬å‘éœ€æ±‚çš„å†…ç½‘ IP éƒ½åŠ è¿›å») ç¬¬äºŒæ­¥ï¼šæ·»åŠ å…¨å±€å›æµè§„åˆ™\nåœ¨ IP -\u0026gt; Firewall -\u0026gt; NAT ä¸­æ·»åŠ è¿™ä¸€æ¡ï¼ˆç¡®ä¿å®ƒåœ¨æ‰€æœ‰ dst-nat è§„åˆ™ä¹‹åï¼Œä½†åœ¨åŸºç¡€ masquerade è§„åˆ™ä¹‹å‰ï¼Œæˆ–è€…ç´§éšå…¶åï¼‰ï¼š ä»£ç æ®µ\n/ip firewall nat add chain=srcnat src-address=10.20.20.0/24 dst-address-list=Internal_Servers action=masquerade comment=\u0026#34;Global Hairpin NAT\u0026#34; ä½¿ç”¨ Address Listï¼ˆåœ°å€åˆ—è¡¨ï¼‰ çš„æ–¹å¼æœ€ä¸ºé«˜æ•ˆï¼Œä¸éœ€è¦åœ¨ NAT è§„åˆ™é‡ŒæŒ‡å®šç«¯å£ã€‚\nå½“è¯·æ±‚çš„ç›®æ ‡åœ°å€åŒ¹é…åˆ—è¡¨ä¸­çš„ IP æ—¶ï¼ŒRouterOS ä¼šè‡ªåŠ¨å¯¹æ‰€æœ‰åè®®ï¼ˆTCP/UDP/ICMP ç­‰ï¼‰å’Œæ‰€æœ‰ç«¯å£æ‰§è¡Œå›æµæ“ä½œã€‚\nè§„åˆ™æ’åº ä¾‹ï¼š /ip firewall nat # ==================== # ç¬¬ä¸€éƒ¨åˆ†ï¼šç«¯å£æ˜ å°„ (DSTNAT - å¤–éƒ¨è®¿é—®å†…ç½‘) # ==================== # å°†å¤–éƒ¨ç½‘ç»œ (WAN åˆ—è¡¨) å¯¹ 80/443 ç«¯å£çš„è®¿é—®ï¼Œè½¬å‘ç»™å†…ç½‘æœåŠ¡å™¨ (ä»¥ä½ çš„ 10.20.20.10 ä¸ºä¾‹) add chain=dstnat action=dst-nat dst-port=80,443 in-interface-list=WAN protocol=tcp to-addresses=10.20.20.10 comment=\u0026#34;Web Server Port Forward from WAN\u0026#34; # ==================== # ç¬¬äºŒéƒ¨åˆ†ï¼šæºåœ°å€ä¼ªè£… (SRCNAT - å†…ç½‘è®¿é—®å¤–éƒ¨) # ==================== # 1. Hairpin NAT (å†…ç½‘å›æµï¼Œå¿…é¡»æ”¾åœ¨å…¨å±€ä¼ªè£…ä¹‹å‰) # ä½œç”¨ï¼šç¡®ä¿å†…ç½‘è®¾å¤‡é€šè¿‡å…¬ç½‘åŸŸåè®¿é—®å†…ç½‘æœåŠ¡å™¨æ—¶ï¼Œæ•°æ®åŒ…èƒ½åœ¨è·¯ç”±å™¨å†…éƒ¨æ­£ç¡®æŠ˜è¿” add chain=srcnat action=masquerade src-address=10.20.20.0/24 dst-address-list=Internal_Servers comment=\u0026#34;Global Hairpin NAT\u0026#34; # 2. å…¨å±€ä¸Šç½‘ä¼ªè£… (å…¨å±€å…œåº•ï¼Œå¿…é¡»æ”¾åœ¨ srcnat é“¾çš„æœ€åº•éƒ¨) # ä½œç”¨ï¼šæ‰€æœ‰ä» WAN åˆ—è¡¨ç‰©ç†æˆ–è™šæ‹Ÿæ¥å£å‘å‡ºçš„æµé‡ï¼Œå…¨éƒ¨è½¬æ¢å¹¶ä¼ªè£…ä¸ºè·¯ç”±å™¨çš„å…¬ç½‘ IP add chain=srcnat action=masquerade out-interface-list=WAN comment=\u0026#34;Global Internet Masquerade\u0026#34; è‡³æ­¤ï¼Œä½ çš„ RouterOS é˜²ç«å¢™åº•å±‚é‡æ„å°±å·²ç»å…¨éƒ¨å®Œæˆï¼Œæ—¢æ»¡è¶³äº†æ—è·¯ç”±ç§‘å­¦ä¸Šç½‘çš„è‹›åˆ»è¦æ±‚ï¼Œåˆå…·å¤‡äº†ä¼ä¸šçº§çš„æ‰©å±•èƒ½åŠ›ã€‚\n4. éªŒè¯ Web æœåŠ¡ å¤–ç½‘æµ‹è¯•ï¼šæ‰‹æœºå…³ Wi-Fiï¼Œè®¿é—®åŸŸåï¼Œç¡®è®¤ Web æ­£å¸¸ã€‚\nå†…ç½‘æµ‹è¯•ï¼šæ‰‹æœºè¿ Wi-Fiï¼Œè®¿é—®åŒä¸€ä¸ªåŸŸåã€‚å¦‚æœèƒ½æ‰“å¼€ï¼Œè¯´æ˜å›æµé…ç½®æˆåŠŸã€‚\n5. é…å¥—çš„é˜²ç«å¢™è§„åˆ™ï¼Œä¹Ÿæ˜¯æˆ‘è‡ªç”¨çš„ ç‰¹åˆ«å¼ºè°ƒï¼šå¦‚æœä½¿ç”¨äº†å°åŒ…ä¼˜å…ˆè§„åˆ™é…ç½®ï¼Œå¿…é¡»åœç”¨ä¸‹é¢æ‰€æœ‰é…ç½®ä¸­çš„fasttrack-connection ç¡¬ä»¶åŠ é€Ÿè§„åˆ™ RouterOS é»˜è®¤å¼€å¯äº† Fasttrackï¼ˆç¡¬ä»¶åŠ é€Ÿï¼‰ï¼Œè¯¥åŠŸèƒ½ä¼šå¼ºåˆ¶æ•°æ®åŒ…ç»•è¿‡ Mangle æ ‡è®°å’Œ Queue Tree æ’é˜Ÿï¼Œå¦‚æœä¸å¤„ç†ï¼Œæ‰€æœ‰ QoS é…ç½®å‡æ— æ•ˆã€‚\nipv4é˜²ç«å¢™é…ç½® å®‰å…¨æ¸…ç©ºæ—§é˜²ç«å¢™è§„åˆ™ ä½¿ç”¨å¸¦æœ‰ dynamic=no å‚æ•°çš„æ¸…ç†å‘½ä»¤ï¼ŒåªæŠ¹é™¤æ‰‹å·¥é…ç½®çš„é™æ€è§„åˆ™ï¼Œé¿å¼€ç³»ç»Ÿåº•å±‚çš„å†…ç½®ä¿æŠ¤è§„åˆ™ã€‚\nä»£ç æ®µ\n/ip firewall filter remove [find dynamic=no] /ipv6 firewall filter remove [find dynamic=no] å¸¦æ·»åŠ æ—è·¯ç”±ipè§„åˆ™ç‰ˆ (mosdns+sb): /ip firewall filter # ==================== # å…¥ç«™é“¾ (INPUT) - è®¿é—®è·¯ç”±å™¨æœ¬èº« # ==================== add action=accept chain=input comment=\u0026#34;1. Accept established,related,untracked\u0026#34; connection-state=established,related,untracked add action=drop chain=input comment=\u0026#34;2. Drop invalid\u0026#34; connection-state=invalid add action=accept chain=input comment=\u0026#34;3. Accept bridge1 (Internal Admin)\u0026#34; in-interface=bridge1 # é˜²çˆ†ç ´é€»è¾‘ (é’ˆå¯¹ 3981, 2222 ç«¯å£) add action=drop chain=input comment=\u0026#34;4. Drop Bruteforce IPs\u0026#34; dst-port=3981,2222 protocol=tcp src-address-list=bruteforce_blacklist add action=accept chain=input comment=\u0026#34;5. Accept limited connections\u0026#34; connection-limit=10,32 dst-port=3981,2222 protocol=tcp add action=add-src-to-address-list address-list=bruteforce_blacklist address-list-timeout=3d chain=input comment=\u0026#34;6. Add to Bruteforce List\u0026#34; dst-port=3981,2222 protocol=tcp add action=drop chain=input comment=\u0026#34;7. Drop excess packets\u0026#34; dst-port=3981,2222 protocol=tcp # WANå£ä¸¢å¼ƒä¸å…œåº• add action=drop chain=input comment=\u0026#34;8. Drop ICMP from WAN\u0026#34; in-interface=pppoe-out1 protocol=icmp add action=drop chain=input comment=\u0026#34;9. Drop all other input from WAN\u0026#34; in-interface=pppoe-out1 # ==================== # è½¬å‘é“¾ (FORWARD) - ç©¿è¿‡è·¯ç”±å™¨ (å¤–ç½‘\u0026lt;-\u0026gt;å†…ç½‘) # ==================== # 1. æ—è·¯ç”±è±å… (å¿…é¡»æ”¾åœ¨ Fasttrack å’Œ Invalid ä¸¢å¼ƒä¹‹å‰) add action=accept chain=forward comment=\u0026#34;1. Bypass Fasttrack \u0026amp; Tracking: sing-box out\u0026#34; src-address=10.20.20.6 add action=accept chain=forward comment=\u0026#34;2. Bypass Fasttrack \u0026amp; Tracking: sing-box in\u0026#34; dst-address=10.20.20.6 # 2. ç¡¬ä»¶åŠ é€Ÿ (å¤„ç†å†…ç½‘å…¶ä»–æ­£å¸¸ä¸èµ°ä»£ç†çš„ç›´è¿æµé‡) add action=fasttrack-connection chain=forward comment=\u0026#34;3. Fasttrack\u0026#34; connection-state=established,related # 3. åŸºç¡€çŠ¶æ€æ”¾è¡Œ add action=accept chain=forward comment=\u0026#34;4. Accept established,related,untracked\u0026#34; connection-state=established,related,untracked # 4. å†…ç½‘æ­£å¸¸è½¬å‘ä¸ç«¯å£æ˜ å°„æ”¾è¡Œ add action=accept chain=forward comment=\u0026#34;6. Allow bridge1 forward (Internal Outbound)\u0026#34; in-interface=bridge1 add action=accept chain=forward comment=\u0026#34;7. Allow DSTNAT (Port Forwarding)\u0026#34; connection-nat-state=dstnat in-interface=pppoe-out1 # 5. å…¨å±€å…œåº•æ‹¦æˆª (é›¶ä¿¡ä»»åŸåˆ™) add action=drop chain=forward comment=\u0026#34;8. Drop all other forward\u0026#34; è½¬å‘é“¾ (FORWARD)ç‰¹åˆ«è¯´æ˜ï¼š FORWARDé“¾â€œæ—è·¯ç”±è±å…â€å¡«å…¥ä½ çš„mos+sbçš„ip\nINPUTé“¾â€œ3981, 2222ç«¯å£â€å¡«å…¥ä½ çš„winboxï¼Œsshç­‰ç›¸å…³å¯¹å¤–å¼€æ”¾çš„ç«¯å£\nä¸æ·»åŠ æ—è·¯ç”±ipè§„åˆ™ç‰ˆï¼š /ip firewall filter # ==================== # å…¥ç«™é“¾ (INPUT) - è®¿é—®è·¯ç”±å™¨æœ¬èº« # ==================== add action=accept chain=input comment=\u0026#34;1. Accept established,related,untracked\u0026#34; connection-state=established,related,untracked add action=drop chain=input comment=\u0026#34;2. Drop invalid\u0026#34; connection-state=invalid add action=accept chain=input comment=\u0026#34;3. Accept bridge1 (Internal Admin)\u0026#34; in-interface=bridge1 # é˜²çˆ†ç ´é€»è¾‘ (é’ˆå¯¹ 3981, 2222 ç«¯å£) add action=drop chain=input comment=\u0026#34;4. Drop Bruteforce IPs\u0026#34; dst-port=3981,2222 protocol=tcp src-address-list=bruteforce_blacklist add action=accept chain=input comment=\u0026#34;5. Accept limited connections\u0026#34; connection-limit=10,32 dst-port=3981,2222 protocol=tcp add action=add-src-to-address-list address-list=bruteforce_blacklist address-list-timeout=3d chain=input comment=\u0026#34;6. Add to Bruteforce List\u0026#34; dst-port=3981,2222 protocol=tcp add action=drop chain=input comment=\u0026#34;7. Drop excess packets\u0026#34; dst-port=3981,2222 protocol=tcp # WANå£ä¸¢å¼ƒä¸å…œåº• add action=drop chain=input comment=\u0026#34;8. Drop ICMP from WAN\u0026#34; in-interface=pppoe-out1 protocol=icmp add action=drop chain=input comment=\u0026#34;9. Drop all other input from WAN\u0026#34; in-interface=pppoe-out1 # ==================== # è½¬å‘é“¾ (FORWARD) - ç©¿è¿‡è·¯ç”±å™¨ (å¤–ç½‘\u0026lt;-\u0026gt;å†…ç½‘) # ==================== # 1. ç¡¬ä»¶åŠ é€Ÿ (å¤„ç†å†…ç½‘å…¶ä»–æ­£å¸¸ä¸èµ°ä»£ç†çš„ç›´è¿æµé‡) add action=fasttrack-connection chain=forward comment=\u0026#34;3. Fasttrack\u0026#34; connection-state=established,related # 2. åŸºç¡€çŠ¶æ€æ”¾è¡Œ add action=accept chain=forward comment=\u0026#34;4. Accept established,related,untracked\u0026#34; connection-state=established,related,untracked # 3. ä¸¢å¼ƒæ— æ•ˆåŒ… (æ”¾åœ¨æ—è·¯ç”±ä¹‹åï¼Œé˜²æ­¢éå¯¹ç§°è·¯ç”±å›ç¨‹åŒ…è¢«è¯¯æ€) add action=drop chain=forward comment=\u0026#34;5. Drop invalid\u0026#34; connection-state=invalid # 4. å†…ç½‘æ­£å¸¸è½¬å‘ä¸ç«¯å£æ˜ å°„æ”¾è¡Œ add action=accept chain=forward comment=\u0026#34;6. Allow bridge1 forward (Internal Outbound)\u0026#34; in-interface=bridge1 add action=accept chain=forward comment=\u0026#34;7. Allow DSTNAT (Port Forwarding)\u0026#34; connection-nat-state=dstnat in-interface=pppoe-out1 # 5. å…¨å±€å…œåº•æ‹¦æˆª (é›¶ä¿¡ä»»åŸåˆ™) add action=drop chain=forward comment=\u0026#34;8. Drop all other forward\u0026#34; è½¬å‘é“¾ (FORWARD)ç‰¹åˆ«è¯´æ˜ï¼š ç¬¬5æ¡\u0026ldquo;DST-NAT\u0026quot;è§„åˆ™ï¼šåœ¨ IPv4 çš„ Forward é“¾ä¸­ï¼Œæˆ‘åŠ å…¥äº†ä¸€æ¡ connection-nat-state=dstnatã€‚è¿™ç¡®ä¿äº†ä½ åœ¨ IP -\u0026gt; Firewall -\u0026gt; NAT ä¸­åšçš„ç«¯å£æ˜ å°„èƒ½å¤Ÿç©¿é€ forward çš„å…œåº• drop è§„åˆ™ã€‚ å†…ç½‘äº’é€šï¼šåªè¦æ•°æ®åŒ…è¿›å…¥ bridge1 æ¥å£ï¼Œå°±ä¼šè¢« Allow bridge1 forward æ•è·å¹¶æ”¾è¡Œï¼Œä¸ä¼šå—åˆ°æœ€åä¸€æ¡ drop çš„å½±å“ã€‚\nè¿™æ ·é…ç½®åï¼Œå±€åŸŸç½‘å†…çš„ PT ä¸‹è½½ã€NAS å¤–éƒ¨å¤§æ–‡ä»¶ä¼ è¾“ç­‰ä¸èµ° 10.20.20.6 çš„ç›´è¿æµé‡ä¾ç„¶å¯ä»¥äº«å—ç¡¬ä»¶åŠ é€Ÿé™ä½ CPU è´Ÿè½½ï¼Œè€Œ sing-box è¿›å‡ºçš„æµé‡åˆ™ç”± CPU ç¨³å¦¥å¤„ç†ï¼Œäº’ä¸å¹²æ‰°\nipv6é˜²ç«å¢™é…ç½® æ·»åŠ æ—è·¯ç”±ipè§„åˆ™ç‰ˆ (mosdns+sb) /ipv6 firewall filter # ==================== # å…¥ç«™é“¾ (INPUT) - ä¿æŠ¤è·¯ç”±å™¨æœ¬ä½“ # ==================== add action=accept chain=input comment=\u0026#34;1. Accept established,related,untracked\u0026#34; connection-state=established,related,untracked add action=drop chain=input comment=\u0026#34;2. Drop invalid\u0026#34; connection-state=invalid add action=accept chain=input comment=\u0026#34;3. Accept ICMPv6 (Critical for IPv6)\u0026#34; protocol=icmpv6 add action=accept chain=input comment=\u0026#34;4. Allow DHCPv6 Client from WAN\u0026#34; dst-port=546 in-interface=pppoe-out1 protocol=udp src-address=fe80::/10 add action=accept chain=input comment=\u0026#34;5. Allow bridge1 (Internal Admin)\u0026#34; in-interface=bridge1 add action=drop chain=input comment=\u0026#34;6. Drop all not from bridge1\u0026#34; in-interface=!bridge1 # ==================== # è½¬å‘é“¾ (FORWARD) - ç©¿è¿‡è·¯ç”±å™¨ (å¤–ç½‘\u0026lt;-\u0026gt;å†…ç½‘) # ==================== # 1. æ—è·¯ç”±è±å… (å¿…é¡»æ”¾åœ¨ Fasttrack å’Œ Invalid ä¸¢å¼ƒä¹‹å‰) add action=accept chain=forward comment=\u0026#34;1. Bypass Fasttrack \u0026amp; Tracking: sing-box out\u0026#34; src-address=fd88::6666 add action=accept chain=forward comment=\u0026#34;2. Bypass Fasttrack \u0026amp; Tracking: sing-box in\u0026#34; dst-address=fd88::6666 # 2. ç¡¬ä»¶åŠ é€Ÿ (å¤„ç†æ­£å¸¸ä¸èµ°ä»£ç†çš„ IPv6 ç›´è¿æµé‡) add action=fasttrack-connection chain=forward comment=\u0026#34;3. Fasttrack\u0026#34; connection-state=established,related # 3. åŸºç¡€çŠ¶æ€æ”¾è¡Œ add action=accept chain=forward comment=\u0026#34;4. Accept forward established,related,untracked\u0026#34; connection-state=established,related,untracked # 4. æ ¸å¿ƒåè®®ä¸å†…ç½‘æ”¾è¡Œ add action=accept chain=forward comment=\u0026#34;6. Accept Forward ICMPv6\u0026#34; protocol=icmpv6 add action=accept chain=forward comment=\u0026#34;7. Allow bridge1 forward (Internal Outbound)\u0026#34; in-interface=bridge1 # --- æš´éœ²å†…ç½‘æœåŠ¡ (æ³¨æ„ï¼šæ›¿æ¢ä¸ºå®é™…å…¬ç½‘ IPv6 åœ°å€åå†æŒ‰éœ€å¯ç”¨) --- add action=accept chain=forward comment=\u0026#34;8. Allow NPM (HTTP/HTTPS)\u0026#34; disabled=yes dst-address=240e::xxxx:xxxx dst-port=80,443 protocol=tcp add action=accept chain=forward comment=\u0026#34;9. Allow Hysteria2/Proxy\u0026#34; disabled=yes dst-address=240e::xxxx:xxxx dst-port=36789 protocol=udp add action=accept chain=forward comment=\u0026#34;10. Allow Shadowsocks\u0026#34; disabled=yes dst-address=240e::xxxx:xxxx dst-port=36789 protocol=tcp # 5. å…œåº•æ‹¦æˆª (é›¶ä¿¡ä»»åŸåˆ™) add action=drop chain=forward comment=\u0026#34;11. Drop all other forward (Protect LAN)\u0026#34; å…³é”®æé†’ï¼š ä¿®æ”¹æ—è·¯ç”±çš„ipä¸ºä½ çš„ipv6åœ°å€\nå¦‚æœä½ çš„å®½å¸¦æ˜¯åŠ¨æ€ IPv6 å‰ç¼€ï¼ˆPDï¼‰ï¼ŒæœåŠ¡å™¨çš„å®Œæ•´ IPv6 åœ°å€ä¼šå˜åŒ–ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä¸åº”ç›´æ¥å†™æ­» dst-addressï¼Œè€Œæ˜¯éœ€è¦ç»“åˆ MikroTik çš„ IPv6 Firewall Address Lists åŠŸèƒ½ï¼Œæˆ–è€…ä½¿ç”¨ in-interface=pppoe-out1 é…åˆ out-interface=bridge1 åŠ ä¸Šç‰¹å®šè®¾å¤‡çš„ç‰¹å®šåŒ¹é…è§„åˆ™ï¼ˆæ¯”å¦‚é€šè¿‡é˜²ç«å¢™è„šæœ¬åŠ¨æ€æ›´æ–°ï¼‰ã€‚\nIPv4 ä¾é  NATï¼Œä¸ä¸»åŠ¨æ˜ å°„å¤–éƒ¨è¿›ä¸æ¥ï¼›ä½† IPv6 æ˜¯ç«¯åˆ°ç«¯ç›´é€šï¼ˆæ²¡æœ‰ NATï¼‰ã€‚ ä½ åœ¨ forward é“¾ä¸­æ”¾è¡Œ dst-port=80,443ï¼Œå´æ²¡æœ‰æŒ‡å®šç›®æ ‡åœ°å€ (dst-address)ã€‚ä¸€æ—¦å¯ç”¨ï¼Œè¿™ä»£è¡¨å…¬ç½‘å¯ä»¥è®¿é—®ä½ å±€åŸŸç½‘å†…æ‰€æœ‰è®¾å¤‡çš„ 80 å’Œ 443 ç«¯å£ï¼ˆåŒ…æ‹¬å…‰çŒ«ã€è·¯ç”±å™¨åå°ã€æ™ºèƒ½å®¶å±…ã€å…¶ä»–ç”µè„‘ç­‰ï¼‰ã€‚\næ­£ç¡®åšæ³•ï¼šå¿…é¡»ä¸¥æ ¼ç»‘å®šç›®æ ‡æœåŠ¡å™¨çš„ IPv6 åœ°å€ï¼ˆdst-address=æœåŠ¡å™¨IPv6åœ°å€ï¼‰ï¼Œæˆ–è€…é€šè¿‡ MAC åœ°å€è‡ªåŠ¨è·å–åˆ°çš„ IPv6 åç¼€ã€‚\nä¸æ·»åŠ æ—è·¯ç”±ipè§„åˆ™ç‰ˆ (mosdns+sb)ï¼š /ipv6 firewall filter # ==================== # å…¥ç«™é“¾ (INPUT) - ä¿æŠ¤è·¯ç”±å™¨æœ¬ä½“ # ==================== add action=accept chain=input comment=\u0026#34;1. Accept established,related,untracked\u0026#34; connection-state=established,related,untracked add action=drop chain=input comment=\u0026#34;2. Drop invalid\u0026#34; connection-state=invalid add action=accept chain=input comment=\u0026#34;3. Accept ICMPv6 (Critical for IPv6)\u0026#34; protocol=icmpv6 add action=accept chain=input comment=\u0026#34;4. Allow DHCPv6 Client from WAN\u0026#34; dst-port=546 in-interface=pppoe-out1 protocol=udp src-address=fe80::/10 add action=accept chain=input comment=\u0026#34;5. Allow bridge1 (Internal Admin)\u0026#34; in-interface=bridge1 add action=drop chain=input comment=\u0026#34;6. Drop all not from bridge1\u0026#34; in-interface=!bridge1 # ==================== # è½¬å‘é“¾ (FORWARD) - ç©¿è¿‡è·¯ç”±å™¨ (å¤–ç½‘\u0026lt;-\u0026gt;å†…ç½‘) # ==================== # 1. ç¡¬ä»¶åŠ é€Ÿ (å¤„ç†æ­£å¸¸ä¸èµ°ä»£ç†çš„ IPv6 ç›´è¿æµé‡) add action=fasttrack-connection chain=forward comment=\u0026#34;3. Fasttrack\u0026#34; connection-state=established,related # 2. åŸºç¡€çŠ¶æ€æ”¾è¡Œ add action=accept chain=forward comment=\u0026#34;4. Accept forward established,related,untracked\u0026#34; connection-state=established,related,untracked # 3. ä¸¢å¼ƒæ— æ•ˆåŒ… (é˜²æ­¢æ—è·¯ç”±éå¯¹ç§°å›ç¨‹åŒ…è¢«è¯¯æ€) add action=drop chain=forward comment=\u0026#34;5. Drop invalid\u0026#34; connection-state=invalid # 4. æ ¸å¿ƒåè®®ä¸å†…ç½‘æ”¾è¡Œ add action=accept chain=forward comment=\u0026#34;6. Accept Forward ICMPv6\u0026#34; protocol=icmpv6 add action=accept chain=forward comment=\u0026#34;7. Allow bridge1 forward (Internal Outbound)\u0026#34; in-interface=bridge1 # --- æš´éœ²å†…ç½‘æœåŠ¡ (æ³¨æ„ï¼šæ›¿æ¢ä¸ºå®é™…å…¬ç½‘ IPv6 åœ°å€åå†æŒ‰éœ€å¯ç”¨) --- add action=accept chain=forward comment=\u0026#34;8. Allow NPM (HTTP/HTTPS)\u0026#34; disabled=yes dst-address=240e::xxxx:xxxx dst-port=80,443 protocol=tcp add action=accept chain=forward comment=\u0026#34;9. Allow Hysteria2/Proxy\u0026#34; disabled=yes dst-address=240e::xxxx:xxxx dst-port=36789 protocol=udp add action=accept chain=forward comment=\u0026#34;10. Allow Shadowsocks\u0026#34; disabled=yes dst-address=240e::xxxx:xxxx dst-port=36789 protocol=tcp # 5. å…œåº•æ‹¦æˆª (é›¶ä¿¡ä»»åŸåˆ™) add action=drop chain=forward comment=\u0026#34;11. Drop all other forward (Protect LAN)\u0026#34; è§£é‡Šï¼šä¸ºä»€ä¹ˆæ·»åŠ è·¯ç”±ipåè¦åˆ é™¤å±è”½æ— æ•ˆåŒ…ï¼šå³ï¼šFORWARD é“¾ Drop invalid è¿™æ˜¯å› ä¸ºæ–°åŠ å…¥çš„ FORWARD é“¾ Drop invalidï¼ˆä¸¢å¼ƒæ— æ•ˆåŒ…ï¼‰è§„åˆ™ï¼Œä¸ä½ çš„æ—è·¯ç”±ï¼ˆ10.20.20.6ï¼‰ç½‘ç»œæ¶æ„äº§ç”Ÿäº†å†²çªï¼Œå¯¼è‡´ RouterOS è¯¯æ€äº†éƒ¨åˆ†æ­£å¸¸çš„ UDP æ¸¸æˆæµé‡å’Œ Telegram çš„åˆå§‹æ¡æ‰‹åŒ…ã€‚\nç§‘å­¦ä¾æ® åœ¨ä½ çš„ç½‘ç»œæ‹“æ‰‘ä¸­ï¼Œå®¢æˆ·ç«¯å°†ç½‘å…³æŒ‡å‘äº† 10.20.20.6ï¼ˆæ—è·¯ç”±ï¼‰ã€‚ å½“è®¿é—®ä¸ç»è¿‡ä»£ç†çš„ç›´è¿ç½‘ç»œï¼ˆå¦‚å›½å†…æµé‡ã€éƒ¨åˆ† P2P/UDP æ¸¸æˆèŠ‚ç‚¹ï¼‰æ—¶ï¼Œå¾€å¾€ä¼šäº§ç”Ÿéå¯¹ç§°è·¯ç”±ï¼š\nå»ç¨‹ï¼šå®¢æˆ·ç«¯ -\u0026gt; æ—è·¯ç”± (10.20.20.6) -\u0026gt; ä¸»è·¯ç”± (ROS) -\u0026gt; äº’è”ç½‘ã€‚ å›ç¨‹ï¼šäº’è”ç½‘ -\u0026gt; ä¸»è·¯ç”± (ROS) -\u0026gt; ç›´æ¥äº¤å›ç»™å®¢æˆ·ç«¯ï¼ˆå› ä¸ºéƒ½åœ¨ bridge1 åŒä¸€ç½‘æ®µï¼‰ã€‚ è¿™ç§ä¸€æ¥ä¸€å›è·¯å¾„ä¸ä¸€è‡´çš„æ•°æ®æµï¼Œä¼šè®© RouterOS çš„è¿æ¥è·Ÿè¸ªå¼•æ“ï¼ˆConnection Trackerï¼‰æŠ“ä¸åˆ°å®Œæ•´çš„ TCP ä¸‰æ¬¡æ¡æ‰‹æˆ– UDP åŒå‘é€šè®¯çŠ¶æ€ã€‚å› æ­¤ï¼ŒROS ä¼šå°†è¿™äº›åŒ…æ ‡è®°ä¸º invalidï¼ˆæ— æ•ˆçŠ¶æ€ï¼‰ã€‚ åœ¨ä½ åŸæ¥çš„æ—§é…ç½®ä¸­ï¼Œå› ä¸ºç¼ºå°‘ FORWARD é“¾çš„æ‹¦æˆªè§„åˆ™ï¼Œè¿™äº›åŒ…è¢«é»˜è®¤æ”¾è¡Œäº†ï¼›è€Œæ–°é…ç½®è¡¥é½äº†è¿™æ¡ä¸¥è‹›çš„æ‹¦æˆªè§„åˆ™ï¼Œåè€Œå¯¼è‡´ Telegram è¿æ¥å¡é¡¿ï¼ˆç­‰å¾…è¶…æ—¶åå›é€€å…¶ä»–åè®®ï¼‰ä»¥åŠè‹±é›„è”ç›Ÿç¾æœï¼ˆä¾èµ–å¤§é‡ UDP æŠ¥æ–‡ï¼‰æ–­è¿ã€‚\næˆåŠŸçš„æ­¥éª¤å’Œæ–¹æ³• è§£å†³åŠæ³•éå¸¸ç®€å•ï¼Œåªéœ€ç¦ç”¨æˆ–åˆ é™¤è½¬å‘é“¾ä¸­çš„æ— æ•ˆåŒ…æ‹¦æˆªè§„åˆ™ï¼Œå°†è¿™éƒ¨åˆ†å®¹é”™ç©ºé—´è¿˜ç»™æ—è·¯ç”±ç½‘ç»œã€‚\nè¯·åœ¨ RouterOS ç»ˆç«¯ä¸­ç›´æ¥å¤åˆ¶æ‰§è¡Œä»¥ä¸‹ä¸¤è¡Œä»£ç ï¼š\n# 1. åœç”¨ IPv4 è½¬å‘é“¾ä¸­çš„æ— æ•ˆåŒ…æ‹¦æˆª /ip firewall filter disable [find chain=forward connection-state=invalid] # 2. åœç”¨ IPv6 è½¬å‘é“¾ä¸­çš„æ— æ•ˆåŒ…æ‹¦æˆª /ipv6 firewall filter disable [find chain=forward connection-state=invalid] æˆ–è€…ç›´æ¥åˆ é™¤ï¼š ä¸ºäº†ä¿æŒé…ç½®çš„æ•´æ´ï¼Œå»ºè®®ç›´æ¥å°†è¿™ä¸¤æ¡å·²ç»ç¦ç”¨çš„æ— ç”¨è§„åˆ™å½»åº•åˆ é™¤ã€‚è¯·åœ¨ç»ˆç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\nä»£ç æ®µ\nå½»åº•ç§»é™¤å·²è¢«åœç”¨çš„æ— æ•ˆåŒ…æ‹¦æˆªè§„åˆ™ /ip firewall filter remove [find chain=forward connection-state=invalid disabled=yes] /ipv6 firewall filter remove [find chain=forward connection-state=invalid disabled=yes] æ‰§è¡Œå®Œæ¯•åï¼Œæ‰€æœ‰ invalid çŠ¶æ€çš„æ•°æ®åŒ…ä¼šç›´æ¥è·³è¿‡è¯¥è§„åˆ™ï¼Œè½å…¥åé¢çš„ Allow LAN forward è¢«æ­£å¸¸æ”¾è¡Œã€‚ä½ å¯ä»¥ç«‹å³é‡æ–°æ‰“å¼€ Telegram å’Œè‹±é›„è”ç›Ÿç¾æœæµ‹è¯•ï¼Œç½‘ç»œåº”è¯¥ä¼šç¬é—´æ¢å¤å¦‚åˆï¼Œä½ çš„ç½‘ç»œæ—¢èƒ½äº«å—å…¨é€Ÿçš„ Fasttrack ç¡¬ä»¶åŠ é€Ÿï¼Œåˆèƒ½å®Œç¾å…¼å®¹ 10.20.20.6 çš„é€æ˜ä»£ç†åˆ†æµï¼ŒåŒæ—¶ä¿æŒç€æé«˜çš„ä¼ä¸šçº§å®‰å…¨é˜²å¾¡æ ‡å‡†ã€‚\nç»“æŸï¼ å¦‚åˆ›å»ºäº†interface listï¼Œé˜²ç«å¢™çš„é…ç½®æ–¹æ¡ˆï¼š 1. åˆ›å»ºåˆ—è¡¨åç§° /interface list add name=WAN add name=LAN 2. å°† pppoe-out1 åŠ å…¥ WAN åˆ—è¡¨ /interface list member add interface=pppoe-out1 list=WAN 3. å°† bridge1 åŠ å…¥ LAN åˆ—è¡¨ add interface=bridge1 list=LAN å¸¦æ·»åŠ æ—è·¯ç”±ipè§„åˆ™ç‰ˆ (mosdns+sb)ï¼š # ========================================== # ç¬¬ä¸€éƒ¨åˆ†ï¼šIPv4 é˜²ç«å¢™è§„åˆ™ (å·²é€‚é… Interface List) # ========================================== /ip firewall filter # --- å…¥ç«™é“¾ (INPUT) - ä¿æŠ¤è·¯ç”±å™¨æœ¬ä½“ --- add action=accept chain=input comment=\u0026#34;1. Accept established,related,untracked\u0026#34; connection-state=established,related,untracked add action=drop chain=input comment=\u0026#34;2. Drop invalid\u0026#34; connection-state=invalid add action=accept chain=input comment=\u0026#34;3. Accept LAN (Internal Admin)\u0026#34; in-interface-list=LAN # é˜²çˆ†ç ´é€»è¾‘ add action=drop chain=input comment=\u0026#34;4. Drop Bruteforce IPs\u0026#34; dst-port=3981,2222 protocol=tcp src-address-list=bruteforce_blacklist add action=accept chain=input comment=\u0026#34;5. Accept limited connections\u0026#34; connection-limit=10,32 dst-port=3981,2222 protocol=tcp add action=add-src-to-address-list address-list=bruteforce_blacklist address-list-timeout=3d chain=input comment=\u0026#34;6. Add to Bruteforce List\u0026#34; dst-port=3981,2222 protocol=tcp add action=drop chain=input comment=\u0026#34;7. Drop excess packets\u0026#34; dst-port=3981,2222 protocol=tcp # WANå£ä¸¢å¼ƒå…œåº• add action=drop chain=input comment=\u0026#34;8. Drop ICMP from WAN\u0026#34; in-interface-list=WAN protocol=icmp add action=drop chain=input comment=\u0026#34;9. Drop all other input from WAN\u0026#34; in-interface-list=WAN # --- è½¬å‘é“¾ (FORWARD) - ç©¿è¿‡è·¯ç”±å™¨ --- # 1. æ—è·¯ç”±è±å… add action=accept chain=forward comment=\u0026#34;1. Bypass Fasttrack \u0026amp; Tracking: sing-box out\u0026#34; src-address=10.20.20.6 add action=accept chain=forward comment=\u0026#34;2. Bypass Fasttrack \u0026amp; Tracking: sing-box in\u0026#34; dst-address=10.20.20.6 # 2. ç¡¬ä»¶åŠ é€Ÿ add action=fasttrack-connection chain=forward comment=\u0026#34;3. Fasttrack\u0026#34; connection-state=established,related # 3. åŸºç¡€çŠ¶æ€æ”¾è¡Œä¸ä¸¢å¼ƒ add action=accept chain=forward comment=\u0026#34;4. Accept established,related,untracked\u0026#34; connection-state=established,related,untracked # 4. å†…ç½‘æ­£å¸¸è½¬å‘ä¸ç«¯å£æ˜ å°„æ”¾è¡Œ add action=accept chain=forward comment=\u0026#34;6. Allow LAN forward (Internal Outbound)\u0026#34; in-interface-list=LAN add action=accept chain=forward comment=\u0026#34;7. Allow DSTNAT (Port Forwarding)\u0026#34; connection-nat-state=dstnat in-interface-list=WAN # 5. å…¨å±€å…œåº•æ‹¦æˆª add action=drop chain=forward comment=\u0026#34;8. Drop all other forward\u0026#34; # ========================================== # ç¬¬äºŒéƒ¨åˆ†ï¼šIPv6 é˜²ç«å¢™è§„åˆ™ (å·²é€‚é… Interface List) # ========================================== /ipv6 firewall filter # --- å…¥ç«™é“¾ (INPUT) - ä¿æŠ¤è·¯ç”±å™¨æœ¬ä½“ --- add action=accept chain=input comment=\u0026#34;1. Accept established,related,untracked\u0026#34; connection-state=established,related,untracked add action=drop chain=input comment=\u0026#34;2. Drop invalid\u0026#34; connection-state=invalid add action=accept chain=input comment=\u0026#34;3. Accept ICMPv6 (Critical for IPv6)\u0026#34; protocol=icmpv6 add action=accept chain=input comment=\u0026#34;4. Allow DHCPv6 Client from WAN\u0026#34; dst-port=546 in-interface-list=WAN protocol=udp src-address=fe80::/10 add action=accept chain=input comment=\u0026#34;5. Allow LAN (Internal Admin)\u0026#34; in-interface-list=LAN add action=drop chain=input comment=\u0026#34;6. Drop all not from LAN\u0026#34; in-interface-list=!LAN # --- è½¬å‘é“¾ (FORWARD) - ç©¿è¿‡è·¯ç”±å™¨ --- # 1. æ—è·¯ç”±è±å… add action=accept chain=forward comment=\u0026#34;1. Bypass Fasttrack \u0026amp; Tracking: sing-box out\u0026#34; src-address=fd88::6666 add action=accept chain=forward comment=\u0026#34;2. Bypass Fasttrack \u0026amp; Tracking: sing-box in\u0026#34; dst-address=fd88::6666 # 2. ç¡¬ä»¶åŠ é€Ÿ add action=fasttrack-connection chain=forward comment=\u0026#34;3. Fasttrack\u0026#34; connection-state=established,related # 3. åŸºç¡€çŠ¶æ€æ”¾è¡Œ add action=accept chain=forward comment=\u0026#34;4. Accept forward established,related,untracked\u0026#34; connection-state=established,related,untracked # 4. æ ¸å¿ƒåè®®ä¸å†…ç½‘æ”¾è¡Œ add action=accept chain=forward comment=\u0026#34;6. Accept Forward ICMPv6\u0026#34; protocol=icmpv6 add action=accept chain=forward comment=\u0026#34;7. Allow LAN forward (Internal Outbound)\u0026#34; in-interface-list=LAN # 5. æš´éœ²å†…ç½‘æœåŠ¡ (æ›¿æ¢ä¸ºå®é™…å…¬ç½‘ IPv6 åœ°å€åå†æŒ‰éœ€å¯ç”¨) add action=accept chain=forward comment=\u0026#34;8. Allow NPM (HTTP/HTTPS)\u0026#34; disabled=yes dst-address=240e::xxxx:xxxx dst-port=80,443 protocol=tcp add action=accept chain=forward comment=\u0026#34;9. Allow Hysteria2/Proxy\u0026#34; disabled=yes dst-address=240e::xxxx:xxxx dst-port=36789 protocol=udp add action=accept chain=forward comment=\u0026#34;10. Allow Shadowsocks\u0026#34; disabled=yes dst-address=240e::xxxx:xxxx dst-port=36789 protocol=tcp # 6. å…œåº•æ‹¦æˆª add action=drop chain=forward comment=\u0026#34;11. Drop all other forward (Protect LAN)\u0026#34; ä¸æ·»åŠ æ—è·¯ç”±ipè§„åˆ™ç‰ˆ (mosdns+sb): # ========================================== # ç¬¬ä¸€éƒ¨åˆ†ï¼šIPv4 é˜²ç«å¢™è§„åˆ™ (å·²é€‚é… Interface List) # ========================================== /ip firewall filter # --- å…¥ç«™é“¾ (INPUT) - ä¿æŠ¤è·¯ç”±å™¨æœ¬ä½“ --- add action=accept chain=input comment=\u0026#34;1. Accept established,related,untracked\u0026#34; connection-state=established,related,untracked add action=drop chain=input comment=\u0026#34;2. Drop invalid\u0026#34; connection-state=invalid add action=accept chain=input comment=\u0026#34;3. Accept LAN (Internal Admin)\u0026#34; in-interface-list=LAN # é˜²çˆ†ç ´é€»è¾‘ add action=drop chain=input comment=\u0026#34;4. Drop Bruteforce IPs\u0026#34; dst-port=3981,2222 protocol=tcp src-address-list=bruteforce_blacklist add action=accept chain=input comment=\u0026#34;5. Accept limited connections\u0026#34; connection-limit=10,32 dst-port=3981,2222 protocol=tcp add action=add-src-to-address-list address-list=bruteforce_blacklist address-list-timeout=3d chain=input comment=\u0026#34;6. Add to Bruteforce List\u0026#34; dst-port=3981,2222 protocol=tcp add action=drop chain=input comment=\u0026#34;7. Drop excess packets\u0026#34; dst-port=3981,2222 protocol=tcp # WANå£ä¸¢å¼ƒå…œåº• add action=drop chain=input comment=\u0026#34;8. Drop ICMP from WAN\u0026#34; in-interface-list=WAN protocol=icmp add action=drop chain=input comment=\u0026#34;9. Drop all other input from WAN\u0026#34; in-interface-list=WAN # --- è½¬å‘é“¾ (FORWARD) - ç©¿è¿‡è·¯ç”±å™¨ --- # 1. ç¡¬ä»¶åŠ é€Ÿ add action=fasttrack-connection chain=forward comment=\u0026#34;3. Fasttrack\u0026#34; connection-state=established,related # 2. åŸºç¡€çŠ¶æ€æ”¾è¡Œä¸ä¸¢å¼ƒ add action=accept chain=forward comment=\u0026#34;4. Accept established,related,untracked\u0026#34; connection-state=established,related,untracked add action=drop chain=forward comment=\u0026#34;5. Drop invalid\u0026#34; connection-state=invalid # 3. å†…ç½‘æ­£å¸¸è½¬å‘ä¸ç«¯å£æ˜ å°„æ”¾è¡Œ add action=accept chain=forward comment=\u0026#34;6. Allow LAN forward (Internal Outbound)\u0026#34; in-interface-list=LAN add action=accept chain=forward comment=\u0026#34;7. Allow DSTNAT (Port Forwarding)\u0026#34; connection-nat-state=dstnat in-interface-list=WAN # 4. å…¨å±€å…œåº•æ‹¦æˆª add action=drop chain=forward comment=\u0026#34;8. Drop all other forward\u0026#34; # ========================================== # ç¬¬äºŒéƒ¨åˆ†ï¼šIPv6 é˜²ç«å¢™è§„åˆ™ (å·²é€‚é… Interface List) # ========================================== /ipv6 firewall filter # --- å…¥ç«™é“¾ (INPUT) - ä¿æŠ¤è·¯ç”±å™¨æœ¬ä½“ --- add action=accept chain=input comment=\u0026#34;1. Accept established,related,untracked\u0026#34; connection-state=established,related,untracked add action=drop chain=input comment=\u0026#34;2. Drop invalid\u0026#34; connection-state=invalid add action=accept chain=input comment=\u0026#34;3. Accept ICMPv6 (Critical for IPv6)\u0026#34; protocol=icmpv6 add action=accept chain=input comment=\u0026#34;4. Allow DHCPv6 Client from WAN\u0026#34; dst-port=546 in-interface-list=WAN protocol=udp src-address=fe80::/10 add action=accept chain=input comment=\u0026#34;5. Allow LAN (Internal Admin)\u0026#34; in-interface-list=LAN add action=drop chain=input comment=\u0026#34;6. Drop all not from LAN\u0026#34; in-interface-list=!LAN # --- è½¬å‘é“¾ (FORWARD) - ç©¿è¿‡è·¯ç”±å™¨ --- # 1. ç¡¬ä»¶åŠ é€Ÿ add action=fasttrack-connection chain=forward comment=\u0026#34;3. Fasttrack\u0026#34; connection-state=established,related # 2. åŸºç¡€çŠ¶æ€æ”¾è¡Œä¸ä¸¢å¼ƒ add action=accept chain=forward comment=\u0026#34;4. Accept forward established,related,untracked\u0026#34; connection-state=established,related,untracked add action=drop chain=forward comment=\u0026#34;5. Drop invalid\u0026#34; connection-state=invalid # 3. æ ¸å¿ƒåè®®ä¸å†…ç½‘æ”¾è¡Œ add action=accept chain=forward comment=\u0026#34;6. Accept Forward ICMPv6\u0026#34; protocol=icmpv6 add action=accept chain=forward comment=\u0026#34;7. Allow LAN forward (Internal Outbound)\u0026#34; in-interface-list=LAN # 4. æš´éœ²å†…ç½‘æœåŠ¡ (æ›¿æ¢ä¸ºå®é™…å…¬ç½‘ IPv6 åœ°å€åå†æŒ‰éœ€å¯ç”¨) add action=accept chain=forward comment=\u0026#34;8. Allow NPM (HTTP/HTTPS)\u0026#34; disabled=yes dst-address=240e::xxxx:xxxx dst-port=80,443 protocol=tcp add action=accept chain=forward comment=\u0026#34;9. Allow Hysteria2/Proxy\u0026#34; disabled=yes dst-address=240e::xxxx:xxxx dst-port=36789 protocol=udp add action=accept chain=forward comment=\u0026#34;10. Allow Shadowsocks\u0026#34; disabled=yes dst-address=240e::xxxx:xxxx dst-port=36789 protocol=tcp # 5. å…œåº•æ‹¦æˆª add action=drop chain=forward comment=\u0026#34;11. Drop all other forward (Protect LAN)\u0026#34; IPV6çš„NDç…§ç€æ“ä½œå³å¯ ","permalink":"https://hanigege.github.io/posts/routers/05.routeros%E5%A6%82%E4%BD%95nat%E5%9B%9E%E6%B5%81/","tags":null,"title":"05.RouterOSå¦‚ä½•natå›æµåŠåŒ…å«é…å¥—é˜²ç«å¢™è§„åˆ™"},{"categories":["routers"],"contents":"æœ¬æ•™ç¨‹ä»‹ç»ä½¿ç”¨ queue tree å¼€å¯ ROS çš„æµæ§åŠŸèƒ½ æœ¬æ•™ç¨‹ä»‹ç»å¦‚ä½•ä½¿ç”¨ RouterOS çš„ queue tree å®ç°æµé‡æ•´å½¢ã€‚ æ–‡ç« åˆ†æˆä¸¤ç§æ–¹æ¡ˆï¼š\nä¸º DNSã€Web ç­‰å°åŒ…æµé‡è®¾ç½®æ›´é«˜ä¼˜å…ˆçº§ï¼Œæé«˜ç½‘é¡µå“åº”é€Ÿåº¦ï¼Œé€‚åˆä¸€èˆ¬ç”¨æˆ·ï¼› ä¸ºå®½å¸¦åŠç‰¹å®šæœåŠ¡è®¾å®šä¸Šä¼ /ä¸‹è½½é™é€Ÿï¼Œå¹¶æŒ‰æœåŠ¡è®¾å®šä¼˜å…ˆçº§ï¼Œé€‚åˆ BT/PT ç­‰å¤§æµé‡åº”ç”¨ç”¨æˆ·ã€‚ 1ã€ä¸º DNSã€Web ç­‰å°åŒ…æµé‡è®¾ç½®æ›´é«˜ä¼˜å…ˆçº§ï¼Œæé«˜ç½‘é¡µå“åº”é€Ÿåº¦ï¼Œé€‚åˆä¸€èˆ¬ç”¨æˆ·ä½¿ç”¨ã€‚ æ·»åŠ queue type /queue type add fq-codel-flows=128 fq-codel-interval=30ms fq-codel-limit=128 fq-codel-memlimit=4096.0KiB fq-codel-quantum=512 fq-codel-target=3ms kind=fq-codel name=Fq_Codel_Dns_Up /queue type add fq-codel-flows=256 fq-codel-interval=30ms fq-codel-limit=128 fq-codel-memlimit=8.0MiB fq-codel-quantum=512 fq-codel-target=3ms kind=fq-codel name=Fq_Codel_Dns_Down /queue type add fq-codel-flows=512 fq-codel-interval=50ms fq-codel-limit=512 fq-codel-memlimit=8.0MiB fq-codel-quantum=512 fq-codel-target=5ms kind=fq-codel name=Fq_Codel_Small_Up /queue type add fq-codel-flows=512 fq-codel-interval=50ms fq-codel-limit=512 fq-codel-memlimit=16.0MiB fq-codel-quantum=512 fq-codel-target=5ms kind=fq-codel name=Fq_Codel_Small_Down /queue type add fq-codel-flows=512 fq-codel-interval=50ms fq-codel-limit=2048 fq-codel-memlimit=64.0MiB fq-codel-quantum=1400 fq-codel-target=5ms kind=fq-codel name=Fq_Codel_Web_Up /queue type add fq-codel-flows=1024 fq-codel-interval=50ms fq-codel-limit=4096 fq-codel-memlimit=128.0MiB fq-codel-quantum=1500 fq-codel-target=5ms kind=fq-codel name=Fq_Codel_Web_Down /queue type add fq-codel-flows=1024 fq-codel-interval=100ms fq-codel-limit=8192 fq-codel-memlimit=128.0MiB fq-codel-quantum=1400 fq-codel-target=8ms kind=fq-codel name=Fq_Codel_Stream_Up /queue type add fq-codel-flows=2048 fq-codel-interval=100ms fq-codel-limit=10240 fq-codel-memlimit=256.0MiB fq-codel-quantum=1500 fq-codel-target=8ms kind=fq-codel name=Fq_Codel_Stream_Down /queue type add fq-codel-flows=2048 fq-codel-interval=100ms fq-codel-limit=10240 fq-codel-memlimit=128.0MiB fq-codel-quantum=1400 fq-codel-target=20ms kind=fq-codel name=Fq_Codel_Nomark_Up /queue type add fq-codel-flows=4096 fq-codel-interval=100ms fq-codel-limit=10240 fq-codel-memlimit=256.0MiB fq-codel-quantum=1500 fq-codel-target=15ms kind=fq-codel name=Fq_Codel_Nomark_Down é…ç½® queue tree è‡ªè¡Œä¿®æ”¹æ¡¥çš„åç§°ï¼ˆbridge1ï¼‰åŠpppoeæ‹¨å·å£ï¼ˆpppoe-out1ï¼‰çš„åç§°\næ³¨ï¼šä¸‹è¡ŒDownï¼Œé…ç½®äº†bridgeåˆ™ç”¨beidgeï¼Œæœªé…ç½®åˆ™ç”¨lanç½‘å¡ /queue tree add bucket-size=0.005 name=Dns-packet-Down packet-mark=Dns-packet parent=bridge1 priority=1 queue=Fq_Codel_Dns_Down /queue tree add bucket-size=0.01 name=Small-packet-Down packet-mark=Small-packet parent=bridge1 priority=2 queue=Fq_Codel_Small_Down /queue tree add bucket-size=0.03 name=Web-packet-Down packet-mark=Web-packet parent=bridge1 priority=3 queue=Fq_Codel_Web_Down /queue tree add bucket-size=0.06 name=Stream-Packet-Down packet-mark=Stream-packet parent=bridge1 priority=4 queue=Fq_Codel_Stream_Down /queue tree add bucket-size=0.1 name=Nomark-Packet-Down packet-mark=no-mark parent=bridge1 priority=6 queue=Fq_Codel_Nomark_Down æ³¨ï¼šä¸Šè¡ŒUPï¼Œæ¥å£ç›´æ¥ç”¨ç½‘å¡wan /queue tree add bucket-size=0.005 name=Dns-packet-Up packet-mark=Dns-packet parent=wan priority=1 queue=Fq_Codel_Dns_Up /queue tree add bucket-size=0.01 name=Small-packet-Up packet-mark=Small-packet parent=wan priority=2 queue=Fq_Codel_Small_Up /queue tree add bucket-size=0.03 name=Web-packet-Up packet-mark=Web-packet parent=wan priority=3 queue=Fq_Codel_Web_Up /queue tree add bucket-size=0.06 name=Stream-Packet-Up packet-mark=Stream-packet parent=wan priority=4 queue=Fq_Codel_Stream_Up /queue tree add bucket-size=0.1 name=Nomark-Packet-Up packet-mark=no-mark parent=wan priority=6 queue=Fq_Codel_Nomark_Up ipv4é˜²ç«å¢™ä¸­ä½¿ç”¨mangleæ ‡è®°ä¸åŒç±»å‹çš„æµé‡ï¼ˆå¯ç›´æ¥å¤åˆ¶ï¼Œä¸ç”¨ä¿®æ”¹ï¼‰ ä¸‹é¢ç¤ºä¾‹ä¸º IPv4 çš„ mangle æ ‡è®°è§„åˆ™ï¼š\n/ip firewall mangle add action=mark-packet chain=prerouting new-packet-mark=Dns-packet passthrough=no port=53 protocol=udp /ip firewall mangle add action=mark-packet chain=prerouting new-packet-mark=Dns-packet passthrough=no port=53,853 protocol=tcp /ip firewall mangle add action=mark-packet chain=prerouting new-packet-mark=Web-packet packet-mark=no-mark passthrough=no port=80,443,8080 protocol=tcp /ip firewall mangle add action=mark-packet chain=prerouting new-packet-mark=Web-packet packet-mark=no-mark passthrough=no port=80,443,8080 protocol=udp /ip firewall mangle add action=mark-packet chain=prerouting new-packet-mark=Small-packet packet-mark=no-mark packet-size=0-512 connection-bytes=0-256k passthrough=no /ip firewall mangle add action=mark-packet chain=prerouting new-packet-mark=Stream-packet packet-mark=no-mark passthrough=no /ip firewall mangle add action=mark-packet chain=forward new-packet-mark=Dns-packet passthrough=no port=53 protocol=udp /ip firewall mangle add action=mark-packet chain=forward new-packet-mark=Dns-packet passthrough=no port=53,853 protocol=tcp /ip firewall mangle add action=mark-packet chain=forward new-packet-mark=Web-packet packet-mark=no-mark passthrough=no port=80,443,8080 protocol=tcp /ip firewall mangle add action=mark-packet chain=forward new-packet-mark=Web-packet packet-mark=no-mark passthrough=no port=80,443,8080 protocol=udp /ip firewall mangle add action=mark-packet chain=forward new-packet-mark=Small-packet packet-mark=no-mark packet-size=0-512 connection-bytes=0-256k passthrough=no /ip firewall mangle add action=mark-packet chain=forward new-packet-mark=Stream-packet packet-mark=no-mark passthrough=no ipv6é˜²ç«å¢™ä¸­ä½¿ç”¨mangleæ ‡è®°ä¸åŒç±»å‹çš„æµé‡ï¼ˆå¯ç›´æ¥å¤åˆ¶ï¼Œä¸ç”¨ä¿®æ”¹ï¼‰\n/ipv6 firewall mangle add action=mark-packet chain=prerouting new-packet-mark=Dns-packet passthrough=no port=53 protocol=udp /ipv6 firewall mangle add action=mark-packet chain=prerouting new-packet-mark=Dns-packet passthrough=no port=53,853 protocol=tcp /ipv6 firewall mangle add action=mark-packet chain=prerouting new-packet-mark=Web-packet packet-mark=no-mark passthrough=no port=80,443,8080 protocol=tcp /ipv6 firewall mangle add action=mark-packet chain=prerouting new-packet-mark=Web-packet packet-mark=no-mark passthrough=no port=80,443,8080 protocol=udp /ipv6 firewall mangle add action=mark-packet chain=prerouting new-packet-mark=Small-packet packet-mark=no-mark packet-size=0-512 passthrough=no /ipv6 firewall mangle add action=mark-packet chain=prerouting new-packet-mark=Stream-packet packet-mark=no-mark passthrough=no /ipv6 firewall mangle add action=mark-packet chain=forward new-packet-mark=Dns-packet passthrough=no port=53 protocol=udp /ipv6 firewall mangle add action=mark-packet chain=forward new-packet-mark=Dns-packet passthrough=no port=53,853 protocol=tcp /ipv6 firewall mangle add action=mark-packet chain=forward new-packet-mark=Web-packet packet-mark=no-mark passthrough=no port=80,443,8080 protocol=tcp /ipv6 firewall mangle add action=mark-packet chain=forward new-packet-mark=Web-packet packet-mark=no-mark passthrough=no port=80,443,8080 protocol=udp /ipv6 firewall mangle add action=mark-packet chain=forward new-packet-mark=Small-packet packet-mark=no-mark packet-size=0-512 connection-bytes=0-256k passthrough=no /ipv6 firewall mangle add action=mark-packet chain=forward new-packet-mark=Stream-packet packet-mark=no-mark passthrough=no 2ã€ä¸ºå®½å¸¦åŠç‰¹å®šæœåŠ¡è®¾å®šä¸Šä¼ ä¸‹è½½é™é€Ÿï¼Œå¹¶æŒ‰æœåŠ¡è®¾å®šä¼˜å…ˆçº§ï¼Œä¸»è¦é€‚åˆPTã€BTç”¨æˆ·ï¼ŒPCDNä¹Ÿå¯å‚è€ƒä½¿ç”¨ï¼Œä¸€èˆ¬å®¶ç”¨ç”¨ç¬¬ä¸€ç§å³å¯ æ·»åŠ queue typeï¼Œä¸ºæ¯ä¸ªç±»å‹çš„æµé‡æ·»åŠ ä¸€ä¸ªtype\n/queue type set 1 pfifo-limit=256 add fq-codel-flows=128 fq-codel-interval=30ms fq-codel-limit=128 fq-codel-memlimit=4096.0KiB fq-codel-quantum=512 fq-codel-target=3ms kind=fq-codel name=Fq_Codel_Dns_Up add fq-codel-flows=256 fq-codel-interval=30ms fq-codel-limit=128 fq-codel-memlimit=8.0MiB fq-codel-quantum=512 fq-codel-target=3ms kind=fq-codel name=Fq_Codel_Dns_Down add fq-codel-flows=512 fq-codel-interval=50ms fq-codel-limit=512 fq-codel-memlimit=8.0MiB fq-codel-quantum=512 kind=fq-codel name=Fq_Codel_Small_Up add fq-codel-flows=512 fq-codel-interval=50ms fq-codel-limit=512 fq-codel-memlimit=16.0MiB fq-codel-quantum=512 kind=fq-codel name=Fq_Codel_Small_Down add fq-codel-flows=512 fq-codel-interval=50ms fq-codel-limit=2048 fq-codel-memlimit=64.0MiB fq-codel-quantum=1400 kind=fq-codel name=Fq_Codel_Web_Up add fq-codel-interval=50ms fq-codel-limit=4096 fq-codel-memlimit=128.0MiB fq-codel-quantum=1500 kind=fq-codel name=Fq_Codel_Web_Down add fq-codel-limit=8192 fq-codel-memlimit=128.0MiB fq-codel-quantum=1400 fq-codel-target=8ms kind=fq-codel name=Fq_Codel_Pt_Up add fq-codel-flows=2048 fq-codel-limit=8192 fq-codel-memlimit=256.0MiB fq-codel-quantum=1500 fq-codel-target=8ms kind=fq-codel name=Fq_Codel_Pt_Down add fq-codel-flows=2048 fq-codel-limit=8192 fq-codel-memlimit=128.0MiB fq-codel-quantum=1400 fq-codel-target=20ms kind=fq-codel name=Fq_Codel_Nomark_Up add fq-codel-flows=4096 fq-codel-limit=8192 fq-codel-memlimit=256.0MiB fq-codel-quantum=1500 fq-codel-target=15ms kind=fq-codel name=Fq_Codel_Nomark_Down add fq-codel-flows=2048 fq-codel-limit=8192 fq-codel-memlimit=128.0MiB fq-codel-quantum=1500 kind=fq-codel name=Fq_Codel_Down add fq-codel-flows=2048 fq-codel-interval=50ms fq-codel-limit=4096 fq-codel-memlimit=64.0MiB fq-codel-quantum=1480 kind=fq-codel name=Fq_Codel_Up ipv4é˜²ç«å¢™ä¸­ä½¿ç”¨mangleæ ‡è®°éœ€è®¾å®šä¼˜å…ˆçº§çš„æµé‡ é€šè¿‡ç«¯å£æ ‡è®°DNSæµé‡ /ip firewall mangle add action=mark-packet chain=prerouting comment=DNS disabled=yes new-packet-mark=Dns-packet passthrough=no port=53 protocol=udp /ip firewall mangle add action=mark-packet chain=prerouting comment=DNS disabled=yes new-packet-mark=Dns-packet passthrough=no port=53,853 protocol=tcp /ip firewall mangle add action=mark-packet chain=forward comment=DNS disabled=yes new-packet-mark=Dns-packet passthrough=no port=53 protocol=udp /ip firewall mangle add action=mark-packet chain=forward comment=DNS disabled=yes new-packet-mark=Dns-packet passthrough=no port=53,853 protocol=tcp é€šè¿‡ç«¯å£æ ‡è®°WEBæµé‡ /ip firewall mangle add action=mark-packet chain=prerouting comment=WEB disabled=yes new-packet-mark=Web-packet packet-mark=no-mark passthrough=no port=80,443,8080 protocol=tcp /ip firewall mangle add action=mark-packet chain=prerouting comment=WEB disabled=yes new-packet-mark=Web-packet packet-mark=no-mark passthrough=no port=80,443,8080 protocol=udp /ip firewall mangle add action=mark-packet chain=forward comment=WEB disabled=yes new-packet-mark=Web-packet packet-mark=no-mark passthrough=no port=80,443,8080 protocol=tcp /ip firewall mangle add action=mark-packet chain=forward comment=WEB disabled=yes new-packet-mark=Web-packet packet-mark=no-mark passthrough=no port=80,443,8080 protocol=udp é€šè¿‡åŒ…å¤§å°æ ‡è®°å°åŒ…æµé‡ /ip firewall mangle add action=mark-packet chain=prerouting comment=SMALL connection-bytes=0-256000 disabled=yes new-packet-mark=Small-packet packet-mark=no-mark packet-size=0-512 passthrough=no /ip firewall mangle add action=mark-packet chain=forward comment=SMALL connection-bytes=0-256000 disabled=yes new-packet-mark=Small-packet packet-mark=no-mark packet-size=0-512 passthrough=no é€šè¿‡macåœ°å€æˆ–IPåœ°å€æ ‡è®°qbçš„æµé‡ï¼Œå¯åŒæ—¶æ ‡è®°2ä¸ªqbï¼Œå…¶ä¸Šä¼ åŠä¸‹è½½é€Ÿåº¦å°†åŠ æ€»ååšé™åˆ¶ /ip firewall mangle add action=mark-connection chain=prerouting comment=qB-1 new-connection-mark=PT-conection src-address=10.0.0.55 /ip firewall mangle add action=mark-connection chain=prerouting comment=qB-2 new-connection-mark=PT-conection src-mac-address=02:42:0A:00:00:1F /ip firewall mangle add action=mark-packet chain=prerouting comment=PT connection-mark=PT-conection new-packet-mark=qBittorent_packet passthrough=no /ip firewall mangle add action=mark-connection chain=forward comment=qB-1 disabled=yes new-connection-mark=PT-conection src-address=10.0.0.55 /ip firewall mangle add action=mark-connection chain=forward comment=qB-2 disabled=yes new-connection-mark=PT-conection src-mac-address=02:42:0A:00:00:1F /ip firewall mangle add action=mark-packet chain=forward comment=PT connection-mark=PT-conection disabled=yes new-packet-mark=qBittorent_packet passthrough=no å»ºè®®æ ¹æ®æˆªå›¾é‡æ–°æ’åº åœ¨ipv6ä¸­åšç›¸åŒçš„mangleï¼Œæ³¨æ„markæ ‡è®°é€‰æ‹©ä¸v4æ—¶é…ç½®çš„ä¸€è‡´ é€šè¿‡ç«¯å£æ ‡è®°DNSæµé‡ /ipv6 firewall mangle add action=mark-packet chain=prerouting comment=DNS disabled=yes new-packet-mark=Dns-packet passthrough=no port=53 protocol=udp /ipv6 firewall mangle add action=mark-packet chain=prerouting comment=DNS disabled=yes new-packet-mark=Dns-packet passthrough=no port=53,853 protocol=tcp /ipv6 firewall mangle add action=mark-packet chain=forward comment=DNS disabled=yes new-packet-mark=Dns-packet passthrough=no port=53 protocol=udp /ipv6 firewall mangle add action=mark-packet chain=forward comment=DNS disabled=yes new-packet-mark=Dns-packet passthrough=no port=53,853 protocol=tcp é€šè¿‡ç«¯å£æ ‡è®°WEBæµé‡ /ipv6 firewall mangle add action=mark-packet chain=prerouting comment=WEB disabled=yes new-packet-mark=Web-packet packet-mark=no-mark passthrough=no port=80,443,8080 protocol=tcp /ipv6 firewall mangle add action=mark-packet chain=prerouting comment=WEB disabled=yes new-packet-mark=Web-packet packet-mark=no-mark passthrough=no port=80,443,8080 protocol=udp /ipv6 firewall mangle add action=mark-packet chain=forward comment=WEB disabled=yes new-packet-mark=Web-packet packet-mark=no-mark passthrough=no port=80,443,8080 protocol=tcp /ipv6 firewall mangle add action=mark-packet chain=forward comment=WEB disabled=yes new-packet-mark=Web-packet packet-mark=no-mark passthrough=no port=80,443,8080 protocol=udp é€šè¿‡åŒ…å¤§å°æ ‡è®°å°åŒ…æµé‡ /ipv6 firewall mangle add action=mark-packet chain=prerouting comment=SMALL connection-bytes=0-256000 disabled=yes new-packet-mark=Small-packet packet-mark=no-mark packet-size=0-512 passthrough=no /ipv6 firewall mangle add action=mark-packet chain=forward comment=SMALL connection-bytes=0-256000 disabled=yes new-packet-mark=Small-packet packet-mark=no-mark packet-size=0-512 passthrough=no é€šè¿‡macåœ°å€æˆ–IPåœ°å€æ ‡è®°qbçš„æµé‡ï¼Œå¯åŒæ—¶æ ‡è®°2ä¸ªqbï¼Œå…¶ä¸Šä¼ åŠä¸‹è½½é€Ÿåº¦å°†åŠ æ€»ååšé™åˆ¶é‡ /ipv6 firewall mangle add action=mark-connection chain=prerouting comment=qB-1 new-connection-mark=PT-conection src-address=dc00::1056 /ipv6 firewall mangle add action=mark-connection chain=prerouting comment=qB-2 new-connection-mark=PT-conection src-mac-address=02:42:0A:00:00:1F /ipv6 firewall mangle add action=mark-packet chain=prerouting comment=PT connection-mark=PT-conection new-packet-mark=qBittorent_packet passthrough=no /ipv6 firewall mangle add action=mark-connection chain=forward comment=qB-1 disabled=yes new-connection-mark=PT-conection src-address=dc00::1055 /ipv6 firewall mangle add action=mark-connection chain=forward comment=qB-2 disabled=yes new-connection-mark=PT-conection src-mac-address=02:42:0A:00:00:1F /ipv6 firewall mangle add action=mark-packet chain=forward comment=PT connection-mark=PT-conection disabled=yes new-packet-mark=qBittorent_packet passthrough=no å»ºè®®æ ¹æ®æˆªå›¾é‡æ–°æ’åº åœ¨queue treeé…ç½®æµé‡ä¼˜å…ˆçº§ã€‚åˆ†åˆ«å¯¹upä¸Šè¡Œå’Œdownä¸‹è¡Œæµé‡è¿›è¡Œæµæ§ã€‚ä¸Šä¸‹è¡Œæ€»å¸¦å®½åŠå„åº”ç”¨çš„ä¼˜å…ˆçº§ã€å…è®¸çš„æœ€å¤§ä¸Šä¸‹è¡Œï¼ŒBurst Limitçªå‘é€Ÿç‡ç­‰éœ€æ ¹æ®ä½¿ç”¨äººå…·ä½“æƒ…å†µé€æ­¥è°ƒè¯•è‡³æœ€ä½³çŠ¶å†µã€‚ æœ¬ä¾‹ä¸­ï¼ŒUPä¸­çš„50Mä¸ºå®½å¸¦ä¸Šä¼ æ€»ä¸Šé™ï¼ŒDOWNä¸­400Mä¸ºå®½å¸¦ä¸‹è½½æ€»ä¸Šé™ï¼Œå…¶ä½™å„ç±»å‹æµé‡é™é€Ÿå¯è‡ªè¡Œè°ƒæ•´ DNSæµé‡ä¼˜å…ˆçº§ä¸º1ï¼ˆæœ€é«˜ï¼‰ï¼Œå…¶æ¬¡ä¸ºå°åŒ…æµé‡ä¼˜å…ˆçº§ä¸º2ï¼ŒWEBæµé‡ä¼˜å…ˆçº§ä¸º3ï¼Œæœªè¢«æ ‡è®°çš„å…œåº•æµé‡ä¼˜å…ˆçº§ä¸º6ï¼ŒqBittorrentæµé‡ä¼˜å…ˆçº§ä¸ºæœ€ä½çš„7 /queue tree add bucket-size=0.05 max-limit=50M name=UP parent=wan queue=Fq_Codel_Up add bucket-size=0.005 max-limit=5M name=1_Dns_up packet-mark=Dns-packet parent=UP priority=1 queue=Fq_Codel_Dns_Up add bucket-size=0.01 max-limit=10M name=2_Small_up packet-mark=Small-packet parent=UP priority=2 queue=Fq_Codel_Small_Up add bucket-size=0.03 burst-limit=60M burst-threshold=10M burst-time=5s max-limit=55M name=3_Web_up packet-mark=Web-packet parent=UP priority=3 queue=Fq_Codel_Web_Up add burst-time=20s max-limit=55M name=6_Nomark_up packet-mark=no-mark parent=UP priority=6 queue=Fq_Codel_Nomark_Up add bucket-size=0.06 max-limit=50M name=7_qb_up packet-mark=qBittorent_packet parent=UP priority=7 queue=Fq_Codel_Pt_Up add bucket-size=0.05 max-limit=400M name=DOWN parent=lan queue=Fq_Codel_Down add bucket-size=0.005 limit-at=5M max-limit=5M name=1_Dns_down packet-mark=Dns-packet parent=DOWN priority=1 queue=Fq_Codel_Dns_Down add bucket-size=0.01 limit-at=10M max-limit=10M name=2_Small_down packet-mark=Small-packet parent=DOWN priority=2 queue=Fq_Codel_Small_Down add bucket-size=0.03 max-limit=400M name=3_Web_down packet-mark=Web-packet parent=DOWN priority=3 queue=Fq_Codel_Web_Down add max-limit=400M name=6_Nomark_down packet-mark=no-mark parent=DOWN priority=6 queue=Fq_Codel_Nomark_Down add bucket-size=0.06 max-limit=400M name=7_qb_down packet-mark=qBittorent_packet parent=DOWN priority=7 queue=Fq_Codel_Pt_Down ","permalink":"https://hanigege.github.io/posts/routers/04.routeros%E4%BD%BF%E7%94%A8queue_tree%E9%85%8D%E7%BD%AE%E6%B5%81%E9%87%8F%E6%95%B4%E5%BD%A2/","tags":null,"title":"04.RouterOSä½¿ç”¨queue_treeé…ç½®æµé‡æ•´å½¢"},{"categories":["routers"],"contents":"æœ¬æ–‡ä»‹ç»ä½¿ç”¨ FakeIP åˆ†æµæ³•å®ç°å±€åŸŸç½‘å†…è®¾å¤‡é€æ˜ä»£ç†æ—¶ï¼Œä¸»è·¯ç”± RouterOS éƒ¨åˆ†çš„è®¾ç½®ã€‚ æ³¨æ„ï¼šsing-box åŠ mosdns çš„å…·ä½“é…ç½®ä¸åœ¨æœ¬æ–‡è®¨è®ºèŒƒå›´å†…ã€‚ ä½œè€…ï¼šTom ç¯å¢ƒè®¾å®š sing-box IP: IPv4 10.0.0.2, IPv6 dc00::2222 FakeIP ç½‘æ®µ: IPv4 28.0.0.0/8, IPv6 f2b0::/18 æ³¨æ„: å¼€å¯ FastTrack å Mangle ä¼šå¤±æ•ˆï¼Œå»ºè®®ä½¿ç”¨ Route æˆ– Routing Rules æ–¹å¼ã€‚ æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ Mangle æ‰“æ ‡ç­¾æ–¹å¼ IPv4 éƒ¨åˆ† æ·»åŠ sing-box-v4è·¯ç”±è¡¨ï¼š /routing table add name=sing-box-v4 fib é…ç½®åœ°å€åˆ—è¡¨ï¼ˆåœ°å€åˆ—è¡¨ä¸­æ–°å¢proxy_ipv4åˆ—è¡¨ï¼Œå¡«å…¥fakeipç½‘æ®µã€tg v4ç½‘æ®µã€å¥ˆè²v4ç½‘æ®µï¼‰ï¼š /ip firewall address-list add list=proxy_ipv4 address=28.0.0.0/8 /ip firewall address-list add list=proxy_ipv4 address=1.1.1.1/32 /ip firewall address-list add list=proxy_ipv4 address=1.0.0.1/32 /ip firewall address-list add list=proxy_ipv4 address=8.8.8.8/32 /ip firewall address-list add list=proxy_ipv4 address=8.8.4.4/32 /ip firewall address-list add list=proxy_ipv4 address=8.41.4.0/24 /ip firewall address-list add list=proxy_ipv4 address=23.23.189.144/28 /ip firewall address-list add list=proxy_ipv4 address=23.246.0.0/18 /ip firewall address-list add list=proxy_ipv4 address=34.195.253.0/25 /ip firewall address-list add list=proxy_ipv4 address=37.77.184.0/21 /ip firewall address-list add list=proxy_ipv4 address=38.72.126.0/24 /ip firewall address-list add list=proxy_ipv4 address=45.57.0.0/17 /ip firewall address-list add list=proxy_ipv4 address=52.24.178.0/24 /ip firewall address-list add list=proxy_ipv4 address=52.35.140.0/24 /ip firewall address-list add list=proxy_ipv4 address=54.204.25.0/28 /ip firewall address-list add list=proxy_ipv4 address=54.213.167.0/24 /ip firewall address-list add list=proxy_ipv4 address=64.120.128.0/17 /ip firewall address-list add list=proxy_ipv4 address=66.197.128.0/17 /ip firewall address-list add list=proxy_ipv4 address=69.53.224.0/19 /ip firewall address-list add list=proxy_ipv4 address=103.87.204.0/22 /ip firewall address-list add list=proxy_ipv4 address=108.175.32.0/20 /ip firewall address-list add list=proxy_ipv4 address=185.2.220.0/22 /ip firewall address-list add list=proxy_ipv4 address=185.9.188.0/22 /ip firewall address-list add list=proxy_ipv4 address=192.173.64.0/18 /ip firewall address-list add list=proxy_ipv4 address=198.38.96.0/19 /ip firewall address-list add list=proxy_ipv4 address=198.45.48.0/20 /ip firewall address-list add list=proxy_ipv4 address=203.75.84.0/24 /ip firewall address-list add list=proxy_ipv4 address=203.198.13.0/24 /ip firewall address-list add list=proxy_ipv4 address=203.198.80.0/24 /ip firewall address-list add list=proxy_ipv4 address=207.45.72.0/22 /ip firewall address-list add list=proxy_ipv4 address=208.75.76.0/22 /ip firewall address-list add list=proxy_ipv4 address=210.0.153.0/24 /ip firewall address-list add list=proxy_ipv4 address=91.108.56.0/22 /ip firewall address-list add list=proxy_ipv4 address=91.108.4.0/22 /ip firewall address-list add list=proxy_ipv4 address=91.108.8.0/22 /ip firewall address-list add list=proxy_ipv4 address=91.108.16.0/22 /ip firewall address-list add list=proxy_ipv4 address=91.108.12.0/22 /ip firewall address-list add list=proxy_ipv4 address=149.154.160.0/20 /ip firewall address-list add list=proxy_ipv4 address=91.105.192.0/23 /ip firewall address-list add list=proxy_ipv4 address=91.108.20.0/22 /ip firewall address-list add list=proxy_ipv4 address=185.76.151.0/24 /ip firewall address-list add list=proxy_ipv4 address=95.161.64.0/20 ä¸ºç›®çš„ipä¸ºproxy_ipv4åœ°å€åˆ—è¡¨çš„è¿æ¥æ‰“ä¸Šâ€œsing-box-v4â€æ ‡è®°ï¼š /ip firewall mangle add action=mark-routing chain=prerouting dst-address-list=proxy_ipv4 new-routing-mark=sing-box-v4 passthrough=yes è®¾ç½®è·¯ç”±è¡¨sing-box-v4çš„ä¸‹ä¸€è·³ç½‘å…³ä¸ºsing-boxï¼š /ip route add dst-address=0.0.0.0/0 gateway=10.0.0.2 routing-table=sing-box-v4 IPv6 éƒ¨åˆ† æ·»åŠ sing-box-v6è·¯ç”±è¡¨ï¼š /routing table add name=sing-box-v6 fib åœ°å€åˆ—è¡¨æ·»åŠ æ·»åŠ fakev6åŠtg v6ç½‘æ®µï¼š /ipv6 firewall address-list add address=f2b0::/18 list=proxy_ipv6 /ipv6 firewall address-list add address=2001:b28:f23d::/48 list=proxy_ipv6 /ipv6 firewall address-list add address=2001:b28:f23f::/48 list=proxy_ipv6 /ipv6 firewall address-list add address=2001:67c:4e8::/48 list=proxy_ipv6 /ipv6 firewall address-list add address=2001:b28:f23c::/48 list=proxy_ipv6 /ipv6 firewall address-list add address=2a0a:f280::/32 list=proxy_ipv6 ä¸ºç›®çš„ipä¸ºproxy_ipv6çš„è¿æ¥æ‰“æ ‡è®°ï¼š /ipv6 firewall mangle add action=mark-routing chain=prerouting dst-address-list=proxy_ipv6 new-routing-mark=sing-box-v6 è®¾ç½®è·¯ç”±è¡¨sing-box-v6çš„ä¸‹ä¸€è·³ç½‘å…³ä¸ºsing-boxã€‚æ³¨æ„gatewayä¸ºsing-boxçš„IPv6ï¼š\n/ipv6 route add dst-address=::/0 gateway=dc00::2222 routing-table=sing-box-v6 æ·»åŠ è·¯ç”±è§„åˆ™ç¡®ä¿fakev6è·¯ç”±æ­£å¸¸æ‰§è¡Œï¼š\n/routing rule add action=lookup-only-in-table routing-mark=sing-box-v6 table=sing-box-v6 æ–¹æ¡ˆ 2ï¼šç›´æ¥åœ¨ /ip route ä¸­æ·»åŠ é™æ€è·¯ç”± æ­¤æ–¹æ³•é€šè¿‡ç›´æ¥æŒ‡å®šç›®æ ‡ç½‘æ®µçš„ä¸‹ä¸€è·³æ¥å®ç°ï¼Œä¸ä¾èµ– Mangleã€‚ ä¸‹é¢å‘½ä»¤æœªåŒ…å«TG IPã€å¥ˆè²IPï¼Œéœ€è¦ç”¨å¯è‡ªè¡Œæ·»åŠ ã€‚æ­¤æ–¹æ³•ä¸ç¬¬1ç§mangleæ ‡è®°æ³•ä¸å†²çªï¼Œä¾‹å¦‚å¯ä»¥FakeIPä½¿ç”¨routeï¼ŒTG IPç­‰ä¾ç„¶ä½¿ç”¨mangleã€‚\nipv4 /ip route add disabled=no dst-address=28.0.0.0/8 gateway=10.0.0.2 routing-table=main suppress-hw-offload=no /ip route add disabled=no distance=1 dst-address=8.8.8.8/32 gateway=10.0.0.2 routing-table=main scope=30 suppress-hw-offload=no target-scope=10 /ip route add disabled=no distance=1 dst-address=1.1.1.1/32 gateway=10.0.0.2 routing-table=main scope=30 suppress-hw-offload=no target-scope=10 /ip route add disabled=no distance=1 dst-address=8.8.4.4/32 gateway=10.0.0.2 routing-table=main scope=30 suppress-hw-offload=no target-scope=10 /ip route add disabled=no distance=1 dst-address=1.0.0.1/32 gateway=10.0.0.2 routing-table=main scope=30 suppress-hw-offload=no target-scope=10 ipv6 /ipv6 route add disabled=no distance=1 dst-address=f2b0::/18 gateway=dc00::2222 routing-table=main scope=30 suppress-hw-offload=no target-scope=10 æ–¹æ¡ˆ 3ï¼šé€šè¿‡ /routing rules é…ç½®ï¼ˆæ¨èï¼‰ è¿™æ˜¯åšä¸»ç›®å‰ä½¿ç”¨çš„æ–¹æ³•ï¼Œæœ€ä¸ºç®€æ´ä¸”ä¸å— FastTrack å½±å“ã€‚\næ·»åŠ sing-box-v4ã€sing-box-v6è·¯ç”±è¡¨ï¼š /routing table add name=sing-box-v4 fib /routing table add name=sing-box-v6 fib è®¾ç½®è·¯ç”±è¡¨sing-box-v4ã€sing-box-v6çš„ä¸‹ä¸€è·³ç½‘å…³ä¸ºsing-boxï¼š /ip route add dst-address=0.0.0.0/0 gateway=10.0.0.2 routing-table=sing-box-v4 /ipv6 route add dst-address=::/0 gateway=dc00::2222 routing-table=sing-box-v6 è®¾ç½®FakeIPã€TG IPç­‰IPçš„è·¯ç”±è§„åˆ™ï¼š /routing rule add action=lookup disabled=no dst-address=f2b0::/18 table=sing-box-v6 add action=lookup disabled=no dst-address=2001:b28:f23d::/48 table=sing-box-v6 add action=lookup disabled=no dst-address=2001:b28:f23f::/48 table=sing-box-v6 add action=lookup disabled=no dst-address=2001:67c:4e8::/48 table=sing-box-v6 add action=lookup disabled=no dst-address=2001:b28:f23c::/48 table=sing-box-v6 add action=lookup disabled=no dst-address=2a0a:f280::/32 table=sing-box-v6 add action=lookup disabled=no dst-address=1.1.1.1/32 table=sing-box-v4 add action=lookup disabled=no dst-address=1.0.0.1/32 table=sing-box-v4 add action=lookup disabled=no dst-address=192.168.31.0/24 table=sing-box-v4 add action=lookup disabled=no dst-address=8.8.8.8/32 table=sing-box-v4 add action=lookup disabled=no dst-address=8.8.4.4/32 table=sing-box-v4 add action=lookup disabled=no dst-address=8.41.4.0/24 table=sing-box-v4 add action=lookup disabled=no dst-address=45.12.89.152/32 table=sing-box-v4 add action=lookup disabled=no dst-address=104.19.192.175/32 table=sing-box-v4 add action=lookup disabled=no dst-address=23.23.189.144/28 table=sing-box-v4 add action=lookup disabled=no dst-address=23.246.0.0/18 table=sing-box-v4 add action=lookup disabled=no dst-address=34.195.253.0/25 table=sing-box-v4 add action=lookup disabled=no dst-address=37.77.184.0/21 table=sing-box-v4 add action=lookup disabled=no dst-address=38.72.126.0/24 table=sing-box-v4 add action=lookup disabled=no dst-address=45.57.0.0/17 table=sing-box-v4 add action=lookup disabled=no dst-address=52.24.178.0/24 table=sing-box-v4 add action=lookup disabled=no dst-address=52.35.140.0/24 table=sing-box-v4 add action=lookup disabled=no dst-address=54.204.25.0/28 table=sing-box-v4 add action=lookup disabled=no dst-address=54.213.167.0/24 table=sing-box-v4 add action=lookup disabled=no dst-address=64.120.128.0/17 table=sing-box-v4 add action=lookup disabled=no dst-address=66.197.128.0/17 table=sing-box-v4 add action=lookup disabled=no dst-address=69.53.224.0/19 table=sing-box-v4 add action=lookup disabled=no dst-address=103.87.204.0/22 table=sing-box-v4 add action=lookup disabled=no dst-address=108.175.32.0/20 table=sing-box-v4 add action=lookup disabled=no dst-address=185.2.220.0/22 table=sing-box-v4 add action=lookup disabled=no dst-address=185.9.188.0/22 table=sing-box-v4 add action=lookup disabled=no dst-address=192.173.64.0/18 table=sing-box-v4 add action=lookup disabled=no dst-address=198.38.96.0/19 table=sing-box-v4 add action=lookup disabled=no dst-address=198.45.48.0/20 table=sing-box-v4 add action=lookup disabled=no dst-address=203.75.84.0/24 table=sing-box-v4 add action=lookup disabled=no dst-address=203.198.13.0/24 table=sing-box-v4 add action=lookup disabled=no dst-address=203.198.80.0/24 table=sing-box-v4 add action=lookup disabled=no dst-address=207.45.72.0/22 table=sing-box-v4 add action=lookup disabled=no dst-address=208.75.76.0/22 table=sing-box-v4 add action=lookup disabled=no dst-address=210.0.153.0/24 table=sing-box-v4 add action=lookup disabled=no dst-address=91.108.56.0/22 table=sing-box-v4 add action=lookup disabled=no dst-address=91.108.4.0/22 table=sing-box-v4 add action=lookup disabled=no dst-address=91.108.8.0/22 table=sing-box-v4 add action=lookup disabled=no dst-address=91.108.16.0/22 table=sing-box-v4 add action=lookup disabled=no dst-address=91.108.12.0/22 table=sing-box-v4 add action=lookup disabled=no dst-address=149.154.160.0/20 table=sing-box-v4 add action=lookup disabled=no dst-address=28.0.0.0/8 table=sing-box-v4 add action=lookup disabled=no dst-address=91.108.20.0/22 table=sing-box-v4 add action=lookup disabled=no dst-address=91.105.192.0/23 table=sing-box-v4 add action=lookup disabled=no dst-address=95.161.64.0/20 table=sing-box-v4 add action=lookup disabled=no dst-address=185.76.151.0/24 table=sing-box-v4 ","permalink":"https://hanigege.github.io/posts/routers/03.routeros%E9%85%8D%E7%BD%AEfakeip/","tags":null,"title":"03.RouterOSé…ç½®FakeIP"},{"categories":["routers"],"contents":"æœ¬æ–‡ä»‹ç» RouterOS å¦‚ä½•å¼€å¯ IPv6ã€‚ä»¥ **NAT6** æ¨¡å¼ä¸ºä¾‹ï¼ŒIPv6 å†…ç½‘ç½‘æ®µé»˜è®¤ä¸º `dc00::/64`ï¼ŒRouterOS `bridge1` çš„ IPv6 å†…ç½‘åœ°å€ä¸º `dc00::1111/64`ã€‚ æ¡¥æ¥æ¥å£ `bridge1`ã€æ‹¨å·æ¥å£ `pppoe-out1` åç§°è‹¥ä¸åŒåˆ™è‡ªè¡Œæ›¿æ¢ã€‚ ä½œè€…ï¼šTom 1. å¼€å¯ IPv6 æ¨¡å— /ipv6 settings set disable-ipv6=no 2. è·å– IPv6 å‰ç¼€ (Prefix) ä»è¿è¥å•†å¤„è·å– IPv6 PDï¼š\n/ipv6 dhcp-client add interface=pppoe-out1 pool-name=dhcpv6-gua-pool1 pool-prefix-length=60 request=prefix 3. æ·»åŠ å±€åŸŸç½‘ ULA åœ°å€æ±  /ipv6 pool add name=dhcpv6-ula-pool1 prefix=dc00::/64 prefix-length=64 4. é…ç½®æ¥å£åœ°å€ è®¡ç®— EUI-64 åœ°å€ï¼šå¯ä½¿ç”¨ EUI-64 è®¡ç®—å™¨ï¼Œæˆ–ç›´æ¥ä½¿ç”¨ ::1,æˆ–ä½¿ç”¨ä¸Šé¢è®¡ç®—å¾—åˆ°çš„åç¼€ï¼ˆä¾‹å¦‚::BF24:12FF:FEE1:E81Bï¼‰é…ç½®pppoe-out1çš„GUAåœ°å€ é…ç½® PPPoE æ¥å£ GUA åœ°å€ï¼š /ipv6 address add address=::BF24:12FF:FEE1:E81B/64 from-pool=dhcpv6-gua-pool1 interface=pppoe-out1 é…ç½® Bridge æ¥å£ ULA åœ°å€ï¼Œé»˜è®¤dc00::1111ï¼ˆå¯è‡ªè¡Œä¿®æ”¹ï¼‰ï¼š /ipv6 address add address=dc00::1111/64 from-pool=dhcpv6-ula-pool1 interface=bridge1 5. å¼€å¯ NAT6 (æºåœ°å€ä¼ªè£…) /ipv6 firewall nat add action=masquerade chain=srcnat src-address=dc00::/64 6. é…ç½®é‚»å±…å‘ç° (ND) ç¦ç”¨é»˜è®¤ ND é…ç½®ï¼Œå¹¶æ–°å»ºé…ç½®ã€‚å»ºè®®ä¸å¹¿æ’­ IPv6 DNSã€‚\n/ipv6 nd set [ find default=yes ] advertise-dns=no disabled=yes /ipv6 nd add advertise-dns=no advertise-mac-address=no interface=bridge1 managed-address-configuration=yes other-configuration=yes ra-interval=5m-15m 7. IPv6 é˜²ç«å¢™è§„åˆ™ å› ä½¿ç”¨ NAT6ï¼Œè§„åˆ™é€»è¾‘ä¸ IPv4 ç±»ä¼¼ï¼Œæ²¡æœ‰PSDã€‚\n/ipv6 firewall filter add action=accept chain=forward in-interface=bridge1 add action=accept chain=input in-interface=bridge1 add action=accept chain=forward connection-state=established,related,untracked add action=accept chain=input connection-state=established,related add action=drop chain=input connection-state=invalid in-interface=pppoe-out1 # å…è®¸å¿…è¦çš„ ICMPv6 åè®® add action=accept chain=input icmp-options=128:0-255 in-interface=pppoe-out1 protocol=icmpv6 add action=accept chain=input comment=\u0026#34;Allow Echo request (ping)\u0026#34; icmp-options=128:0-255 protocol=icmpv6 add action=accept chain=input comment=\u0026#34;Allow Echo reply\u0026#34; icmp-options=129:0-255 protocol=icmpv6 add action=accept chain=input comment=\u0026#34;Allow Router Solicitation\u0026#34; icmp-options=133:0-255 protocol=icmpv6 add action=accept chain=input comment=\u0026#34;Allow Router Advertisement\u0026#34; icmp-options=134:0-255 protocol=icmpv6 add action=accept chain=input comment=\u0026#34;Allow Neighbor Solicitation\u0026#34; icmp-options=135:0-255 protocol=icmpv6 add action=accept chain=input comment=\u0026#34;Allow Neighbor Advertisement\u0026#34; icmp-options=136:0-255 protocol=icmpv6 # æ‹¦æˆªå…¶ä»–æ¥è‡ª WAN çš„å†…å®¹ add action=drop chain=input comment=\u0026#34;Drop other ICMPv6 from WAN\u0026#34; in-interface=pppoe-out1 protocol=icmpv6 add action=drop chain=input dst-port=53,8291 in-interface=pppoe-out1 protocol=tcp add action=drop chain=input dst-port=53,8291 in-interface=pppoe-out1 protocol=udp 8. è°ƒæ•´ TCP MSS /ipv6 firewall mangle add action=change-mss chain=forward new-mss=clamp-to-pmtu protocol=tcp tcp-flags=syn /ipv6 firewall mangle add action=change-mss chain=output new-mss=clamp-to-pmtu protocol=tcp tcp-flags=syn æç¤ºï¼šé…ç½®å®Œæˆåï¼Œè®¿é—® http://[2402:4e00:1013:e500:0:9671:f018:4947]ï¼ˆä»…æ˜¾ç¤º IP åœ°å€çš„æµ‹è¯•é¡µï¼‰éªŒè¯è¿é€šæ€§ã€‚\n","permalink":"https://hanigege.github.io/posts/routers/02.routeros%E5%BC%80%E5%90%AFipv6%E5%B9%B6%E9%85%8D%E7%BD%AE%E9%98%B2%E7%81%AB%E5%A2%99/","tags":null,"title":"02.RouterOSå¼€å¯IPv6å¹¶é…ç½®é˜²ç«å¢™"},{"categories":["routers"],"contents":"æœ¬æ–‡ä»‹ç» RouterOS æ‹¨å·ã€é…ç½® DHCP æœåŠ¡å™¨ã€é…ç½® DNSã€å¼€å¯ IPv4 é˜²ç«å¢™ç­‰é€šç½‘çš„åŸºç¡€é…ç½®ã€‚ æ¡¥æ¥æ¥å£ `bridge1`ã€æ‹¨å·æ¥å£ `pppoe-out1` åç§°è‹¥ä¸åŒåˆ™è‡ªè¡Œæ›¿æ¢ã€‚ ä½œè€…ï¼šTom 1. PPPoE æ‹¨å·é…ç½® æ‰‹åŠ¨é…ç½® pppoe-out1 æ¥å£æ‹¨å·ï¼š\nUser: å¡«å…¥å®½å¸¦è´¦å· Password: å¡«å…¥å®½å¸¦å¯†ç  å¦‚æœä¸ä½¿ç”¨è¿è¥å•†æä¾›çš„ DNSï¼Œå¯ä¸å‹¾é€‰ Use Peer DNSã€‚ æ³¨ï¼šæ¥å£å‰å‡ºç° â€œRâ€ ä»£è¡¨æ‹¨å·æˆåŠŸã€‚æ‹¨å·æˆåŠŸåå»ºè®®å…ˆç¦ç”¨ï¼Œå¾…é˜²ç«å¢™é…ç½®å®Œæ¯•åå†å¼€å¯ï¼ 2. é…ç½® DHCP æœåŠ¡å™¨ DHCP IP èŒƒå›´ä¸º 10.0.0.100-10.0.0.250ï¼Œç½‘å…³å’Œ DNS é»˜è®¤ä¸º ROSã€‚å¦‚æœå¸Œæœ›å…¨å±€é…ç½®é€æ˜ä»£ç†ï¼Œdns-server å¯é…ç½®ä¸º mosdnsã€‚\n/ip pool add name=dhcpv4-pool1 ranges=10.0.0.100-10.0.0.250 /ip dhcp-server add name=dhcpv4-server1 interface=bridge1 address-pool=dhcpv4-pool1 lease-time=1d /ip dhcp-server network add address=10.0.0.0/24 gateway=10.0.0.1 dns-server=10.0.0.1 3. é…ç½® DNS è®¾ç½® ROS çš„ä¸Šæ¸¸ DNSï¼Œæ­¤å¤„å…ˆè®¾ç½® 223.5.5.5ï¼Œä¹Ÿå¯è‡ªå®šä¹‰å¡«å…¥è¿è¥å•†åˆ†é…çš„ DNSã€‚\n/ip dns set servers=223.5.5.5 allow-remote-requests=yes max-concurrent-queries=4096 max-concurrent-tcp-sessions=512 cache-size=8192 cache-max-ttl=04:00:00 4. é…ç½®åŠ¨æ€æºåœ°å€ä¼ªè£… (NAT) é™åˆ¶æº IP ä¸ºå†…ç½‘ç½‘æ®µï¼ˆæ³¨æ„å­ç½‘æ©ç ï¼Œå»ºè®®å°† WireGuard ä½¿ç”¨ç½‘æ®µåŒ…å«å…¶ä¸­ï¼‰ã€‚\n/ip firewall nat add action=masquerade chain=srcnat comment=\u0026#34;defconf: masquerade IPv4\u0026#34; src-address=10.0.0.0/8 è‡³æ­¤æ‰“å¼€ pppoe æ¥å£å³å¯é€šç½‘ï¼Œä½†å»ºè®®ç»§ç»­é…ç½®å®Œé˜²ç«å¢™å†é€šç½‘ï¼\n5. è®¿é—®å…‰çŒ«ï¼ˆå¯é€‰ï¼‰ å¦‚æœéœ€è¦è®¿é—®å…‰çŒ«ï¼Œåˆ™ä¸º WAN å£åˆ†é…ä¸€ä¸ªå…‰çŒ«åŒç½‘æ®µçš„ IP åœ°å€ï¼ˆä¸€èˆ¬ä¸º 192.168.1.0/24ï¼‰ã€‚æ³¨æ„ interface ä¸ºç‰©ç†æ¥å£ WANï¼Œä¸æ˜¯æ‹¨å·å£ã€‚ 6. IPv4 é˜²ç«å¢™é…ç½® è§„åˆ™æºäº @Ronä½¬ï¼Œå»ºè®®æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´ã€‚\næ·»åŠ é˜²ç«å¢™è§„åˆ™ /ip firewall filter add action=accept chain=forward in-interface=bridge1 /ip firewall filter add action=accept chain=input in-interface=bridge1 /ip firewall filter add action=accept chain=forward connection-state=established,related,untracked /ip firewall filter add action=accept chain=input connection-state=established,related /ip firewall filter add action=drop chain=input src-address-list=BlockIP in-interface=pppoe-out1 /ip firewall filter add action=drop chain=input connection-state=invalid in-interface=pppoe-out1 /ip firewall filter add action=drop chain=input protocol=icmp in-interface=pppoe-out1 ## 5391æ˜¯Winboxç™»é™†ç«¯å£ï¼Œå¯ä»¥åŠ ä¸Šæƒ³éšè—çš„ç«¯å£ã€‚å¦‚æœåœ¨NATæœ‰æ˜ å°„ï¼Œç«¯å£æ— æ³•éšè— /ip firewall filter add action=drop chain=input protocol=tcp dst-port=53,5391 in-interface=pppoe-out1 /ip firewall filter add action=drop chain=input protocol=udp dst-port=53,5391 in-interface=pppoe-out1 /ip firewall filter add action=add-src-to-address-list chain=input address-list=BlockIP address-list-timeout=1w protocol=tcp dst-port=!53,853,5391 tcp-flags=rst in-interface=pppoe-out1 psd=21,5s,3,1 /ip firewall filter add action=add-src-to-address-list chain=input address-list=BlockIP address-list-timeout=1w protocol=tcp dst-port=!53,853,5391 tcp-flags=syn in-interface=pppoe-out1 psd=21,5s,3,1 ## UDPåè®® dst-port=!53,853,5391 å¯ä»¥åŠ ä¸Šwireguardç«¯å£ï¼Œé˜²æ­¢è§¦å‘PSDï¼Œé€ æˆIPè¢«Block /ip firewall filter add action=add-src-to-address-list chain=input address-list=BlockIP address-list-timeout=1w protocol=udp dst-port=!53,853,5391 in-interface=pppoe-out1 psd=21,5s,3,1 /ip firewall filter add action=drop chain=input src-address-list=BlockIP è°ƒæ•´ TCP MSS /ip firewall mangle add action=change-mss chain=forward protocol=tcp tcp-flags=syn new-mss=clamp-to-pmtu passthrough=yes /ip firewall mangle add action=change-mss chain=output protocol=tcp tcp-flags=syn new-mss=clamp-to-pmtu passthrough=yes å…³é—­éå¿…è¦æœåŠ¡ç«¯å£ /ip firewall service-port disable ftp /ip firewall service-port disable irc /ip firewall service-port disable pptp /ip firewall service-port disable rtsp /ip firewall service-port disable sip /ip firewall service-port disable tftp æ³¨ï¼šé˜²ç«å¢™é…ç½®å®Œæ¯•åï¼Œå³å¯æ‰“å¼€ pppoe æ¥å£å¼€å§‹ä¸Šç½‘ã€‚\n","permalink":"https://hanigege.github.io/posts/routers/01.routeros%E8%81%94%E7%BD%91%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%E5%8F%8Aipv4%E9%98%B2%E7%81%AB%E5%A2%99/","tags":null,"title":"01.RouterOSè”ç½‘åŸºæœ¬é…ç½®åŠIPv4é˜²ç«å¢™"},{"categories":["routers"],"contents":" # 00.RouterOS åˆå§‹åŒ–åŠåŸºç¡€é…ç½® ä½œè€…ï¼šTom ç¬¬ä¸€æ¬¡è¿›å…¥ RouterOS å…ˆæ¢å¤åŸå‚è®¾ç½®ï¼Œä½¿ç”¨ Winbox ç™»å½•ï¼ˆé€šè¿‡ MAC åœ°å€è®¿é—®åå°é…ç½®ï¼‰ã€‚\nå»ºè®®å…ˆé…ç½®é˜²ç«å¢™ï¼Œå†å¼€å¯ PPPoE æ¥å£è®¾ç½®å¸å·å¯†ç è”ç½‘ï¼š\n/system reset-configuration ç¡®è®¤æ¥å£å¹¶ä¿®æ”¹åç§° ç¡®è®¤ç½‘å£åŠŸèƒ½ï¼ˆåŒºåˆ† lanã€wanï¼‰ï¼Œå¹¶é‡å‘½åä¸ºæ–¹ä¾¿åç»­æ“ä½œï¼š\n/interface set ether1 name=lan /interface set ether2 name=wan å»ºç«‹ç½‘æ¡¥ï¼ˆBridgeï¼‰ å°†æ‰€æœ‰ LAN æ¥å£æ·»åŠ è¿›æ¡¥ï¼ˆbridgeï¼‰ï¼š\n/interface bridge add name=bridge1 /interface bridge port add bridge=bridge1 interface=lan æ³¨ï¼šå¦‚æœåŒç½‘å£ï¼Œå¯ä¸å»ºbridgeï¼Œç›´æ¥ä½¿ç”¨lanå£ï¼Œå¹¶æ¥å…¥ç‰©ç†äº¤æ¢æœºã€‚ä½†ä¸ºæ–¹ä¾¿ç®¡ç† å¹¶ä¸ºåæœŸvlanç­‰è™šæ‹Ÿæ¥å£å¹¶å…¥bridgeåšå‡†å¤‡ï¼Œå»ºè®®å»ºç«‹bridgeã€‚\nä¸º bridge1 å’Œ wan è®¾ç½® IP ä¸ºbridge1è®¾ç½®IPã€‚æœ¬æ•™ç¨‹ä»¥bridge1ä¸ºä¾‹ï¼Œå³rosæœ¬æœºipä¸º10.0.0.1/24 ï¼š\n/ip address add interface=bridge1 address=10.0.0.1/24 network=10.0.0.0 è®¾ç½®æ—¶åŒºä¸ NTP æœåŠ¡å™¨ /system clock set time-zone-name=\u0026#34;Asia/Shanghai\u0026#34; /system clock manual set time-zone=+08:00 /system ntp client set enabled=yes servers=cn.pool.ntp.org,ntp1.aliyun.com,time1.cloud.tencent.com å…³é—­æ‰€æœ‰ä¸éœ€è¦çš„æœåŠ¡åŠç«¯å£ï¼Œæ›´æ”¹Winboxç™»é™†ç«¯å£ä¸º5391ï¼ˆå¯è‡ªå®šä¹‰ï¼‰ï¼Œå¹¶å¼€å¯ä»…å…è®¸å†…ç½‘è®¿é—®ï¼Œæ³¨æ„ä¸‹æ–¹address=10.0.0.0/24ä¿®æ”¹ä¸ºè‡ªå·±çš„å†…ç½‘ç½‘æ®µ /ip smb set enabled=no /ip smb shares disable numbers=0 /ip ssh set forwarding-enabled=no /ip socks set enabled=no /ip upnp set enabled=no /ip proxy set enabled=no /ip service disable api /ip service disable api-ssl /ip service disable ftp /ip service disable ssh /ip service disable telnet /ip service disable www /ip service disable www-ssl /ip service set winbox port=5391 address=10.0.0.0/24 /tool bandwidth-server set enabled=no åˆ›å»ºç®¡ç†å‘˜å¸å·å¹¶ç¦ç”¨é»˜è®¤è´¦å· /user add name=ç”¨æˆ·å password=å¯†ç  group=full address=10.0.0.0/24 ç¦ç”¨é»˜è®¤è´¦æˆ· /user disable admin æ³¨æ„ï¼šè¯·å…ˆç¡®è®¤æ–°åˆ›å»ºçš„ç”¨æˆ·åå’Œå¯†ç å¯ä»¥æ­£å¸¸ç™»å½•ï¼Œå†ç¦ç”¨é»˜è®¤ç®¡ç†å‘˜å¸å·ã€‚\nä¿®æ”¹ç«¯å£åç™»é™†æ—¶ipåœ°å€åæ³¨æ„åŠ ä¸Š5391ç«¯å£ æ›´æ–°åŠæˆæƒåŠ é€ŸæœåŠ¡å™¨æ·»åŠ é™æ€IPï¼ˆå¯ä¸æ“ä½œï¼Œè‹¥åç»­æ›´æ–°æ…¢å¯å°è¯•æ·»åŠ ï¼‰ /ip dns static add address=45.12.89.152 name=upgrade.mikrotik.com type=A add address=45.12.89.152 name=licence.mikrotik.com type=A ","permalink":"https://hanigege.github.io/posts/routers/00.routeros%E5%88%9D%E5%A7%8B%E5%8C%96%E5%8F%8A%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/","tags":null,"title":"00.RouterOSåˆå§‹åŒ–åŠåŸºç¡€é…ç½®"},{"categories":["linux"],"contents":"è¯´æ˜ï¼šæ”¯æŒipv4\u0026amp;ipv6,è‡ªåŠ¨æ£€æµ‹æœ‰æ— ipv6ï¼Œæ·»åŠ mss.è‡ªåŠ¨æ£€æµ‹sshç«¯å£ç­‰ï¼Œå¾ˆæ–¹ä¾¿ æˆåŠŸçš„æ­¥éª¤ä¸æ–¹æ³• nano iptables_manager.sh ç›´æ¥å¤åˆ¶å¹¶æ‰§è¡Œä»¥ä¸‹å®Œæ•´ä»£ç è¦†ç›–åŸè„šæœ¬ï¼š cat \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; \u0026gt; iptables_manager.sh #!/bin/bash # ========================================================== # è„šæœ¬åç§°ï¼šé«˜çº§é˜²ç«å¢™ç®¡ç†å·¥å…· (Debian/Ubuntu ä¸“å±è‡ªé€‚åº”ç‰ˆ V4.1) # æ ¸å¿ƒå‡çº§ï¼šåŸºäºè½¯ä»¶å’Œå†…æ ¸æ¨¡å—çš„æ·±åº¦æ™ºèƒ½æ£€æµ‹ï¼Œæ¶ˆé™¤å†—ä½™è§„åˆ™ # ========================================================== gl_lv=\u0026#39;\\033[32m\u0026#39; gl_huang=\u0026#39;\\033[33m\u0026#39; gl_hong=\u0026#39;\\033[31m\u0026#39; gl_bai=\u0026#39;\\033[0m\u0026#39; root_use() { [ \u0026#34;$EUID\u0026#34; -ne 0 ] \u0026amp;\u0026amp; echo -e \u0026#34;${gl_huang}æç¤º: ${gl_bai}éœ€ root æƒé™è¿è¡Œï¼\u0026#34; \u0026amp;\u0026amp; exit 1 } check_deps() { if ! dpkg -l | grep -qw iptables-persistent; then echo -e \u0026#34;${gl_huang}æ£€æµ‹åˆ°æœªå®‰è£…æŒä¹…åŒ–ç»„ä»¶ï¼Œæ­£åœ¨è‡ªåŠ¨å®‰è£…...${gl_bai}\u0026#34; apt-get update DEBIAN_FRONTEND=noninteractive apt-get install -y iptables iptables-persistent netfilter-persistent echo -e \u0026#34;${gl_lv}ä¾èµ–å®‰è£…å®Œæˆï¼${gl_bai}\u0026#34; sleep 1 fi } root_use check_deps if command -v ip6tables \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 \u0026amp;\u0026amp; ip addr 2\u0026gt;/dev/null | grep -q \u0026#34;inet6 .* global\u0026#34;; then CMDS=\u0026#34;iptables ip6tables\u0026#34; HAS_IPV6=true else CMDS=\u0026#34;iptables\u0026#34; HAS_IPV6=false fi save_rules() { echo -e \u0026#34;${gl_huang}æ­£åœ¨æŒä¹…åŒ–è§„åˆ™...${gl_bai}\u0026#34; mkdir -p /etc/iptables netfilter-persistent save \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 || { iptables-save \u0026gt; /etc/iptables/rules.v4 [ \u0026#34;$HAS_IPV6\u0026#34; == true ] \u0026amp;\u0026amp; ip6tables-save \u0026gt; /etc/iptables/rules.v6 } echo -e \u0026#34;${gl_lv}è§„åˆ™ä¿å­˜æˆåŠŸã€‚${gl_bai}\u0026#34; } get_ssh_port() { local port=$(grep -i \u0026#34;^Port\u0026#34; /etc/ssh/sshd_config 2\u0026gt;/dev/null | awk \u0026#39;{print $2}\u0026#39; | head -n 1) [ -z \u0026#34;$port\u0026#34; ] \u0026amp;\u0026amp; port=22 echo \u0026#34;$port\u0026#34; } view_rules() { for cmd in $CMDS; do echo -e \u0026#34;\\n${gl_lv}=== $cmd filter è¡¨çŠ¶æ€ ===${gl_bai}\u0026#34; $cmd -L INPUT -n -v --line-numbers echo -e \u0026#34;${gl_huang}--- FORWARD è½¬å‘çŠ¶æ€ ---${gl_bai}\u0026#34; $cmd -L FORWARD -n -v --line-numbers echo -e \u0026#34;${gl_huang}--- MSS é’³åˆ¶çŠ¶æ€ (mangle è¡¨) ---${gl_bai}\u0026#34; $cmd -t mangle -L FORWARD -n -v --line-numbers done read -p \u0026#34;æŒ‰å›è½¦ç»§ç»­...\u0026#34; } allow_port_flexible() { read -e -p \u0026#34;è¯·è¾“å…¥è¦æ”¾è¡Œçš„ç«¯å£å·: \u0026#34; port [ -z \u0026#34;$port\u0026#34; ] \u0026amp;\u0026amp; return echo -e \u0026#34;1. TCP 2. UDP 3. åŒæ—¶æ”¾è¡Œ\u0026#34; read -p \u0026#34;é€‰æ‹© (1-3): \u0026#34; p_choice for cmd in $CMDS; do case $p_choice in 1) $cmd -I INPUT 4 -p tcp --dport \u0026#34;$port\u0026#34; -j ACCEPT ;; 2) $cmd -I INPUT 4 -p udp --dport \u0026#34;$port\u0026#34; -j ACCEPT ;; 3) $cmd -I INPUT 4 -p tcp --dport \u0026#34;$port\u0026#34; -j ACCEPT $cmd -I INPUT 4 -p udp --dport \u0026#34;$port\u0026#34; -j ACCEPT ;; esac done save_rules } block_ip() { read -e -p \u0026#34;è¾“å…¥è¦å±è”½çš„ IP: \u0026#34; tip [ -z \u0026#34;$tip\u0026#34; ] \u0026amp;\u0026amp; return if [[ \u0026#34;$tip\u0026#34; == *\u0026#34;:\u0026#34;* ]]; then if [ \u0026#34;$HAS_IPV6\u0026#34; == true ]; then ip6tables -I INPUT 1 -s \u0026#34;$tip\u0026#34; -j DROP else echo -e \u0026#34;${gl_hong}ç³»ç»Ÿæœªå¼€å¯ IPv6ï¼Œæ— æ³•æ·»åŠ è¯¥è§„åˆ™ã€‚${gl_bai}\u0026#34; sleep 2 return fi else iptables -I INPUT 1 -s \u0026#34;$tip\u0026#34; -j DROP fi save_rules } delete_rule() { echo -e \u0026#34;1. IPv4 (iptables)\u0026#34; [ \u0026#34;$HAS_IPV6\u0026#34; == true ] \u0026amp;\u0026amp; echo \u0026#34;2. IPv6 (ip6tables)\u0026#34; read -p \u0026#34;é€‰æ‹©åè®®: \u0026#34; p_choice local cmd=\u0026#34;iptables\u0026#34; if [ \u0026#34;$p_choice\u0026#34; == \u0026#34;2\u0026#34; ] \u0026amp;\u0026amp; [ \u0026#34;$HAS_IPV6\u0026#34; == true ]; then cmd=\u0026#34;ip6tables\u0026#34; elif [ \u0026#34;$p_choice\u0026#34; == \u0026#34;2\u0026#34; ]; then echo -e \u0026#34;${gl_hong}ç³»ç»Ÿä¸æ”¯æŒ IPv6ã€‚${gl_bai}\u0026#34; sleep 2 return fi $cmd -L INPUT -n --line-numbers read -p \u0026#34;è¾“å…¥è¦åˆ é™¤çš„ filter/INPUT è§„åˆ™ç¼–å·: \u0026#34; num [ -n \u0026#34;$num\u0026#34; ] \u0026amp;\u0026amp; $cmd -D INPUT \u0026#34;$num\u0026#34; \u0026amp;\u0026amp; save_rules } close_all_but_ssh() { local ssh_p=$(get_ssh_port) echo -e \u0026#34;${gl_huang}å¼€å§‹æ‰§è¡Œè‡ªé€‚åº”æ·±åº¦åŠ å›º...${gl_bai}\u0026#34; sysctl -w net.ipv4.ip_forward=1 \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 [ \u0026#34;$HAS_IPV6\u0026#34; == true ] \u0026amp;\u0026amp; sysctl -w net.ipv6.conf.all.forwarding=1 \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 || true for cmd in $CMDS; do $cmd -P INPUT ACCEPT $cmd -P FORWARD ACCEPT $cmd -L INPUT --line-numbers | grep -vE \u0026#34;ts-|DOCKER\u0026#34; | awk \u0026#39;/^[0-9]/ {print $1}\u0026#39; | sort -nr | xargs -r -I{} $cmd -D INPUT {} 2\u0026gt;/dev/null $cmd -F FORWARD $cmd -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT $cmd -A INPUT -i lo -j ACCEPT if $cmd -L ts-input \u0026gt;/dev/null 2\u0026gt;\u0026amp;1; then $cmd -D INPUT -j ts-input 2\u0026gt;/dev/null || true $cmd -I INPUT 3 -j ts-input fi $cmd -A INPUT -p tcp --dport \u0026#34;$ssh_p\u0026#34; -j ACCEPT # è§„èŒƒ ICMP if [ \u0026#34;$cmd\u0026#34; == \u0026#34;iptables\u0026#34; ]; then $cmd -A INPUT -p icmp --icmp-type echo-request -m limit --limit 1/s --limit-burst 5 -j ACCEPT $cmd -A INPUT -p icmp --icmp-type 3 -j ACCEPT $cmd -A INPUT -p icmp --icmp-type 11 -j ACCEPT $cmd -A INPUT -p icmp -j DROP else for type in 2 133 134 135 136 137; do $cmd -A INPUT -p ipv6-icmp --icmpv6-type $type -j ACCEPT done $cmd -A INPUT -p ipv6-icmp --icmpv6-type echo-request -m limit --limit 1/s --limit-burst 5 -j ACCEPT $cmd -A INPUT -p ipv6-icmp -j DROP fi if $cmd -L ts-forward \u0026gt;/dev/null 2\u0026gt;\u0026amp;1; then $cmd -D FORWARD -j ts-forward 2\u0026gt;/dev/null || true $cmd -I FORWARD 1 -j ts-forward fi # æ ¸å¿ƒä¼˜åŒ–ï¼šæ™ºèƒ½ç¯å¢ƒæ£€æµ‹ (æ£€æµ‹è½¯ä»¶å®‰è£…çŠ¶æ€è€Œéç½‘å¡çŠ¶æ€) if command -v docker \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 || command -v dockerd \u0026gt;/dev/null 2\u0026gt;\u0026amp;1; then $cmd -A FORWARD -i docker+ -j ACCEPT $cmd -A FORWARD -o docker+ -j ACCEPT fi if command -v tailscaled \u0026gt;/dev/null 2\u0026gt;\u0026amp;1; then $cmd -A FORWARD -i tailscale+ -j ACCEPT $cmd -A FORWARD -o tailscale+ -j ACCEPT fi if command -v wg \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 || lsmod | grep -q wireguard; then $cmd -A FORWARD -i wg+ -j ACCEPT $cmd -A FORWARD -o wg+ -j ACCEPT fi if command -v openvpn \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 || [ -c /dev/net/tun ]; then $cmd -A FORWARD -i tun+ -j ACCEPT $cmd -A FORWARD -o tun+ -j ACCEPT fi if command -v pppd \u0026gt;/dev/null 2\u0026gt;\u0026amp;1; then $cmd -A FORWARD -i ppp+ -j ACCEPT $cmd -A FORWARD -o ppp+ -j ACCEPT fi $cmd -A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT $cmd -P INPUT DROP $cmd -P FORWARD DROP # åŒæ ˆ MSS é’³åˆ¶ $cmd -t mangle -F FORWARD $cmd -t mangle -A FORWARD -p tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu 2\u0026gt;/dev/null || true done save_rules echo -e \u0026#34;${gl_lv}æ·±åº¦åŠ å›ºåŠ MSS ç½‘ç»œä¼˜åŒ–å®Œæˆï¼å†—ä½™è§„åˆ™å·²æ¸…ç†ã€‚${gl_bai}\u0026#34; sleep 2 } open_all_ports() { for cmd in iptables ip6tables; do command -v $cmd \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 || continue $cmd -P INPUT ACCEPT $cmd -P FORWARD ACCEPT $cmd -P OUTPUT ACCEPT $cmd -F $cmd -X 2\u0026gt;/dev/null || true $cmd -t mangle -F FORWARD 2\u0026gt;/dev/null || true done save_rules echo -e \u0026#34;${gl_lv}é˜²ç«å¢™å·²é‡ç½®å…¨å¼€æ¨¡å¼ï¼ŒMSS é’³åˆ¶å·²æ¸…é™¤ã€‚${gl_bai}\u0026#34; sleep 2 } iptables_panel() { while true; do clear echo -e \u0026#34;${gl_lv}===========================================${gl_bai}\u0026#34; echo -e \u0026#34; é«˜çº§é˜²ç«å¢™ç®¡ç† (Debian/Ubuntu è‡ªé€‚åº”ç‰ˆ V4.1) \u0026#34; echo -e \u0026#34; å½“å‰ IPv6 çŠ¶æ€: \\c\u0026#34; if [ \u0026#34;$HAS_IPV6\u0026#34; == true ]; then echo -e \u0026#34;${gl_lv}å·²å¯ç”¨${gl_bai}\u0026#34;; else echo -e \u0026#34;${gl_huang}æœªå¯ç”¨${gl_bai}\u0026#34;; fi echo -e \u0026#34;${gl_lv}===========================================${gl_bai}\u0026#34; echo \u0026#34; 1. æŸ¥çœ‹è§„åˆ™ (å« MSS é’³åˆ¶çŠ¶æ€)\u0026#34; echo \u0026#34; 2. æ”¾è¡Œç«¯å£\u0026#34; echo \u0026#34; 3. å±è”½åœ°å€\u0026#34; echo \u0026#34; 4. åˆ é™¤è§„åˆ™\u0026#34; echo -e \u0026#34; 5. ${gl_hong}æ‰§è¡Œæ·±åº¦åŠ å›º (æ™ºèƒ½æ£€æµ‹ç¯å¢ƒï¼Œæ‹’ç»å†—ä½™è§„åˆ™)${gl_bai}\u0026#34; echo -e \u0026#34; 6. ${gl_huang}ç´§æ€¥æ¢å¤å…¨å¼€ (é‡ç½®æ‰€æœ‰ç­–ç•¥)${gl_bai}\u0026#34; echo \u0026#34; 7. æ‰‹åŠ¨æŒä¹…åŒ–ä¿å­˜\u0026#34; echo \u0026#34; 0. é€€å‡ºè„šæœ¬\u0026#34; echo \u0026#34;-------------------------------------------\u0026#34; read -e -p \u0026#34;è¯·é€‰æ‹©: \u0026#34; choice case $choice in 1) view_rules ;; 2) allow_port_flexible ;; 3) block_ip ;; 4) delete_rule ;; 5) close_all_but_ssh ;; 6) open_all_ports ;; 7) save_rules; sleep 2 ;; 0) exit 0 ;; *) echo \u0026#34;æ— æ•ˆé€‰æ‹©\u0026#34;; sleep 1 ;; esac done } iptables_panel EOF chmod +x iptables_manager.sh ./iptables_manager.sh ä½¿ç”¨æ³¨æ„ æ‰§è¡Œåé€‰æ‹© 5ï¼Œç³»ç»Ÿå°†åªæ ¹æ®ä½ çœŸå®å®‰è£…çš„ç»„ä»¶å†™å…¥å¿…éœ€çš„è½¬å‘è§„åˆ™ã€‚ ","permalink":"https://hanigege.github.io/posts/linux/ubuntu2026iptables+mss%E9%98%B2%E7%81%AB%E5%A2%99%E7%AE%A1%E7%90%86%E4%B8%80%E9%94%AE%E8%84%9A%E6%9C%AC/","tags":null,"title":"2026ç‰ˆUbuntu\u0026Debianä¸‹iptables+mssé˜²ç«å¢™ç®¡ç†ä¸€é”®è„šæœ¬"},{"categories":["linux"],"contents":"\nå®‰è£… Neovim (\u003e= 0.10.0) 1. å®‰è£…neovim (Debian13\u0026amp;Ubuntu25.10+)(è‡ªåŠ¨è·å–æœ€æ–°ç‰ˆï¼Œå¿…é¡»æ˜¯é»˜è®¤ \u0026gt;= 0.10.x) apt update \u0026amp;\u0026amp; apt install neovim éªŒè¯ç‰ˆæœ¬ä¿¡æ¯ nvim --version | grep ^NVIM å¦‚æœæ˜¯ä½ç‰ˆæœ¬ç³»ç»Ÿï¼Œä¹Ÿå¯è‡ªè¡Œç¼–è¯‘å®‰è£…ï¼ˆæœ€æ–°ç‰ˆï¼‰ # 1. å®‰è£…ç¼–è¯‘æ‰€å¿…é¡»çš„åŸºç¡€å·¥å…·å’Œç³»ç»Ÿä¾èµ– sudo apt update sudo apt install ninja-build gettext cmake unzip curl build-essential git -y # 2. æ‹‰å– Neovim æºç å¹¶åˆ‡æ¢åˆ°ç¨³å®šç‰ˆåˆ†æ”¯ (è§„é¿å¼€å‘ç‰ˆçš„æ½œåœ¨ bug) git clone https://github.com/neovim/neovim.git ~/neovim-src cd ~/neovim-src git checkout stable # 3. ç¼–è¯‘å¹¶å…¨å±€å®‰è£… (åˆ©ç”¨å¤šæ ¸åŠ é€Ÿ) make CMAKE_BUILD_TYPE=Release -j$(nproc) sudo make install # 4. æ¸…ç†è·¯å¾„ç¼“å­˜å¹¶éªŒè¯ç‰ˆæœ¬ hash -r nvim -v å®‰è£…æ ¼å¼åŒ–ä¸å‰ªè´´æ¿ä¾èµ–ç¯å¢ƒ è¦è®© conform.nvim æˆåŠŸè°ƒç”¨ prettierï¼Œä»¥åŠä¿è¯ç³»ç»Ÿä¸ Neovim ä¹‹é—´çš„å‰ªè´´æ¿äº¤äº’é¡ºç•…ï¼Œå¿…é¡»åœ¨æ“ä½œç³»ç»Ÿå±‚é¢å®‰è£…ä»¥ä¸‹å·¥å…·ï¼š\n\u0026ndash;Debian13\u0026ndash;:\n2. å®‰è£… Node.js å’Œ npm (æä¾›è¿è¡Œç¯å¢ƒ), xclip (æä¾›å‰ªè´´æ¿æ”¯æŒ) sudo apt update \u0026amp;\u0026amp; sudo apt install -y nodejs npm xclip 3. å…¨å±€å®‰è£… Prettier sudo npm install -g prettier 4. æ¸…ç†æ—§ç¯å¢ƒ rm -rf ~/.config/nvim ~/.local/share/nvim ~/.local/state/nvim ~/.cache/nvim mkdir -p ~/.config/nvim 5. å†™å…¥é…ç½® cat \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; \u0026gt; ~/.config/nvim/init.lua -- [åŸºç¡€è®¾ç½®] vim.g.mapleader = \u0026#34;;\u0026#34; local opt = vim.opt opt.number = true opt.relativenumber = true opt.cursorline = true opt.termguicolors = true opt.encoding = \u0026#34;utf-8\u0026#34; opt.mouse = \u0026#34;a\u0026#34; opt.timeoutlen = 300 opt.splitright = true opt.splitbelow = true -- [å®‰è£… lazy.nvim] local lazypath = vim.fn.stdpath(\u0026#34;data\u0026#34;) .. \u0026#34;/lazy/lazy.nvim\u0026#34; if not vim.loop.fs_stat(lazypath) then vim.fn.system({ \u0026#34;git\u0026#34;, \u0026#34;clone\u0026#34;, \u0026#34;--filter=blob:none\u0026#34;, \u0026#34;https://github.com/folke/lazy.nvim.git\u0026#34;, \u0026#34;--branch=stable\u0026#34;, lazypath, }) end vim.opt.rtp:prepend(lazypath) -- [æ’ä»¶é…ç½®] require(\u0026#34;lazy\u0026#34;).setup({ -- 1. ä¸»é¢˜ (Onedark) { \u0026#34;navarasu/onedark.nvim\u0026#34;, lazy = false, priority = 1000, config = function() require(\u0026#34;onedark\u0026#34;).setup({ style = \u0026#39;dark\u0026#39; }) require(\u0026#34;onedark\u0026#34;).load() -- æŠ¤çœ¼æ¨¡å¼ä¿®å¤ local hl = vim.api.nvim_set_hl hl(0, \u0026#34;Normal\u0026#34;, { bg = \u0026#34;#1e2127\u0026#34;, fg = \u0026#34;#abb2bf\u0026#34; }) hl(0, \u0026#34;CursorLine\u0026#34;, { bg = \u0026#34;#2c313a\u0026#34; }) end }, -- 2. æ–‡ä»¶æ ‘ (NvimTree) { \u0026#34;nvim-tree/nvim-tree.lua\u0026#34;, dependencies = { \u0026#34;nvim-tree/nvim-web-devicons\u0026#34; }, config = function() require(\u0026#34;nvim-tree\u0026#34;).setup({ view = { width = 30 }, renderer = { indent_markers = { enable = true } } }) end }, -- 3. è¿œç¨‹å¤åˆ¶ (OSC 52) { \u0026#34;ojroques/nvim-osc52\u0026#34;, config = function() require(\u0026#39;osc52\u0026#39;).setup() vim.api.nvim_create_autocmd(\u0026#34;TextYankPost\u0026#34;, { callback = function() if vim.v.event.operator == \u0026#34;y\u0026#34; and vim.v.event.regname == \u0026#34;\u0026#34; then require(\u0026#39;osc52\u0026#39;).copy_register(\u0026#34;\u0026#34;) end end, }) end }, -- 4. ä»£ç æ ¼å¼åŒ– (Conform) { \u0026#34;stevearc/conform.nvim\u0026#34;, config = function() require(\u0026#34;conform\u0026#34;).setup({ formatters_by_ft = { json = { \u0026#34;prettier\u0026#34; }, yaml = { \u0026#34;prettier\u0026#34; }, html = { \u0026#34;prettier\u0026#34; }, css = { \u0026#34;prettier\u0026#34; }, javascript = { \u0026#34;prettier\u0026#34; }, typescript = { \u0026#34;prettier\u0026#34; }, }, format_on_save = { timeout_ms = 1000, lsp_fallback = true }, }) end } }) -- [å¿«æ·é”®æ˜ å°„] local map = vim.keymap.set -- åŸºç¡€åŠŸèƒ½ map(\u0026#34;n\u0026#34;, \u0026#34;\u0026lt;leader\u0026gt;w\u0026#34;, \u0026#34;:w\u0026lt;CR\u0026gt;\u0026#34;, { silent = true }) map(\u0026#34;n\u0026#34;, \u0026#34;\u0026lt;leader\u0026gt;q\u0026#34;, \u0026#34;:q\u0026lt;CR\u0026gt;\u0026#34;, { silent = true }) map(\u0026#34;n\u0026#34;, \u0026#34;\u0026lt;CR\u0026gt;\u0026#34;, \u0026#34;:noh\u0026lt;CR\u0026gt;\u0026lt;CR\u0026gt;\u0026#34;, { silent = true }) -- æ™ºèƒ½æ–‡ä»¶æ ‘æ¥å›åˆ‡æ¢ (;t) map(\u0026#34;n\u0026#34;, \u0026#34;\u0026lt;leader\u0026gt;t\u0026#34;, function() local view = require(\u0026#34;nvim-tree.view\u0026#34;) if view.is_visible() then if vim.api.nvim_get_current_win() == view.get_winnr() then vim.cmd(\u0026#34;wincmd p\u0026#34;) else vim.cmd(\u0026#34;NvimTreeFocus\u0026#34;) end else vim.cmd(\u0026#34;NvimTreeToggle\u0026#34;) end end, { silent = true }) -- æ ¼å¼åŒ– (;f) map({ \u0026#34;n\u0026#34;, \u0026#34;v\u0026#34; }, \u0026#34;\u0026lt;leader\u0026gt;f\u0026#34;, function() require(\u0026#34;conform\u0026#34;).format({ lsp_fallback = true, timeout_ms = 1000 }) print(\u0026#34;âœ¨ Format executed\u0026#34;) end, { silent = true }) -- çª—å£å¯¼èˆª map(\u0026#34;n\u0026#34;, \u0026#34;\u0026lt;C-h\u0026gt;\u0026#34;, \u0026#34;\u0026lt;C-w\u0026gt;h\u0026#34;) map(\u0026#34;n\u0026#34;, \u0026#34;\u0026lt;C-l\u0026gt;\u0026#34;, \u0026#34;\u0026lt;C-w\u0026gt;l\u0026#34;) map(\u0026#34;n\u0026#34;, \u0026#34;\u0026lt;C-j\u0026gt;\u0026#34;, \u0026#34;\u0026lt;C-w\u0026gt;j\u0026#34;) map(\u0026#34;n\u0026#34;, \u0026#34;\u0026lt;C-k\u0026gt;\u0026#34;, \u0026#34;\u0026lt;C-w\u0026gt;k\u0026#34;) EOF é…ç½®å®Œæˆåï¼Œè¾“å…¥ nvim å¯åŠ¨ï¼ŒæŒ‰å›è½¦è®©å®ƒè‡ªåŠ¨ä¸‹è½½å¹¶éƒ¨ç½²æ‰€æœ‰æ’ä»¶å³å¯ã€‚ æ ¸å¿ƒç‰¹æ€§ æ™ºèƒ½åˆ‡æ¢ï¼šä½¿ç”¨ ;t åœ¨æ–‡ä»¶æ ‘ä¸ä»£ç ä¹‹é—´æ¥å›è·³è½¬ æ ¼å¼åŒ–ï¼š;f æ‰‹åŠ¨æ ¼å¼åŒ–ï¼Œ;w ä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–ï¼Œ;q é€€å‡º å…¶å®ƒï¼šå’Œ vim å‘½ä»¤æ— å¼‚ï¼Œæ”¯æŒè·¨ç»ˆç«¯å¤åˆ¶ç²˜è´´ï¼Œy å¤åˆ¶ ","permalink":"https://hanigege.github.io/posts/linux/debianmac%E4%B8%8Bnvim%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%85%A8%E5%AE%B6%E6%A1%B6%E5%AE%89%E8%A3%85/","tags":null,"title":"Debianä¸‹nvimæ ¼å¼åŒ–å…¨å®¶æ¡¶å®‰è£…"},{"categories":["freebsd"],"contents":"\nä¸€é”®æ‰§è¡Œè„šæœ¬ curl -fsSL https://raw.githubusercontent.com/hanigege/scripts/main/pf_manager.sh -o pf_manager.sh \u0026amp;\u0026amp; sh pf_manager.sh ","permalink":"https://hanigege.github.io/posts/freebsd/freebsd15-pf-js/","tags":null,"title":"FreeBSD 15 PF ç»ˆæäº¤äº’å¼ç®¡ç†è„šæœ¬"},{"categories":["routers"],"contents":"vyosä¸Šé…ç½®wireguard ï¼ˆIPV4ï¼‰ 1. ç”Ÿæˆ WireGuard å¯†é’¥ wg genkey | tee privatekey | wg pubkey \u0026gt; publickey â€¢ privatekey æ–‡ä»¶ä¸­å­˜å‚¨ ç§é’¥\nâ€¢ publickey æ–‡ä»¶ä¸­å­˜å‚¨ å…¬é’¥\nç„¶åä½¿ç”¨ï¼š\ncat privatekey æŠŠç§é’¥å¡«å…¥ ç¬¬ä¸€æ­¥ çš„ \u0026lt;æœåŠ¡å™¨ç§é’¥\u0026gt; ä½ç½®ã€‚\né…ç½®wireguard:\nset interfaces wireguard wg0 address \u0026#39;10.20.30.1/24\u0026#39; set interfaces wireguard wg0 port \u0026#39;11133\u0026#39; set interfaces wireguard wg0 private-key \u0026#39;private-key\u0026#39; set interfaces wireguard wg0 peer iphone allowed-ips \u0026#39;10.20.30.2/32\u0026#39; set interfaces wireguard wg0 peer iphone public-key \u0026#39;public-key\u0026#39; set interfaces wireguard wg0 peer iphone preshared-key \u0026#39;preshared-key\u0026#39; ä¸Šé¢è¿™æ˜¯æ·»åŠ è¿‡peerçš„ã€‚\nå¦‚æœè®©wgç§‘å­¦ï¼Œä¸‹é¢æ¥ç€æ“ä½œï¼š\næ·»åŠ ç»„ï¼š set firewall group network-group LAN-v4 network \u0026#39;10.20.20.0/24\u0026#39; # å†…ç½‘æ®µ set firewall group network-group LAN-v4 network \u0026#39;10.20.23.0/24\u0026#39; # wgç½‘æ®µ set firewall group ipv6-network-group LAN-v6 network \u0026#39;fd88::/64\u0026#39; è®¾ç½®ç­–ç•¥è·¯ç”±: ä¸¾ä¾‹: è®©wg0çš„æµé‡èµ°100å·è·¯ç”±è¡¨, 100å·è·¯ç”±è¡¨æ˜¯sbçš„è·¯ç”±è¡¨ set policy route WG0-to-SB interface \u0026#39;wg0\u0026#39; set policy route WG0-to-SB rule 10 destination group network-group \u0026#39;!LAN-v4\u0026#39; set policy route WG0-to-SB rule 10 set table \u0026#39;100\u0026#39; # è¿™ä¸‹é¢ä¸‰æ¡ä»…ä¾›å‚è€ƒï¼Œæ·»åŠ åç”µæŠ¥å®¹æ˜“æ–­è¿ã€‚ set policy route6 WG0-to-SB interface \u0026#39;wg0\u0026#39; set policy route6 WG0-to-SB rule 10 destination group network-group \u0026#39;!LAN-v6\u0026#39; set policy route6 WG0-to-SB rule 10 set table \u0026#39;106\u0026#39; #è·¯ç”±è¡¨ï¼ˆä¹‹å‰æ·»åŠ è¿‡å°±ä¸è¦é‡å¤æ·»åŠ ï¼‰ set protocols static table 100 route 0.0.0.0/0 next-hop 10.20.20.9 or set protocols static table 100 route 0.0.0.0/0 next-hop 172.23.0.99 set protocols static table 100 route 0.0.0.0/0 next-hop 192.168.100.9 set protocols static table 106 route6 ::/0 next-hop fd88::9999 ----- Happy Routing! 2.vyosä¸Šé…ç½®wireguard ï¼ˆIPV4ï¼‰é¢„å…±äº«å¯†é’¥ é…ç½® WireGuard çš„ é¢„å…±äº«å¯†é’¥ï¼ˆPreshared Keyï¼Œç®€ç§° PSKï¼‰ï¼Œå¯ä»¥ä¸ºç°æœ‰çš„å…¬ç§é’¥æ¡æ‰‹å†åŠ ä¸€å±‚åŠ å¯†ï¼Œæå‡å®‰å…¨æ€§ã€‚\nğŸ§© PSK æ˜¯ä»€ä¹ˆï¼Ÿ é¢„å…±äº«å¯†é’¥æ˜¯åœ¨é€šä¿¡åŒæ–¹ç§ä¸‹å…±äº«çš„é¢å¤–å¯†é’¥ï¼Œç”¨ä½œå¯¹ç§°åŠ å¯†ï¼ˆæ··æ·† DH å¯†é’¥åå•†ç»“æœï¼‰ï¼Œæé«˜æŠµæŠ—é‡å­è®¡ç®—ç ´è§£çš„èƒ½åŠ›\nâœ… å¦‚ä½•ç”Ÿæˆ PSK åœ¨ VyOS æˆ–å®¢æˆ·ç«¯ï¼ˆéƒ½å¯ä»¥ï¼‰æ‰§è¡Œï¼š\nwg genpsk \u0026gt; psk.key æŸ¥çœ‹å†…å®¹ï¼š\ncat psk.key ä¼šè¾“å‡ºä¸€ä¸² Base64 ç¼–ç çš„å¯†é’¥ï¼Œæ¯”å¦‚ï¼š\nzT4XEDXe9qJpKRgqz0VjdRm2Vu+I+ZYoY7vI99aAv0Q= ğŸ§© åœ¨ VyOS ä¸­æ·»åŠ  PSK å‡è®¾ä½ å·²æœ‰å¦‚ä¸‹ WireGuard é…ç½®ï¼š\nset interfaces wireguard wg0 address \u0026#39;10.20.30.1/24\u0026#39; set interfaces wireguard wg0 port \u0026#39;51820\u0026#39; set interfaces wireguard wg0 peer iphone public-key \u0026#39;xxx...=\u0026#39; åŠ å…¥ PSK çš„å‘½ä»¤å¦‚ä¸‹ï¼š\nset interfaces wireguard wg0 peer iphone preshared-key \u0026#39;zT4XEDXe9qJpKRgqz0VjdRm2Vu+I+ZYoY7vI99aAv00= ","permalink":"https://hanigege.github.io/posts/routers/vyos-wireguard-ipv4/","tags":null,"title":"Vyos Wireguard Ipv4"},{"categories":["linux"],"contents":"\nå®‰è£…è¿™ä¸ªç¨‹åºä¸»è¦æ˜¯æ–¹ä¾¿äººåœ¨å¤–é¢ï¼Œè¿æ¥è‡ªå·±æœåŠ¡å™¨ä½¿ç”¨ï½ å¯ä»¥ç†è§£ä¸ºwireguardå¸¦webç®¡ç†é¡µé¢çš„ã€‚ pveä¸‹å®‰è£…ubuntuæˆ–è€…debian ä¸‹è½½ä¸‹é¢çš„ä¸»ç¨‹åºç„¶åæ ¹æ®æ•™ç¨‹æ“ä½œ wg-easy.zip\nå®‰è£…æ•™ç¨‹ # vm ubuntu22.04æµ‹è¯•é€šè¿‡ï¼Œæ–°ç‰ˆæœ¬æ³¨æ„ä¸‹é¢æ”¹äº†ä¸ªç»„ä»¶ï¼Œå³ï¼šnpm@11.6.2 1ã€è¿ç§»ä»£ç  å¤åˆ¶appæ–‡ä»¶å¤¹åˆ° /app cd /app 2ã€å®‰è£…ä¾èµ– apt update apt install -y wireguard iptables curl -fsSL https://deb.nodesource.com/setup_22.x | sudo bash - sudo apt-get install -y nodejs sudo npm install -g npm@11.6.2 bcryptjs debug express-session h3 qrcode 3ã€é…ç½®ç¯å¢ƒ export NODE_PATH=/usr/lib/node_modules echo \u0026#34;export NODE_PATH=/usr/lib/node_modules\u0026#34; \u0026gt;\u0026gt; ~/.bashrc source ~/.bashrc npm audit fix 4ã€å¯ç”¨ IPv4 å’Œ IPv6 è½¬å‘ sudo sysctl -w net.ipv4.ip_forward=1 sudo sysctl -w net.ipv6.conf.all.forwarding=1 sudo bash -c \u0026#39;echo \u0026#34;net.ipv4.ip_forward = 1\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.conf\u0026#39; sudo bash -c \u0026#39;echo \u0026#34;net.ipv6.conf.all.forwarding = 1\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.conf\u0026#39; sudo sysctl -p 5ã€é…ç½® systemd æœåŠ¡ å¤åˆ¶wg-easy.serviceåˆ° /etc/systemd/system/ chmod +x /etc/systemd/system/wg-easy.service systemctl enable wg-easy.service systemctl start wg-easy.service systemctl status wg-easy.service ç™»å½•WebUIï¼š http://ip:51821/ è¯¦ç»†å‚æ•°è¯·ä¿®æ”¹ /app/config.js # å¦‚æœæŠ¥500é”™è¯¯çš„è¯ cd /app npm audit fix fd88::/64, 192.168.100.0/24, f2b0::/18, 198.18.0.0/15, 10.9.0.0/24, 91.108.56.0/22, 91.108.4.0/22, 91.108.8.0/22, 91.108.16.0/22, 91.108.12.0/22, 149.154.160.0/20, 91.105.192.0/23, 91.108.20.0/22, 185.76.151.0/24, 2001:67c:4e8::/48, 2001:b28:f23f::/48, 2a0a:f280::/32, 2001:b28:f23c::/48, 2001:b28:f23d::/48 ä¸Šé¢çš„ipé‡Œä¿®æ”¹ç›¸åº”çš„å†…ç½‘ipæ®µåŠwgçš„ipæ®µã€‚\næ¯”å¦‚æˆ‘æ ¹æ®æˆ‘çš„ç¯å¢ƒæ”¹çš„å¦‚ä¸‹ï¼š\nfd88::/64, 10.20.20.0/24, f2b0::/18, 198.18.0.0/15, 10.8.0.0/24, fdcc:cafe:8888::/64, 91.108.56.0/22, 91.108.4.0/22, 91.108.8.0/22, 91.108.16.0/22, 91.108.12.0/22, 149.154.160.0/20, 91.105.192.0/23, 91.108.20.0/22, 185.76.151.0/24, 2001:67c:4e8::/48, 2001:b28:f23f::/48, 2a0a:f280::/32, 2001:b28:f23c::/48, 2001:b28:f23d::/48 ç­‰æ•ˆäºå‘Šè¯‰å®¢æˆ·ç«¯ï¼š æœ¬åœ°å†…ç½‘ç½‘æ®µï¼š10.20.20.0/24ã€fd88::/64\nWireGuard ç½‘æ®µï¼š10.8.0.0/24ã€fdcc:cafe:8888::/64\nç‰¹æ®Šè·¯ç”±ç½‘æ®µï¼š198.18.0.0/15ï¼ˆFake IPï¼‰ã€f2b0::/18ï¼ˆFake IPï¼‰ã€fe80::/64ï¼ˆé“¾è·¯æœ¬åœ°ï¼Œé€šå¸¸ä¸éœ€è¦åŠ è¿›å»ï¼ŒWireGuard æœ¬èº«ä¼šè‡ªåŠ¨å¤„ç†ï¼Œè¿™ä¸ªä¸Šé¢IPå·²ç»åˆ é™¤ï¼Œç•™ä¸‹æ„æ€è¦çŸ¥é“æ³¨æ„äº†ï¼‰\nTelegram IPv4/IPv6 åœ°å€æ®µï¼šæ‰€æœ‰ 91.108.ã€149.154.160.0/20ã€185.76.151.0/24ã€2001:67c:4e8::/48ã€2001:b28:f23::/48ã€2a0a:f280::/32\næœ‰å‡ ç‚¹æ³¨æ„ï¼š fe80::/64 ä¸€èˆ¬ä¸è¦æ”¾è¿› AllowedIPsï¼Œè¿™æ˜¯é“¾è·¯æœ¬åœ°åœ°å€æ®µï¼Œæ¯ä¸ªæ¥å£éƒ½å¿…é¡»æœ‰ï¼Œæ”¾è¿›å»æœ‰å¯èƒ½å¯¼è‡´å®¢æˆ·ç«¯è·¯ç”±å¼‚å¸¸ã€‚\n0.0.0.0/0, ::/0 å’Œä½ ç°åœ¨çš„å†™æ³•æ˜¯ äº’æ–¥çš„ï¼š\n0.0.0.0/0, ::/0 = å…¨å±€ä»£ç†ï¼Œæ‰€æœ‰æµé‡èµ°éš§é“ã€‚\næŒ‡å®šç½‘æ®µåˆ—è¡¨ = åˆ†æµæ¨¡å¼ï¼Œåªæœ‰è¿™äº›ç½‘æ®µæ‰ä¼šèµ°éš§é“ã€‚ ä½ éœ€è¦æ ¹æ®è‡ªå·±éœ€æ±‚äºŒé€‰ä¸€ã€‚\nå¦‚æœä½ æ˜¯æƒ³åšã€Œåªèµ° Telegram + å†…ç½‘èµ„æº + æµ‹è¯•ç½‘æ®µ + WG åœ°å€ã€ï¼Œé‚£å°±ä¿ç•™ä½ å†™çš„åˆ—è¡¨ï¼Œåˆ«åŠ  0.0.0.0/0, ::/0ã€‚\nå…¨å±€ä»£ç†æ¨¡å¼ï¼ˆæ‰€æœ‰æµé‡èµ°éš§é“ï¼‰ module.exports.WG_ALLOWED_IPS = \u0026#39;0.0.0.0/0, ::/0\u0026#39;; åˆ†æµæ¨¡å¼ï¼ˆåªèµ°å†…ç½‘ + WireGuard ç½‘æ®µ + Telegramï¼‰ module.exports.WG_ALLOWED_IPS = \u0026#39;10.20.20.0/24, fd88::/64, 10.8.0.0/24, fdcc:cafe:8888::/64, 198.18.0.0/15, f2b0::/18, 91.108.56.0/22, 91.108.4.0/22, 91.108.8.0/22, 91.108.16.0/22, 91.108.12.0/22, 91.105.192.0/23, 91.108.20.0/22, 149.154.160.0/20, 185.76.151.0/24, 2001:67c:4e8::/48, 2001:b28:f23f::/48, 2a0a:f280::/32, 2001:b28:f23c::/48, 2001:b28:f23d::/48\u0026#39;; ğŸ‘‰ è¿™æ ·å®¢æˆ·ç«¯ï¼š\nè®¿é—®æƒé™è¯´æ˜ èƒ½è®¿é—®å†…ç½‘èµ„æºï¼ˆ10.20.20.0/24, fd88::/64ï¼‰ èƒ½èµ° WireGuard ç§æœ‰ç½‘æ®µé€šä¿¡ï¼ˆ10.8.0.0/24, fdcc:cafe:8888::/64ï¼‰ èƒ½è®¿é—® Telegramï¼ˆç›¸å…³ IPv4 + IPv6 æ®µï¼‰ å…¶ä»–æµé‡ç›´è¿ï¼Œä¸èµ°éš§é“ã€‚ âš ï¸ æˆ‘æŠŠ fe80::/64 å»æ‰äº†ï¼Œå› ä¸ºå®ƒæ˜¯é“¾è·¯æœ¬åœ°åœ°å€æ®µï¼Œä¸èƒ½ä¸‹å‘åˆ°å®¢æˆ·ç«¯ä½œä¸ºè·¯ç”±ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´ç³»ç»Ÿè·¯ç”±å†²çªã€‚\n","permalink":"https://hanigege.github.io/posts/linux/ck%E4%BD%AC%E7%9A%84wg-easy%E4%B8%80%E9%94%AE%E8%84%9A%E6%9C%AC%E7%A8%8B%E5%BA%8F/","tags":null,"title":"wg-Easyï¼ˆwireguardå¯è§†ç®¡ç†ï¼‰ç¨‹åº"},{"categories":["freebsd"],"contents":"FreeBSD15ä¸‹é…ç½®æœåŠ¡å™¨ç«¯Hysteria2 å»ºè®®ç”¨rootç”¨æˆ·è¿è¡Œï¼š\nç‰¹æƒç«¯å£é™åˆ¶ï¼šé root ç”¨æˆ·æ— æ³•ç›‘å¬ 1024 ä»¥ä¸‹çš„ç«¯å£ï¼ˆå¦‚ 443ï¼‰ã€‚ Hysteria2è®¾ç½®ç®€å•ï¼Œæ€§èƒ½å¼ºåŠ²ï¼Œå¼ºåŠ›æ¨èï¼Œåªè‡ªå·±ç”¨ï¼Œå¾ˆæ–¹ä¾¿ã€‚\nå…ˆåˆ°å®˜ç½‘ä¸‹è½½æœ€æ–°çš„for freebsdç‰ˆ å®˜ç½‘ä¸‹è½½\n1. å®‰è£…hysteria fetch https://github.com/apernet/hysteria/releases/download/app%2Fv2.7.0/hysteria-freebsd-amd64 #ä¸‹è½½ç›®å‰æœ€æ–°çš„2.7.0ç‰ˆ mv hysteria-freebsd-amd64 hysteria #æŠŠæ–‡ä»¶æ”¹åæˆhysteria chmod +x hysteria #è®©æ–‡ä»¶å¯æ‰§è¡Œ mv hysteria /usr/local/bin #å°†æ–‡ä»¶ç§»åˆ°ç›¸åº”ç›®å½• sysrc hysteria_enable=\u0026#34;YES\u0026#34; #è®¾ç½®å¼€æœºå¯åŠ¨ 2. è‡ªç­¾è¯ä¹¦ï¼š ä»¥ä¸‹æ˜¯é€‚é… FreeBSD çš„é«˜æ•ˆæ‰§è¡Œæ­¥éª¤ï¼š\nmkdir -p /usr/local/etc/hysteria # ç”Ÿæˆç§é’¥ä¸è¯ä¹¦ bing.comä¹Ÿå¯ä»¥æ”¹ä¸ºå…¶å®ƒçš„ openssl req -x509 -nodes -newkey ec -pkeyopt ec_paramgen_curve:prime256v1 \\ -keyout /usr/local/etc/hysteria/server.key \\ -out /usr/local/etc/hysteria/server.crt \\ -subj \u0026#34;/CN=bing.com\u0026#34; -days 36500 # ä¿®æ­£æƒé™ (FreeBSD ä¸­ hysteria ç”¨æˆ·ç»„åé€šå¸¸ä¹Ÿæ˜¯ hysteria) rootç”¨æˆ·ç™»å½•ä¸‹é¢å‘½ä»¤æ²¡æœ‰å¿…è¦ # chown hysteria:hysteria /usr/local/etc/hysteria/server.key /usr/local/etc/hysteria/server.crt # æ‰€æœ‰ç”¨æˆ·å¿…é¡»æ‰§è¡ŒåŒ…æ‹¬root,ç»™è¯ä¹¦æƒé™ chmod 644 /usr/local/etc/hysteria/server.crt chmod 600 /usr/local/etc/hysteria/server.key Hysteria æœåŠ¡é…ç½®æç¤º åœ¨ FreeBSD ä¸Šè¿è¡Œ Hysteria æ—¶ï¼Œè¯·ç¡®ä¿ /usr/local/etc/hysteria/config.yamlï¼ˆæˆ–ä½ çš„é…ç½®æ–‡ä»¶ï¼‰å¼•ç”¨äº†æ­£ç¡®çš„è·¯å¾„ï¼š\ncert: /usr/local/etc/hysteria/server.crt key: /usr/local/etc/hysteria/server.key æ³¨æ„ï¼š ç”±äºä½ ä½¿ç”¨äº†è‡ªç­¾åè¯ä¹¦ï¼Œå®¢æˆ·ç«¯è¿æ¥æ—¶å¿…é¡»å¼€å¯ insecure: true æˆ–é…ç½®å¯¹åº”çš„ ca æ ¡éªŒã€‚\n3. åˆ›å»ºå¯åŠ¨è„šæœ¬ åœ¨ FreeBSD ä¸­ï¼Œä»…ä»…æŠŠäºŒè¿›åˆ¶æ–‡ä»¶æ”¾è¿›å»æ˜¯ä¸å¤Ÿçš„ï¼Œå¿…é¡»ç¼–å†™ä¸€ä¸ªç¬¦åˆ rc.subr æ ‡å‡†çš„å¯åŠ¨è„šæœ¬ã€‚\nåˆ›å»ºå¯åŠ¨è„šæœ¬,å¹¶å°†è„šæœ¬æ”¾åˆ°ç›®å½• /usr/local/etc/rc.d ä¸­ã€‚ç³»ç»Ÿé»˜è®¤æ²¡æœ‰è¿™ä¸ªè„šæœ¬ï¼Œæˆ‘çš„è„šæœ¬å¦‚ä¸‹:\nnano /usr/local/etc/rc.d/hysteria #!/bin/sh # PROVIDE: hysteria # REQUIRE: NETWORKING # KEYWORD: shutdown . /etc/rc.subr name=\u0026#34;hysteria\u0026#34; rcvar=\u0026#34;hysteria_enable\u0026#34; load_rc_config $name : ${hysteria_enable:=\u0026#34;NO\u0026#34;} : ${hysteria_config:=\u0026#34;/usr/local/etc/hysteria/config.yaml\u0026#34;} : ${hysteria_log:=\u0026#34;/var/log/hysteria.log\u0026#34;} pidfile=\u0026#34;/var/run/${name}.pid\u0026#34; procname=\u0026#34;/usr/local/bin/hysteria\u0026#34; # ä½¿ç”¨ daemon -f ç¡®ä¿è¿›ç¨‹å®Œå…¨åå°åŒ–ï¼Œ-p è®°å½•å­è¿›ç¨‹çœŸå® PID command=\u0026#34;/usr/sbin/daemon\u0026#34; command_args=\u0026#34;-f -p ${pidfile} -o ${hysteria_log} ${procname} server -c ${hysteria_config}\u0026#34; run_rc_command \u0026#34;$1\u0026#34; èµ‹äºˆæƒé™ä¸åˆ›å»ºæ—¥å¿— # èµ‹äºˆæ‰§è¡Œæƒé™ chmod +x /usr/local/etc/rc.d/hysteria # åˆ›å»ºå¹¶æˆæƒæ—¥å¿—æ–‡ä»¶ touch /var/log/hysteria.log chmod 644 /var/log/hysteria.log 4. æ·»åŠ é…ç½®æ–‡ä»¶config.yaml å°†æ–‡ä»¶æ”¾åˆ°/usr/local/etc/hysteria/ä¸‹\nnvim /usr/local/etc/hysteria/config.yaml ï¼ˆ1ï¼‰å›å®¶é…ç½® listen: :33443 #ç›‘å¬ç«¯å£ #ä½¿ç”¨è‡ªç­¾è¯ä¹¦ tls: cert: /usr/local/etc/hysteria/server.crt key: /usr/local/etc/hysteria/server.key auth: type: password password: 888888 #è®¾ç½®è®¤è¯å¯†ç  masquerade: type: proxy proxy: url: https://bing.com #ä¼ªè£…ç½‘å€ rewriteHost: true ï¼ˆ2ï¼‰æ ‡å‡†é…ç½® å°†æ–‡ä»¶æ”¾åˆ°/usr/local/etc/hysteria/ä¸‹ã€‚\n# Hysteria 2 Server Config for FreeBSD 15 listen: :443 tls: cert: /usr/local/etc/hysteria/server.crt key: /usr/local/etc/hysteria/server.key auth: type: password password: \u0026#34;888888\u0026#34; bandwidth: up: 200 mbps down: 200 mbps masquerade: type: proxy proxy: url: https://bing.com/ rewriteHost: true ï¼ˆ3ï¼‰ä¼˜åŒ–é…ç½®ï¼šï¼ˆæ¨èï¼‰ # Hysteria 2 Server Config for FreeBSD 15 listen: :443 tls: cert: /usr/local/etc/hysteria/server.crt key: /usr/local/etc/hysteria/server.key auth: type: password password: \u0026#34;888888\u0026#34; # ç§‘å­¦å»ºè®®ï¼šåœ¨ FreeBSD ä¸‹ï¼Œé€šè¿‡ ignoreClientBandwidth è®©æœåŠ¡ç«¯æ›´çµæ´» # å¦‚æœä¾ç„¶æƒ³é™åˆ¶ï¼Œè¯·ä¿æŒ 300 mbpsï¼Œä½†åŠ¡å¿…é…åˆæˆ‘ä¹‹å‰ç»™ä½ çš„ sysctl å†…æ ¸ä¼˜åŒ– bandwidth: up: 300 mbps down: 300 mbps ignoreClientBandwidth: true # æ ¹æ²» i/o timeout çš„å…³é”®ï¼šæŒ‡å®šå¯é çš„å›½é™… DNS resolver: type: udp udp: addr: 8.8.8.8:53 masquerade: type: proxy proxy: url: https://www.bing.com rewriteHost: true # ä¿æŒ 80 ç«¯å£å…³é—­ï¼Œä¸ä½¿ç”¨ listenHTTPï¼Œæ˜¯æœ€ç§‘å­¦çš„é¿ç¾æ–¹å¼ quic: initStreamReceiveWindow: 8388608 # 8 MB maxStreamReceiveWindow: 8388608 # 8 MB initConnReceiveWindow: 20971520 # 20 MB maxConnReceiveWindow: 20971520 # 20 MB # è¿™é‡Œçš„æ—¥å¿—ç­‰çº§è®¾ä¸º warnï¼Œå‡å°‘æ— æ•ˆä¿¡æ¯å †ç§¯ï¼Œä»…ä¿ç•™å…³é”®é”™è¯¯ log: level: warn 5. å¯åŠ¨ # å¯åŠ¨ service hysteria start # æ£€æŸ¥çŠ¶æ€ (ç°åœ¨çš„ PID ä¼šéå¸¸å‡†ç¡®) service hysteria status # æŸ¥çœ‹æ—¥å¿—ç¡®è®¤è¿è¡Œæƒ…å†µ tail -f /var/log/hysteria.log 6. æ·»åŠ rc.conf é‡Œè‡ªå¯åŠ¨é¡¹ FreeBSD çš„è„šæœ¬å¯¹å˜é‡åéå¸¸æ•æ„Ÿã€‚è¯·ç¡®ä¿ä½ çš„ /etc/rc.conf ä¸­é…ç½®çš„æ˜¯ï¼š\nhysteria_enable=\u0026#34;YES\u0026#34; hysteria_config=\u0026#34;/usr/local/etc/hysteria/config.yaml\u0026#34; 7. æŸ¥çœ‹æ—¥å¿—ï¼š tail -f /var/log/hysteria.log 8. æœåŠ¡ç«¯ç³»ç»Ÿä¼˜åŒ– # è¿½åŠ æœ€ä¼˜é…ç½®åˆ° sysctl.conf cat \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf kern.ipc.maxsockbuf=33554432 net.inet.udp.recvspace=8388608 net.inet.udp.maxdgram=65535 net.route.netisr_maxqlen=2048 net.inet.udp.blackhole=1 EOF # 3. å°†åªè¯»å˜é‡å†™å…¥ /boot/loader.conf echo \u0026#39;net.link.ifqmaxlen=\u0026#34;2048\u0026#34;\u0026#39; \u0026gt;\u0026gt; /boot/loader.conf # çƒ­åŠ è½½ sysctl å¹¶é‡å¯ hysteria sysctl -f /etc/sysctl.conf service hysteria restart å®Œäº‹ï¼ ","permalink":"https://hanigege.github.io/posts/freebsd/freebsd%E5%AE%89%E8%A3%85hysteria2%E6%9C%8D%E5%8A%A1%E7%AB%AF/","tags":null,"title":"Freebsdå®‰è£…Hysteria2æœåŠ¡ç«¯"},{"categories":["freebsd"],"contents":"å‰ææ˜¯æ–°ç¼–è¾‘å™¨å·²ç»å®‰è£… FreeBSD ä¸‹ä½ å¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ EDITOR æ¥æ›´æ”¹ crontab -e ä½¿ç”¨çš„é»˜è®¤ç¼–è¾‘å™¨ã€‚ä¸‹é¢æ˜¯å‡ ç§å¸¸è§æ–¹æ³•ï¼š\nâœ… ä¸´æ—¶æ›´æ”¹ï¼ˆå½“å‰ shell æœ‰æ•ˆï¼‰ EDITOR=nano crontab -e æˆ–è€…ç”¨å…¶ä»–ä½ å–œæ¬¢çš„ç¼–è¾‘å™¨ï¼Œå¦‚ï¼š\nEDITOR=micro crontab -e EDITOR=ee crontab -e EDITOR=vim crontab -e âœ… æ°¸ä¹…æ›´æ”¹ï¼ˆåŠ åˆ° shell å¯åŠ¨æ–‡ä»¶ï¼‰ å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ sh æˆ– bashï¼Œå¯ä»¥å°†ä»¥ä¸‹å†…å®¹åŠ åˆ° ~/.profile æˆ– ~/.bashrcæˆ– ~/bash_profileï¼š\nexport EDITOR=nano å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ tcshï¼ˆFreeBSD é»˜è®¤ï¼‰ï¼Œè¯·åŠ åˆ° ~/.cshrc æ–‡ä»¶ä¸­ï¼š\nsetenv EDITOR nano ç„¶åæ‰§è¡Œï¼š\nsource ~/.cshrc ğŸ“¦ è¡¥å……æç¤ºï¼šå®‰è£…ç®€æ˜“ç¼–è¾‘å™¨ å¦‚æœä½ æƒ³ç”¨ nano ä½†ç³»ç»Ÿæ²¡æœ‰ï¼Œå¯ä»¥ç”¨ pkg å®‰è£…ï¼š\nsudo pkg install nano ","permalink":"https://hanigege.github.io/posts/freebsd/freebsd%E6%9B%B4%E6%94%B9%E9%BB%98%E8%AE%A4%E7%BC%96%E8%BE%91%E5%99%A8vi/","tags":null,"title":"Freebsdæ›´æ”¹é»˜è®¤ç¼–è¾‘å™¨vi"},{"categories":["freebsd"],"contents":"IPFIREWALL (IPFWï¼ŒIP é˜²ç«å¢™) æ˜¯ä¸€æ¬¾ç”± FreeBSD å‘èµ·çš„é˜²ç«å¢™åº”ç”¨è½¯ä»¶ï¼Œå®ƒç”± FreeBSD é¡¹ç›®ç¼–å†™å’Œç»´æŠ¤ã€‚ ipfw åœ¨åŸºæœ¬ç³»ç»Ÿçš„å†…æ ¸ï¼ˆGENERICï¼‰ä½œä¸ºå¯åŠ è½½æ¨¡å—è€Œå­˜åœ¨ã€‚\nè­¦å‘Š IPFW é»˜è®¤ä¼šæœ‰ä¸€æ¡è§„åˆ™ï¼Œè§„åˆ™å·ä¸º 65535ï¼Œæ˜¯ä¸å¯ä»¥åˆ é™¤çš„ï¼šè¿™æ¡è§„åˆ™ä¼šæŠŠæ‰€æœ‰æµé‡éƒ½åˆ‡æ–­ã€‚æ•…åœ¨æœªé…ç½®å¥½é˜²ç«å¢™å‰ï¼Œè¯·å‹¿å¯åŠ¨ IPFWï¼Œå¦åˆ™å°±ä¼šé¢ä¸´è¢«é˜»æŒ¡åœ¨é˜²ç«å¢™ä¹‹å¤–çš„éº»çƒ¦ã€‚\næœåŠ¡é¡¹ å¼€æœºè‡ªåŠ¨å¯åŠ¨é˜²ç«å¢™ç›¸åº”çš„å†…æ ¸æ¨¡å—ï¼š\n# sysrc firewall_enable=\u0026#34;YES\u0026#34; å‚è§ å®˜æ–¹ç½‘å€\næˆ–è€…\n# service ipfw enable # é¡»é‡å¯åç”Ÿæ•ˆ ä¿å­˜æ‰€éœ€ç¼–è¾‘åï¼Œå¯åŠ¨é˜²ç«å¢™ã€‚è¦ç«‹å³å¯ç”¨æ—¥å¿—è®°å½•é™åˆ¶ï¼Œè¿˜è¯·è®¾ç½®sysctlä¸Šé¢æŒ‡å®šçš„å€¼ï¼š\n# service ipfw start å¯åŠ¨ ipfwï¼šï¼ˆå¯åŠ¨å‰éœ€è¦å…ˆæ·»åŠ æ”¾å¼€22ç«¯å£çš„è§„åˆ™ï¼Œå…ˆæ‰§è¡Œä¸‹é¢çš„ï¼‰\n# service ipfw start Firewall rules loaded. Firewall logging enabled. ifconfig: interface ipfw0 already exists Firewall logging pseudo-interface (ipfw0) created. æŸ¥çœ‹ ipfw çŠ¶æ€ï¼š\n# service ipfw status ipfw is enabled å…¶ä»– RC é…ç½®\n# sysrc firewall_type=\u0026#34;open\u0026#34; # å…è®¸ä»»ä½•è®¿é—®ã€‚å¦‚æœä¸è¿™ä¹ˆåšï¼Œä¼šè°ƒç”¨é»˜è®¤è§„åˆ™ 65535â€”â€”deny ip from any to anyï¼Œæ‹’ç»æ‰€æœ‰ IPã€‚ä½ å°±åªèƒ½å»ç‰©ç†æœºä¸Šå†æ“ä½œäº†ã€‚åŸºæœ¬ç­‰åŒäº net.inet.ip.fw.default_to_accept=\u0026#34;1\u0026#34; # sysrc firewall_script=\u0026#34;/usr/local/etc/ipfw.rules\u0026#34; # æŒ‡å®š ipfw è§„åˆ™çš„è·¯å¾„ï¼Œåœ¨æ­¤å¤„ç¼–è¾‘è§„åˆ™ # sysrc firewall_logging=\u0026#34;YES\u0026#34; # è¿™æ · ipfw å°±å¯ä»¥æ‰“å°æ—¥å¿— # sysrc firewall_logif=\u0026#34;YES\u0026#34; # æŠŠæ—¥å¿—æ‰“å°åˆ° `ipfw0` è¿™ä¸ªè®¾å¤‡é‡Œ sysrc firewall_type=\u0026quot;open\u0026quot; è®¾ç½®åä¸ä¼šç›´æ¥å†™å…¥ allow ip from any to any åˆ°é…ç½®æ–‡ä»¶ã€‚\nç»æµ‹è¯•ï¼Œèƒ½æ§åˆ¶é˜²ç«å¢™å…¨å¼€æ”¾æ˜¯ï¼š\nä½ æŠŠnet.inet.ip.fw.default_to_accept=1æ”¾åˆ°/boot/loader.confé‡å¯æ‰èƒ½ç”Ÿæ•ˆ ï¼Œæ‰‹åŠ¨æ”¹æ–‡ä»¶æ”¾è¿›å»ã€‚ç„¶åé‡å¯ç³»ç»Ÿæ‰èƒ½ç”Ÿæ•ˆï¼Œä¼šåœ¨é…ç½®æ–‡ä»¶é‡Œç”Ÿæˆï¼šallow ip from any to any # æ³¨æ„æ­¤å¤„\næˆ–è€…ï¼š\nsysctl net.inet.ip.fw.default_to_accept=1 ä½†ç³»ç»Ÿå¯åŠ¨æ—¶ä¼šåŠ è½½ç­‰æ•ˆçš„è§„åˆ™ï¼Œä½œç”¨å°±æ˜¯å®Œå…¨å¼€æ”¾é˜²ç«å¢™ã€‚\næŒ‰ä¸Šé¢çš„é…ç½®åçš„è§„åˆ™ï¼š\n# ipfw list 00100 allow ip from any to any via lo0 00200 deny ip from any to 127.0.0.0/8 00300 deny ip from 127.0.0.0/8 to any 00400 deny ip from any to ::1 00500 deny ip from ::1 to any 00600 allow ipv6-icmp from :: to ff02::/16 00700 allow ipv6-icmp from fe80::/10 to fe80::/10 00800 allow ipv6-icmp from fe80::/10 to ff02::/16 00900 allow ipv6-icmp from any to any icmp6types 1 01000 allow ipv6-icmp from any to any icmp6types 2,135,136 65000 allow ip from any to any # æ³¨æ„æ­¤å¤„ 65535 deny ip from any to any ç¼–è¾‘ /usr/local/etc/ipfw.rules æ–‡ä»¶ æŒ‡å®šé˜²ç«å¢™è§„åˆ™ï¼š\nipfw -q -f flush # -q é€‰é¡¹è¡¨ç¤ºé™é»˜æ¨¡å¼ï¼Œé¿å…è¾“å‡ºå†—ä½™ä¿¡æ¯, åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰æ¸…é™¤åˆ—è¡¨ã€‚ cmd=\u0026#34;ipfw -q add\u0026#34; # â€‹å®šä¹‰ä¸€ä¸ªå˜é‡ cmdï¼Œç”¨äºç®€åŒ–åç»­æ·»åŠ è§„åˆ™çš„å‘½ä»¤ã€‚ # loopback $cmd 10 allow all from any to any via lo0 # å…è®¸æ‰€æœ‰é€šè¿‡å›ç¯æ¥å£ lo0 çš„æµé‡ã€‚ $cmd 20 deny all from any to 127.0.0.0/8 # æ‹’ç»ä»»ä½•è¯•å›¾è®¿é—®æœ¬åœ°å›ç¯åœ°å€èŒƒå›´ï¼ˆ127.0.0.0/8ï¼‰çš„å¤–éƒ¨æµé‡ï¼Œé˜²æ­¢ä¼ªé€ çš„å›ç¯åœ°å€é€šä¿¡ã€‚ $cmd 30 deny all from 127.0.0.0/8 to any # æ‹’ç»æ¥è‡ªå›ç¯åœ°å€èŒƒå›´çš„ä»»ä½•æµé‡ç¦»å¼€æœ¬åœ°ä¸»æœºï¼Œè¿›ä¸€æ­¥ç¡®ä¿å›ç¯åœ°å€çš„å®‰å…¨æ€§ã€‚ $cmd 40 deny tcp from any to any frag # â€‹æ‹’ç»æ‰€æœ‰åˆ†ç‰‡çš„ TCP æ•°æ®åŒ…ï¼Œæœ‰åŠ©äºé˜²èŒƒæŸäº›ç±»å‹çš„æ”»å‡»ã€‚ # statefull $cmd 50 check-state # æ£€æŸ¥ç°æœ‰çš„ä¼šè¯çŠ¶æ€ï¼Œå…è®¸å·²å»ºç«‹çš„ä¼šè¯ç»§ç»­é€šä¿¡ã€‚ $cmd 60 allow tcp from any to any established # å…è®¸æ‰€æœ‰å·²å»ºç«‹çš„ TCP è¿æ¥çš„æ•°æ®åŒ…é€šè¿‡ã€‚ $cmd 70 allow all from any to any out keep-state # å…è®¸æ‰€æœ‰å‘å¤–çš„æµé‡ï¼Œå¹¶å¯¹å…¶åˆ›å»ºçŠ¶æ€è®°å½•ï¼Œä»¥ä¾¿å“åº”æµé‡èƒ½å¤Ÿè‡ªåŠ¨é€šè¿‡ã€‚ $cmd 80 allow icmp from any to any # å…è®¸æ‰€æœ‰ ICMP æ•°æ®åŒ…ï¼Œæ”¯æŒç½‘ç»œè¯Šæ–­å’Œé”™è¯¯æŠ¥å‘ŠåŠŸèƒ½ã€‚â€‹ # open port for ssh $cmd 110 allow tcp from any to any 22 out # å…è®¸æ‰€æœ‰å‘å¤–çš„ SSH æµé‡ $cmd 120 allow tcp from any to any 22 in # ç¡®ä¿å¯ä»¥é€šè¿‡ SSH è®¿é—®è¯¥ä¸»æœºã€‚ # open port for samba # å…è®¸ä¸ Samba æ–‡ä»¶å…±äº«æœåŠ¡ç›¸å…³çš„ç«¯å£ï¼ˆ137-139 å’Œ 445ï¼‰çš„è¿›å‡ºæµé‡ï¼Œç¡®ä¿ Samba æœåŠ¡æ­£å¸¸è¿è¡Œã€‚ $cmd 130 allow tcp from any to any 139 out $cmd 140 allow tcp from any to any 139 in $cmd 150 allow tcp from any to any 445 out $cmd 160 allow tcp from any to any 445 in $cmd 170 allow udp from any to any 137 out $cmd 180 allow udp from any to any 137 in $cmd 190 allow udp from any to any 138 out $cmd 200 allow udp from any to any 138 in # deny and log everything # æ‹’ç»æ‰€æœ‰æœªæ˜ç¡®å…è®¸çš„æµé‡ï¼Œå¹¶å°†å…¶è®°å½•åˆ°æ—¥å¿—ä¸­ï¼Œä¾¿äºå®¡è®¡å’Œæ•…éšœæ’æŸ¥ã€‚ $cmd 500 deny log all from any to any æ¯ä¸€æ¡è§„åˆ™çš„ç»“æ„åŸºæœ¬éƒ½æ˜¯ï¼š\n# ipfw add [è§„åˆ™ç¼–å·] â‘  [åŠ¨ä½œ] [åè®®] from [æºåœ°å€] to [ç›®æ ‡åœ°å€] [å…¶ä»–æ¡ä»¶] â‘  æŒ‰ä¼˜å…ˆçº§æ’åºï¼Œæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼Œå¯ä¼˜å…ˆè¦†ç›–ç›¸åŒçš„ã€æ•°å­—å¤§çš„è§„åˆ™ã€‚\n$cmd 500 deny log all from any to any â€”â€”\u0026gt; ipfw add 500 deny log all from any to any\næ³¨æ„ `ipfw å‘½ä»¤æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œå®ƒä¼šåœ¨æ‰§è¡Œæ—¶å³æ—¶ç”Ÿæ•ˆï¼Œä½†ä¸ä¼šæ°¸ä¹…ä¿å­˜è§„åˆ™ã€‚ä½ é¡»å†™å…¥æŒ‡å®šçš„è§„åˆ™æ–‡ä»¶ã€‚\næˆ‘ä»¬å¯ä»¥æŠŠé»˜è®¤æ‹’ç»çš„è§„åˆ™ 65535 deny ip from any to any æ”¹æˆé»˜è®¤å…è®¸`\n# echo net.inet.ip.fw.default_to_accept=\u0026#34;1\u0026#34; \u0026gt;\u0026gt; /boot/loader.conf æŸ¥çœ‹ ipfw è§„åˆ™ # ipfw list 00100 allow ip from any to any via lo0 00200 deny ip from any to 127.0.0.0/8 00300 deny ip from 127.0.0.0/8 to any 00400 deny ip from any to ::1 00500 deny ip from ::1 to any 00600 allow ipv6-icmp from :: to ff02::/16 00700 allow ipv6-icmp from fe80::/10 to fe80::/10 00800 allow ipv6-icmp from fe80::/10 to ff02::/16 00900 allow ipv6-icmp from any to any icmp6types 1 01000 allow ipv6-icmp from any to any icmp6types 2,135,136 65535 allow ip from any to any # æ³¨æ„æ­¤å¤„æ˜¯é»˜è®¤å…è®¸äº†ï¼Œåé¢æ²¡äº† ","permalink":"https://hanigege.github.io/posts/freebsd/freebsd-ipfirewallipfw/","tags":null,"title":"Freebsd-Ipfirewall(IPFW)é˜²ç«å¢™ä»‹ç»"},{"categories":["freebsd"],"contents":"åœ¨ pf.conf ä¸­ï¼ŒPF è§„åˆ™çš„é¡ºåºæ˜¯éå¸¸ä¸¥æ ¼çš„ã€‚æ­£ç¡®çš„é¡ºåºåº”è¯¥æ˜¯ï¼š options â€” è®¾ç½® PF çš„å…¨å±€é€‰é¡¹ã€‚\nethernet â€” è®¾ç½®ç½‘ç»œæ¥å£ã€‚\nnormalization â€” è®¾ç½®æ•°æ®åŒ…çš„è§„èŒƒåŒ–ã€‚\nqueueing â€” è®¾ç½®é˜Ÿåˆ—ï¼ˆå¯é€‰ï¼‰ã€‚\ntranslation â€” NAT æˆ– RDR è®¾ç½®ã€‚\nfiltering â€” åŒ…è¿‡æ»¤è§„åˆ™ã€‚\nPFï¼ˆPacket Filterï¼ŒåŒ…è¿‡æ»¤å™¨ï¼‰æ˜¯ä¸€æ¬¾ç”± OpenBSD ç§»æ¤è€Œæ¥çš„é˜²ç«å¢™ï¼Œæä¾›äº†å¤§é‡åŠŸèƒ½ï¼ŒåŒ…æ‹¬ ALTQ (Alternate Queuingï¼Œäº¤é”™é˜Ÿåˆ—) ç­‰ã€‚ å¯ç”¨ PF\n# kldload pf # â‘  åŠ è½½å†…æ ¸æ¨¡å— # ç¤ºä¾‹æ–‡ä»¶ä½œä¸ºé»˜è®¤é…ç½®è§„åˆ™é›†æ–‡ä»¶ï¼Œå¦åˆ™ pf æ— æ³•å¯åŠ¨ â‘¡ # cp /usr/share/examples/pf/pf.conf /etc/ # service pf enable # è®¾ç½® pf å¼€æœºå¯åŠ¨ # service pf start # å¯åŠ¨ pf â‘  å¦‚ä¸åšï¼Œåˆ™æç¤º pfctl: /dev/pf: No such file or directoryã€‚æˆ–è€…ä½ é‡å¯å† service pf startã€‚\nâ‘¡ å¦åˆ™æç¤ºï¼š\n/etc/rc.d/pf: WARNING: /etc/pf.conf is not readable. pfctlå‘½ä»¤è¯¦è§£ pf çš„ç®¡ç†å‘½ä»¤ä¸º pfctlï¼Œå¸¸ç”¨æ“ä½œç¤ºä¾‹å¦‚ä¸‹ï¼š\n# å¯åŠ¨ pfï¼Œç›¸å½“äº service pf start # pfctl -e # å³ç¦æ­¢è§„åˆ™ã€‚å‡ ä¹ç›¸å½“äº service pf stopï¼ˆåœæ­¢é˜²ç«å¢™ï¼‰ # pfctl -d # åŠ è½½è§„åˆ™é›†æ–‡ä»¶ä¸­çš„è§„åˆ™ # pfctl -f /etc/pf.conf # è§£æè§„åˆ™ï¼Œä½†ä¸åŠ è½½ã€‚-f å‚æ•°è¿˜å¯ä»¥ä¸å…¶ä»–å‚æ•°é…åˆï¼Œå¦‚ -N è¡¨ç¤ºåªè½½å…¥ NAT è§„åˆ™ï¼Œ-R è¡¨ç¤ºåªè½½å…¥è¿‡æ»¤è§„åˆ™ï¼Œ-A åªè½½å…¥é˜Ÿåˆ—è§„åˆ™ï¼Œ-O åªè½½å…¥é€‰é¡¹è§„åˆ™ # pfctl -nf /etc/pf.conf # æŸ¥çœ‹ pf æ‰€æœ‰å¯¹è±¡ä¿¡æ¯ã€‚å¦‚æœæƒ³æŸ¥çœ‹ç‰¹å®šå¯¹è±¡ä¿¡æ¯ï¼Œå¯ä»¥ç”¨ natã€queueã€rulesã€Anchorsã€statesã€Sourcesã€infoã€Runningã€labelsã€timeoutsã€memoryã€Tablesã€osfpã€Interfaces æ›¿æ¢ all # pfctl -s all # æ¸…ç† pf æ‰€æœ‰è§„åˆ™ # pfctl -F all å¦‚æœæƒ³æŸ¥çœ‹ç‰¹å®šè§„åˆ™ï¼Œå¯ä»¥ç”¨ natã€queueã€rulesã€statesã€Sourcesã€infoã€Tablesã€osfp æ›¿æ¢ allã€‚\nä¸è¿‡ä»¥ä¸Šæ“ä½œå¹¶æ²¡æœ‰å¯¹è§„åˆ™çš„ç®¡ç†ï¼Œå› æ­¤è¿˜éœ€è¦ä¿®æ”¹è§„åˆ™é›†æ–‡ä»¶ï¼Œå¸¸ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š\n# æ•´ç†æ‰€æœ‰è¾“å…¥çš„æ•°æ® scrub in all # æ‹’ç»æ‰€æœ‰è®¿é—® block all # é»˜è®¤æ˜ç¤ºç¦æ­¢æ‰€æœ‰è®¿é—®ã€‚block æ˜¯åŠ¨ä½œï¼Œall æ˜¯ä»ä»»ä½•æºåˆ°ä»»ä½•ç›®æ ‡çš„ç®€å†™ï¼Œè¡¨ç¤ºä»æºåœ°å€åˆ°ç›®æ ‡åœ°å€ã€‚ # æ”¾å¼€å›ç¯æ¥å£çš„è®¿é—®æƒé™ï¼Œå›ç¯æ¥å£ä¸å¯¹å¤–éƒ¨ pass quick on lo0 all # quick å…³é”®å­—è¡¨ç¤ºè‹¥è§„åˆ™åŒ¹é…ï¼Œå°±åœæ­¢æ‰§è¡Œï¼Œä¸ä¼šå†æ‰§è¡Œåç»­è§„åˆ™ # å¢åŠ  TCP åè®®è®¿é—® 80 ç«¯å£çš„è§„åˆ™ï¼Œå…è®¸ä»»ä½•è®¾å¤‡ä»¥ TCP åè®®è®¿é—®æœ¬æœº 80 ç«¯å£ pass in quick proto tcp from any to 192.168.1.184 port 80 # proto tcp æ˜¯è®¿é—®åè®®ï¼Œport 80 æ˜¯ç›®æ ‡ç«¯å£ # å…è®¸å›æ˜¾ä¿¡æ¯ç»™ä»»ä½•è®¿é—®çš„è®¾å¤‡ pass out quick proto tcp from 192.168.1.184 port 80 to any # å…è®¸æœ¬æœºå‘å¤–å‘é€ 80 ç«¯å£çš„å“åº” # å¢åŠ  80 ç«¯å£åˆ° 8080 ç«¯å£æµé‡è½¬å‘çš„è§„åˆ™ rdr pass on em0 inet proto tcp from any to 192.168.1.184 port 80 -\u0026gt; 192.168.1.166 port 8080 # è½¬å‘æµé‡åˆ°å†…ç½‘åœ°å€ 192.168.1.166 ç«¯å£ 8080 # å…è®¸æœ¬æœºä¸å¤–éƒ¨è®¾å¤‡äº’ ping pass quick inet proto icmp all icmp-type 8 code 0 # icmp-type 8 æ˜¯æŸ¥è¯¢è¯·æ±‚ï¼Œcode 0 è¡¨ç¤ºè¿”å›ç ä¸º 0 # å…è®¸ traceroute å‘½ä»¤ä»¥ ICMP åè®®æ‰§è¡Œ pass out quick inet proto icmp from 192.168.1.184 to any icmp-type 11 code 0 # icmp-type 11 ç”¨äºæ—¶é—´è¶…æ—¶ # å…è®¸ traceroute ä½¿ç”¨ UDP åè®®æ‰§è¡Œï¼Œç«¯å£å·ä» 33434 å¼€å§‹ pass out quick proto udp from 192.168.1.184 to any port 33434 \u0026gt;\u0026lt; 34500 # é»˜è®¤ UDP åè®®ï¼Œç«¯å£å·ä» 33434 å¼€å§‹ï¼Œæ¯è½¬å‘ä¸€æ¬¡ç«¯å£å·åŠ  1 å¯èƒ½ç”¨åˆ°çš„è§„åˆ™é›†æ–‡ä»¶ /etc/pf.conf å¦‚ä¸‹ï¼š # æµé‡æ•´å½¢ scrub in all # è½¬å‘è§„åˆ™ rdr pass on em0 inet proto tcp from any to 192.168.1.184 port 8080 -\u0026gt; 192.168.1.184 port 80 # æ³¨æ„è§„åˆ™æ¬¡åºï¼Œæ ¹æ® pf.conf è§„åˆ™ï¼Œè½¬å‘è§„åˆ™åº”ä½äºè¿‡æ»¤è§„åˆ™ä¹‹å‰ï¼Œç›¸å…³å†…å®¹è¯·å‚è€ƒå¸®åŠ© # è¿‡æ»¤è§„åˆ™ block all pass quick on lo0 all # é˜»æ­¢æ‰€æœ‰æµé‡ï¼Œä½†å…è®¸å›ç¯æ¥å£ï¼ˆlo0ï¼‰ä¸Šçš„æµé‡ # è®¾ç½®ä»»ä½•è®¾å¤‡å¯ä»¥è®¿é—®æœåŠ¡å™¨çš„ 22ã€80ã€443ã€4200ã€10000 ç«¯å£ pass in quick proto tcp from any to 192.168.1.184 port { 22, 80, 443, 4200, 10000 } # è®¾ç½®æœåŠ¡å™¨å¯ä»¥è®¿é—®å¤–éƒ¨è®¾å¤‡çš„ 22ã€80ã€443ã€4200ã€10000 ç«¯å£ pass out quick proto tcp from 192.168.1.184 port { 22, 80, 443, 4200, 10000 } to any # è®¾ç½®æœåŠ¡å™¨è®¿é—®ä»»ä½•ç½‘ç»œè®¾å¤‡çš„ 80ã€443 ç«¯å£ï¼Œå¹¶ä¿æŒçŠ¶æ€ pass out quick proto tcp from 192.168.1.184 to any port { 80, 443 } keep state # è®¾ç½®æœåŠ¡å™¨è®¿é—® DNS æœåŠ¡å™¨ï¼ˆUDP ç«¯å£ 53ï¼‰ pass out quick proto udp from any to any port 53 keep state # è®¾ç½®æœåŠ¡å™¨è®¿é—® DHCP æœåŠ¡å™¨ï¼ˆUDP ç«¯å£ 67ï¼‰ pass out quick proto udp from any to any port 67 keep state # å…è®¸æœåŠ¡å™¨å‘é€ ICMP è¯·æ±‚ pass quick inet proto icmp all icmp-type 8 code 0 # å…è®¸æœåŠ¡å™¨å‘é€ ICMP è¶…æ—¶æ¶ˆæ¯ï¼ˆTTL è¶…è¿‡ï¼‰ pass out quick inet proto icmp from 192.168.1.184 to any icmp-type 11 code 0 # å…è®¸æœåŠ¡å™¨è®¿é—® UDP èŒƒå›´ç«¯å£ 33434 åˆ° 34500 pass out quick proto udp from 192.168.1.184 to any port 33434 \u0026gt;\u0026lt; 34500 ä¿å­˜æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥åœ¨ç»ˆç«¯æ‰§è¡Œå‘½ä»¤ï¼š\n# åŠ è½½è§„åˆ™é›†æ–‡ä»¶ä¸­çš„è§„åˆ™ å°±å¯ä»¥çœ‹åˆ°æ•ˆæœäº†ã€‚ # pfctl -Fa -f /etc/pf.conf ----------------------------------------------------------------\nè¦å–æ¶ˆï¼ˆå¸è½½ï¼‰å·²ç»åŠ è½½çš„å†…æ ¸æ¨¡å— pfï¼Œå¯ä»¥ä½¿ç”¨ kldunload å‘½ä»¤ã€‚å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š kldunload pf è§£é‡Šï¼š kldunload pf ä¼šå¸è½½å·²åŠ è½½çš„ pfï¼ˆPacket Filterï¼‰å†…æ ¸æ¨¡å—ã€‚å¦‚æœè¿™ä¸ªæ¨¡å—æ­£åœ¨è¢«ä½¿ç”¨ï¼ˆä¾‹å¦‚ï¼Œé…ç½®äº†é˜²ç«å¢™è§„åˆ™ï¼‰ï¼Œå¸è½½æ—¶å¯èƒ½ä¼šäº§ç”Ÿä¸€äº›å½±å“ã€‚\nè¯·ç¡®ä¿åœ¨å¸è½½æ¨¡å—å‰æ²¡æœ‰ç›¸å…³æœåŠ¡æˆ–è§„åˆ™åœ¨è¿è¡Œã€‚\næŸ¥çœ‹å½“å‰åŠ è½½çš„å†…æ ¸æ¨¡å—ï¼š ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å½“å‰åŠ è½½çš„å†…æ ¸æ¨¡å—ï¼š\nkldstat è¿™ä¼šåˆ—å‡ºå½“å‰åŠ è½½çš„æ‰€æœ‰å†…æ ¸æ¨¡å—ï¼ŒåŒ…æ‹¬ pfã€‚\næ³¨æ„ï¼š å¦‚æœä½ å¸Œæœ›åœ¨ç³»ç»Ÿé‡å¯åä¸å†åŠ è½½ pf æ¨¡å—ï¼Œå¯ä»¥ç§»é™¤ç›¸å…³çš„é…ç½®æ–‡ä»¶ä¸­çš„ kldload pf æŒ‡ä»¤ï¼Œä¾‹å¦‚ /etc/rc.conf æ–‡ä»¶ä¸­çš„è®¾ç½®ã€‚\n","permalink":"https://hanigege.github.io/posts/freebsd/freebsd-packet-filterpf%E9%98%B2%E7%81%AB%E5%A2%99%E4%BB%8B%E7%BB%8D/","tags":null,"title":"Freebsd-Packet-Filterï¼ˆPFï¼‰é˜²ç«å¢™ä»‹ç»"},{"categories":["freebsd"],"contents":"åœ¨ FreeBSD ä¸Šç¼–è¯‘å¹¶å®‰è£… sing-boxï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œã€‚æˆ‘ä»¬å°†ä½¿ç”¨ git æ‹‰å–æºä»£ç å¹¶ç¼–è¯‘ï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†æ­¥éª¤ï¼š 1. å®‰è£…ä¾èµ–å·¥å…· é¦–å…ˆï¼Œä½ éœ€è¦å®‰è£…ä¸€äº›åŸºç¡€å·¥å…·ï¼Œä¾‹å¦‚ git å’Œ goï¼ˆGo è¯­è¨€ç¯å¢ƒï¼‰ï¼Œä»¥ä¾¿èƒ½ç¼–è¯‘å’Œæ„å»º sing-boxã€‚\npkg update pkg install git ç‚¹å‡»å®‰è£…æœ€æ–°ç‰ˆæœ¬go1.23.1\n2. è·å– Sing-Box æºä»£ç  ç„¶åï¼Œä½¿ç”¨ git å…‹éš† sing-box çš„æºç åº“ï¼š\n# ä¸‹é¢æ˜¯rootç”¨æˆ·å®‰è£… mkdir /usr/local/opt git clone https://github.com/SagerNet/sing-box.git /usr/local/opt/sing-box cd /usr/local/opt/sing-box # ä¸‹é¢æ˜¯æ™®é€šç”¨æˆ·å®‰è£…ï¼Œåªèƒ½å®‰è£…æœ¬çº§ç›®å½•ä¸‹~/ mkdir .usr/local/opt git clone https://github.com/SagerNet/sing-box.git .usr/local/opt/sing-box cd .usr/local/opt/sing-box 3. ç¼–è¯‘ Sing-Box ç¡®ä¿ä½ çš„ç³»ç»Ÿä¸Šå®‰è£…äº† Go è¯­è¨€ç¯å¢ƒåï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥ç¼–è¯‘ sing-boxï¼š\n# æ‰§è¡Œæ„å»ºï¼Œæ²¡æœ‰ä»»ä½•è¾“å‡ºå°±æ˜¯æ„å»ºå®Œ go build -tags \u0026#34;with_quic with_dhcp with_wireguard with_utls with_acme with_clash_api with_gvisor with_grpc with_v2ray_api\u0026#34; ./cmd/sing-box # è¿™ä¼šç¼–è¯‘ sing-box å¹¶å¯ç”¨ QUICåè®®æ”¯æŒã€‚ # ä½ ç°åœ¨åº”è¯¥å¯ä»¥åœ¨å½“å‰ç›®å½•çœ‹åˆ°å¯æ‰§è¡Œæ–‡ä»¶äº† ls -lh sing-box # å¦‚æœä½ è¿˜æƒ³æŠŠå®ƒå®‰è£…åˆ°ç³»ç»Ÿè·¯å¾„ä¸­ï¼Œå¯ä»¥æ‰§è¡Œï¼ˆéœ€è¦ root æƒé™ï¼‰ï¼š sudo install -m 755 sing-box /usr/local/bin/sing-box # æ™®é€šç”¨æˆ·æ‰§è¡Œ go build -tags \u0026#34;with_quic with_dhcp with_wireguard with_utls with_acme with_clash_api with_gvisor with_grpc with_v2ray_api\u0026#34; ./cmd/sing-box # è¿™ä¼šç¼–è¯‘ sing-box å¹¶å¯ç”¨ QUICåè®®æ”¯æŒã€‚ # ä½ ç°åœ¨åº”è¯¥å¯ä»¥åœ¨å½“å‰ç›®å½•çœ‹åˆ°å¯æ‰§è¡Œæ–‡ä»¶äº† ls -lh sing-box # æˆ‘è£…åœ¨äº†ä¹‹å‰goçš„binæ–‡ä»¶å¤¹é‡Œï¼Œå¯ä»¥æ‰§è¡Œï¼š install -m 755 sing-box ~/.usr/local/opt/go/bin/sing-box æˆ–è€…ï¼šï¼ˆæ˜ç™½åŸç†ï¼Œè£…å“ªé‡Œå°±éšå¿ƒæ‰€æ¬²äº†ï¼‰ å¦‚æœä½ æ˜¯ æ™®é€šç”¨æˆ·ï¼ˆé rootï¼‰å¹¶æƒ³ä¸ä½¿ç”¨ sudo å®‰è£… sing-boxï¼Œå¯ä»¥å°†å…¶å®‰è£…åˆ°ä½ è‡ªå·±çš„ $HOME ç›®å½•ä¸‹çš„ bin/ å­ç›®å½•ä¸­ï¼Œè¿™æ˜¯ Unix ç³»ç»Ÿå¸¸ç”¨çš„åšæ³•ä¹‹ä¸€ã€‚\nâœ… æ¨èåšæ³•ï¼š\nmkdir -p ~/bin install -m 755 sing-box ~/bin/sing-box è¿™ä¼šå°† sing-box å®‰è£…åˆ°ä½ çš„ ~/bin/ ç›®å½•ä¸‹ã€‚\nâœ… æ·»åŠ åˆ° PATHï¼ˆå¦‚æœè¿˜æ²¡æ·»åŠ ï¼‰\nå¦‚æœä½ å°šæœªæŠŠ ~/bin åŠ å…¥ç¯å¢ƒå˜é‡ PATHï¼Œè¯·åœ¨ä½ çš„ shell é…ç½®æ–‡ä»¶é‡ŒåŠ ä¸€å¥ï¼š\nå¯¹äº bashï¼š(è£…å¥½bashå°±ç”¨è¿™ä¸ªï¼‰\necho \u0026#39;export PATH=\u0026#34;$HOME/bin:$PATH\u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.bash_profile source ~/.bash_profile å¯¹äº tcshï¼ˆFreeBSD é»˜è®¤ï¼‰ï¼š\necho \u0026#39;setenv PATH \u0026#34;$HOME/bin:$PATH\u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.cshrc source ~/.cshrc å¯¹äº zshï¼š\necho \u0026#39;export PATH=\u0026#34;$HOME/bin:$PATH\u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.zshrc source ~/.zshrc ğŸ” éªŒè¯å®‰è£…\nwhich sing-box sing-box version ç¡®è®¤è¾“å‡ºæ­£ç¡®ç‰ˆæœ¬ä¿¡æ¯å³å¯ã€‚\n4. é…ç½® Sing-Box ä½ éœ€è¦é…ç½® sing-boxï¼Œé€šå¸¸å¯ä»¥å°†é…ç½®æ–‡ä»¶æ”¾ç½®åœ¨ ~/.config/sing-box/ æˆ– /usr/local/etc/sing-box/ ç›®å½•ä¸‹ã€‚ä½ å¯ä»¥åœ¨ sing-box é…ç½®æ–‡ä»¶æ–‡æ¡£ ä¸­æ‰¾åˆ°è¯¦ç»†çš„é…ç½®è¯´æ˜ã€‚\nåˆ›å»ºé…ç½®ç›®å½•ï¼š\n# rootç”¨æˆ· mkdir -p /usr/local/etc/sing-box \u0026amp;\u0026amp; echo \u0026#34;{}\u0026#34; \u0026gt; /usr/local/etc/sing-box/config.json # æ™®é€šç”¨æˆ· mkdir -p ~/.usr/local/etc/sing-box \u0026amp;\u0026amp; echo \u0026#34;{}\u0026#34; \u0026gt; ~/.usr/local/etc/sing-box/config.json å°†é…ç½®æ–‡ä»¶æ”¾åˆ°è¯¥ç›®å½•ä¸‹ï¼Œæˆ–è€…æ ¹æ®å®é™…æƒ…å†µè‡ªå®šä¹‰é…ç½®ã€‚\nsocksé…ç½®å®ä¾‹ï¼š { \u0026#34;log\u0026#34;: { \u0026#34;disabled\u0026#34;: false, \u0026#34;level\u0026#34;: \u0026#34;info\u0026#34;, \u0026#34;timestamp\u0026#34;: true }, \u0026#34;dns\u0026#34;: { \u0026#34;servers\u0026#34;: [ { \u0026#34;tag\u0026#34;: \u0026#34;alidns\u0026#34;, \u0026#34;address\u0026#34;: \u0026#34;https://223.5.5.5/dns-query\u0026#34;, \u0026#34;strategy\u0026#34;: \u0026#34;ipv4_only\u0026#34;, \u0026#34;detour\u0026#34;: \u0026#34;direct\u0026#34; }, { \u0026#34;tag\u0026#34;: \u0026#34;cloudflare\u0026#34;, \u0026#34;address\u0026#34;: \u0026#34;https://1.1.1.1/dns-query\u0026#34;, \u0026#34;strategy\u0026#34;: \u0026#34;ipv4_only\u0026#34;, \u0026#34;detour\u0026#34;: \u0026#34;proxy\u0026#34; }, { \u0026#34;tag\u0026#34;: \u0026#34;block\u0026#34;, \u0026#34;address\u0026#34;: \u0026#34;rcode://success\u0026#34; } ], \u0026#34;rules\u0026#34;: [ { \u0026#34;outbound\u0026#34;: [ \u0026#34;any\u0026#34; ], \u0026#34;server\u0026#34;: \u0026#34;alidns\u0026#34; }, { \u0026#34;domain_suffix\u0026#34;: [ \u0026#34;.cn\u0026#34; ], \u0026#34;server\u0026#34;: \u0026#34;alidns\u0026#34; }, { \u0026#34;rule_set\u0026#34;: [ \u0026#34;geosite-cn\u0026#34; ], \u0026#34;server\u0026#34;: \u0026#34;alidns\u0026#34; }, { \u0026#34;rule_set\u0026#34;: [ \u0026#34;geosite-category-ads-all\u0026#34; ], \u0026#34;server\u0026#34;: \u0026#34;block\u0026#34; } ], \u0026#34;final\u0026#34;: \u0026#34;cloudflare\u0026#34;, \u0026#34;strategy\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;disable_cache\u0026#34;: false, \u0026#34;disable_expire\u0026#34;: false }, \u0026#34;inbounds\u0026#34;: [ { \u0026#34;type\u0026#34;: \u0026#34;socks\u0026#34;, \u0026#34;tag\u0026#34;: \u0026#34;socks-in\u0026#34;, \u0026#34;listen\u0026#34;: \u0026#34;0.0.0.0\u0026#34;, \u0026#34;listen_port\u0026#34;: 1080, \u0026#34;users\u0026#34;: [ ] } ], \u0026#34;outbounds\u0026#34;: [ { \u0026#34;tag\u0026#34;: \u0026#34;proxy\u0026#34;, \u0026#34;server\u0026#34;: \u0026#34;167.232\u0026#34;, // æ”¹åœ°å€ \u0026#34;server_port\u0026#34;: 449, //æ”¹ç«¯å£ \u0026#34;up_mbps\u0026#34;: 50, \u0026#34;down_mbps\u0026#34;: 500, \u0026#34;type\u0026#34;: \u0026#34;hysteria2\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;iry\u0026#34;, //æ”¹å¯†ç  \u0026#34;tls\u0026#34;: { \u0026#34;insecure\u0026#34;: true, \u0026#34;enabled\u0026#34;: true, \u0026#34;server_name\u0026#34;: \u0026#34;bing.com\u0026#34; }, \u0026#34;tcp_fast_open\u0026#34;: false }, { \u0026#34;type\u0026#34;: \u0026#34;direct\u0026#34;, \u0026#34;tag\u0026#34;: \u0026#34;direct\u0026#34; } ], \u0026#34;route\u0026#34;: { \u0026#34;rules\u0026#34;: [ { \u0026#34;action\u0026#34;: \u0026#34;sniff\u0026#34; }, { \u0026#34;protocol\u0026#34;: \u0026#34;dns\u0026#34;, \u0026#34;action\u0026#34;: \u0026#34;hijack-dns\u0026#34; }, { \u0026#34;ip_is_private\u0026#34;: true, \u0026#34;outbound\u0026#34;: \u0026#34;direct\u0026#34; }, { \u0026#34;domain_suffix\u0026#34;: [ \u0026#34;.cn\u0026#34; ], \u0026#34;outbound\u0026#34;: \u0026#34;direct\u0026#34; }, { \u0026#34;rule_set\u0026#34;: [ \u0026#34;geoip-cn\u0026#34;, \u0026#34;geosite-cn\u0026#34;, \u0026#34;geosite-private\u0026#34; ], \u0026#34;outbound\u0026#34;: \u0026#34;direct\u0026#34; }, { \u0026#34;rule_set\u0026#34;: [ \u0026#34;geosite-category-ads-all\u0026#34; ], \u0026#34;action\u0026#34;: \u0026#34;reject\u0026#34; } ], \u0026#34;rule_set\u0026#34;: [ { \u0026#34;tag\u0026#34;: \u0026#34;geoip-cn\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;remote\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;binary\u0026#34;, \u0026#34;url\u0026#34;: \u0026#34;https://raw.githubusercontent.com/SagerNet/sing-geoip/rule-set/geoip-cn.srs\u0026#34;, \u0026#34;download_detour\u0026#34;: \u0026#34;proxy\u0026#34; }, { \u0026#34;tag\u0026#34;: \u0026#34;geosite-cn\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;remote\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;binary\u0026#34;, \u0026#34;url\u0026#34;: \u0026#34;https://raw.githubusercontent.com/SagerNet/sing-geosite/rule-set/geosite-cn.srs\u0026#34;, \u0026#34;download_detour\u0026#34;: \u0026#34;proxy\u0026#34; }, { \u0026#34;tag\u0026#34;: \u0026#34;geosite-private\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;remote\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;binary\u0026#34;, \u0026#34;url\u0026#34;: \u0026#34;https://raw.githubusercontent.com/SagerNet/sing-geosite/rule-set/geosite-private.srs\u0026#34;, \u0026#34;download_detour\u0026#34;: \u0026#34;proxy\u0026#34; }, { \u0026#34;tag\u0026#34;: \u0026#34;geosite-category-ads-all\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;remote\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;binary\u0026#34;, \u0026#34;url\u0026#34;: \u0026#34;https://raw.githubusercontent.com/SagerNet/sing-geosite/rule-set/geosite-category-ads-all.srs\u0026#34;, \u0026#34;download_detour\u0026#34;: \u0026#34;proxy\u0026#34; } ], \u0026#34;auto_detect_interface\u0026#34;: true, \u0026#34;final\u0026#34;: \u0026#34;proxy\u0026#34; }, \u0026#34;experimental\u0026#34;: { \u0026#34;cache_file\u0026#34;: { \u0026#34;enabled\u0026#34;: true, \u0026#34;path\u0026#34;: \u0026#34;cache.db\u0026#34;, \u0026#34;cache_id\u0026#34;: \u0026#34;mycacheid\u0026#34;, \u0026#34;store_fakeip\u0026#34;: true } } } 6. è¿è¡Œ Sing-Box é…ç½®å¥½åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ sing-boxï¼š\n# rootç”¨æˆ· sing-box run -C /usr/local/etc/sing-box/ # æ™®é€šç”¨æˆ· sing-box run -C ~/.usr/local/etc/sing-box/ 7. rootç”¨æˆ·ä¸‹è®¾ç½®ä¸ºæœåŠ¡ï¼ˆå¯é€‰ï¼‰ å¦‚æœä½ å¸Œæœ›å°† sing-box è®¾ç½®ä¸ºç³»ç»ŸæœåŠ¡ï¼Œæ–¹ä¾¿å¼€æœºå¯åŠ¨ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæœåŠ¡è„šæœ¬ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ rc.d æœåŠ¡è„šæœ¬ç¤ºä¾‹ï¼š\nåˆ›å»ºæœåŠ¡è„šæœ¬æ–‡ä»¶ /usr/local/etc/rc.d/sing-boxï¼š\nnano /usr/local/etc/rc.d/sing-box æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\næœ‰é‡å®šå‘æ—¥å¿—åŠŸèƒ½ #!/bin/sh # # PROVIDE: sing_box # REQUIRE: NETWORKING # KEYWORD: shutdown . /etc/rc.subr name=\u0026#34;sing_box\u0026#34; rcvar=sing_box_enable command=\u0026#34;/usr/local/bin/sing-box\u0026#34; pidfile=\u0026#34;/var/run/${name}.pid\u0026#34; command_args=\u0026#34;run -C /usr/local/etc/sing-box/ \u0026gt;\u0026gt; /var/log/singbox.log 2\u0026gt;\u0026amp;1 \u0026amp; echo \\$! \u0026gt; ${pidfile}\u0026#34; load_rc_config $name : ${sing_box_enable:=\u0026#34;NO\u0026#34;} run_rc_command \u0026#34;$1\u0026#34; æ— æ—¥å¿—é‡å®šå‘ç‰ˆæœ¬ï¼š #!/bin/sh # # PROVIDE: sing_box # REQUIRE: NETWORKING # KEYWORD: shutdown . /etc/rc.subr name=\u0026#34;sing_box\u0026#34; rcvar=sing_box_enable command=\u0026#34;/usr/local/bin/sing-box\u0026#34; pidfile=\u0026#34;/var/run/${name}.pid\u0026#34; command_args=\u0026#34;run -C /usr/local/etc/sing-box/ \u0026amp; echo \\$! \u0026gt; ${pidfile}\u0026#34; load_rc_config $name : ${sing_box_enable:=\u0026#34;NO\u0026#34;} run_rc_command \u0026#34;$1\u0026#34; load_rc_config $name ç”¨äºåŠ è½½æœåŠ¡çš„é…ç½®æ–‡ä»¶ï¼Œè€Œ ${sing_box_enable:=\u0026quot;NO\u0026quot;} æ˜¯ä¸ºå˜é‡è®¾ç½®é»˜è®¤å€¼ã€‚è¿™é‡Œçš„é€»è¾‘æ˜¯ï¼š\nâ¦ å¿…é¡»æ·»åŠ ï¼šå¦åˆ™åœ¨ sing_box_enable æœªæ˜ç¡®è®¾ç½®ä¸º YES æ—¶ï¼Œè„šæœ¬ä¼šå› å˜é‡ç¼ºå¤±å¯¼è‡´å¯åŠ¨å¤±è´¥ï¼ˆå¦‚ /etc/rc é”™è¯¯æç¤ºï¼‰\nè®¾ç½®è„šæœ¬ä¸ºå¯æ‰§è¡Œï¼š chmod +x /usr/local/etc/rc.d/sing-box å¯ç”¨æœåŠ¡ï¼š\nsysrc sing_box_enable=YES å¯åŠ¨æœåŠ¡ï¼š\nservice sing-box start æ£€æŸ¥æœåŠ¡çŠ¶æ€ ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š service sing-box status æ™®é€šç”¨æˆ·å¯åŠ¨ç®¡ç†ï¼ˆå¯é€‰ï¼‰ FreeBSD ä¸‹çš„æ™®é€šç”¨æˆ·å¯ä»¥ä¸ºæ”¾åœ¨ç”¨æˆ·ç›®å½•ä¸‹çš„ sing-box è®¾ç½®ç”¨æˆ·çº§åˆ«çš„å¯åŠ¨æœåŠ¡ï¼Œæ›´æ ‡å‡†åšæ³•æ˜¯ä½¿ç”¨ cron @reboot æˆ– login.conf å¯åŠ¨æœºåˆ¶ã€‚ ä¸è¿‡ï¼ŒFreeBSD å¹¶ä¸åƒ Linuxï¼ˆæœ‰ systemd çš„ \u0026ndash;user æ¨¡å¼ï¼‰é‚£æ ·å¯¹ç”¨æˆ·æœåŠ¡æ”¯æŒé‚£ä¹ˆæ ‡å‡†åŒ–ï¼Œä½†ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼å®ç°ï¼š\nâœ… æ–¹æ³•ä¸€ï¼šä½¿ç”¨ crontab å®ç°å¼€æœºè‡ªå¯\n# ç³»ç»Ÿé»˜è®¤çš„æ˜¯vi crontab -e # ä¸´æ—¶æŒ‡å®švimæ‰“å¼€crontab -e EDITOR=vim crontab -e æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼ˆç¡®ä¿ sing-box å¯æ‰§è¡Œï¼‰ï¼š\n@reboot sh -c \u0026#39;$HOME/.usr/local/opt/go/bin/sing-box run -c $HOME/.usr/local/etc/sing-box/config.json \u0026gt; $HOME/.sing-box.log 2\u0026gt;\u0026amp;1 \u0026amp;\u0026#39; è¿™ä¸ªæ–¹å¼ç®€å•æœ‰æ•ˆï¼Œæ— éœ€ root æƒé™ã€‚\nâœ… æ–¹æ³•äºŒï¼šå†™ä¸ªç”¨æˆ·è‡ªå¯è„šæœ¬æ”¾åˆ° .login\nä¾‹å¦‚ï¼Œå¦‚æœä½ ç™»å½•ä½¿ç”¨çš„æ˜¯ç»ˆç«¯ï¼Œå¯ä»¥åœ¨ ~/.login åŠ ä¸€è¡Œï¼š\n$HOME/.usr/local/opt/go/bin/sing-box run -c $HOME.usr/local/etc/sing-box/config.json \u0026gt; $HOME/.sing-box.log 2\u0026gt;\u0026amp;1 \u0026amp; é™„æ™®é€šç”¨æˆ·å¯åŠ¨ç¨‹åºçŸ¥è¯†ç‚¹ï¼š æŸ¥çœ‹è¿›ç¨‹ï¼š pgrep -a sing-box å¦‚æœåœ¨è¿è¡Œä¼šçœ‹ç”¨IDï¼Œæ€è¡Œè¿›ç¨‹å‘½ä»¤ï¼š\nkill -9 ID è¦å°† sing-box run -C ~/.usr/local/etc/sing-box å‘½ä»¤æ”¹ä¸ºåå°è¿è¡Œï¼Œä½ å¯ä»¥æœ‰å‡ ç§æ–¹å¼é€‰æ‹©ï¼š\nâœ… æ–¹æ³• 1ï¼šåŠ  \u0026amp; ç›´æ¥åå°è¿è¡Œ sing-box run -C ~/.usr/local/etc/sing-box \u0026amp; è¿™ä¼šå°†è¿›ç¨‹æ”¾åˆ°åå°è¿è¡Œï¼Œä½†å…³é—­ç»ˆç«¯åä¼šé€€å‡ºï¼Œä¸æ¨èç”¨äºé•¿æœŸæœåŠ¡ã€‚\nâœ… æ–¹æ³• 2ï¼šä½¿ç”¨ nohup ä¿æŒåå°è¿è¡Œï¼ˆæ¨èï¼‰ nohup sing-box run -C ~/.usr/local/etc/sing-box \u0026gt; ~/sing-box.log 2\u0026gt;\u0026amp;1 \u0026amp; è§£é‡Šï¼š\nnohupï¼šé˜²æ­¢è¿›ç¨‹éšç»ˆç«¯é€€å‡ºï¼› \u0026gt; ~/sing-box.logï¼šå°†è¾“å‡ºä¿å­˜åˆ°æ—¥å¿—æ–‡ä»¶ï¼› 2\u0026gt;\u0026amp;1ï¼šåˆå¹¶æ ‡å‡†é”™è¯¯è¾“å‡ºï¼› \u0026amp;ï¼šåå°è¿è¡Œã€‚ ---\nâœ… æ–¹æ³• 3ï¼šä½¿ç”¨ tmux æˆ– screen ç®¡ç†åå°ä»»åŠ¡ï¼ˆé€‚åˆè°ƒè¯•ï¼‰ tmux new -s singbox sing-box run -C ~/.usr/local/etc/sing-box # æŒ‰ Ctrl+B ç„¶å D å¯åå° detach è¿™æ ·ä½ å¯ä»¥éšæ—¶æ¢å¤æ§åˆ¶å°æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ã€‚\n---\nâœ… æ–¹æ³• 4ï¼šå†™å…¥ crontab @reboot å¯åŠ¨ï¼ˆä½ ä¹‹å‰æåˆ°è¿‡ï¼‰ @reboot nohup $HOME/.usr/local/bin/sing-box run -C $HOME/.usr/local/etc/sing-box \u0026gt; $HOME/sing-box.log 2\u0026gt;\u0026amp;1 \u0026amp; `\u0026mdash;\næ€»ç»“ï¼š å®‰è£…ä¾èµ–å·¥å…·ï¼ˆgit å’Œ goï¼‰ã€‚\nå…‹éš† sing-box æºä»£ç å¹¶ç¼–è¯‘ã€‚\nå°†äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…åˆ° /usr/local/bin/ã€‚\né…ç½®å¹¶è¿è¡Œ sing-boxã€‚\nsing-box ä¸­ -C å’Œ -c æ˜¯ä¸åŒçš„å‚æ•°ï¼Œå®ƒä»¬çš„ä½œç”¨å¦‚ä¸‹ï¼š\nâœ… -c ï¼šæŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„ sing-box run -c /usr/local/etc/sing-box/config.json è¿™æ˜¯æœ€å¸¸ç”¨çš„å‚æ•°ã€‚\nç›´æ¥å‘Šè¯‰ sing-box ä½ è¦ç”¨å“ªä¸ªé…ç½®æ–‡ä»¶æ¥å¯åŠ¨ã€‚\né™„ï¼šPFé˜²ç«å¢™å¯ç”¨ï½ ç¼–è¾‘ pf é…ç½®æ–‡ä»¶ æ‰“å¼€ /etc/pf.conf æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n# å®šä¹‰æ¥å£ ext_if = \u0026#34;em0\u0026#34; # ä½ çš„å¤–ç½‘æ¥å£åç§°ï¼Œé€šå¸¸ä¸º em0 æˆ–è€… eth0ï¼Œå…·ä½“çœ‹ä½ çš„ç³»ç»Ÿ # å…è®¸æµé‡é€šè¿‡loopbackæ¥å£ set skip on lo0 # é»˜è®¤æ‹’ç»æ‰€æœ‰å…¥ç«™è¿æ¥ block all # å…è®¸æ‰€æœ‰å‡ºç«™æµé‡ pass out all # å…è®¸æ¥è‡ªæœ¬åœ°ç½‘ç»œçš„æµé‡åˆ°è¾¾22ç«¯å£å’Œ1080ç«¯å£ pass in on $ext_if proto tcp from any to any port 22 keep state pass in on $ext_if proto tcp from any to any port 1080 keep state # å…è®¸å…¶ä»–å·²ç»å»ºç«‹çš„è¿æ¥çš„æ•°æ®åŒ…é€šè¿‡ pass in all keep state å¯ç”¨ pf é˜²ç«å¢™ é…ç½®æ–‡ä»¶å®Œæˆåï¼Œå¯ç”¨ pf é˜²ç«å¢™å¹¶åº”ç”¨è§„åˆ™ï¼š\npfctl -f /etc/pf.conf # åŠ è½½ pf é…ç½®æ–‡ä»¶ pfctl -e # å¯ç”¨ pf é˜²ç«å¢™ éªŒè¯ pf é…ç½® ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥é˜²ç«å¢™è§„åˆ™æ˜¯å¦å·²æˆåŠŸåŠ è½½ï¼š\npfctl -sr ç¡®è®¤è¿æ¥ å…è®¸ 22 ç«¯å£ï¼šä½ å¯ä»¥é€šè¿‡ ssh è¿æ¥åˆ°è¿™å°æœºå™¨ï¼Œç¡®è®¤ 22 ç«¯å£æ˜¯å¦å¼€æ”¾ã€‚\nå…è®¸ 1080 ç«¯å£ï¼šä½ å¯ä»¥é€šè¿‡ SOCKS å®¢æˆ·ç«¯è¿æ¥åˆ°ä½ çš„ SOCKS ä»£ç†ï¼Œç¡®è®¤ 1080 ç«¯å£æ˜¯å¦å¼€æ”¾ã€‚\nå…¶ä»–ç«¯å£ï¼šå…¶ä»–ç«¯å£çš„è¿æ¥ä¼šè¢«é˜»æ­¢ã€‚\né…ç½®è§£é‡Šï¼š å…è®¸æ‰€æœ‰å‡ºç«™æµé‡ï¼š pass out all è§„åˆ™æ”¾è¡Œæ‰€æœ‰ä»æœ¬æœºå‡ºå»çš„æµé‡ã€‚è¿™æ ·ä½ å°±å¯ä»¥è‡ªç”±è®¿é—®å¤–éƒ¨ç½‘ç»œã€‚\nå…è®¸è¿›ç«™æµé‡çš„é™åˆ¶ï¼š pass in on $ext_if proto tcp from any to any port 22 keep state åªå…è®¸å¤–éƒ¨è®¿é—® 22 ç«¯å£ï¼ˆSSHï¼‰ã€‚\npass in on $ext_if proto tcp from any to any port 1080 keep state åªå…è®¸å¤–éƒ¨è®¿é—® 1080 ç«¯å£ï¼ˆä½ çš„ SOCKS æœåŠ¡ï¼‰ã€‚\né»˜è®¤é˜»æ­¢æ‰€æœ‰å…¥ç«™æµé‡ï¼š block all è¿™æ¡è§„åˆ™é˜»æ­¢æ‰€æœ‰æœªè¢«æ˜ç¡®å…è®¸çš„å…¥ç«™æµé‡ï¼Œç¡®ä¿æœåŠ¡å™¨æ›´åŠ å®‰å…¨ã€‚\nä¿æŒè¿æ¥çŠ¶æ€ï¼š keep state ä¿è¯äº†å…è®¸çš„è¿æ¥çŠ¶æ€ï¼ˆå¦‚ SSH å’Œ SOCKSï¼‰çš„æŒç»­æ€§ã€‚æ„å‘³ç€ä½ å»ºç«‹çš„è¿æ¥ä¸ä¼šå› ä¸ºé˜²ç«å¢™è§„åˆ™çš„å˜åŠ¨è€Œè¢«æ„å¤–ä¸­æ–­ã€‚\nè¿™æ ·ï¼Œä½ çš„é˜²ç«å¢™ä¼šå…è®¸å¤–éƒ¨çš„ SSH å’Œ SOCKS æµé‡ï¼Œä½†æ‹’ç»å…¶ä»–ç«¯å£çš„è®¿é—®ï¼ŒåŒæ—¶å…è®¸æ‰€æœ‰çš„å‡ºç«™æµé‡ã€‚\n","permalink":"https://hanigege.github.io/posts/freebsd/freebsd14.2%E6%8B%89%E5%8F%96%E6%BA%90%E7%A0%81%E5%AE%89%E8%A3%85sing-box/","tags":null,"title":"Freebsd14.2æ‹‰å–æºç å®‰è£…sing-Box(åŒ…å«pfé˜²ç«å¢™é…ç½®)"},{"categories":["freebsd"],"contents":"æ‰‹åŠ¨å®‰è£…æœ€æ–°ç‰ˆæœ¬ Go ä» Go å®˜æ–¹ç½‘ç«™ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ Go è¯­è¨€ï¼š\nè®¿é—® Go è¯­è¨€å®˜ç½‘ ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ Goã€‚é€‰æ‹©é€‚åˆ FreeBSD çš„ç‰ˆæœ¬ï¼Œä¾‹å¦‚ go1.23.1.freebsd-amd64.tar.gzï¼Œåé¢å¦‚éœ€ç‰ˆæœ¬æ›´æ–°ï¼Œè¯·è‡ªè¡Œä¿®æ”¹æ–°ç‰ˆæœ¬ä¸‹è½½é“¾æ¥ï¼Œä¸€èˆ¬æƒ…å†µä¸‹åªä¿®æ”¹ç‰ˆæœ¬å·å°±å¯ä»¥äº†ã€‚\nrootç”¨æˆ·å®‰è£…æ–¹æ³•ï¼š fetch https://golang.org/dl/go1.26.0.freebsd-amd64.tar.gz tar -C /usr/local -xzf go1.26.0.freebsd-amd64.tar.gz å¦‚éœ€ä¿®æ”¹å®‰è£…è·¯å¾„ï¼š\nmkdir -p /usr/local/opt/ fetch -o /usr/local/opt/go1.26.0.freebsd-amd64.tar.gz https://golang.org/dl/go1.26.0.freebsd-amd64.tar.gz cd /usr/local/opt/ tar -C /usr/local/opt/ -xzf go1.26.0.freebsd-amd64.tar.gz æ™®é€šç”¨æˆ·çš„å®‰è£…æ–¹æ³•ï¼š(åªèƒ½åœ¨è‡ªå·±ç›®å½•ä¸­æ“ä½œï¼Œå¥½å¤„:å®‰å…¨ï¼Œéš”ç¦»ï¼‰{æ¨è} mkdir -p .usr/local/opt/ fetch -o .usr/local/opt/go1.26.0.freebsd-amd64.tar.gz https://golang.org/dl/go1.26.0.freebsd-amd64.tar.gz cd .usr/local/opt/ tar -C ~/.usr/local/opt/ -xzf go1.26.0.freebsd-amd64.tar.gz è®¾ç½® Go ç¯å¢ƒå˜é‡ï¼š\næ‰“å¼€~/.profile æ–‡ä»¶ï¼Œæ·»åŠ  Go çš„ç¯å¢ƒå˜é‡ï¼š\nåŸæ–¹å¼ï¼š\nexport PATH=$PATH:/usr/local/go/bin æ”¹è·¯å¾„åï¼š\nexport PATH=$PATH:/usr/local/opt/go/bin æ™®é€šç”¨æˆ·ä¸‹ï¼šåœ¨.bash_profile æ–‡ä»¶ä¸­æ·»åŠ å˜é‡ï¼ˆæ™®é€šç”¨æˆ·å·²æ”¹ä¸ºbashæŒ‡ä»¤ï¼‰å¦‚ç”¨æshæŒ‡ä»¤ï¼Œé‚£å°±åœ¨.profileæ–‡ä»¶ä¸­æ”¹ï¼š export PATH=$PATH:~/.usr/local/opt/go/bin åˆ·æ–°é…ç½®æˆ–é‡å¯ç»ˆç«¯ï¼šåœ¨ FreeBSD ä¸­ï¼Œé»˜è®¤ä½¿ç”¨çš„ shell æ˜¯ shï¼Œè€Œ sh ä¸æ”¯æŒ source å‘½ä»¤ã€‚ç›¸åï¼Œsh ä½¿ç”¨ . æ¥ä»£æ›¿ sourceã€‚å› æ­¤ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ shï¼Œéœ€è¦æ”¹ä¸ºä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥åŠ è½½é…ç½®æ–‡ä»¶ï¼š\n. ~/.profile or\n. .bash_profile éªŒè¯ Go ç‰ˆæœ¬æ˜¯å¦æ›´æ–°æˆåŠŸï¼š\ngo version è¾“å‡ºåº”æ˜¾ç¤ºæœ€æ–°çš„ Go ç‰ˆæœ¬ï¼Œä¾‹å¦‚ï¼š\ngo version go1.26.0 freebsd/amd64 æ€»ç»“ï¼š æ›´æ–° Go ç‰ˆæœ¬åˆ° 1.26.0 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚\nå¦‚æœ Go ç‰ˆæœ¬æ›´æ–°æˆåŠŸï¼Œå†æ¬¡å°è¯•è¿è¡Œ make æ¥ç¼–è¯‘ sing-boxã€‚\n","permalink":"https://hanigege.github.io/posts/freebsd/freebsd-install-go1231/","tags":null,"title":"Freebsd Install Goæœ€æ–°ç‰ˆ"},{"categories":["linux"],"contents":"acme.shè„šæœ¬ç”³è¯·cloudflareçš„è¯ä¹¦ æ”¯æŒæ³›åŸŸå å‰è¨€ï¼šacme.shæ˜¯ä¸€ä¸ªéå¸¸å¥½ç”¨çš„ç”¨äºç”³è¯·è¯ä¹¦çš„è„šæœ¬ï¼Œå®ƒå¼€æºåœ¨Githubï¼Œå®ƒæå¤§åœ°é™ä½äº†ç”³è¯·è¯ä¹¦çš„éš¾åº¦ï¼Œæ”¯æŒä½¿ç”¨cloudflare apiç­‰å¤šç§apiæ¥ç”³è¯·è¯ä¹¦ã€‚\næœ¬æ–‡ä¸»è¦ä»‹ç»ä½¿ç”¨æ­¤è„šæœ¬æ¥ç”³è¯· ssl è¯ä¹¦ï¼Œç»™ä½ çš„httpè¯·æ±‚åŠ æŠŠé”ï¼Œå…·ä½“å¯ä»¥ç”¨æ¥cloudflare apiä»‹ç»ã€‚\nå‡†å¤‡æ¡ä»¶ï¼š ä¸€å°è¢«åˆ†é…äº†å…¬ç½‘IPçš„ä¸»æœº\nä¸€ä¸ªåŸŸå(å»ºè®®è´­ä¹°æ”¶è´¹åŸŸå)\nç”µè„‘sshå®¢æˆ·ç«¯\nèƒ½è§£å†³ä¸ªä½“çš„é—®é¢˜\nä¸€ã€å…¨çƒAPIç”³è¯·è¯ä¹¦ 1.1ã€å®‰è£…è„šæœ¬æ–‡ä»¶ ä»¥rootç”¨æˆ·sshè¿æ¥åˆ°ä¸»æœºï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å®‰è£…è„šæœ¬ï¼š\napt update \u0026amp;\u0026amp; apt -y install socat //æ›´æ–°æºå¹¶å®‰è£…socat wget -qO- get.acme.sh | bash //å®‰è£…æ­¤è„šæœ¬ source ~/.bashrc //è®©åˆ«åç”Ÿæ•ˆï¼Œæ­¤åæ— è®ºåœ¨å“ªé‡Œç›´æ¥ä½¿ç”¨acme.shï¼Œä¸ç”¨è¾“ç»å¯¹è·¯å¾„ # ç”±äºæœ€æ–°acme.shè„šæœ¬é»˜è®¤caå˜æˆäº†zerosslï¼Œç°## æ‰§è¡Œä¸‹é¢å‘½ä»¤ä¿®æ”¹è„šæœ¬é»˜è®¤caä¸ºletsencrypt acme.sh --set-default-ca --server letsencrypt 1.2ã€è¯ä¹¦é…ç½® 1.2.1 è·å–Cloudflare api key æ³¨å†Œå¥½cloudflareè´¦å·ï¼ŒæŠŠåŸŸåè§£æçš„è§£ææƒé™é”å®šcloudflareå¤„ç†ï¼Œè¿™æ ·ä»¥ååªéœ€è¦åœ¨cloudflareè¿™é‡Œé…ç½®è§£æè®°å½•ã€‚æŒ‰ç…§å›¾æ ‡è·å–cloudflare api keyã€‚ 1.2.2 ç”³è¯·è¯ä¹¦ï¼ˆäºŒé€‰ä¸€ï¼‰ è¿™é‡Œå‡è®¾æ‚¨çš„åŸŸåæ˜¯yourdomain.comï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤ç”³è¯·è¯ä¹¦ï¼š\n1.2.2.1 dnsæ–¹å¼éªŒè¯\nexport CF_Key=\u0026#34;slfjksjffjfhfhkjhfksjf\u0026#34; //æ­¤å¤„æ›¿æ¢æˆä½ è‡ªå·±çš„Key export CF_Email=\u0026#34;yourcloudflare@gmail.com\u0026#34; //æ­¤å¤„å¡«å†™ä½ ç»™Cloudflareç»‘å®šçš„é‚®ç®±è´¦å· acme.sh --issue --dns dns_cf -d yourdomain.com -d www.yourdomain.com -k ec-256 è¯´æ˜ï¼šCloudflare ç›®å‰ä¸æ”¯æŒ.tk .cf .mlç­‰å…è´¹ç”³è¯·æ¥çš„åŸŸååç¼€ä½¿ç”¨æ­¤ DNS éªŒè¯æ–¹å¼ï¼Œä»˜è´¹åŸŸåæ‰å—æ”¯æŒï¼Œå…è´¹åŸŸåä½¿ç”¨ä½äº 2.2.2 æ–¹å¼ã€‚è„šæœ¬ç”³è¯·åˆ°çš„è¯ä¹¦å’Œå¯†é’¥éƒ½æ”¾åœ¨ç›®å½•ä¸‹~/.acme.sh/yourdomain.com_eccã€‚\n1.2.2.2 httpæ–¹å¼éªŒè¯ æ‰§è¡Œä¸‹é¢å‘½ä»¤å‰è¯·ä¿è¯ä½ 80ç«¯å£æ²¡æœ‰è¢«å…¶ä»–ç¨‹åºä½¿ç”¨ï¼Œå¦‚æœæœ‰ï¼Œkillæ‰ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤å‰éœ€è¦ä½ å…ˆåœ¨cloudflare dnsé‚£é‡Œæ·»åŠ å¥½ä¸€æ¡è®°å½•å¯ä»¥ï¼Œå¼€å¯cloudflare cdnï¼ˆcdnæ­¤æ—¶httpæ–¹å¼éªŒè¯æ— ï¼‰å½±å“ï¼‰ï¼š\nacme.sh --issue --standalone -d yourdomain.com -d www.yourdomain.com -k ec-256 è¯´æ˜ï¼šè·Ÿä¸Šé¢ä¸€æ ·ï¼Œè„šæœ¬ç”³è¯·åˆ°çš„è¯ä¹¦æ”¾åœ¨~/.acme.sh/yourdomain.com_eccç›®å½•ä¸‹\n1.2.3 å®‰è£…è¯ä¹¦åˆ°æŒ‡å®šä½ç½® å¦‚æœlinuxä¸»æœºé‡Œå·²æœ‰/root/sslç›®å½•ï¼Œç°åœ¨å·²ç»æŠŠè¯ä¹¦å’Œå¯†é’¥å®‰è£…åˆ°è¿™ä¸ªç›®å½•ä¸‹ï¼Œé‚£ä¹ˆæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å³å¯ï¼š\nacme.sh --installcert -d yourdomain.com -d www.yourdomain.com --fullchain-file /root/ssl/web.crt --key-file /root/ssl/web.key --ecc 1.3ã€è¯ä¹¦æ›´æ–° ä½†ä»letscncryptç”³è¯·è¯ä¹¦åˆ°çš„ç¨‹åº¦æ˜¯90å¤©ï¼Œè„šæœ¬ä¼šæ¯60å¤©åˆ°è¯ä¹¦è¿›è¡Œæ›´æ–°ï¼Œåç»­å¯èƒ½ä¼šæŒç»­è¿™ä¸ªæ—¶é—´ï¼Œéƒ½æ˜¯è‡ªåŠ¨çš„ã€‚\n# æ‰‹åŠ¨å¼ºåˆ¶æ›´æ–°è¯ä¹¦ acme.sh --renew -d yourdomain.com -d www.yourdomain.com --force --ecc äºŒã€å±€éƒ¨API æœ¬æ–‡ä¸»è¦ä»¥Debian10ä¸ºä¾‹ï¼Œä»‹ç»ä½¿ç”¨æ–°çš„cloudflare apiä»¤ç‰Œæ¥ç”³è¯·è¯ä¹¦ï¼Œå…è´¹åŸŸåå·²ä¸å—cloudflareç¬¬ä¸€æ–¹å¼æ¥ç”³è¯·è¯ä¹¦ï¼Œè¯·ä½¿ç”¨ä»˜è´¹åŸŸåã€‚\n2.1ã€å®‰è£…é…ç½®acme.shè„šæœ¬ ä»¥rootç”¨æˆ·sshç™»é™†åˆ°ä¸»æœºï¼Œä½¿ç”¨ä¸‹é¢å‘½ä»¤å®‰è£…é…ç½®è„šæœ¬ï¼š\næ›´æ–°æºå¹¶å®‰è£…socat apt update \u0026amp;\u0026amp; apt -y install socat # å®‰è£…è„šæœ¬ wget -qO- get.acme.sh | bash # è®©è„šæœ¬åœ¨.bashrcæ–‡ä»¶è¿½åŠ çš„ä¸€è¡Œç¯å¢ƒå˜é‡ç”Ÿæ•ˆï¼Œä»¥åæ— è®ºåœ¨å“ªé‡Œç›´æ¥ä½¿ç”¨acme.shï¼Œä¸ç”¨è¾“ç»å¯¹è·¯å¾„ source ~/.bashrc # ç”±äºæœ€æ–°acme.shè„šæœ¬é»˜è®¤caå˜æˆäº†zerosslï¼Œç°æ‰§è¡Œä¸‹é¢å‘½ä»¤ä¿®æ”¹è„šæœ¬é»˜è®¤caä¸ºletsencrypt acme.sh --set-default-ca --server letsencrypt 2.2ã€é…ç½®Cloudflareç§¯åˆ†ä»¤ç‰Œ 2.2.1 åˆ›å»ºä»£å¸ æ ¹æ®acme.shä½œè€…è„šæœ¬æä¾›çš„æ–‡æ¡£ï¼šä½¿ç”¨æ–°çš„cloudflare apiä»¤ç‰Œï¼Œéœ€è¦æ–°åˆ›å»ºæ­¤ä»¤ç‰Œæ–¹å¯ä½¿ç”¨ï¼š å…¶ä¸­å›¾ç‰‡è®¾ç½®å³å¯ï¼Œé€‰æ‹©æ·»åŠ åŒºåŸŸ-DNS-ç¼–è¾‘å’ŒåŒºåŸŸ-åŒºåŸŸ-è¯»å–æƒé™ï¼ŒåŒºåŸŸèµ„æºé‡Œé¢åŒ…æ‹¬-è´¦æˆ·çš„æ‰€æœ‰åŒºåŸŸ-ä½ çš„è´¦æˆ· é…ç½®å¥½ä»¥åï¼Œç‚¹å‡»åˆ›å»ºä»¤ç‰Œï¼Œæ³¨æ„æ­¤ä»¤ç‰Œtokenåªä¼šå‡ºç°ä¸€æ¬¡ï¼Œåˆ‡è®°ä¿å­˜ï¼Œåˆ‡è®°ä¿å­˜ï¼Œåˆ‡è®°ä¿å­˜ï¼ï¼ï¼\n2.2.2 è·å–è´¦æˆ·IDå’ŒåŒºåŸŸID æ ¹æ®acme.shæ–‡æ¡£ï¼Œç”³è¯·è¯ä¹¦å¯èƒ½è¿˜éœ€è¦æä¾›ä¸¤ä¸ªIDï¼Œå…¶ä¸­è´¦æˆ·IDå¿…é¡»ï¼ŒåŒºåŸŸIDå¯æœ‰æ— ï¼Œæ ¹æ®ä¸‹å›¾æ–¹æ³•è·å–è¿™ä¸¤ä¸ªIDï¼š ä¸‹æ‹‰ï¼Œæ‰¾åˆ°APIåŒºåŸŸï¼š\nè‡³æ­¤ï¼Œå³å‡†å¤‡å¥½ç”³è¯·è¯ä¹¦æ‰€éœ€çš„ææ–™ï¼š\n# ä¸Šé¢ç¬¬ä¸€æ­¥åˆ›å»ºçš„ä»¤ç‰Œï¼Œå³ä¸ºtoken CF_Token=\u0026#34;xxxxxxx\u0026#34; # æ ¹æ®ä¸Šå›¾åˆ†åˆ«è·å–è´¦æˆ·IDå’ŒåŒºåŸŸID CF_Account_ID=\u0026#34;aaaaaaaa\u0026#34; CF_Zone_ID=\u0026#34;bbbbbbbbb\u0026#34; //æ­¤é¡¹éå¿…é¡» 2.3ã€ç”³è¯·é…ç½®è¯ä¹¦ 2.3.1 ç”³è¯·è¯ä¹¦ å¦‚æœæ‚¨çš„åŸŸåæ˜¯example.comï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤ç”³è¯·è¯ä¹¦ï¼Œérootç”¨æˆ·ä¹Ÿæ‰§è¡Œï¼š\n# æ‰§è¡Œæ­¤å‘½ä»¤è®¾ç½®å˜é‡çš„å€¼ï¼Œacme.shè„šæœ¬æ‰§è¡Œè¿‡ç¨‹ä¼šè¯»å– export CF_Token=\u0026#34;xxxxxxx\u0026#34; export CF_Account_ID=\u0026#34;aaaaaaa\u0026#34; export CF_Zone_ID=\u0026#34;bbbbbbbb\u0026#34; //æ­¤é¡¹éå¿…é¡»ï¼Œä¸Šé¢ä¸¤é¡¹éœ€è¦æä¾› # ç”³è¯·è¯ä¹¦ acme.sh --issue -d example.com -d *.example.com --dns dns_cf -k ec-256 2.3.2 å®‰è£…è¯ä¹¦åˆ°æŒ‡å®šä½ç½® å¦‚æœlinuxä¸»æœºé‡Œå·²æœ‰/etc/sslç›®å½•ï¼Œç°åœ¨å·²ç»æŠŠè¯ä¹¦å’Œå¯†é’¥å®‰è£…åˆ°è¿™ä¸ªç›®å½•ä¸‹ï¼Œé‚£ä¹ˆæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å³å¯ï¼š\nacme.sh --installcert -d example.com -d *.example.com --fullchain-file /etc/ssl/web.crt --key-file /etc/ssl/web.key --ecc # ç”¨--reloadcmdæŒ‡å®šå®‰è£…è¯ä¹¦åçš„å‘½ä»¤ acme.sh --installcert -d example.com -d *.example.com --fullchain-file /etc/ssl/web.crt --key-file /etc/ssl/web.key --ecc --reloadcmd \u0026#34;systemctl restart webserver\u0026#34; è¯´æ˜ï¼šè„šæœ¬æ›´æ–°å®Œè¯ä¹¦åï¼Œä¼šè‡ªåŠ¨éµå¾ªä¸Šé¢æŒ‡å®šçš„ç»å¯¹è·¯å¾„å°†è¯ä¹¦å’Œå¯†é’¥å®‰è£…åˆ°æŒ‡å®šä½ç½®ï¼Œå¹¶æ ¹æ®\u0026ndash;reloadcmdæ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚\n------------------------\nä¾‹ï¼šæˆ‘çš„sslç›®å½•è·¯å¾„ä¸ºï¼š #nginxgé…ç½®æ–‡ä»¶é‡Œçš„è¯ä¹¦è·¯å¾„ï¼Œåªé™äºæˆ‘è‡ªå·±ä½¿ç”¨ï¼Œä½ ä»¬éšæ„ ssl_certificate /etc/nginx/certs/web.crt; ssl_certificate_key /etc/nginx/certs/web.key; acme.sh --installcert -d 29.xyz -d *.29.xyz --fullchain-file /root/data/docker_data/nginx/certs/web.crt --key-file /root/data/docker_data/nginx/certs/web.key --ecc #å®‰è£…åˆ°æˆ‘æŒ‡å®šçš„è·¯å¾„ -------------------------\n2.3.3 è¯ä¹¦æ›´æ–° ä»letsencryptç”³è¯·åˆ°çš„è¯ä¹¦æœ‰æ•ˆæœŸæ˜¯90å¤©ï¼Œè„šæœ¬æ¯60å¤©å°†è¿›è¡Œè¯ä¹¦æ›´æ–°ï¼Œä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨å¼ºåˆ¶æ›´æ–°ï¼š\n# æŸ¥è¯¢åŸŸåç”³è¯·è¯ä¹¦ä¿¡æ¯ acme.sh --list # è‡ªåŠ¨æ›´æ–°è¯ä¹¦ ~/.acme.sh/acme.sh --upgrade --auto-upgrade # æ‰‹åŠ¨å¼ºåˆ¶æ›´æ–°è¯ä¹¦ acme.sh --renew -d example.com -d *.example.com --force --ecc acme.sh --renew -d example.com -d *.example.com --force //éECCè¯ä¹¦ä½¿ç”¨æ­¤å‘½ä»¤ é™„ä¸€ä»½nginx.confå®Œæ•´çš„åå‘ä»£ç†é…ç½®æ–‡ä»¶ä¾›å‚è€ƒï¼š events { worker_connections 1024; } http { client_max_body_size 4096m; server { listen 80; listen [::]:80; server_name 29.xyz; return 301 https://$host$request_uri; } server { listen 443 ssl; listen [::]:443 ssl; server_name 29.xyz; ssl_certificate /etc/nginx/certs/web.crt; ssl_certificate_key /etc/nginx/certs/web.key; location / { proxy_pass http://192.168.8.8:8008; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; } } server { listen 80; listen [::]:80; server_name s.29.xyz; return 301 https://$host$request_uri; } server { listen 443 ssl; listen [::]:443 ssl; server_name s.29.xyz; ssl_certificate /etc/nginx/certs/web.crt; ssl_certificate_key /etc/nginx/certs/web.key; location / { proxy_pass http://192.168.8.8:12332; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; } } #htmlé™æ€ç½‘é¡µ server { listen 80; server_name hp.29.xyz; return 301 https://$server_name$request_uri; } server { listen 443 ssl; server_name hp.29.xyz; ssl_certificate /etc/nginx/certs/web.crt; ssl_certificate_key /etc/nginx/certs/web.key; charset utf-8; # æ·»åŠ è¿™è¡Œæ¥æŒ‡å®šç¼–ç  location / { #è§£å†³css.jsåŠ è½½ include mime.types; default_type application/octet-stream; ##è§£å†³css.jså®Œæ¯• root /usr/share/nginx/html; index index.html; } } ##é™æ€ç½‘é¡µå®Œ } ","permalink":"https://hanigege.github.io/posts/linux/%E6%89%8B%E5%8A%A8%E7%94%B3%E8%AF%B7%E5%9F%9F%E5%90%8Dssl%E8%AF%81%E4%B9%A6/","tags":null,"title":"æ‰‹åŠ¨ç”³è¯·åŸŸåsslè¯ä¹¦"},{"categories":["other"],"contents":"å‰è¨€ æˆ‘ä¸ªäººæ­å»ºSIPçš„ä¸»è¦ç›®çš„æ˜¯å› ä¸ºæˆ‘ä¸ªäººæœ‰å¾ˆå¤šæ‰‹æœºå¡ï¼Œè€Œæ‰‹æœºåªæœ‰2ä¸ªå¡æ§½ï¼Œå¹¶ä¸”æ¯å¹´å‡ºå›½ç©çš„æ—¶å€™æ‰‹æœºå¸¦å‡ºå»å°±æ˜¯å…¨çƒæ¼«æ¸¸ï¼Œé‚£åŸºæœ¬ä¸æ•¢æ‰“ç”µè¯ã€‚æ‰€ä»¥å†³å®šæ­å»ºä¸€å¥—è‡ªå·±çš„SIP Serveræ¥è¿›è¡Œæ‹¨æ‰“æ¥å¬ç”µè¯ï¼Œæ‰‹æœºé‡Œåªæ”¾ä¸€å¼ æµé‡å¡ï¼Œè€Œä¸”åœ¨ä¸åŒåœ°ç‚¹å¯ä»¥åœ¨æ‰‹æœºåŸç†èº«è¾¹çš„æ—¶å€™åœ¨å…¶ä»–ç»ˆç«¯æ¥å¬ç”µè¯ã€‚è¿˜èƒ½ç ”ç©¶å­¦ä¹ ä¸€é¡¹æ–°æŠ€æœ¯ï¼ˆç¬‘ï¼‰\nç»è¿‡å¤šæ”¾è€ƒè™‘æœ€åæˆ‘é€‰æ‹©äº†Synwayå‡ºå“çš„SMG4004-4LCè¿™æ¬¾GOIPæœºå™¨ï¼Œæ”¯æŒå…¨ç½‘é€šï¼Œ4ä¸ªå¡æ§½ï¼ˆé•¿æœŸåº”è¯¥æ˜¯å¤Ÿç”¨äº†ï¼‰ï¼ŒSMS Over Emailï¼ˆè™½ç„¶ä»–ä¹Ÿæ”¯æŒSMS Over SIPï¼Œä½†ç”±äºFreePBXå®˜æ–¹ä¸æ”¯æŒï¼Œè€Œä¸”æœ¬æ¬¡æˆ‘åˆ†æœºä¸»è¦åˆ›å»ºçš„æ˜¯PJSIPï¼Œè€Œè¿™æ¬¾æœºå™¨çš„SMSæ˜¯é€šè¿‡Chan SIPå‘é€çš„ï¼Œå¤„ç†èµ·æ¥å¾ˆéº»çƒ¦ï¼Œæœ€åé€‰æ‹©äº†ä½¿ç”¨Emailæ¥æ”¶çš„æ–¹å¼ã€ç¨³å®šä¸€äº›ã€‘ï¼Œå½“ç„¶å®˜æ–¹æä¾›äº†å¤§é‡APIæ¥å£ï¼Œåº”è¯¥æ˜¯å¯ä»¥å†™ä¸€äº›æœºå™¨äººå‘é€åˆ°å¦‚Telegramä¹‹ç±»çš„ã€å·²è§£å†³ï¼Œæœ¬ç«™æœ‰æä¾›ã€‘ï¼‰ï¼Œè€Œä¸”å›½å†…è¿˜æœ‰ä»£ç†å•†ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„ä¹°åˆ°ã€‚\nå¡æ§½ç•Œé¢ æ­å»ºFreePBX æˆ‘ç›´æ¥ä½¿ç”¨äº†å®˜æ–¹ISOé•œåƒï¼ˆåŸºäºCentOSï¼‰è¿›è¡Œé»˜è®¤æ­å»ºï¼Œæ­å®Œè¿˜å‡äº†ä¸ªçº§ï¼Œå…³äºFreePBXè®¾ç½®çš„æ•™ç¨‹ç½‘ä¸Šå¾ˆå¤šï¼Œä¸Šå‡ ä¸ªå›¾å¤§å®¶ä¹Ÿå¯ä»¥å‚ç…§æˆ‘å›¾é‡Œçš„è¿›è¡Œè®¾ç½®ã€‚ è¿˜è¦è®¾ç½® PJSIPçš„UDP,TCPåè®®å¼€å¯ è½¯è·¯ç”±å¼€å¯ç«¯å£ å¯¹æ¥ç½‘å…³ é¦–å…ˆè¦å°†ç½‘å…³æ•´æœºæ³¨å†Œåˆ°FreePBXå®ç°SIPäº’é€š\nåˆ›å»ºä¸­ç»§è´¦å· é€‰æ‹©åˆ›å»ºä¸€ä¸ª chan_sip ä¸­ç»§ é¦–å…ˆä»…å¡«å†™ä¸­ç»§å è·¯ç”±è§„åˆ™å†™ X. SIPè®¾ç½®é¡µé¢å¡«å†™ä¸­ç»§åã€å’Œä¸­ç»§é…ç½®ï¼ˆå¯å‚è€ƒä¸‹æ–¹æˆ‘çš„é…ç½®ï¼‰ host=dynamic port=5160 type=peer secret=da*********************éšä¾¿è®¾ç½®ä¸ªå¯†ç  context=from-pstn dtmfmode=rfc2833 insecure=no qualify=3000 è®¾ç½®å‡ºå±€çº¿è·¯ è®¾ç½®å®Œä¸­ç»§ä¹‹åæˆ‘ä»¬è¿˜éœ€è¦è®¾ç½®ä¸€ä¸‹å‡ºå±€çº¿è·¯è®©FreePBXçš„åˆ†æœºå¯ä»¥æˆåŠŸèµ°ç½‘å…³è¿›è¡Œæ‹¨æ‰“ è®¾ç½®ä¸€ä¸‹åŒ¹é…ä¸­ç»§ è®¾ç½®åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ä¸º X. ä¿å­˜FreePBXé…ç½® ç‚¹å‡» æ³¨å†Œç½‘å…³åˆ°FreePBX æ¥åˆ°ç½‘å…³çš„ç®¡ç†ç•Œé¢ï¼Œä¸€å®šè¦é€‰æ‹©æ³¨å†Œæ•´ä¸ªç½‘å…³ï¼Œå¯†ç å°±æ˜¯åˆ›å»ºä¸­ç»§é…ç½®æ–‡ä»¶é‡Œçš„é‚£ä¸ª ","permalink":"https://hanigege.github.io/posts/other/voip-0/","tags":null,"title":"å‡ºå›½è‡ªå»ºvoip(ä¸€.2)FreePBXå¯¹æ¥SMG4004ç½‘å…³å®ç°SIPç½‘ç»œç”µè¯"},{"categories":["routers"],"contents":"ä¸ºäº†è®©ç½‘ç»œä½å»¶è¿Ÿã€å°åŒ…ä¼˜å…ˆçœŸæ­£ç”Ÿæ•ˆï¼Œç§‘å­¦çš„åšæ³•æ˜¯ï¼šç¦ç”¨ Fasttrackã€‚ æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼Œæ‰¾åˆ°å¹¶ç¦ç”¨ Fasttrack è§„åˆ™ï¼š\nä»£ç æ®µ\n/ip firewall filter # æŸ¥æ‰¾å¸¦æœ‰ fasttrack-connection åŠ¨ä½œçš„è§„åˆ™å¹¶ç¦ç”¨å®ƒ disable [find action=fasttrack-connection] æ³¨æ„ï¼šç¦ç”¨åï¼Œæ‰€æœ‰æµé‡å°†äº¤ç”± CPU è¿›è¡Œ Mangle æ ‡è®°å’Œ Queue æ ‘æ’é˜Ÿã€‚ä½ çš„å°åŒ…ä¼˜å…ˆå’Œé™é€Ÿæœºåˆ¶å°†ç«‹åˆ» 100% ç”Ÿæ•ˆã€‚\nä¾‹ï¼šå¤–ç½‘ä¸‹è¡Œæ˜¯300mï¼Œä¸Šè¡Œæ˜¯30mçš„å¸¦å®½ ä¸‹è¡Œé˜Ÿåˆ—çš„æŒ‚è½½æ¥å£ç²¾å‡†æ›¿æ¢ä¸º bridge1ï¼Œä¸Šè¡Œæ¥å£ä¿æŒ pppoe-out1\næˆåŠŸçš„æ­¥éª¤ä¸ç§‘å­¦è®¡ç®— é¢„ç•™ç¼“å†²é¿å…å…‰çŒ«æ’é˜Ÿï¼š å¿…é¡»æ‰£é™¤è¿è¥å•†æ ‡ç§°å¸¦å®½çš„ 5% åˆ° 10%ï¼Œå°†æ’é˜Ÿæœºåˆ¶å¼ºè¡Œæ‹‰å›åˆ° RouterOS æœ¬åœ°å¤„ç†ï¼Œä»¥å½»åº•æ¶ˆé™¤ç¼“å†²è†¨èƒ€ï¼ˆBufferbloatï¼‰å¸¦æ¥çš„é«˜å»¶è¿Ÿã€‚\nä¸Šè¡Œä¸¥æ ¼é˜ˆå€¼ï¼š 30M Ã— 0.95 = 28M\nä¸‹è¡Œä¸¥æ ¼é˜ˆå€¼ï¼š 300M Ã— 0.95 = 285M\né‡æ„æŒ‚è½½ç‚¹ï¼š å°†ä¸Šè¡Œé˜Ÿåˆ—æŒ‚è½½åœ¨æ‹¨å·æ¥å£ï¼Œä¸‹è¡Œé˜Ÿåˆ—æŒ‚è½½åœ¨å†…ç½‘æ¥å£ã€‚Mangle æ ‡è®°åªéœ€åœ¨ prerouting å’Œ postrouting æŠ“å–ä¸€æ¬¡ï¼Œå³å¯è¢«ä¸Šä¸‹è¡Œé˜Ÿåˆ—åŒæ—¶è°ƒç”¨ã€‚\n1ã€ä»£ç å¯¼å…¥çš„æ–¹æ³• å¯¼å…¥ä»£ç ï¼š\n/ip firewall mangle # 1. ä¼˜å…ˆ DNS add action=mark-packet chain=prerouting protocol=udp dst-port=53 new-packet-mark=dns passthrough=no add action=mark-packet chain=prerouting protocol=tcp dst-port=53 new-packet-mark=dns passthrough=no # 2. ä¼˜å…ˆ ICMP add action=mark-packet chain=prerouting protocol=icmp new-packet-mark=small-packet passthrough=no # 3. æ ¹æ®åŒ…å¤§å°æ ‡è®°ä¸­å°åŒ… (è¦†ç›– TCP ACK å’Œæ¸¸æˆæ•°æ®) add action=mark-packet chain=prerouting packet-size=0-128 new-packet-mark=small-packet passthrough=no add action=mark-packet chain=prerouting packet-size=129-512 new-packet-mark=medium-packet passthrough=no # 4. å‰©ä½™å¤§åŒ…å…œåº• (ä¸‹è½½ã€è§†é¢‘ç­‰) add action=mark-packet chain=prerouting new-packet-mark=large-packet passthrough=no # 5. MSS é’³åˆ¶ add action=change-mss chain=forward protocol=tcp tcp-flags=syn new-mss=clamp-to-pmtu passthrough=yes /queue tree # æ¸…ç†æ—§é˜Ÿåˆ— remove [find] # ================= ä¸Šè¡Œé˜Ÿåˆ— (Upload) ================= # æŒ‚è½½åˆ°å¤–ç½‘æ‹¨å·æ¥å£ pppoe-out1ï¼Œæ€»å¸¦å®½ 28M add name=Upload-Total parent=pppoe-out1 max-limit=28M add name=U1-Dns parent=Upload-Total packet-mark=dns priority=1 queue=default-small limit-at=2M max-limit=28M add name=U2-Small parent=Upload-Total packet-mark=small-packet priority=2 queue=default-small limit-at=5M max-limit=28M add name=U3-Medium parent=Upload-Total packet-mark=medium-packet priority=3 queue=default-small limit-at=10M max-limit=28M add name=U4-Large parent=Upload-Total packet-mark=large-packet priority=8 queue=default-small limit-at=11M max-limit=28M # ================= ä¸‹è¡Œé˜Ÿåˆ— (Download) ================= # æŒ‚è½½åˆ°å†…ç½‘æ¡¥æ¥æ¥å£ bridge1ï¼Œæ€»å¸¦å®½ 285M add name=Download-Total parent=bridge1 max-limit=285M add name=D1-Dns parent=Download-Total packet-mark=dns priority=1 queue=default-small limit-at=5M max-limit=285M add name=D2-Small parent=Download-Total packet-mark=small-packet priority=2 queue=default-small limit-at=20M max-limit=285M add name=D3-Medium parent=Download-Total packet-mark=medium-packet priority=3 queue=default-small limit-at=50M max-limit=285M add name=D4-Large parent=Download-Total packet-mark=large-packet priority=8 queue=default-small limit-at=210M max-limit=285M è¦è®©ä»¥ä¸Š QoS è§„åˆ™çœŸæ­£ç”Ÿæ•ˆï¼Œå¿…é¡»å¤„ç†ï¼ˆç¦ç”¨ï¼‰é˜²ç«å¢™ä¸­çš„ Fasttrackï¼ˆç¡¬ä»¶åŠ é€Ÿï¼‰è§„åˆ™ï¼Œå¦åˆ™æ‰€æœ‰æ•°æ®åŒ…éƒ½ä¼šç›´æ¥ç»•è¿‡ Mangle å’Œ Queue æ ‘ã€‚\nå®ƒä»¬å¯¹â€œå¿«â€çš„å®šä¹‰å®Œå…¨ç›¸åã€‚Fasttrack ä¿éšœçš„æ˜¯â€œæé™ååé‡â€ï¼ˆæµ‹é€Ÿæ•°å­—å¤§ï¼‰ï¼Œå°åŒ…ä¼˜å…ˆä¿éšœçš„æ˜¯â€œæä½å»¶è¿Ÿâ€ï¼ˆå“åº”å¿«ã€ä¸å¡é¡¿ï¼‰ã€‚\nç§‘å­¦äº‹å®ä¸ä¼˜åŠ£åŠ¿å¯¹æ¯” 1. Fasttrackï¼ˆç¡¬ä»¶/åº•å±‚åŠ é€Ÿï¼‰â€”â€” è¿½æ±‚æé™å¸¦å®½\nç§‘å­¦åŸç†ï¼š è®©å»ºç«‹å¥½è¿æ¥çš„æ•°æ®åŒ…å¼ºåˆ¶ç»•è¿‡é˜²ç«å¢™ Mangle å’Œ Queue é˜Ÿåˆ—ï¼Œç›´æ¥åœ¨åº•å±‚è½¬å‘ï¼Œæå¤§å‡è½» CPU è´Ÿæ‹…ã€‚ æ•ˆæœï¼š æµ‹é€Ÿèƒ½è·‘æ»¡ç”šè‡³æº¢å‡ºä½ çš„ 300M å¸¦å®½ï¼Œè·¯ç”±å™¨ CPU å ç”¨ç‡æä½ã€‚ è‡´å‘½ç¼ºé™·ï¼š å®Œå…¨ä¸§å¤±æ‹¥å¡æ§åˆ¶èƒ½åŠ›ã€‚ä¸€æ—¦å±€åŸŸç½‘å†…æœ‰è®¾å¤‡æ»¡é€Ÿä¸‹è½½æˆ–ä¸Šä¼ ï¼ˆç‰¹åˆ«æ˜¯ä½ åªæœ‰ 30M çš„ä¸Šè¡Œï¼‰ï¼Œæ•´ä¸ªç½‘ç»œä¼šå‘ç”Ÿä¸¥é‡çš„ç¼“å†²è†¨èƒ€ï¼ˆBufferbloatï¼‰ï¼Œå¯¼è‡´æ¸¸æˆç–¯ç‹‚è·³ Pingã€ç½‘é¡µè½¬åœˆæ‰“ä¸å¼€ã€‚ 2. å°åŒ…ä¼˜å…ˆï¼ˆQoS Queue Treeï¼‰â€”â€” è¿½æ±‚æè‡´å“åº”\nç§‘å­¦åŸç†ï¼š ä¸»åŠ¨ç‰ºç‰² 5%-10% çš„æé™å¸¦å®½ä½œä¸ºç¼“å†²ç©ºé—´ï¼Œåˆ©ç”¨ CPU ç®—åŠ›å¯¹æ‰€æœ‰æ•°æ®åŒ…è¿›è¡Œç²¾å‡†æ’é˜Ÿï¼Œå¼ºåˆ¶è®© DNSã€æ¸¸æˆå°åŒ…ã€ç½‘é¡µè¯·æ±‚â€œæ’é˜Ÿâ€å…ˆå‘ã€‚ æ•ˆæœï¼š æ— è®ºå†…ç½‘è®¾å¤‡æ€ä¹ˆç–¯ç‹‚ä¸‹è½½æˆ–ä¸Šä¼ ï¼Œæ¸¸æˆå»¶è¿Ÿæ°¸è¿œä¿æŒåœ¨æœ€ä½æ°´å¹³ï¼Œç½‘é¡µå§‹ç»ˆç§’å¼€ï¼Œç½‘ç»œä½“éªŒä¸æ»‘ã€‚ ä»£ä»·ï¼š æµ‹é€Ÿæ•°å­—æœ€é«˜åªèƒ½è¾¾åˆ°ä½ è®¾å®šçš„ 285M å’Œ 28Mï¼Œä¸”ç”±äºæ‰€æœ‰åŒ…éƒ½è¦ç»è¿‡ CPU è¿ç®—ï¼Œè·¯ç”±å™¨ CPU è´Ÿè½½ä¼šå‡é«˜ã€‚ ç¦ç”¨ Fasttrackï¼Œå…¨é¢å¯ç”¨å°åŒ…ä¼˜å…ˆ QoSã€‚ç”¨æµ‹é€Ÿè½¯ä»¶ä¸Šå°‘è·‘ 15M çš„æ•°å­—ï¼Œæ¢å–å…¨å¤©å€™æ°¸è¿œä¸å¡é¡¿çš„é«˜è´¨é‡ç½‘ç»œä½“éªŒï¼Œè¿™æ‰æ˜¯çœŸæ­£çš„â€œç½‘é€Ÿå¿«â€ã€‚\nä¾‹ï¼šä¸‹è¡Œæ˜¯350mpbs ä¸‹è¡Œæ˜¯50mpbs ç…§ä½ æœ€æ–°ç¡®è®¤çš„ç‰©ç†æé™ï¼ˆä¸‹è¡Œ 350Mbpsï¼Œä¸Šè¡Œ 50Mbpsï¼‰é‡æ–°è®¡ç®—é˜²æ‹¥å µé˜ˆå€¼ï¼Œç¡®ä¿é¢„ç•™ 5% çš„æ’é˜Ÿç¼“å†²ç©ºé—´ã€‚\nç§‘å­¦è®¡ç®—ä¸æ–°é˜ˆå€¼ ä¸Šè¡Œä¸¥æ ¼é˜ˆå€¼ï¼š 50M Ã— 0.95 = 47M\nä¸‹è¡Œä¸¥æ ¼é˜ˆå€¼ï¼š 350M Ã— 0.95 = 332M\næˆåŠŸçš„è°ƒæ•´æ­¥éª¤ è¯·ç›´æ¥åœ¨ ROS ç»ˆç«¯æ‰§è¡Œä»¥ä¸‹å®Œæ•´ä»£ç ï¼Œè¦†ç›–ä¹‹å‰çš„é˜Ÿåˆ—é…ç½®ï¼ˆMangle æ ‡è®°ä¿æŒä¸å˜ï¼‰\n/queue tree # æ¸…ç†æ—§é˜Ÿåˆ— remove [find] # ================= ä¸Šè¡Œé˜Ÿåˆ— (Upload: é€‚é… 50Mï¼Œå®è®¾ 47M) ================= add name=Upload-Total parent=pppoe-out1 max-limit=47M add name=U1-Dns parent=Upload-Total packet-mark=dns priority=1 queue=default-small limit-at=3M max-limit=47M add name=U2-Small parent=Upload-Total packet-mark=small-packet priority=2 queue=default-small limit-at=8M max-limit=47M add name=U3-Medium parent=Upload-Total packet-mark=medium-packet priority=3 queue=default-small limit-at=15M max-limit=47M add name=U4-Large parent=Upload-Total packet-mark=large-packet priority=8 queue=default-small limit-at=21M max-limit=47M # ================= ä¸‹è¡Œé˜Ÿåˆ— (Download: é€‚é… 350Mï¼Œå®è®¾ 332M) ================= add name=Download-Total parent=bridge1 max-limit=332M add name=D1-Dns parent=Download-Total packet-mark=dns priority=1 queue=default-small limit-at=5M max-limit=332M add name=D2-Small parent=Download-Total packet-mark=small-packet priority=2 queue=default-small limit-at=30M max-limit=332M add name=D3-Medium parent=Download-Total packet-mark=medium-packet priority=3 queue=default-small limit-at=80M max-limit=332M add name=D4-Large parent=Download-Total packet-mark=large-packet priority=8 queue=default-small limit-at=217M max-limit=332M åˆ«å¿˜äº†å¯¼å…¥ipv6çš„mangleè§„åˆ™ /ipv6 firewall mangle # ä¼˜å…ˆ DNS (UDP/TCP 53) add action=mark-packet chain=prerouting protocol=udp dst-port=53 new-packet-mark=dns passthrough=no add action=mark-packet chain=prerouting protocol=tcp dst-port=53 new-packet-mark=dns passthrough=no # ä¼˜å…ˆ ICMPv6 (Pingï¼Œæ³¨æ„åè®®åä¸º icmpv6) add action=mark-packet chain=prerouting protocol=icmpv6 new-packet-mark=small-packet passthrough=no # æ ‡è®°æ‰€æœ‰å°åŒ…ä¸ä¸­åŒ… add action=mark-packet chain=prerouting packet-size=0-128 new-packet-mark=small-packet passthrough=no add action=mark-packet chain=prerouting packet-size=129-512 new-packet-mark=medium-packet passthrough=no # å‰©ä½™å¤§åŒ…å…œåº• (å½»åº•æ‹¦æˆª IPv6 æµ‹é€Ÿå’Œä¸‹è½½) add action=mark-packet chain=prerouting new-packet-mark=large-packet passthrough=no ä¼˜åŒ–å†…ç½‘sing-boxçš„æµé‡è§„åˆ™ ï¼ˆå¯é€‰ï¼‰ /ip firewall mangle # 1. æŠ“å– IPv4 sing-box å‘èµ·çš„æ‰€æœ‰åŒå‘è¿æ¥ add action=mark-connection chain=prerouting src-address=10.20.20.6 new-connection-mark=proxy-conn passthrough=yes place-before=0 # 2. èµ‹äºˆä¸“å±æ•°æ®åŒ…æ ‡è®°ï¼Œå¹¶é˜»æ­¢å…¶è¿›å…¥åç»­çš„å¤§å°åŒ…åˆ†ç±» add action=mark-packet chain=prerouting connection-mark=proxy-conn new-packet-mark=proxy-packet passthrough=no place-before=1 /ipv6 firewall mangle # 3. æŠ“å– IPv6 sing-box å‘èµ·çš„æ‰€æœ‰åŒå‘è¿æ¥ add action=mark-connection chain=prerouting src-address=fd88::6666 new-connection-mark=proxy-conn passthrough=yes place-before=0 # 4. èµ‹äºˆä¸“å±æ•°æ®åŒ…æ ‡è®° add action=mark-packet chain=prerouting connection-mark=proxy-conn new-packet-mark=proxy-packet passthrough=no place-before=1 /queue tree # 5. åœ¨ä¸Šè¡Œå’Œä¸‹è¡Œæ€»é˜Ÿåˆ—ä¸‹ï¼Œæ’å…¥ç‹¬ç«‹çš„ä»£ç†é«˜ä¼˜é˜Ÿåˆ— (Priority 2ï¼Œäº«å—ä¸æ™®é€šå°åŒ…åŒç­‰çš„ VIP æ’é˜Ÿç‰¹æƒ) add name=U1.5-Proxy parent=Upload-Total packet-mark=proxy-packet priority=2 queue=default-small limit-at=10M max-limit=47M add name=D1.5-Proxy parent=Download-Total packet-mark=proxy-packet priority=2 queue=default-small limit-at=50M max-limit=332M éªŒè¯æ­¥éª¤ ä¸ºäº†è®©å…³é—­ Fasttrack çš„åŠ¨ä½œç«‹åˆ»ã€å½»åº•åœ°å¯¹å…¨å±€ç”Ÿæ•ˆï¼Œå¿…é¡»æš´åŠ›æ¸…ç©ºè·¯ç”±å™¨å†…å­˜ä¸­çš„è¿æ¥è¿½è¸ªè¡¨ï¼Œå¼ºåˆ¶æ‰€æœ‰è®¾å¤‡é‡æ–°æ¡æ‰‹ï¼Œè€è€å®å®å»æ’é˜Ÿã€‚\nè¯·åœ¨ ROS ç»ˆç«¯æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š\n# å¼ºåˆ¶æ¸…ç©ºæ‰€æœ‰ç°æœ‰è¿æ¥çŠ¶æ€ï¼ˆæ³¨æ„ï¼šæ‰§è¡Œç¬é—´å…¨å®¶ç½‘ç»œä¼šæ–­å¼€ 1-2 ç§’ï¼Œéšåè‡ªåŠ¨é‡è¿ï¼‰ /ip firewall connection remove [find] æ‰§è¡Œå®Œæ¯•åï¼Œè¯·ç«‹åˆ»å†è·‘ä¸€æ¬¡æµ‹é€Ÿã€‚æµ‹é€Ÿç½‘\nç§‘å­¦æŒ‡æ ‡ï¼š è¿™æ¬¡å¦‚æœä¸Šè¡Œè¢«æ­»æ­»é’³åˆ¶åœ¨49Mbpsä»¥å†…ï¼Œä¸‹è¡Œå¡åœ¨ 332M å·¦å³ï¼Œå°±è¯æ˜ QoS çš„å¤§é—¨çœŸæ­£å…³ä¸Šäº†ï¼Œæ’é˜Ÿæœºåˆ¶å®Œç¾ç”Ÿæ•ˆã€‚ çªç ´é˜ˆå€¼çš„æ•°å­¦çœŸç›¸ï¼š ä½ çš„ä¸Šè¡Œæµ‹é€Ÿè·‘åˆ°äº† 48.57 Mbpsã€‚æˆ‘ä»¬è®¾å®šçš„é™é€Ÿæ˜¯ 47Mã€‚åœ¨ RouterOS çš„åº•å±‚å•ä½æ¢ç®—ä¸­ï¼Œå®ƒæ˜¯æŒ‰ 1024 è¿›ä½è®¡ç®—çš„ï¼š47M = 47 Ã— 1024 Ã— 1024 bps = 49,283,072 bpsã€‚å°†å®ƒæ¢ç®—æˆæµ‹é€Ÿç½‘ç«™å¸¸ç”¨çš„åè¿›åˆ¶ Mbpsï¼Œç†è®ºå€¼æ­£å¥½æ˜¯ 49.28 Mbpsã€‚è¿™è¯´æ˜ä¸ä»… QoS é˜Ÿåˆ—ç²¾å‡†è½åœ°ï¼Œè€Œä¸”ä½ ä¸€æ»´å¸¦å®½éƒ½æ²¡æœ‰æµªè´¹ï¼Œç²¾å‡†å¡åœ¨äº†ç‰©ç†æé™çš„æœ€å®Œç¾å¹³è¡¡ç‚¹ä¸Šã€‚\n","permalink":"https://hanigege.github.io/posts/routers/ros%E7%9A%84mangle%E5%B0%8F%E5%8C%85%E8%A7%84%E5%88%99/","tags":null,"title":"è‡ªç”¨ROSçš„MANGLEå°åŒ…è§„åˆ™"},{"categories":["freebsd"],"contents":"æˆ‘ä¸ªäººä¸å»ºè®®å®‰è£…å¼€å¯sudo,å› ä¸ºæ™®é€šç”¨æˆ·ç”¨è‡ªå·±çš„å¯†ç å°±å¯ä»¥æå‡ç®¡ç†æƒé™ã€‚ä¸ªäººç†è§£è¿˜æ˜¯å®Œå…¨éš”ç¦»çš„å¥½ **ä¸‹é¢åªæä¾›çŸ¥è¯†ç‚¹å‚è€ƒ**ï½\nå®‰è£…freebsdæ—¶å·²ç»æ·»åŠ å¥½æ™®é€šç”¨æˆ·çš„ï¼Œå¯ä»¥ç›´æ¥ä»ä¸‹é¢å¯ä»¥ç”¨ visudo æ‰“å¼€ sudo é…ç½®æ–‡ä»¶ è¿™é‡Œç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶å°±å¯ä»¥äº†ã€‚ ä½ çœ‹åˆ°çš„æç¤ºï¼š\ngary is not in the sudoers file. This incident has been reported to the administrator. æ„æ€æ˜¯ï¼šå½“å‰ç”¨æˆ· gary æ²¡æœ‰æƒé™ä½¿ç”¨ sudoï¼Œå› æ­¤ä¸èƒ½å®‰è£…è½¯ä»¶æˆ–æ‰§è¡Œéœ€è¦ç®¡ç†å‘˜æƒé™çš„æ“ä½œã€‚\nè§£å†³åŠæ³•ï¼ˆéœ€è¦ root ç”¨æˆ·æ“ä½œï¼‰ ä½ éœ€è¦åˆ‡æ¢åˆ° root ç”¨æˆ·ï¼Œç„¶åæŠŠ gary æ·»åŠ åˆ° sudo æƒé™ç»„ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š\nâœ… 1. ç”¨ root ç”¨æˆ·ç™»å½•ï¼Œæˆ–è€…ç”¨ su åˆ‡æ¢åˆ° rootï¼š\nsu - ç³»ç»Ÿä¼šæç¤ºä½ è¾“å…¥ root çš„å¯†ç ï¼Œä¸æ˜¯ gary çš„å¯†ç ã€‚\nâœ… 2. å®‰è£… sudoï¼ˆå¦‚æœè¿˜æ²¡è£…ï¼‰ï¼š\npkg install sudo âœ… 3. æŠŠ gary ç”¨æˆ·æ·»åŠ åˆ° wheel ç»„ï¼š(å¦‚æœå®‰è£…ç³»ç»Ÿæ—¶å·²åŠ å…¥wheelç»„å°±ä¸éœ€è¦ä¸‹é¢çš„å†æ¬¡æ“ä½œï¼‰\npw usermod gary -G wheel é»˜è®¤ FreeBSD çš„ sudoers æ–‡ä»¶å…è®¸ wheel ç»„çš„ç”¨æˆ·ä½¿ç”¨ sudoã€‚\nâœ… 4. ç¡®è®¤ sudoers é…ç½®ä¸­å…è®¸ wheel ç»„ä½¿ç”¨ sudoï¼š\nå¯ä»¥ç”¨ visudo æ‰“å¼€ sudo é…ç½®æ–‡ä»¶ï¼šï¼ˆé»˜è®¤viå‘½ä»¤æ‰“å¼€ï¼‰ visudo æŒ‡å®švimå‘½ä»¤æ‰“å¼€visudoæ–‡ä»¶ï¼š EDITOR=vim visudo ç¡®ä¿æœ‰ä»¥ä¸‹å†…å®¹ï¼ˆæ²¡æœ‰æ³¨é‡Š #ï¼‰ï¼š %wheel ALL=(ALL:ALL) ALL ç‰¹åˆ«è¯´æ˜ï¼šæ‰“å¼€visudoæ–‡ä»¶åï¼Œä¼šçœ‹åˆ°ä¸‹é¢ä¸‰ç§ï¼Œåªéœ€è¦å»æ‰å¸¦%wheel ALL=(ALL:ALL) ALLå‰é¢çš„#å·å°±è¡Œäº†ï¼š root ALL=(ALL:ALL) ALL ## Uncomment to allow members of group wheel to execute any command # %wheel ALL=(ALL:ALL) ALL ## Same thing without a password # %wheel ALL=(ALL:ALL) NOPASSWD: ALL ## Uncomment to allow members of group sudo to execute any command # %sudo ALL=(ALL:ALL) ALL âœ… 5. ç°åœ¨ç”¨ gary ç™»å½•ï¼Œå°±èƒ½ç”¨ sudo äº†ï¼š sudo pkg install bash ..... ","permalink":"https://hanigege.github.io/posts/freebsd/freebsd%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8sudo/","tags":null,"title":"Freebsdæ™®é€šç”¨æˆ·å¦‚ä½•ä½¿ç”¨sudo"},{"categories":["other"],"contents":"dockeræ­å»ºCoturn TURNæœåŠ¡å™¨ å…±ä¸¤ç§æ–¹æ¡ˆï¼š ç¬¬ä¸€ç§æ–¹æ¡ˆï¼ˆè¦äº†è§£ï¼‰ å…ˆå»ºç«‹ä¸€ä¸ªæ–‡ä»¶å¤¹ mkdir -p ~/data/docker_data/coturn/etc/coturn mkdir -p ~/data/docker_data/coturn/var/run mkdir -p ~/data/docker_data/coturn/var/log #å¦‚æœç”¨ä¸‹é¢ç¬¬ä¸€ç§æ–¹æ¡ˆè¿™ä¸ªæ‰éœ€è¦å»ºç«‹ï¼Œç¬¬äºŒç§ä¸éœ€è¦ cd ~/data/docker_data/coturn/etc/coturn touch turnserver.conf cd ~/data/docker_data/coturn/var/run touch turnserver.pid cd ../../ chmod 777 -R var æ‹‰å–é•œåƒ\ndocker pull coturn/coturn ç›´æ¥hostæ–¹å¼è¿è¡Œ\ndocker run -d --network=host \\ -v /root/data/docker_data/coturn/etc/coturn/turnserver.conf:/etc/coturn/turnserver.conf \\ -v /root/data/docker_data/coturn/etc/:/etc/ \\ -v /root/data/docker_data/coturn/var:/var \\ coturn/coturn è¿è¡Œæ—¶ä¸åŠ  -d å…ˆçœ‹è¾“å…¥æœ‰é”™è¯¯å—ï¼ åŒæ—¶æŸ¥çœ‹varä¸‹çš„logçœ‹ç›¸å…³çš„é—®é¢˜ è°ƒè¯•å¯åŠ¨å‘½ä»¤ï¼šåœæ­¢å®¹å™¨åä¼šè‡ªåŠ¨å›¾åˆ é™¤å®¹å™¨ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š\ndocker run --network=host \\ -v /root/data/docker_data/coturn/etc/coturn/turnserver.conf:/etc/coturn/turnserver.conf \\ -v /root/data/docker_data/coturn/etc/:/etc/ \\ -v /root/data/docker_data/coturn/var:/var \\ --rm \\ coturn/coturn å“ªæœå»æ‰äº†é…ç½®æ–‡ä»¶é‡Œçš„æŒ‡å®šlogï¼Œåœç”¨cliåŠŸèƒ½ï¼Œä¸‹é¢æœ‰è¯´æ˜ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å¯åŠ¨å‘½ä»¤ï¼š\ndocker run -d --network=host \\ -e DETECT_EXTERNAL_IP=yes \\ -e DETECT_RELAY_IP=yes \\ -v /root/data/docker_data/coturn/etc/coturn/turnserver.conf:/etc/coturn/turnserver.conf \\ -v /root/data/docker_data/coturn/etc/:/etc/ \\ -v /root/data/docker_data/coturn/var:/var \\ coturn/coturn \\ -n --log-file=stdout ä½ ä¹‹åä¸è¦1~65535å…¨éƒ½å¼€æ”¾ å®è¡Œç™½åå•æ”¾è¡Œæ¨¡å¼\næ¯”å¦‚coturnåªå¼€æ”¾ä»¥ä¸‹\n3478\n5349\nä¸Šé¢ä¸¤ä¸ªtcp udpå…¨æ‰“å¼€\n49152~65535\nç”Ÿæˆè¯ä¹¦ï¼š\nsudo openssl req -x509 -newkey rsa:2048 -keyout /etc/turn_server_pkey.pem -out /etc/turn_server_cert.pem -days 99999 -nodes ç”Ÿæˆçš„ä¸¤ä¸ªè¯ä¹¦ä¼ è¾“åˆ° /root/data/docker_data/coturn/etc/ æ–‡ä»¶å¤¹ä¸‹ã€‚å¯ä»¥å…ˆä¸‹è½½ä¸‹æ¥ï¼Œå†ä¼ åˆ°ç›¸åº”çš„æ–‡ä»¶å¤¹é‡Œã€‚ æˆ–è€…ä¸€æ­¥åˆ°ä½ç›´æ¥ç”Ÿæˆåˆ°ç›®æ ‡æ–‡ä»¶å¤¹\nsudo openssl req -x509 -newkey rsa:2048 -keyout /root/data/docker_data/coturn/etc/turn_server_pkey.pem -out /root/data/docker_data/coturn/etc/turn_server_cert.pem -days 99999 -nodes netstat -anpl | grep turnserver #æ£€æµ‹ Dibianæ²¡æœ‰è¿™ä¸ªå‘½ä»¤ï¼Œå¯ä»¥å®‰è£…ï¼š\napt-get install net-tools æå®šï¼ ç”ŸæˆéªŒè¯å¯†é’¥åˆ°test.confæ–‡ä»¶ï¼Œç”Ÿæˆåæ‰“å¼€æ–‡ä»¶å¤åˆ¶å¯†é’¥æ›¿æ¢ä¸‹é¢é…ç½®æ–‡ä»¶é‡Œçš„å¯†é’¥ï¼šï¼ˆç‰¹åˆ«è¯´æ˜ï¼Œå¯†é’¥çš„é•¿åº¦å¯ä»¥ä¿®æ”¹ä¸‹é¢å‘½ä»¤è¡Œé‡Œçš„256å‚æ•°ï¼Œå»ºè®®è®¾ä¸º68å³å¯ï¼Œä¹Ÿå°±æ˜¯68ä¸ªå­—ç¬¦\necho \u0026#34;static-auth-secret=$(cat /dev/urandom | tr -cd \u0026#39;[:alnum:]\u0026#39; | fold -w 256 | head -n 1)\u0026#34; | sudo tee /root/test.conf å¦‚ä¸‹ï¼š\necho \u0026#34;static-auth-secret=$(cat /dev/urandom | tr -cd \u0026#39;[:alnum:]\u0026#39; | fold -w 68 | head -n 1)\u0026#34; | sudo tee /root/test.conf å…·ä½“é…ç½®æ–‡ä»¶æ˜¯ï¼šturnserver.conf è·¯å¾„ä¸ºï¼š/root/data/docker_data/coturn/etc/coturn\nCOTURN Server é…ç½®æ ·ä¾‹ï¼šturnserver.conf\nuse-auth-secret static-auth-secret=ynojlSEBrJ6VjFHNyjJiyZRnnMUQ0WKAsSzGdMhL8he realm=coturn.1.xyz #æŒ‡å®š Coturn çš„æ—¥å¿—æ–‡ä»¶è·¯å¾„ log-file=/var/log/turnserver.log # VoIP traffic is all UDP. There is no reason to let users connect to arbitrary TCP endpoints via the relay. no-tcp-relay # è°ƒè¯•æ—¥å¿—çº§åˆ« verbose=1 cli-password=8al8la.com # Set a non-empty CLI password # don\u0026#39;t let the relay ever try to connect to private IP address ranges within your network (if any) # given the turn server is likely behind your firewall, remember to include any privileged public IPs too. denied-peer-ip=10.0.0.0-10.255.255.255 denied-peer-ip=192.168.0.0-192.168.255.255 denied-peer-ip=172.16.0.0-172.31.255.255 # special case the turn server itself so that client-\u0026gt;TURN-\u0026gt;TURN-\u0026gt;client flows work allowed-peer-ip=10.0.0.1 listener-ip=coturn.1.xyz relay-ip=coturn.1.xyz # consider whether you want to limit the quota of relayed streams per user (or total) to avoid risk of DoS. user-quota=12 # 4 streams per video call, so 12 streams = 3 simultaneous relayed calls per user. total-quota=1200 # TLS certificates, including intermediate certs. # æŒ‡å®šäº† TLS è¯ä¹¦æ–‡ä»¶çš„è·¯å¾„ cert=/etc/turn_server_cert.pem # æŒ‡å®šäº† TLS ç§é’¥æ–‡ä»¶çš„è·¯å¾„ pkey=/etc/turn_server_pkey.pem pidfile=/var/run/turnserver.pid ä¿®æ”¹ä¸Šé¢çš„åŸŸåï¼Œå’Œé‚£ä¸€ä¸²å¯†ç ï¼Œä¿å­˜åé‡å¯coturnçš„å®¹å™¨ï¼\nè°ƒè¯•æ—¥å¿—è¯´æ˜ åœ¨æ‚¨æä¾›çš„é…ç½®ä¸­ï¼Œæ—¥å¿—è°ƒè¯•çº§åˆ«ç”±verboseå‚æ•°æŒ‡å®šã€‚åœ¨æ‚¨çš„é…ç½®ä¸­ï¼Œverboseè®¾ç½®ä¸º1ï¼Œè¡¨ç¤ºå¯ç”¨äº†æœ€ä½çº§åˆ«çš„è°ƒè¯•æ—¥å¿—ã€‚\nè°ƒè¯•çº§åˆ«é€šå¸¸æœ‰ä¸åŒçš„å€¼ï¼Œç”¨äºæ§åˆ¶æ—¥å¿—çš„è¯¦ç»†ç¨‹åº¦ã€‚å¸¸è§çš„çº§åˆ«åŒ…æ‹¬ï¼š\n0ï¼šå…³é—­è°ƒè¯•æ—¥å¿—ï¼Œåªè®°å½•é”™è¯¯å’Œå…³é”®ä¿¡æ¯ã€‚\n1ï¼šæœ€ä½çº§åˆ«çš„è°ƒè¯•ï¼Œé€šå¸¸ç”¨äºè®°å½•åŸºæœ¬çš„æ“ä½œä¿¡æ¯å’Œè­¦å‘Šã€‚\n2ï¼šä¸­ç­‰çº§åˆ«çš„è°ƒè¯•ï¼Œè®°å½•æ›´å¤šçš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸€äº›å†…éƒ¨æ“ä½œçš„ç»†èŠ‚ã€‚\n3ï¼šæœ€é«˜çº§åˆ«çš„è°ƒè¯•ï¼Œè®°å½•éå¸¸è¯¦ç»†çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¯ä¸ªæ­¥éª¤çš„æ“ä½œå’ŒçŠ¶æ€ã€‚\nåœ¨æ‚¨çš„é…ç½®ä¸­ï¼Œè®¾ç½®ä¸º1çš„è°ƒè¯•çº§åˆ«å°†è®°å½•åŸºæœ¬çš„æ“ä½œä¿¡æ¯å’Œè­¦å‘Šï¼Œä½†ä¸ä¼šè®°å½•è¿‡å¤šçš„ç»†èŠ‚ã€‚è¿™å¯¹äºä¸€èˆ¬æƒ…å†µä¸‹çš„æ—¥å¿—è®°å½•å·²ç»è¶³å¤Ÿã€‚å¦‚æœéœ€è¦æ›´è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥å°†è°ƒè¯•çº§åˆ«è®¾ç½®ä¸ºæ›´é«˜çš„å€¼ï¼Œä¾‹å¦‚2æˆ–3ï¼Œä½†è¿™å¯èƒ½ä¼šç”Ÿæˆæ›´å¤šçš„æ—¥å¿—æ•°æ®ã€‚\næ³¨æ„ä¸Šé¢/etc/turn_*è·¯å½¹æ˜¯æŒ‡å®¹å™¨é‡Œçš„è·¯å¾„ã€‚\nå¦‚æœæƒ³å…³é—­CLIç›‘å¬å™¨åŠŸèƒ½ã€‚è¦ç¦ç”¨CLIåŠŸèƒ½ï¼Œæ‚¨å¯ä»¥åˆ é™¤æˆ–æ³¨é‡Šæ‰ç›¸å…³é…ç½®è¡Œã€‚åœ¨æ‚¨çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œåªéœ€è¦åˆ é™¤æˆ–æ³¨é‡Šæ‰ä»¥ä¸‹ä¸¤è¡Œå³å¯ï¼š\ncli-password=8al8la.com # Set a non-empty CLI password # æŒ‡å®š Coturn çš„æ—¥å¿—æ–‡ä»¶è·¯å¾„ # log-file=/var/log/turnserver.log è¯·æ³¨æ„ï¼Œè¿™äº›é…ç½®æ›´æ”¹å°†ç¦ç”¨CLIå¯†ç å’ŒCLIæ—¥å¿—è®°å½•åŠŸèƒ½ã€‚ä¿å­˜æ›´æ”¹åï¼Œé‡æ–°å¯åŠ¨coturnæœåŠ¡å™¨ä»¥ä½¿æ›´æ”¹ç”Ÿæ•ˆã€‚\næ‰€è°“cliåŠŸèƒ½ï¼š\nCLIç›‘å¬å™¨ï¼ˆCommand Line Interface listenerï¼‰å…è®¸æ‚¨é€šè¿‡å‘½ä»¤è¡Œç•Œé¢ä¸coturnæœåŠ¡å™¨è¿›è¡Œäº¤äº’å’Œç®¡ç†ã€‚é€šè¿‡CLIï¼Œæ‚¨å¯ä»¥æ‰§è¡Œå„ç§ç®¡ç†ä»»åŠ¡ï¼Œä¾‹å¦‚æŸ¥çœ‹å½“å‰æœåŠ¡å™¨çŠ¶æ€ã€æ·»åŠ æˆ–åˆ é™¤ç”¨æˆ·ã€é…ç½®è½¬å‘è§„åˆ™ç­‰ã€‚\nCLIç›‘å¬å™¨å…è®¸ç®¡ç†å‘˜é€šè¿‡å‘½ä»¤è¡Œè¾“å…¥ç‰¹å®šçš„å‘½ä»¤æ¥ä¸coturnæœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œè€Œæ— éœ€é€šè¿‡å›¾å½¢ç•Œé¢æˆ–å…¶ä»–æ–¹å¼è¿›è¡Œæ“ä½œã€‚è¿™ä½¿å¾—ç®¡ç†è€…å¯ä»¥æ›´åŠ çµæ´»å’Œé«˜æ•ˆåœ°ç®¡ç†æœåŠ¡å™¨ï¼Œç‰¹åˆ«æ˜¯åœ¨è‡ªåŠ¨åŒ–å’Œè„šæœ¬åŒ–ç®¡ç†æ–¹é¢ã€‚\næŸ¥çœ‹æ—¥å¿—ï¼šè¿è¡Œæ—¶ä¸åŠ  -d çœ‹è¾“å…¥ï¼\njournalctl -u coturnsystemd è¿™æ˜¯åŠ /root/data/docker_data/synapse/data/homeserver.yamlé…ç½®æ–‡ä»¶é‡Œçš„\n#turnserver# turn_uris: [ \u0026#34;turn:coturn.666.eu.org?transport=udp\u0026#34;, \u0026#34;turn:coturn.666.eu.org?transport=tcp\u0026#34; ] turn_shared_secret: \u0026#34;SdQmVOBTRxViwUhsRsRgpBctFNMYatKUBHIO69wFKxEVuqog1HPPoMKya7YA\u0026#34; turn_user_lifetime: 86400000 turn_allow_guests: True ```bash è®°çš„ä¿®æ”¹åŸŸåå’Œå¯†ç å’Œä¸»æ–‡ä»¶åŒæ­¥ã€‚ ```bash ç¡®ä¿æ‚¨çš„é˜²ç«å¢™å…è®¸æµé‡è¿›å…¥æ‚¨é…ç½®ä¸ºä¾¦å¬çš„ç«¯å£ä¸Šçš„ TURN æœåŠ¡å™¨ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼šTURN æµé‡ä½¿ç”¨ 3478 å’Œ 5349ï¼ˆè¯·è®°ä½åŒæ—¶å…è®¸ TCP å’Œ UDP æµé‡ï¼‰ï¼ŒUDP ä¸­ç»§ä½¿ç”¨ç«¯å£ 49152-65535 .) ç‰¹åˆ«è¯´æ˜ï¼šcoturnæœåŠ¡å™¨ä¹Ÿå¯ä»¥ä¸åšåå‘ä»£ç†\nCoturnæœåŠ¡é€šå¸¸éœ€è¦æ‰“å¼€ä»¥ä¸‹ç«¯å£ä»¥æ”¯æŒTURNåè®®å’Œå®ç°NATéå†ï¼š\nTURN Listening Port (Default: 3478): CoturnæœåŠ¡é€šè¿‡æ­¤ç«¯å£ä¾¦å¬TURNè¯·æ±‚ã€‚æ­¤ç«¯å£æ˜¯TURNåè®®çš„æ ‡å‡†ç«¯å£ã€‚\nDefault TURN Port: 3478 TURN TLS Listening Port (Default: 5349): å¦‚æœå¯ç”¨äº†TURN over TLSï¼ˆåŠ å¯†çš„TURNæµé‡ï¼‰ï¼Œåˆ™éœ€è¦æ‰“å¼€æ­¤ç«¯å£ã€‚ Default TURN TLS Port: 5349 Listening Ports Range for Relayed UDP Traffic (Default: 49152-65535): å½“TURNæœåŠ¡å™¨ç”¨äºä¸­ç»§UDPæµé‡æ—¶ï¼Œå®ƒéœ€è¦ä½¿ç”¨ä¸€ç³»åˆ—UDPç«¯å£ã€‚\nä¸Šé¢çš„é…ç½®é‡Œæˆ‘æŒ‡å®šäº†20000-30000\nDefault UDP Port Range: 49152-65535 è¿™äº›ç«¯å£éœ€è¦åœ¨CoturnæœåŠ¡å™¨é…ç½®ä¸­æŒ‡å®šï¼Œå¹¶ä¸”ç›¸åº”çš„é˜²ç«å¢™è§„åˆ™ä¹Ÿéœ€è¦é…ç½®ï¼Œä»¥å…è®¸æµé‡é€šè¿‡è¿™äº›ç«¯å£ã€‚ç¡®ä¿åœ¨é…ç½®CoturnæœåŠ¡å™¨æ—¶å‚è€ƒæ–‡æ¡£ï¼Œå› ä¸ºå®é™…ç«¯å£é…ç½®å¯èƒ½å› ç‰¹å®šç”¨ä¾‹å’Œå®‰å…¨éœ€æ±‚è€Œæœ‰æ‰€ä¸åŒã€‚\nMatrix Synapse Default Communication Port (TCP): 8448 ç¡®ä¿åœ¨é…ç½®é˜²ç«å¢™è§„åˆ™æ—¶ï¼Œè¿™äº›ç«¯å£æ˜¯å¼€æ”¾çš„ï¼Œä»¥ç¡®ä¿Synapseå’ŒCoturnèƒ½å¤Ÿç›¸äº’é€šä¿¡ã€‚\nç¬¬äºŒç§æ–¹æ¡ˆï¼šï¼ˆä¼˜é€‰ï¼Œæ¨èä½¿ç”¨è¿™ä¸€ç§æ–¹æ¡ˆï¼‰ å…³äºæ—¥å¿—è¾“å…¥ç­‰çº§ï¼Œå¸¸è§çš„é€‰é¡¹åŒ…æ‹¬ï¼š\nverboseï¼šå†—ä½™çš„è¾“å‡ºï¼Œé€šå¸¸åŒ…å«äº†éå¸¸è¯¦ç»†çš„ä¿¡æ¯ï¼Œç”¨äºè°ƒè¯•å’Œæ’æŸ¥é—®é¢˜ã€‚\ndebugï¼šè°ƒè¯•çº§åˆ«çš„è¾“å‡ºï¼Œæä¾›æ¯”è¾ƒè¯¦ç»†ä½†ä¸å¦‚ verbose é‚£ä¹ˆå†—ä½™çš„ä¿¡æ¯ã€‚\ninfoï¼šä¿¡æ¯çº§åˆ«çš„è¾“å‡ºï¼Œæä¾›åŸºæœ¬çš„è¿è¡Œä¿¡æ¯ï¼Œé€‚åˆä¸€èˆ¬æƒ…å†µä¸‹çš„ä½¿ç”¨ã€‚\nwarningï¼šè­¦å‘Šçº§åˆ«çš„è¾“å‡ºï¼Œç”¨äºæŒ‡ç¤ºæ½œåœ¨çš„é—®é¢˜æˆ–é”™è¯¯ã€‚\nerrorï¼šé”™è¯¯çº§åˆ«çš„è¾“å‡ºï¼ŒæŒ‡ç¤ºå‡ºç°çš„é”™è¯¯æƒ…å†µã€‚\næ‚¨å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´æ—¥å¿—è¾“å…¥ç­‰çº§ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé€šå¸¸ä¼šå°†æ—¥å¿—è¾“å…¥ç­‰çº§è®¾ç½®ä¸º info æˆ–æ›´é«˜çº§åˆ«ï¼Œä»¥é¿å…å†—ä½™ä¿¡æ¯è¿‡å¤šï¼Œè€Œåœ¨å¼€å‘æˆ–è°ƒè¯•é˜¶æ®µï¼Œåˆ™å¯èƒ½ä¼šé€‰æ‹© debug æˆ– verbose ç­‰çº§ä»¥ä¾¿æ›´è¯¦ç»†åœ°äº†è§£ç³»ç»Ÿè¿è¡Œæƒ…å†µã€‚\nè‡ªè¡Œå®‰è£…å¥½dockeråŠdocker-compose å¼€å§‹æ“ä½œ mkdir -p ~/data/docker_data/coturn/etc/coturn mkdir -p ~/data/docker_data/coturn/var/run mkdir -p ~/data/docker_data/coturn/var/log #å¦‚æœç”¨ä¸‹é¢ç¬¬ä¸€ç§æ–¹æ¡ˆè¿™ä¸ªæ‰éœ€è¦å»ºç«‹ï¼Œç¬¬äºŒç§ä¸éœ€è¦ cd ~/data/docker_data/coturn/etc/coturn touch turnserver.conf cd ~/data/docker_data/coturn/var/run touch turnserver.pid cd ../../ chmod 777 -R var turnserver.conf:\n#è¿™æ˜¯ç³»ç»Ÿæ—¥å¿— #syslog #å†—ä½™çš„æ—¥å¿—è¾“å‡º verbose use-auth-secret static-auth-secret=ThisIsASharedSecret-ChangeMe realm=example.org cert=/etc/letsencrypt/live/turn.example.org/fullchain.pem pkey=/etc/letsencrypt/live/turn.example.org/privkey.pem no-udp external-ip=1.2.3.4 min-port=64000 max-port=65535 è¯¦è§£ï¼š\n# èµ°ç³»ç»Ÿæ—¥å¿— #syslog # å†—ä½™çš„æ—¥å¿—è¾“å‡º verbose # æŒ‡å®šäº†é•¿æœŸå‡­è¯æœºåˆ¶ï¼Œç”¨äºå®¢æˆ·ç«¯çš„èº«ä»½éªŒè¯å’Œä¸‹é¢çš„äºŒé€‰ä¸€ #lt-cred-mech # å¯ç”¨äº†ä½¿ç”¨é™æ€èº«ä»½éªŒè¯å¯†é’¥è¿›è¡Œèº«ä»½éªŒè¯çš„åŠŸèƒ½ use-auth-secret # è®¾ç½®äº†èº«ä»½éªŒè¯å¯†é’¥å’ŒåŸŸå static-auth-secret=ynojlSEBrJnMUQ0WKAsSzGdMhL8he # è®¾ç½®äº†åŸŸå realm=coturn.1.xyz # æŒ‡å®šäº† TLS è¯ä¹¦æ–‡ä»¶çš„è·¯å¾„ cert=/etc/web.crt # æŒ‡å®šäº† TLS ç§é’¥æ–‡ä»¶çš„è·¯å¾„ pkey=/etc/web.key # Set a non-empty CLI password cli-password=8al8la.com # ç¦ç”¨äº† UDP é€šä¿¡ï¼Œæ„å‘³ç€åªä½¿ç”¨ TCP #no-udp min-port=64000 max-port=65535 æœ€ç»ˆå®ä¾‹ï¼š\n# æ—¥å¿—è¾“å‡ºå‚æ•° info # å¯ç”¨è®¤è¯ use-auth-secret # å€¼ä¸ºè®¤è¯æ—¶ä½¿ç”¨çš„å¯†é’¥ static-auth-secret=ynojlSEBnMUQ0WKAsSzGdMhL8he # å€¼ä¸ºä½ ç»™ coturn å®ä¾‹åˆ†é…çš„åŸŸå (å®ƒå¯ä»¥ä¸å’Œä½ çš„åŸŸåå®Œå…¨ä¸€è‡´, ä½†è‡³å°‘å¿…é¡»æœ‰) realm=coturn.10.xyz # æŒ‡å®šäº† TLS è¯ä¹¦æ–‡ä»¶çš„è·¯å¾„ cert=/etc/web.crt # æŒ‡å®šäº† TLS ç§é’¥æ–‡ä»¶çš„è·¯å¾„ pkey=/etc/web.key # Set a non-empty CLI password cli-password=8a.com #é™å®šæœ€å°æœ€å¤§ç«¯å£ min-port=64000 max-port=65535 ä¸Šé¢é…ç½®é‡Œçš„è¯ä¹¦ï¼š å’ŒåŸŸåç”Ÿæˆæ ‡å‡†è¯ä¹¦ä¸€æ ·ï¼Œæœ¬ç«™æœ‰æä¾›æ•™ç¨‹ã€‚æ­¤è¯ä¹¦ä¸ºcoturnæœåŠ¡å™¨åŸŸåçš„è¯ä¹¦ æµ‹è¯•å¯åŠ¨å‘½ä»¤ï¼š(æ²¡æœ‰åŠ -d ï¼ˆåå°è¿è¡Œï¼‰ æµ‹è¯•æ²¡é—®é¢˜äº†ï¼Œå†åŠ ,è¿˜æœ‰æœ€åçš„\u0026ndash;rmå»é™¤æ‰ï¼Œé€€å‡ºè‡ªåŠ¨åˆ é™¤å®¹å™¨çš„æ„æ€ï¼‰ docker run --network=host \\ -v /root/data/docker_data/coturn/etc/coturn/turnserver.conf:/etc/coturn/turnserver.conf \\ -v /root/data/docker_data/coturn/etc/:/etc/ \\ -v /root/data/docker_data/coturn/var/run/turnserver.pid:/var/run/turnserver.pid \\ --rm \\ coturn/coturn (å°æé†’:åŸŸåè¯ä¹¦ç”ŸæˆåæŒ‰ç…§é…ç½®æ–‡ä»¶è·¯å½¹æ”¾å…¥è¿è¡Œåï¼Œå¯èƒ½ä¼šæç¤ºkeyæ–‡ä»¶æƒé™ä¸å¤Ÿï¼Œç»™ä»–ä¸ªotherè¯»æƒé™ï¼Œé‡å¯å³å¯ï¼‰ æ­£å¼å¯åŠ¨å‘½ä»¤ï¼š\ndocker run -d --network=host \\ -v /root/data/docker_data/coturn/etc/coturn/turnserver.conf:/etc/coturn/turnserver.conf \\ -v /root/data/docker_data/coturn/etc/:/etc/ \\ -v /root/data/docker_data/coturn/var/run/turnserver.pid:/var/run/turnserver.pid \\ coturn/coturn docker-compose.yaml\nservices: coturn: image: coturn/coturn container_name: coturn network_mode: host restart: unless-stopped # å§‹ç»ˆå¯åŠ¨ï¼Œé™¤éæ‰‹åŠ¨åœæ­¢ volumes: - /root/data/docker_data/coturn/etc/coturn/turnserver.conf:/etc/coturn/turnserver.conf - /root/data/docker_data/coturn/etc/:/etc/ - /root/data/docker_data/coturn/var/run/turnserver.pid:/var/run/turnserver.pid ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥åå°è¿è¡Œå®¹å™¨ï¼š\ndocker-compose up -d åœ¨synapseé…ç½®æ–‡ä»¶data/homeserver.yamlé‡ŒåŠ å…¥ #turnserver# turn_uris: [ \u0026#34;turn:cotu10.xyz?transport=udp\u0026#34;, \u0026#34;turn:coturnc10.xyz?transport=tcp\u0026#34; ] turn_shared_secret: \u0026#34;ynojlAOWksiyk1SEBrJ6VjFHNyjJiyZRnnMUQ0WKAsSzGdMhL8he\u0026#34; turn_user_lifetime: 86400000 turn_allow_guests: True ","permalink":"https://hanigege.github.io/posts/other/%E5%AE%B6%E5%BA%AD%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B3%BB%E5%88%973coturn%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/","tags":null,"title":"å®¶åº­èŠå¤©æœåŠ¡å™¨ç³»åˆ—ï¼ˆ3ï¼‰coturnæœåŠ¡æ­å»º"},{"categories":["other"],"contents":"\nntfy æ— éœ€æ³¨å†Œçš„é€šçŸ¥æœåŠ¡ æœ€ä¸‹é¢æ˜¯æ¢å¤å¤‡ä»½çš„æ–¹æ¡ˆï¼š ##â€‹â€‹ ä»€ä¹ˆæ˜¯ ntfy ï¼Ÿ â€‹ntfyâ€‹â€‹â€‹ï¼ˆå‘éŸ³ï¼šnotifyâ€‹â€‹â€‹ï¼‰æ˜¯ä¸€ä¸ªç®€å•çš„åŸºäº HTTPâ€‹â€‹â€‹ çš„ pub-subâ€‹â€‹â€‹ é€šçŸ¥æœåŠ¡ã€‚å®ƒå…è®¸æ‚¨é€šè¿‡ä»»ä½•è®¡ç®—æœºä¸Šçš„è„šæœ¬å‘æ‚¨çš„æ‰‹æœºæˆ–æ¡Œé¢å‘é€é€šçŸ¥ï¼Œå®Œå…¨æ— éœ€æ³¨å†Œæˆ–è´¹ç”¨ã€‚\nå®˜æ–¹æä¾›äº†å…è´¹çš„ç‰ˆæœ¬ï¼šhttps://ntfy.sh/app å®‰è£… æ–°å»ºæ–‡ä»¶ï¼šdocker-compose.yml è„šæœ¬å¦‚ä¸‹ï¼š\nservices: ntfy: image: binwiederhier/ntfy:latest container_name: ntfy command: - serve environment: - TZ=Asia/Shanghai volumes: - /root/data/docker_data/ntfy/data/cache:/var/cache/ntfy - /root/data/docker_data/ntfy/data/config:/etc/ntfy ports: - 12332:80 restart: unless-stopped networks: - matrix networks: matrix: name: matrix ä»£ç ä¸­çš„åå‘ä»£ç†npmè½¬å‘å¤–å‡ºç«¯å£12332 ã€‚\nä¸Šé¢çš„ä»£ç ä¸­ä¼šè‡ªå»º ç½‘ç»œmatrix.\nå¦‚æœå…ˆè¡Œè‡ªå·±å»ºç«‹ç½‘ç»œï¼Œå¦‚ï¼š å»ºç«‹ä¸€ä¸ª docker networkï¼š\ndocker network create matrix é‚£ä¹ˆæ‚¨å¯ä»¥æŒ‰ç…§ä¹‹å‰æåˆ°çš„å»ºè®®åœ¨ Docker Compose æ–‡ä»¶ä¸­å°†ç½‘ç»œå®šä¹‰æ ‡è®°ä¸ºå¤–éƒ¨ç½‘ç»œï¼Œå¹¶ä¸”æŒ‡å®šæ­£ç¡®çš„ç½‘ç»œåç§°ã€‚åœ¨æ‚¨çš„ Docker Compose æ–‡ä»¶ä¸­ï¼Œæ‚¨å¯ä»¥å°†ç½‘ç»œå®šä¹‰ä¿®æ”¹ä¸ºç±»ä¼¼ä»¥ä¸‹å†…å®¹ï¼š\nservices: ntfy: image: binwiederhier/ntfy:latest container_name: ntfy command: - serve environment: - TZ=Asia/Shanghai volumes: - /root/data/docker_data/ntfy/data/cache:/var/cache/ntfy - /root/data/docker_data/ntfy/data/config:/etc/ntfy ports: - 12332:80 restart: unless-stopped networks: matrix: external: true networks: matrix: external: true name: matrix è¿™å°†å‘Šè¯‰ Docker Compose ä½¿ç”¨å¤–éƒ¨ç½‘ç»œ \u0026ldquo;matrix\u0026rdquo;ï¼Œå¹¶ä¸”ä¸ä¼šå°è¯•é‡æ–°åˆ›å»ºå®ƒã€‚\nå¦å¤–ï¼Œå¦‚æœæ‚¨ç¡®å®æƒ³è¦ä½¿ç”¨ Compose åˆ›å»ºä¸€ä¸ªæ–°çš„ç½‘ç»œï¼Œå¹¶ä¸”å¸Œæœ›ä½¿ç”¨ \u0026ldquo;matrix\u0026rdquo; è¿™ä¸ªåç§°ï¼Œæ‚¨éœ€è¦å…ˆåˆ é™¤ç°æœ‰çš„ \u0026ldquo;matrix\u0026rdquo; ç½‘ç»œï¼Œç„¶åå†åˆ›å»ºä¸€ä¸ªæ–°çš„ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥åˆ é™¤ç°æœ‰çš„ç½‘ç»œï¼š\ndocker network rm matrix ç„¶åï¼Œå½“æ‚¨è¿è¡Œ docker-compose up -d æ—¶ï¼ŒCompose å°†åˆ›å»ºä¸€ä¸ªæ–°çš„ \u0026ldquo;matrix\u0026rdquo; ç½‘ç»œã€‚\nè¯·ç¡®ä¿æ‚¨çš„ç½‘ç»œè®¾ç½®ç¬¦åˆæ‚¨çš„é¢„æœŸï¼Œå¹¶ä¸”ä¸ä¼šå½±å“åˆ°å…¶ä»–æœåŠ¡ã€‚\nè¿è¡Œ åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ http://IP:12332â€‹ å°±èƒ½çœ‹åˆ°ä¸»ç•Œé¢\nå…³é”®æ³¨æ„ï¼š è¿›å…¥\ncd /root/data/docker_data/ntfy/data/config:/etc/ntfy ç›¸åº”çš„configæ–‡ä»¶å¤¹ä¸‹ï¼Œéœ€è¦å»ºç«‹ä¸€ä¸ªserver.yml é…ç½®æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\nbase-url: \u0026#34;https://sms.888.org\u0026#34; #listen-http: \u0026#34;\u0026#34; #å¦‚æœä¸Šé¢çš„ç½‘å€æ²¡æœ‰åšåå‘è§£æï¼Œå°±è¦åŠ å…¥ç«¯å£å· behind-proxy: true upstream-base-url: \u0026#34;https://ntfy.sh\u0026#34; log-level: TRACE å®ä¾‹ï¼š\nbase-url: \u0026#34;http://ss.160.xyz:125\u0026#34; #listen-http: \u0026#34;\u0026#34; #å¦‚æœä¸Šé¢çš„ç½‘å€æ²¡æœ‰åšåå‘è§£æï¼Œå°±è¦åŠ å…¥ç«¯å£å· behind-proxy: true upstream-base-url: \u0026#34;https://ntfy.sh\u0026#34; log-level: TRACE ç„¶åé‡å¯å®¹å™¨\ndocker restart â€œå®¹å™¨åâ€ è¿™æ ·elementé‡Œçš„ç½‘å…³å°±å¯ä»¥è‡ªåŠ¨æ”¹ä¸ºæœ¬ç½‘å€ï¼Œæ›´åŠ å®‰å…¨ï¼Œæ–¹ä¾¿ ï¼Œæ•ˆç‡ï¼\nâ€‹ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ POST è¯·æ±‚ï¼ˆé€šè¿‡ curl -dï¼‰å‘å¸ƒæ¶ˆæ¯ï¼š\næ ¼å¼æ¯”è¾ƒç®€å•ï¼šcurl -d \u0026lt;æ¶ˆæ¯\u0026gt; \u0026lt;æœåŠ¡å™¨IP:ç«¯å£\u0026gt;/\u0026lt;ä¸»é¢˜\u0026gt;\nç®€å•æ¶ˆæ¯æµ‹è¯• curl -d \u0026#34;Hi\u0026#34; http://192.168.0.197:3680/laosu_test_ch æ‚¨å¯ä»¥è®¾ç½® é€šçŸ¥ä¼˜å…ˆçº§ã€æ ‡é¢˜å’Œæ ‡ç­¾ æ¶ˆæ¯ã€‚è¿™æ˜¯ä¸€èµ·ä½¿ç”¨å…¶ä¸­ä¸€äº›çš„ç¤ºä¾‹ï¼š\næ›´å¤æ‚çš„æ¶ˆæ¯ç¤ºä¾‹ curl \\ -H \u0026#34;Title: Unauthorized access detected\u0026#34; \\ -H \u0026#34;Priority: urgent\u0026#34; \\ -H \u0026#34;Tags: warning,skull\u0026#34; \\ -d \u0026#34;Remote access to $(hostname) detected. Act right away.\u0026#34; \\ http://192.168.0.197:3680/laosu_test_ch æŸ¥çœ‹pushçš„log.å¦‚æœå‡ºç°elementæµ‹è¯•æ¨é€ä¸ä¸‹å»ï¼Œè½¬åœˆåœˆï¼Œæ­£å¸¸èƒ½å‘æ¶ˆæ¯å°±ä¸ç”¨ç®¡ï¼Œlogé‡Œå¯ä»¥ä¼šå‡ºç°200ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š\ndocker logs -tf --tail 100 \u0026lt;synapseå®¹å™¨idæˆ–åç§°\u0026gt; 2\u0026gt;\u0026amp;1 | grep /_matrix/push/v1/notify å®ä¾‹:\ndocker logs -tf --tail 100 cfb 2\u0026gt;\u0026amp;1 | grep /_matrix/push/v1/notify æ¢å¤å¤‡ä»½çš„docker-compose.ymlçš„é…ç½®æ–‡ä»¶ï¼š services: ntfy: image: binwiederhier/ntfy:latest container_name: ntfy command: - serve environment: - TZ=Asia/Shanghai volumes: - /root/data/docker_data/ntfy/data/cache:/var/cache/ntfy - /root/data/docker_data/ntfy/data/config:/etc/ntfy ports: - 12332:80 restart: unless-stopped networks: - matrix networks: matrix: external: true name: matrix æœ¬ç³»åˆ—æœ€åä¸€ç¯‡æ–‡ç« ä¼šæ•™ä½ å¦‚ä½•å’Œelementå®¢æˆ·ç«¯é…åˆä½¿ç”¨ï¼Œelementå®¢æˆ·å†…ç½®æ˜¯æ”¯æŒçš„ã€‚ ","permalink":"https://hanigege.github.io/posts/other/%E5%AE%B6%E5%BA%AD%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B3%BB%E5%88%972ntfy%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/","tags":null,"title":"å®¶åº­èŠå¤©æœåŠ¡å™¨ç³»åˆ—ï¼ˆ2ï¼‰ntfyæœåŠ¡æ­å»º"},{"categories":["other"],"contents":"\nè®¾è®¡æ€è·¯ æœåŠ¡å™¨éœ€è¦2å°ï¼Œå¤–ç½‘ä¸€å°vpså³å¯ï¼Œæ­å»ºcoturnæœåŠ¡ã€‚æœ¬åœ°ä¸€å°ï¼Œæ­å»ºsynapseåŠntfyæœåŠ¡ï¼Œæ‰€æœ‰æœåŠ¡å‡ä»¥dockerçš„æ–¹å¼æ¥æ­å»º 1. ntfyæœåŠ¡ï¼šå› ä¸ºå¾ˆå¤šçš„é™åˆ¶å¯¼è‡´æ¶ˆæ¯æ— æ³•ä¼ è¾¾ï¼Œç±»ä¼¼äºä½ æ¶ˆæ¯æ¥äº†ï¼Œç¡®æ”¶ä¸åˆ°é€šçŸ¥æé†’. 2. coturn æ˜¯ä¸€ä¸ª STUN/TURN æœåŠ¡å™¨ å®ç°ï¼Œä¸»è¦ç”¨äº WebRTCã€VoIPã€è§†é¢‘ä¼šè®®ç­‰å®æ—¶é€šä¿¡åº”ç”¨ä¸­ï¼Œè§£å†³NAT ç©¿é€é—®é¢˜ã€‚coturn åŒæ—¶å®ç°äº† STUN + TURNï¼Œé€šå¸¸ç”¨ä½œ WebRTC çš„ä¸­ç»§æœåŠ¡å™¨ï¼Œç¡®ä¿è§†é¢‘/è¯­éŸ³è¿æ¥åœ¨å„ç§å¤æ‚ç½‘ç»œç¯å¢ƒä¸‹éƒ½èƒ½å»ºç«‹ã€‚ 3. synapseèŠå¤©æœåŠ¡å™¨ä¸»ä½“ï¼Œæ”¯æŒæ–‡å­—ï¼Œè¯­éŸ³ï¼Œåœ¨çº¿è¯­éŸ³ç”µè¯ï¼Œåœ¨çº¿è§†é¢‘ï¼Œæ–‡ä»¶ä¼ é€ï¼Œæ˜¯ä¸€å¥—å®Œæ•´å¯æŒç»­çš„èŠå¤©æœåŠ¡ã€‚ 4. å®¢æˆ·ç«¯æœ‰å¾ˆå¤šç§ï¼Œå®˜ç½‘ä¸Šéƒ½æœ‰ä»‹ç»ï¼Œè¿™é‡Œåªæ¨èä½¿ç”¨Elementå®¢æˆ·ç«¯ã€‚ æœ€æœ€ä¸‹é¢æ˜¯å¤‡ä»½æ¢å¤çš„æ–¹æ³•ï¼Œå¦‚ä½•å¤‡ä»½ï¼ŒæŠŠç›¸å…³dockeræ–‡ä»¶å¤¹æ‰“åŒ…ä¸‹è½½å°±å¯ä»¥äº†ï¼Œéœ€è¦æ¢å¤çš„æ—¶å€™ï¼Œä¸Šä¼ åˆ°ç›¸å…³çš„æœåŠ¡å™¨ï¼Œæ”¾åœ¨rootæ–‡ä»¶å¤¹ä¸‹ã€‚\nåˆ‡è®°ï¼ŒSYNAPAEæœåŠ¡å™¨ä¸å¯ä»¥ä½¿ç”¨fakeipçš„DNSä»£ç†ä¸Šç½‘ï¼Œåªèƒ½ç”¨æœ¬åœ°çš„ç½‘ç»œï¼Œä¸ç„¶ï¼Œä¼šæ”¶ä¸åˆ°æ¶ˆæ¯NTFYä¼šå‡ºé—®é¢˜ï¼ å‰è¨€ é¦–å…ˆå¿…é¡»ä»‹ç»ä¸‹Matrixã€‚Matrixæ˜¯ä¸€ä¸ªå¼€æºã€å¯äº¤äº’ã€å»ä¸­å¿ƒåŒ–çš„å®æ—¶é€šä¿¡æœåŠ¡æ¡†æ¶ã€‚ä½¿ç”¨Matrixå¯ä»¥æ­å»ºå®‰å…¨çš„é€šä¿¡æœåŠ¡å™¨ï¼Œé…åˆæ”¯æŒ Matrix çš„å®¢æˆ·ç«¯å¯ä»¥å®ç°ä¸ªäººã€å›¢é˜Ÿé—´çš„å®æ—¶èŠå¤©äº¤äº’ã€‚\nä¸å¸¸è§çš„QQã€å¾®ä¿¡ã€é’‰é’‰ç›¸æ¯”ï¼ŒMatrixçš„ç‰¹ç‚¹å°±æ˜¯å¼€æºï¼Œå¯ç§æœ‰åŒ–éƒ¨ç½²ï¼Œä¿è¯é€šä¿¡çš„å®‰å…¨å’Œéšç§ã€‚ä¸Rocket.chatã€MatterMostç›¸æ¯”ï¼Œmatrixçš„ç‰¹ç‚¹è¿˜è¦å†åŠ ä¸Šå»ä¸­å¿ƒåŒ–ã€‚æ¯ä¸ªè¿è¡ŒMatrixçš„æœåŠ¡å™¨éƒ½æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©åœ¨ä»»æ„èŠ‚ç‚¹æ³¨å†Œã€è¿æ¥ï¼ŒåŒä¸€ä¸ªèŠ‚ç‚¹å†…çš„ç”¨æˆ·å¯ä»¥ä»»æ„é€šä¿¡ã€‚åŒæ—¶ï¼ŒèŠ‚ç‚¹ä¸èŠ‚ç‚¹ä¹‹é—´ä¹Ÿå¯ä»¥é€šè¿‡è”é”ï¼ˆFederationï¼‰æœºåˆ¶è¿›è¡Œé€šä¿¡ï¼Œå®ç°ä¸åŒèŠ‚ç‚¹çš„ç”¨æˆ·ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚\nå› ä¸ºMatrixåªæ˜¯ä¸ªæ¡†æ¶ï¼Œå¯ä»¥æœ‰å¾ˆå¤šå®ç°ï¼Œæœ¬æ–‡ä½¿ç”¨çš„synapseå°±æ˜¯å…¶ä¸­ä¸€ä¸ªæœåŠ¡ç«¯å®ç°ã€‚\né™¤äº†å®‰è£…æœåŠ¡ç«¯ï¼Œæœ¬æ–‡è¿˜æœ‰å®‰è£…element webç«¯çš„æ­¥éª¤ã€‚\næ­ä¸€ä¸ªdemoå¹¶ä¸è€—èµ„æºï¼ŒåŠ ä¸Špostgresqlæ•°æ®åº“æ‰ç”¨äº†200MBå†…å­˜ä¸åˆ°ï¼Œå¦‚æœç”¨é»˜è®¤çš„sqliteæ•°æ®åº“ä¼šæ›´çœå†…å­˜ã€‚\nå®‰è£…æœåŠ¡ç«¯ æ›´æ–°ç¯å¢ƒ apt update -y \u0026amp;\u0026amp; apt upgrade -y \u0026amp;\u0026amp; apt install -y curl wget sudo socat å®‰è£… Docker curl -fsSL https://get.docker.com -o get-docker.sh \u0026amp;\u0026amp; sh get-docker.sh curl -L \u0026#34;https://github.com/docker/compose/releases/download/v2.16.0/docker-compose-$(uname -s)-$(uname -m)\u0026#34; -o /usr/local/bin/docker-compose chmod +x /usr/local/bin/docker-compose æ­å»ºSynapse æŒ‰ç…§æ•™ç¨‹å»ºç«‹/data/synapse/ä¸‹çš„ä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼š\nmkdir ~/data/docker_data/synapse -p mkdir ~/data/docker_data/synapse/data -p mkdir ~/data/docker_data/synapse/postgres -p mkdir ~/data/docker_data/synapse/html -p å…·ä½“å¦‚ä¸‹ï¼š\né¦–å…ˆï¼Œé€‰æ‹©ä¸€ä¸ªå®¿ä¸»æœºæ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜æ”¾synapseæ‰€æœ‰çš„æ•°æ®ï¼Œæˆ‘çš„è§„åˆ’å¦‚ä¸‹ï¼š\nSynapseæ•°æ®ï¼š/root/data/docker_data/synapse/data\nPostgreSQLæ•°æ®ï¼š /root/data/docker_data/synapse/postgres\nä¸ºäº†è®©æ¡¥æ¥ç”¨çš„å®¹å™¨å’Œ synapse å®¹å™¨èƒ½å¤Ÿäº’ç›¸é€šè®¯ï¼Œå»ºç«‹ä¸€ä¸ª docker networkï¼š\ndocker network create matrix PostgreSQL pgåº“æˆ‘é€‰æ‹©äº†16ç‰ˆæœ¬ï¼Œé€‰æ‹©çš„é•œåƒæ˜¯postgres:16-alpineã€‚\ndocker run --name postgres16 --network matrix --restart=always -v /root/data/docker_data/synapse/postgres:/var/lib/postgresql/data -e POSTGRES_PASSWORD=è‡ªå®šä¹‰PostgreSQLå¯†ç  -p 5432:5432 -d postgres:16-alpine ç•Œé¢ä¼šæ˜¾ç¤ºå®¹å™¨çš„hashå€¼ï¼Œæ¥ç€æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤åˆ›å»ºä¸€ä¸ªç”¨äºè¿æ¥æ•°æ®åº“çš„synapseç”¨æˆ·å¹¶è¾“å…¥ä½ çš„å¯†ç \ndocker exec -it postgres16 createuser -U postgres --pwprompt synapse_user æ‰§è¡Œä¸‹é¢çš„è¯­å¥è¿›å…¥psql\ndocker exec -it postgres16 psql -U postgres æ‰§è¡Œä¸‹é¢çš„å»ºåº“è¯­å¥ç”¨äºå»ºç«‹ä¸€ä¸ªsynapseåº“\nCREATE DATABASE synapse ENCODING \u0026#39;UTF8\u0026#39; LC_COLLATE=\u0026#39;C\u0026#39; LC_CTYPE=\u0026#39;C\u0026#39; template=template0 OWNER synapse_user; æ‰§è¡Œå®Œæ¯•åè¾“å…¥\\qé€€å‡º *åç»­è¿æ¥å¦‚æœæœ‰é—®é¢˜ï¼Œå¯ä»¥åœ¨postgres/pg_hba.confä¸­ æ·»åŠ  host synapse synapse_user all trust\nå®‰è£…synapse å…ˆæ‹‰å–dockeré•œåƒ\ndocker pull matrixdotorg/synapse:latest ç”Ÿæˆé…ç½®æ–‡ä»¶ã€‚æ³¨æ„æ ¹æ®å®é™…ä¿®æ”¹å®¿ä¸»æœºæŒ‚è½½ç›®å½•è·¯å¾„å’Œmatrixçš„host\ndocker run -it --rm -v /root/data/docker_data/synapse/data:/data -e SYNAPSE_SERVER_NAME=matrix.demo.com -e SYNAPSE_REPORT_STATS=yes matrixdotorg/synapse:latest generate ä¸Šé¢çš„åŸŸåï¼ˆä¾‹ï¼‰ï¼Œæ”¹ä¸ºä½ è‡ªå·±çš„åŸŸå\nåœ¨postgresqlä¸­åˆ›å»ºç”¨æˆ·å’Œæ•°æ®åº“ï¼ˆé»˜è®¤ä½¿ç”¨sqliteï¼Œåªæ˜¯ä½“éªŒçš„è¯å¯ä»¥è·³è¿‡ï¼‰\nä¿®æ”¹é…ç½®æ–‡ä»¶/root/data/docker_data/synapse/data/homeserver.yaml\nï¼Œæ³¨é‡Šæ‰åŸå…ˆçš„sqlite3é…ç½®ï¼Œä¿®æ”¹ä¸ºpostgresé…ç½®\nå…ˆæ³¨é‡Šæ–‡ä»¶ä¸­ä¸‹é¢çš„ï¼š\n#database: #name: sqlite3 #args: # database: /data/homeserver.db æ¢æˆï¼š\ndatabase: name: psycopg2 args: user: synapse_user password: \u0026lt;pass\u0026gt; database: synapse host: \u0026lt;host\u0026gt; #ç›´æ¥å¡«å…¥å†…ç½‘ipå³å¯ cp_min: 5 cp_max: 10 åœ¨/root/data/docker_data/synapseæ–‡ä»¶å¤¹ä¸‹æ–°å»ºdocker-compose.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹\nservices: synapse: image: matrixdotorg/synapse:latest container_name: matrix-synapse ports: - \u0026#34;8008:8008\u0026#34; volumes: - ./data:/data - ./html:/usr/local/lib/python3.11/site-packages/synapse/static networks: - matrix restart: always environment: - \u0026#34;TZ=Asia/Shanghai\u0026#34; networks: matrix: name: matrix ä¸Šé¢çš„ä»£ç æœ‰å…³docker ç½‘ç»œçš„çŸ¥é“ï¼Œæ ¹æ®ä¸Šé¢çš„ä»£ç ä¸‹é¢è¯´æ˜ä¸€ä¸‹ï¼š\nåœ¨ä½ çš„Docker Composeæ–‡ä»¶ä¸­ï¼Œä½ å®šä¹‰äº†ä¸€ä¸ªåä¸º\u0026quot;matrix\u0026quot;çš„ç½‘ç»œã€‚å½“ä½ è¿è¡Œdocker-compose up -dæ—¶ï¼ŒDocker Composeä¼šä¸ºæ¯ä¸ªæœåŠ¡è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ¡¥æ¥ç½‘ç»œï¼Œå¹¶åœ¨ç½‘ç»œåç§°å‰åŠ ä¸ŠæœåŠ¡åç§°çš„å‰ç¼€ã€‚\nå› æ­¤ï¼Œç”±äºä½ çš„æœåŠ¡åæ˜¯\u0026quot;synapse\u0026quot;ï¼Œå®é™…åˆ›å»ºçš„æ¡¥æ¥ç½‘ç»œåç§°ä¼šæ˜¯\u0026quot;synapse_matrix\u0026quot;ï¼Œï¼ˆå¦‚æœä¸åŠ name: matrixå°±æ˜¯è¿™æ ·ï¼‰è€Œä¸æ˜¯ä»…ä»…æ˜¯\u0026quot;matrix\u0026quot;ã€‚è¿™æ˜¯Docker Composeçš„é»˜è®¤è¡Œä¸ºã€‚\nä»£ç ä¸­ï¼š - ./html:/usr/local/lib/python3.11/site-packages/synapse/static è¿™æ˜¯æŒ‡å‘synapseçš„ä¸»é¡µç½‘é¡µ\nå¦‚æœä½ æƒ³æ˜¾å¼åœ°æŒ‡å®šç½‘ç»œåç§°ï¼Œå¯ä»¥åœ¨networkséƒ¨åˆ†çš„å®šä¹‰ä¸­ä½¿ç”¨nameå±æ€§ï¼Œä¾‹å¦‚ï¼š\nservices: synapse: image: matrixdotorg/synapse:latest container_name: matrix-synapse ports: - \u0026#34;8008:8008\u0026#34; volumes: - ./data:/data - ./html:/usr/local/lib/python3.11/site-packages/synapse/static networks: - matrix restart: always environment: - \u0026#34;TZ=Asia/Shanghai\u0026#34; networks: matrix: name: my_custom_matrix_network #å› æ­¤è¿™ä¸ªname,æˆ‘å°±å†™ä¸ºä¸Šé¢çš„ï¼šmatrix\nå¯åŠ¨å®¹å™¨ docker-compose up -d é…ç½®nginxåå‘ä»£ç†httpæˆ–httpsï¼ˆç•¥è¿‡ï¼‰\nåˆ›å»ºç”¨æˆ·ï¼ˆé»˜è®¤ç¦æ­¢å…¬å¼€æ³¨å†Œï¼‰\næ ¹æ®æç¤ºè¾“å…¥ç”¨æˆ·åã€å¯†ç ã€æ˜¯å¦è®¾ç½®ä¸ºç®¡ç†å‘˜ register_new_matrix_user -c /data/homeserver.yaml \u0026lt;your matrix server host\u0026gt; cd /root/data/docker_data/synapse docker-compose exec synapse register_new_matrix_user -c /data/homeserver.yaml http://localhost:8008 å®‰è£…element webå®¢æˆ·ç«¯ è®¿é—®githubä¸‹è½½releaseåŒ…\nè§£å‹åï¼Œåˆ›å»ºé…ç½®æ–‡ä»¶\ncp config.sample.json config.json ç¼–è¾‘config.jsonï¼Œè®¾ç½®default_server_config.m.homeserver.base_urlä¸ºè‡ªå·±çš„matrixæœåŠ¡ç«¯åœ°å€\né…ç½®nginxæŒ‡å‘è§£å‹åçš„ç›®å½•\nè®¿é—®è‡ªå»ºçš„element webå®¢æˆ·ç«¯æµ‹è¯•\nè¡¥å…… å…è®¸å…¬å¼€æ³¨å†Œ ä¿®æ”¹synapseçš„homeserver.yamlæ–‡ä»¶ï¼Œè®¾ç½®ä»¥ä¸‹å‚æ•°\nenable_registration: True é‡å¯synapse\nElementçš„Windowså®¢æˆ·ç«¯æŒ‡å®šé»˜è®¤æœåŠ¡å™¨åœ°å€ åœ¨èµ„æºç®¡ç†å™¨ä¸­æ‰“å¼€ç›®å½• %AppData\\Roaming\\Element%\næ–°å»ºæ–‡ä»¶ config.jsonï¼Œè¾“å…¥ä»¥ä¸‹å†…å®¹\n{ \u0026#34;default_server_config\u0026#34;: { \u0026#34;m.homeserver\u0026#34;: { \u0026#34;base_url\u0026#34;: \u0026#34;\u0026lt;your matrix server host\u0026gt;\u0026#34; } } } å¤‡ä»½æ¢å¤çš„æ–¹æ³•ï¼š ä¸ºäº†è®©æ¡¥æ¥ç”¨çš„å®¹å™¨å’Œ synapse å®¹å™¨èƒ½å¤Ÿäº’ç›¸é€šè®¯ï¼Œ å»ºç«‹ä¸€ä¸ª docker networkï¼š\ndocker network create matrix PostgreSQL pgåº“æˆ‘é€‰æ‹©äº†16ç‰ˆæœ¬ï¼Œé€‰æ‹©çš„é•œåƒæ˜¯postgres:16-alpineã€‚\ndocker run --name postgres16 --network matrix --restart=always -v /root/data/docker_data/synapse/postgres:/var/lib/postgresql/data -e POSTGRES_PASSWORD=è‡ªå®šä¹‰PostgreSQLå¯†ç  -p 5432:5432 -d postgres:16-alpine æ›´æ”¹synapseæ–‡ä»¶å¤¹ä¸‹é‡Œçš„docker-compose.ymlé‡Œçš„å†…å®¹å¦‚ä¸‹ï¼Œç›´æ¥å¤åˆ¶æ›¿æ¢ï¼š\nservices: synapse: image: matrixdotorg/synapse:latest container_name: matrix-synapse ports: - \u0026#34;8008:8008\u0026#34; volumes: - /root/data/docker_data/synapse/data/:/data/ - /root/data/docker_data/synapse/html/:/usr/local/lib/python3.11/site-packages/synapse/static/ networks: - matrix restart: always environment: - \u0026#34;TZ=Asia/Shanghai\u0026#34; networks: matrix: driver: bridge è¿è¡Œï¼š\ndocker-compose up -d æå®šï¼\n","permalink":"https://hanigege.github.io/posts/other/%E5%AE%B6%E5%BA%AD%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B3%BB%E5%88%971synapse%E6%90%AD%E5%BB%BA/","tags":null,"title":"å®¶åº­èŠå¤©æœåŠ¡å™¨ç³»åˆ—ï¼ˆ1ï¼‰synapseæ­å»º"},{"categories":["routers"],"contents":"\nè¿™é‡Œä½¿ç”¨vyosè‡ªç®¡ç†å®¹å™¨çš„æ–¹æ³•,å¯ä»¥è·å–åˆ°ç½‘å¡å…¬ç½‘ip æ“ä½œå‰ï¼Œvyosæœ¬æœºå…ˆç§‘å­¦ï¼Œä¸ç„¶æ²¡æ³•æ¥dockeré•œåƒ è¿™ç§æ¨¡å¼ä¸å¯ä»¥è®¾ç½®å•ç‹¬çš„IP,å› ä¸ºä½¿ç”¨çš„æ˜¯vyosä¸»æœºçš„ip\næ¡¥æ¥çš„ç½‘ç»œå¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥å»ºä¸€ä¸ªçš„ï¼šåŸå› æ˜¯æ–¹ä¾¿ ddns-goä½¿ç”¨å†…ç½‘çš„ç½‘å€ç™»å½• ï¼š172.23.0.1 (å¯é€‰ï¼Œéå¿…é¡»ï¼Œä¹Ÿå¯ä»¥ç”¨å†…å¤–ç½‘å£ipç™»å½•)\nåˆ›å»ºæ¡¥æ¥ç½‘ç»œ set container network ct-network prefix \u0026#39;172.23.0.0/24\u0026#39; æå‰å»ºç«‹å¥½ddnsçš„æ˜ å°„æœ¬åœ°æŒä¹…ç›®å½•ï¼š mkdir -p /config/containers/ddns æ‹‰å–å®¹å™¨é•œåƒ $ add container image \u0026#39;jeessy/ddns-go\u0026#39; æ­å»ºddns-go set container name ddns-go allow-host-networks #å…è®¸å®¹å™¨ä½¿ç”¨ä¸»æœºç½‘ç»œï¼ˆhost networkï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®¹å™¨ä¸ä¼šæœ‰ç‹¬ç«‹çš„ç½‘ç»œæ¥å£ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ VyOS ä¸»æœºçš„ç½‘ç»œ set container name ddns-go image \u0026#39;docker.io/jeessy/ddns-go\u0026#39; #æŒ‡å®šè¯¥å®¹å™¨ä½¿ç”¨çš„ Docker é•œåƒ set container name ddns-go restart \u0026#39;always\u0026#39; set container name ddns-go volume config destination \u0026#39;/root/\u0026#39; #æ˜ å°„å®¹å™¨å†…çš„è·¯å¾„ set container name ddns-go volume config source \u0026#39;/config/containers/ddns\u0026#39; #æ˜ å°„æœ¬åœ°çš„è·¯å½¹ æŸ¥çœ‹è¿è¡Œæ˜¯å¦æˆåŠŸæœ‰UPå³æˆåŠŸ sudo podman ps -s sudo podman ps -a ç™»å½•ç®¡ç†å¹³å° http://IP:9876 ç™»å½•ç”¨æˆ·åï¼šadmin\n","permalink":"https://hanigege.github.io/posts/routers/vyos%E4%B8%8B%E5%AE%89%E8%A3%85ddns-go/","tags":null,"title":"Vyosä¸‹å®‰è£…ddns-Go"},{"categories":["freebsd"],"contents":"\npkg æ¢æº è‹¥è¦è·å–æ»šåŠ¨æ›´æ–°çš„åŒ…ï¼Œè¯·å°† quarterly ä¿®æ”¹ä¸º latestã€‚äºŒè€…åŒºåˆ«è§ FreeBSD æ‰‹å†Œã€‚è¯·æ³¨æ„ï¼ŒCURRENT ç‰ˆæœ¬åªæœ‰ latestã€‚\nä½¿ç”¨å‘½ä»¤ä¿®æ”¹ç³»ç»Ÿçº§ pkg æºä½¿ç”¨ latestï¼š\nsed -i \u0026#39;\u0026#39; \u0026#39;s/quarterly/latest/g\u0026#39; /etc/pkg/FreeBSD.conf åˆ›å»ºç”¨æˆ·çº§æºç›®å½•å’Œæ–‡ä»¶ï¼š\n# mkdir -p /usr/local/etc/pkg/repos # nano /usr/local/etc/pkg/repos/mirrors.conf ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™ï¼ˆUSTCï¼‰\nå†™å…¥ä»¥ä¸‹å†…å®¹ï¼š\nustc: { url: \u0026#34;http://mirrors.ustc.edu.cn/freebsd-pkg/${ABI}/latest\u0026#34;, } FreeBSD: { enabled: no } å—äº¬å¤§å­¦å¼€æºé•œåƒç«™\nå†™å…¥ä»¥ä¸‹å†…å®¹ï¼š\nnju: { url: \u0026#34;http://mirrors.nju.edu.cn/freebsd-pkg/${ABI}/latest\u0026#34;, } FreeBSD: { enabled: no } ç½‘æ˜“å¼€æºé•œåƒç«™\nå†™å…¥ä»¥ä¸‹å†…å®¹ï¼š\n163: { url: \u0026#34;http://mirrors.163.com/freebsd-pkg/${ABI}/latest\u0026#34;, } FreeBSD: { enabled: no } ports æºï¼šä»¥æºä»£ç æ–¹å¼ç¼–è¯‘å®‰è£…è½¯ä»¶çš„åŒ…ç®¡ç†å™¨ ä¸‹è½½ ports è¿™ä¸ªæºæ˜¯ä¸‹è½½ ports æœ¬èº«çš„æºã€‚ç­‰åŒäºä»¥å‰çš„ portsnapã€‚\nGit æ–¹æ³• é¡»æå‰å®‰è£… gitï¼š\n# pkg install git æˆ–\n# cd /usr/ports/devel/git # make install clean ç„¶åï¼š(å¦‚æœå·²ç»å®‰è£…äº†portsï¼Œç›´æ¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤ä¼šæŠ¥é”™ï¼Œè¯·ç»§ç»­å¾€ä¸‹çœ‹ï¼‰\n# git clone --filter=tree:0 https://mirrors.ustc.edu.cn/freebsd-ports/ports.git /usr/ports æ³¨æ„\n\u0026ndash;depth 1 ä¼šç»™æœåŠ¡å™¨å¸¦æ¥è¾ƒå¤§è®¡ç®—å‹åŠ›ï¼Œè¯·å°½é‡ä½¿ç”¨å‚æ•° \u0026ndash;filter=tree:0ã€‚\nä½ æ”¶åˆ°çš„é”™è¯¯ä¿¡æ¯è¡¨æ˜ï¼Œç›®æ ‡è·¯å¾„ /usr/ports å·²ç»å­˜åœ¨ï¼Œå¹¶ä¸”è¯¥ç›®å½•ä¸æ˜¯ç©ºçš„ã€‚è¿™æ„å‘³ç€åœ¨å°è¯• git clone æ—¶ï¼ŒGit å‘ç°ç›®æ ‡ç›®å½•å·²ç»æœ‰å†…å®¹ï¼Œå› æ­¤æ— æ³•æ‰§è¡Œå…‹éš†æ“ä½œã€‚\nè§£å†³æ–¹æ³•ï¼š ä½ å¯ä»¥é€‰æ‹©ä»¥ä¸‹å‡ ç§æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š\nåˆ é™¤ç°æœ‰çš„ /usr/ports ç›®å½• å¦‚æœä½ ç¡®è®¤ /usr/ports ç›®å½•ä¸­çš„å†…å®¹ä¸å†éœ€è¦ï¼Œå¯ä»¥åˆ é™¤è¯¥ç›®å½•å¹¶é‡æ–°æ‰§è¡Œ git cloneï¼š\nrm -rf /usr/ports git clone --filter=tree:0 https://mirrors.ustc.edu.cn/freebsd-ports/ports.git /usr/ports æ³¨æ„ï¼š åˆ é™¤ç›®å½•å‰è¯·ç¡®ä¿è¯¥ç›®å½•ä¸­çš„å†…å®¹ä¸å†éœ€è¦ï¼Œå› ä¸ºè¿™ä¼šå®Œå…¨æ¸…é™¤ç›®å½•åŠå…¶å†…å®¹ã€‚\nä½¿ç”¨å·²æœ‰çš„ /usr/ports ç›®å½• å¦‚æœ /usr/ports ç›®å½•å·²ç»åŒ…å«äº†ä¸€éƒ¨åˆ†å†…å®¹ï¼ˆæ¯”å¦‚å·²ç»å­˜åœ¨çš„ Ports æ ‘ï¼‰ï¼Œä½ å¯ä»¥é€‰æ‹©ç›´æ¥åœ¨è¯¥ç›®å½•ä¸­è¿›è¡Œ Git æ›´æ–°ï¼Œè€Œä¸æ˜¯é‡æ–°å…‹éš†ã€‚ é¦–å…ˆï¼Œè¿›å…¥ /usr/ports ç›®å½•ï¼š\ncd /usr/ports ç„¶åï¼Œè¿è¡Œ Git æ‹‰å–æ›´æ–°ï¼š\ngit fetch --all è¿™å°†æ›´æ–°ç°æœ‰çš„ Ports æ ‘ï¼Œè€Œä¸æ˜¯é‡æ–°å…‹éš†ã€‚\nä½¿ç”¨ä¸€ä¸ªä¸åŒçš„ç›®å½•ä½œä¸ºç›®æ ‡ å¦‚æœä½ å¸Œæœ›ä¿ç•™ /usr/ports ä¸­çš„ç°æœ‰å†…å®¹ï¼Œå¯ä»¥å°† Ports æ ‘å…‹éš†åˆ°å¦ä¸€ä¸ªç›®å½•ï¼Œé¿å…å†²çªã€‚ä¾‹å¦‚ï¼š git clone --filter=tree:0 https://mirrors.ustc.edu.cn/freebsd-ports/ports.git /path/to/another/directory è¿™æ ·ï¼Œä½ å°±å¯ä»¥åœ¨æ–°çš„ç›®å½•ä¸­è·å– Ports æ ‘ï¼Œè€Œä¸å½±å“ç°æœ‰çš„ /usr/portsã€‚\næ€»ç»“ï¼š å¦‚æœ /usr/ports ç›®å½•çš„å†…å®¹ä¸å†éœ€è¦ï¼Œå¯ä»¥åˆ é™¤å¹¶é‡æ–°å…‹éš†ã€‚\nå¦‚æœæƒ³ä¿ç•™ç°æœ‰å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨ Git æ›´æ–°å·²æœ‰çš„ä»“åº“ã€‚\nå¦‚æœä¸æƒ³å½±å“ç°æœ‰å†…å®¹ï¼Œå¯ä»¥å°† Ports æ ‘å…‹éš†åˆ°å¦ä¸€ä¸ªç›®å½•ã€‚\n","permalink":"https://hanigege.github.io/posts/freebsd/%E8%AE%A9freebsd%E5%9C%A8%E7%BB%88%E7%AB%AF%E4%B8%8B%E6%8D%A2%E6%BA%90/","tags":null,"title":"è®©freebsdåœ¨ç»ˆç«¯ä¸‹æ¢æº"},{"categories":["freebsd"],"contents":"\nç¼–è¾‘/etc/login.confï¼Œç»“å°¾å¤„ï¼ˆæˆ‘ä¸€èˆ¬åœ¨russianæ®µè½åé¢ï¼‰æ·»åŠ  chinese|Chinese Users Accounts:\\ :charset=UTF-8:\\ :lang=zh_CN.UTF-8:\\ :setenv=LC_ALL=zh_CN.UTF-8:\\ :tc=default: ä¹‹åè¿è¡Œ cap_mkdb /etc/login.conf pw usermod root -L chinese ","permalink":"https://hanigege.github.io/posts/freebsd/%E8%AE%A9freebsd%E5%9C%A8%E7%BB%88%E7%AB%AF%E4%B8%8B%E6%94%AF%E6%8C%81%E4%B8%AD%E6%96%87/","tags":null,"title":"è®©freebsdåœ¨ç»ˆç«¯ä¸‹æ”¯æŒä¸­æ–‡"},{"categories":["freebsd"],"contents":"\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;freebsdç³»ç»Ÿæˆ‘å»ºè®®æ˜¯ç”¨æ™®é€šç”¨æˆ·ç™»å½•ä½¿ç”¨ï¼ŒbashæŒ‡ä»¤é›†åªä¿®æ”¹æ™®é€šç”¨æˆ·ä½¿ç”¨ï¼Œrootç”¨æˆ·ä¸è¦æ”¹ã€‚ \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;ğŸ§± åŸå› ä¸€ï¼šbash é€šå¸¸å®‰è£…åœ¨ /usr/local/binï¼Œè€Œä¸æ˜¯ /bin \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;FreeBSD éµå¾ªä¼ ç»Ÿ Unix çš„ç›®å½•ç»“æ„ï¼Œç³»ç»Ÿæ ¸å¿ƒå·¥å…·ä½äº /binã€/sbinã€/usr/bin ç­‰ï¼Œè€Œ /usr/local/bin æ˜¯ç”¨äºç¬¬ä¸‰æ–¹è½¯ä»¶çš„ã€‚\nå¦‚æœä½ å°† root çš„ shell æ”¹ä¸º /usr/local/bin/bashï¼Œä½† /usr/local æ²¡æŒ‚è½½æˆ–å‡ºæ•…éšœäº†ï¼Œå°±æ— æ³•ç™»å½•æˆ–ä¿®å¤ç³»ç»Ÿã€‚\nè¿™åœ¨ å•ç”¨æˆ·æ¨¡å¼ï¼ˆsingle user modeï¼‰æˆ–ç³»ç»Ÿä¿®å¤ç¯å¢ƒä¸­ æ˜¯ä¸ªå¤§é—®é¢˜ï¼šç³»ç»Ÿé€šå¸¸åªæŒ‚è½½äº†æ ¹åˆ†åŒº /ï¼Œå¹¶ä¸ä¼šæŒ‚è½½ /usrã€‚\nâ¸»\nğŸ§¯ åŸå› äºŒï¼šç³»ç»Ÿå¯åŠ¨æ—¶çš„æœ€å°å¯ç”¨ç¯å¢ƒä¸­æ²¡æœ‰ bash\nç³»ç»Ÿå¯åŠ¨æ—©æœŸå¯èƒ½ bash è¿˜æ²¡è¢«åŠ è½½ï¼Œroot å°±å¿…é¡»ä¾èµ– /bin/sh ä¹‹ç±»çš„æœ€åŸºæœ¬ shellã€‚ å¦‚æœä½ ç”¨çš„æ˜¯ bashï¼Œè€Œ bash åˆä¸å¯ç”¨ï¼Œé‚£ä½ ç”šè‡³è¿ shell éƒ½æ‰“ä¸å¼€ã€‚\n1.å®‰è£…bash cd /usr/ports/shells/bash make install clean åœ¨/binç›®å½•ä¸‹é¢åšä¸€ä¸ªç¬¦å·è¿æ¥ã€‚ï¼ˆè¿™ä¸€æ­¥å¯ä»¥ä¸åšï¼Œå¯é€‰ï¼‰\nln -s /usr/local/bin/bash /bin/bash åŠ å…¥bash,å¦‚æœä¸Šä¸€æ­¥åšäº† echo \u0026#39;/bin/bash\u0026#39; \u0026gt;\u0026gt; /etc/shells ä¿æŒé»˜è®¤è·¯å¾„çš„ç”¨ä¸‹é¢çš„\necho \u0026#39;/usr/local/bin/bash\u0026#39; | sudo tee -a /etc/shells 4.æ›´æ”¹ç”¨æˆ·shell(rootç”¨æˆ·ä¸å»ºè®®ä¿®æ”¹ï¼‰\nchsh -s /bin/bash root ä¿æŒé»˜è®¤è·¯å¾„çš„ç”¨ä¸‹é¢çš„ ï¼ˆæ¨èä¸‹é¢æ™®èƒ½ç”¨æˆ·ç›´æ¥ä½¿ç”¨ï¼‰\nchsh -s /usr/local/bin/bash # sudo chsh -s /usr/local/bin/bash gary 5.é…ç½® (root)\n# vi ~/.profile æˆ–è€…-ä¿æŒé»˜è®¤è·¯å¾„çš„ç”¨ä¸‹é¢çš„(æ™®é€šç”¨æˆ·ï¼‰\n$ vim .bash_profile alias ls=\u0026#39;ls -G\u0026#39; #æ˜¾ç¤ºé¢œè‰² alias ll=\u0026#39;ls -al\u0026#39; alias rm=\u0026#39;rm -i\u0026#39; #ç¡®è®¤åˆ é™¤ alias del=\u0026#39;rm -r\u0026#39; #ç¡®è®¤åˆ é™¤ alias mv=\u0026#39;mv -i\u0026#39; #ç¡®è®¤ç§»åŠ¨ 6.é€€å‡ºé‡æ–°ç™»å½•å³ç”Ÿæ•ˆ è¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ‡æ¢ä¸º bashï¼š\nexec /usr/local/bin/bash -l trzszä¸‹éœ€æ”¹ä¸ºï¼š ä½¿ç”¨bash /usr/local/bin/bash -1 ","permalink":"https://hanigege.github.io/posts/freebsd/freebsd%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8bash/","tags":null,"title":"Freebsdç¼–è¯‘å®‰è£…å’Œä½¿ç”¨bash"},{"categories":["freebsd"],"contents":"\nå¼€å§‹å®‰è£…ï¼Œå›è½¦ ç›´æ¥å›è½¦ å¡«å†™ä¸»æœºå ï¼ˆå¯ç›´æ¥å›è½¦ï¼‰ é»˜è®¤çš„åŸºç¡€ä¸Šå¤šåŠ ä¸€ä¸ªå®‰è£…ports è¿™é‡Œæˆ‘é€‰æ‹©UFSï¼ˆè™šæ‹Ÿæœºæˆ‘å»ºè®®é€‰UFSï¼‰ ç›´æ¥å›è½¦ é€‰æ‹©GPT finish commit å¼€å§‹å®‰è£… å®‰è£…å¥½åä¼šæç¤ºè®¾å®šrootå¯†ç  ok è®¾ç½®ç½‘ç»œ é€‰no ,è‡ªè®¾ç½®ipåœ°å€ è®¾ç½®å®Œç‚¹ok ipv6ç›´æ¥yes è®¾ç½®dns æ ¹æ®è‡ªå·±çš„æ‰€åœ¨åœ°é€‰æ—¶åŒº åé¢æ˜¯è®¾ç½®æ—¶é—´ï¼Œä¸€è·¯å›è½¦ æ·»åŠ ä¸Šä¸¤ä¸ªè‡ªåŠ¨æ ¡å‡†ç½‘ç»œæ—¶é—´çš„ç»„ä»¶ntp ç¬¬ä¸€ä¸ªä¹Ÿå¯ä»¥åŠ ä¸Šunboundè¿™æ˜¯æœ¬åœ°dns (13.1ç³»ç»Ÿï¼‰ç³»ç»Ÿé‚®ä»¶ç”¨ä¸ä¸Šï¼Œå…³é—­sendmailï¼Œæ–°ç‰ˆæœ¬å·²ç»æ²¡æœ‰è¿™ä¸€ä¸ªé€‰é¡¹äº†ï¼Œï¼ˆ14.2ç³»ç»Ÿï¼‰éƒ½ä¸é€‰ï¼š æ·»åŠ æ–°ç”¨æˆ·ï¼š ç”¨æˆ·è®¾ç½®ç‰¹åˆ«æ³¨æ„ï¼Œç”¨æˆ·åå¯†ç è‡ªè¡Œè®¾ç½®ï¼Œç”¨æˆ·ç»„åŠ å…¥wheelå¤–ï¼ˆè¿™æ ·æ‰å¯ä»¥ç”¨sudoï¼‰ï¼Œå…¶å®ƒå…¨éƒ¨é»˜è®¤å›è½¦ è¾“å…¥å®Œå¯†ç åï¼Œåé¢çš„é€‰é¡¹é€‰no,ç›´æ¥å›è½¦å³å¯ æœ€åç¡®è®¤ï¼Œè¾“å…¥yes ","permalink":"https://hanigege.github.io/posts/freebsd/freebsd-install/","tags":null,"title":"å®‰è£…freebsd13.1æµç¨‹(14.2ç‰ˆæœ¬çš„ä¸€æ ·)"},{"categories":["linux"],"contents":"\nç°åœ¨æœ‰å¾ˆå¤šä¾¿å®œNATé¸¡å› ä¸ºé…ç½®è¾ƒä½ï¼Œæ‰€ä»¥åªé€‰ç”¨çš„æ˜¯Alpine Linux,æ‰€ä»¥æˆ‘å°±éšä¾¿å†™äº†ä¸ªæ•™ç¨‹æ–¹ä¾¿ä½¿ç”¨ã€‚ å®‰è£…ä¾èµ– é¦–å…ˆå…ˆå®‰è£…singbox,è¿˜æœ‰vimï¼ˆæ–¹ä¾¿ç¼–è¾‘ï¼‰\necho \u0026#34;@testing https://dl-cdn.alpinelinux.org/alpine/edge/testing\u0026#34; \u0026gt;\u0026gt; /etc/apk/repositories apk add sing-box@testing apk add vim rc-update add sing-box default è®¾ç½®è‡ªå¯. 1.è¿™é‡Œè¦è¯´æ˜ä¸€ä¸‹ï¼Œä¸Šé¢å®‰è£…å¥½åé»˜è®¤ä¼šè‡ªåŠ¨ç”Ÿæˆå¯åŠ¨æ–‡ä»¶/etc/init.d/sing-box , é…ç½®æ–‡ä»¶åœ¨ /etc/sing-box/config.json\n2.å¦‚æœç”¨ä¸‹é¢è‡ªå»ºçš„ï¼Œé»˜è®¤çš„å°±ä¸ç”¨å¯åŠ¨å°±è¡Œäº†ï¼Œæ›´ä¸è¦è®¾ç½®è‡ªå¯åŠ¨ï¼Œä»¥å…å†²çªã€‚ ç¼–è¾‘è¿™ä¸ªæ–‡ä»¶ï¼švim /etc/init.d/singbox\n#!/sbin/openrc-run command=\u0026#34;/usr/bin/sing-box\u0026#34; command_args=\u0026#34;run -c /root/config.json\u0026#34; #æ˜¯æ‚¨çš„é…ç½®æ–‡ä»¶ä½ç½® description=\u0026#34;singbox service\u0026#34; depend() { need net use logger } start() { ebegin \u0026#34;Starting singbox\u0026#34; start-stop-daemon --start --background --exec $command -- $command_args eend $? } stop() { ebegin \u0026#34;Stopping singbox\u0026#34; start-stop-daemon --stop --exec $command eend $? } ç„¶ååŠ å…¥OpenRCè‡ªå¯åŠ¨\nchmod +x /etc/init.d/singbox rc-update add singbox default service singbox start è‡ªç­¾è¯ä¹¦ï¼Œæ³¨æ„è·¯å¾„ï¼š\nmkdir -p /etc/hysteria \u0026amp;\u0026amp; openssl ecparam -genkey -name prime256v1 -out /etc/hysteria/private.key \u0026amp;\u0026amp; openssl req -new -x509 -days 3650 -key /etc/hysteria/private.key -out /etc/hysteria/cert.pem -subj \u0026#34;/CN=bing.com\u0026#34; é…ç½®hy2å…¥ç«™æœåŠ¡ç«¯ï¼š { \u0026#34;log\u0026#34;: { \u0026#34;level\u0026#34;: \u0026#34;info\u0026#34; }, \u0026#34;dns\u0026#34;: { \u0026#34;servers\u0026#34;: [ {\u0026#34;address\u0026#34;: \u0026#34;8.8.8.8\u0026#34;}, {\u0026#34;address\u0026#34;: \u0026#34;1.1.1.1\u0026#34;} ] }, \u0026#34;inbounds\u0026#34;: [ { \u0026#34;type\u0026#34;: \u0026#34;hysteria2\u0026#34;, \u0026#34;listen\u0026#34;: \u0026#34;::\u0026#34;, \u0026#34;listen_port\u0026#34;: 449, \u0026#34;users\u0026#34;: [ { \u0026#34;password\u0026#34;: \u0026#34;your-strong-random-password-123\u0026#34; } ], \u0026#34;tls\u0026#34;: { \u0026#34;enabled\u0026#34;: true, \u0026#34;alpn\u0026#34;: [\u0026#34;h3\u0026#34;], \u0026#34;certificate_path\u0026#34;: \u0026#34;/etc/hysteria/cert.pem\u0026#34;, \u0026#34;key_path\u0026#34;: \u0026#34;/etc/hysteria/private.key\u0026#34; } } ], \u0026#34;outbounds\u0026#34;: [ { \u0026#34;type\u0026#34;: \u0026#34;direct\u0026#34; } ], \u0026#34;route\u0026#34;: { \u0026#34;rules\u0026#34;: [ { \u0026#34;protocol\u0026#34;: \u0026#34;dns\u0026#34;, \u0026#34;action\u0026#34;: \u0026#34;direct\u0026#34; } ] } } é…ç½®hy2å‡ºç«™å®¢æˆ·ç«¯ï¼š { \u0026#34;tag\u0026#34;: \u0026#34;sg-hy2\u0026#34;, \u0026#34;server\u0026#34;: \u0026#34;IPåœ°å€æˆ–è€…åŸŸå\u0026#34;, \u0026#34;server_port\u0026#34;: 449, \u0026#34;up_mbps\u0026#34;: 50, \u0026#34;down_mbps\u0026#34;: 500, \u0026#34;type\u0026#34;: \u0026#34;hysteria2\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;å¯†ç \u0026#34;, \u0026#34;tls\u0026#34;: { \u0026#34;insecure\u0026#34;: true, \u0026#34;enabled\u0026#34;: true, \u0026#34;server_name\u0026#34;: \u0026#34;\u0026#34; }, \u0026#34;tcp_fast_open\u0026#34;: false }, ","permalink":"https://hanigege.github.io/posts/linux/alpine-linux-sing-box/","tags":null,"title":"Alpine Linuxæ­å»ºsing-boxæœåŠ¡ç«¯"},{"categories":["routers"],"contents":"æœåŠ¡ç«¯ï¼š { \u0026#34;type\u0026#34;: \u0026#34;shadowsocks\u0026#34;, \u0026#34;listen\u0026#34;: \u0026#34;::\u0026#34;, \u0026#34;listen_port\u0026#34;: 58442, \u0026#34;method\u0026#34;: \u0026#34;chacha20-ietf-poly1305\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;Um5zktQDo6GKqM1L/lLzwg==\u0026#34;, \u0026#34;multiplex\u0026#34;: { \u0026#34;enabled\u0026#34;: true } }, å®¢æˆ·ç«¯ï¼š { \u0026#34;type\u0026#34;: \u0026#34;shadowsocks\u0026#34;, \u0026#34;tag\u0026#34;: \u0026#34;ss-in-jygg-ros\u0026#34;, \u0026#34;server\u0026#34;: \u0026#34;ä½ çš„åŸŸå.xyz\u0026#34;, \u0026#34;server_port\u0026#34;: 58442, \u0026#34;network_strategy\u0026#34;: \u0026#34;hybrid\u0026#34;, \u0026#34;method\u0026#34;: \u0026#34;chacha20-ietf-poly1305\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;Um5zktQDo6GKqM1L/lLzwg==\u0026#34;, \u0026#34;udp_over_tcp\u0026#34;: false }, ","permalink":"https://hanigege.github.io/posts/routers/sing-box-ss-server/","tags":null,"title":"Sing-Boxä¸­çš„ssæœåŠ¡çš„å†™æ³•é…ç½®"},{"categories":null,"contents":"ä¸‰æ±‡SMG4004-4LCçš„å‡çº§æ–‡ä»¶ 1ã€å…ˆå‡çº§webå›ºä»¶åŒ… install4_2.2.8_2020092516.tar.gz\n2ã€å†å‡çº§åº•å±‚å›ºä»¶åŒ… install4_FPGA_1.11_2.11_3.032018122015.tar.gz\nè™šæ‹Ÿæœºæ‰¿æ¥ä¸‰æ±‡å’Œtelegramæ”¶å‘çŸ­ä¿¡çš„æœºå™¨äººå¯åŠ¨æ–‡ä»¶ è®°çš„ä¿®æ”¹å¯åŠ¨æ–‡ä»¶ä¸­çš„å‚æ•°ï¼Œé‡Œé¢æœ‰æ ‡æ³¨ã€‚sms.py\n","permalink":"https://hanigege.github.io/downloads/","tags":null,"title":"Downloads"},{"categories":["other"],"contents":"æˆ‘ä½¿ç”¨çš„æ˜¯ä¸‰æ±‡SMG4004-4LCï¼ˆç®—æ˜¯æ¡åƒåœ¾äº†ï¼Œè¿™æ˜¯ä»¥å‰çš„è€æ¬¾ï¼‰ï¼Œ4å£è¯­éŸ³ç½‘å…³ï¼Œç›®å‰è¿™æ¬¾åªèƒ½æ”¯æŒ2gç½‘ç»œå’ŒçŸ­ä¿¡ï¼Œæˆ‘æµ‹è¯•æˆ‘è¿™ä¸ªåœ°åŒºåªæ”¯æŒç§»åŠ¨å’Œè”é€šã€‚ä¸è¿‡ä¹Ÿå¤Ÿç”¨äº†ã€‚ ä½¿ç”¨å‰éœ€è¦å…ˆå‡èƒ½è¿™æ¬¾è®¾å¤‡çš„å›ºä»¶ï¼Œç›¸å…³å‡çº§æ–‡ä»¶ï¼Œæœ¬ç«™æœ‰æä¾›ä¸‹è½½ã€‚ ç…§ç€ä¸‹é¢è®¾ç½®ï¼Œå°±å¯ä»¥æµ‹è¯•ç”µè¯å‘¼å«äº†ï¼š ","permalink":"https://hanigege.github.io/posts/other/sanhui-smg4004-4lc-set/","tags":null,"title":"å‡ºå›½è‡ªå»ºvoip(äºŒ.2)ä¸‰æ±‡SMG4004-4LCçš„é…ç½®æ–¹æ³•æµ‹è¯•ç”µè¯å‘¼å«"},{"categories":["other"],"contents":"è¦é€šè¿‡ Telegram æœºå™¨äºº å¯¹æ¥ ä¸‰æ±‡è¯­éŸ³ç½‘å…³ï¼ˆSMG4000-C1LCï¼‰ çš„çŸ­ä¿¡åŠŸèƒ½ï¼Œæ‚¨éœ€è¦å®Œæˆä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š\næ­¥éª¤ 1ï¼š æ‰“å¼€ Telegramï¼Œæœç´¢å¹¶ä¸ BotFather èŠå¤©ã€‚\nå‘é€å‘½ä»¤ /newbot æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„æœºå™¨äººã€‚\nç»™æœºå™¨äººèµ·ä¸ªåå­—å¹¶è®¾ç½®ç”¨æˆ·åã€‚\nBotFather ä¼šç»™ä½ ä¸€ä¸ª API Tokenï¼Œç”¨æ¥ä¸ Telegram æœºå™¨äººè¿›è¡Œäº¤äº’ã€‚ä¿å­˜å¥½è¿™ä¸ª Tokenã€‚\næ­¥éª¤ 2ï¼šé…ç½®ä¸‰æ±‡ç½‘å…³å‘é€çŸ­ä¿¡ ä¸‰æ±‡è¯­éŸ³ç½‘å…³ä¸€èˆ¬æ”¯æŒé€šè¿‡ HTTP API æˆ– SMTP å‘é€çŸ­ä¿¡ã€‚é¦–å…ˆï¼Œç¡®ä¿ä¸‰æ±‡ç½‘å…³çš„çŸ­ä¿¡æœåŠ¡å·²ç»å¯ç”¨ï¼Œå¹¶ä¸”èƒ½å¤Ÿé€šè¿‡æ¥å£å‘é€çŸ­ä¿¡ã€‚\næ­¥éª¤ 3ï¼šç¼–å†™ Telegram æœºå™¨äººå’Œä¸‰æ±‡ç½‘å…³çš„å¯¹æ¥è„šæœ¬ ï¼ˆæœ¬ç«™æœ‰æä¾›ä¸‹è½½ï¼‰ ä½ éœ€è¦ç¼–å†™ä¸€ä¸ªè„šæœ¬ï¼Œä½¿ç”¨ Telegram æœºå™¨äººè·å–ä¿¡æ¯ï¼Œå¹¶é€šè¿‡ HTTP è¯·æ±‚å°†çŸ­ä¿¡å‘é€åˆ°ä¸‰æ±‡ç½‘å…³ã€‚\næ­¥éª¤ 3.1ï¼šå®‰è£… Telegram Bot åº“ï¼ˆä¾‹å¦‚ Python çš„ python-telegram-botï¼‰ï¼ˆè¯¦æƒ…ï¼Œè¯·çœ‹voipå‡ºå›½ç³»åˆ—ä¸‰ï¼‰\n","permalink":"https://hanigege.github.io/posts/other/sanhui-telegram-bot-4/","tags":null,"title":"å‡ºå›½è‡ªå»ºvoip(äºŒï¼‰åˆ›å»º Telegram æœºå™¨äºº"},{"categories":["other"],"contents":"\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;ä¸ºä»€ä¹ˆè¦å»ºå›å®¶voipç³»ç»Ÿï¼Œå‡ºå›½åï¼Œç”µè¯å°±æ˜¯å›½é™…é•¿é€”ï¼Œæ‰“ç”µè¯æ”¶å‘çŸ­ä¿¡éƒ½ä¸æ–¹ä¾¿ï¼Œæœ‰æ²¡æœ‰åŠæ³•å¯ä»¥åšåˆ°é€šè¿‡ç½‘ç»œä¼ é€’è¯­éŸ³å’Œæ”¶å‘çŸ­ä¿¡ï¼ˆåˆ©ç”¨telegramæœºå™¨äººï¼‰ï¼Œå½“ç„¶å¯ä»¥ï¼Œæ‰‹æœºå¡å¯ä»¥æ”¾åœ¨å›½å†…çš„å°è®¾å¤‡ä¸Šï¼Œè‡ªå·±æ‰‹æœºä¸Šè£…ä¸€ä¸ªsipè½¯ç”µè¯å®¢æˆ·ç«¯ï¼Œå³å¯å®Œå…¨å®ç°ï¼Œæ¥å¬æ‹¨æ‰“ç”µè¯ï¼Œæ”¶å‘çŸ­ä¿¡ï¼Œå¹¶ä¸”ä¸ä¼šå†å—åœ°åŸŸé™åˆ¶ï¼Œä»…é™å­¦ä¹ äº¤æµï¼Œå‹æƒ…æé†’ï¼Œä¸è¦åšè¿åå½“åœ°æ³•å¾‹æ³•è§„çš„äº‹ã€‚ å¼€å§‹æ“ä½œ æ¶æ„ freepbx16é¦–å…ˆä¿®æ”¹ipä¸ºå›ºå®šip å®‰è£…å¥½åï¼Œç³»ç»Ÿå…¶å®æ˜¯dhcpåŠ¨æ€è·å¾—ipçš„ï¼Œè¿›å…¥çœ‹äº†çœ‹ï¼Œæ˜¯Centosï¼Œæˆ‘ä»¬ä¸éœ€è¦dhcpï¼ŒæŠŠIPç»™å›ºå®šæ­»\nvi /etc/sysconfig/network-scripts/ifcfg-eth0 ä¸‹é¢çš„å†…å®¹è·Ÿå®é™…é…ç½®æ–‡ä»¶é‡Œçš„å†…å®¹ç›¸å¯¹æ›¿æ¢ï¼Œä¸€ä¸€å¯¹åº”æ›¿æ¢ï¼ŒåŸæ–‡ä»¶é‡Œçš„å†…å®¹å¯èƒ½æ›´å¤šä¸€äº›ï¼Œåªä¿®æ”¹ä¸‹é¢æœ‰çš„ï¼Œæ²¡æ¶‰åŠçš„ä¿æŒåŸæ¥çš„ï¼Œdnsä¸å¯ä»¥ç”¨ç§‘å­¦çš„ï¼Œåªå…è®¸ç”¨æœ¬åœ°ï¼Œä¸ç„¶ä¼šå½±å“åé¢ç³»ç»Ÿé‡Œnat-ipè·å–çš„å‡†ç¡®æ€§\nTYPE=\u0026#34;Ethernet\u0026#34; BOOTPROTO=\u0026#34;static\u0026#34; IPADDR=10.8.2.60 NETMASK=255.255.255.0 GATEWAY=10.8.2.1 DNS1=114.114.114.114 DEFROUTE=\u0026#34;yes\u0026#34; NAME=\u0026#34;eth0\u0026#34; DEVICE=\u0026#34;eth0\u0026#34; ONBOOT=\u0026#34;yes\u0026#34; é‡å¯ï½\nfreepbx16é…ç½®å›¾ä¾‹ freepbx16é»˜è®¤å®‰è£…åœ¨pveç³»ç»Ÿä¸Šå°±å¥½ï¼Œç™»å½•ç³»ç»Ÿå ï¼š\nå…ˆè¿›è¡Œasterisk sip è®¾ç½® ç°åœ¨å¼€å§‹è®¾ç½®ç³»ç»Ÿä¸­æ–‡åœ°åŒºæ—¶é—´ é€‰æ‹©é«˜çº§è®¾ç½®ï¼š\né«˜çº§è®¾ç½®é‡Œä¸€å¼€å§‹è¿˜æœ‰ä¸€ä¸ªé€‰é¡¹æ˜¯å¯`chan_sip`,è¿™ä¸ªè®°çš„è¦æ‰“å¼€ï¼Œä¸ç„¶åé¢è®¾ç½®ä¸­ç»§æˆ–è€…æ˜¯sipæœ‰äº›é€‰é¡¹ä¸æ˜¾ç¤º å¼€å¯ä¸­ç»§é…ç½® ï¼ˆè¿™å—è®¾ç½®æ˜¯è¿æ¥ä¸‰æ±‡è¯­éŸ³ç½‘å…³çš„ï¼‰ host=dynamic port=5160 type=peer secret=666 context=from-pstn dtmfmode=rfc2833 insecure=no qualify=3000 ç…§å›¾å¡«å†™å°±å¥½ï¼Œè¿™é‡Œæ˜¯å†…ç½‘ä¼ è¾“ä½¿ç”¨çš„ï¼Œç«¯å£ä¸å½±å“å•¥\nå…¥å±€çº¿è·¯ï¼ˆä¸éœ€è¦ï¼‰ è®¾ç½®å‡ºå±€çº¿è·¯ ä¸Šå›¾X.çš„æ„æ€æ˜¯ï¼Œæ‹¨æ‰“ç”µè¯æ—¶å¯ä»¥ç›´æ¥è¾“å…¥å¯¹æ–¹æ‰‹æœºå·ç ï¼Œä¸éœ€è¦åŠ 9å†æ‹¨å•¥çš„ï¼Œæ²¡å¿…è¦ã€‚ å…¶å®ƒä¸åŠ¨é»˜è®¤å°±å¥½ã€‚\næ·»åŠ ä¸­æ–‡è¯­éŸ³æé†’ ![CleanShot 2025-05-11 at 10.53.55@2x](assets/CleanShot%202025-05-11%20at%2010.53.55@2 x.png) åœ¨ä¸Šå›¾æ·»åŠ ä¸Šä¼ è¯­éŸ³æ–‡ä»¶ï¼Œå…·ä½“è¯­éŸ³æ–‡ä»¶è‡ªå·±å¯ä»¥googleæœç´¢freepbxä¸“ç”¨çš„ä¸­æ–‡è¯­éŸ³ éƒ½ä¸Šä¼ å®Œï¼Œåœ¨è®¾ç½®é‡Œé€‰æ‹©china å¼€å§‹é…ç½®åˆ†æœº å¯†ç æ¨èç”¨linuxç”Ÿæˆ32ä½çš„å¯†ç  âœ… 1. opensslï¼ˆæ¨èï¼Œå¸¸è§ç³»ç»Ÿé»˜è®¤æœ‰ï¼‰\nopenssl rand -base64 24 | cut -c1-32 â€¢ 24 å­—èŠ‚çš„ base64 ç¼–ç å¤§æ¦‚ç­‰äº 32 ä¸ªå­—ç¬¦ï¼› â€¢ cut -c1-32 ä¿è¯é•¿åº¦æ­£å¥½æ˜¯ 32ã€‚\nâœ… 2. pwgenï¼ˆä¸“é—¨ç”¨äºç”Ÿæˆå¯†ç ï¼‰\npwgen -s 32 1 -s è¡¨ç¤º secureï¼ˆæ›´éšæœºï¼‰ï¼Œ32 æ˜¯é•¿åº¦ï¼Œ1 è¡¨ç¤ºç”Ÿæˆä¸€ä¸ªã€‚\nå¦‚æœæ²¡æœ‰ pwgenï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å®‰è£…ï¼š\n# Debian / Ubuntu sudo apt install pwgen # RHEL / CentOS / Rocky sudo dnf install pwgen è¯­éŸ³é‚®ä»¶æ‰“å¼€ï¼Œä¹Ÿå°±æ˜¯è¯­è¨€ç•™è¨€åŠŸèƒ½ï¼Œè‡ªå·±è®¾ç½®ä¸€ä¸ªç®€å•å¯†ç å³å¯\næŸ¥çœ‹åŠŸèƒ½ä»£ç äº†è§£è‡ªå·±è¿˜èƒ½ä½¿ç”¨ä»€ä¹ˆåŠŸèƒ½ï¼Œå¦‚ç”µè¯ä¼šè®®ï¼Œé—¹é“ƒå›æ‹¨æé†’ï¼Œå°±è·Ÿé…’åº—ä¸€æ ·ã€‚ ","permalink":"https://hanigege.github.io/posts/other/freepbx16-set-all-1/","tags":null,"title":"å‡ºå›½è‡ªå»ºvoip(ä¸€)Freepbx16é…ç½®"},{"categories":["other"],"contents":"root@sms:~# source myenv/bin/activate æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ source myenv/bin/activate (myenv) root@sms:~# nohup python sms.py \u0026gt; sms.log 2\u0026gt;\u0026amp;1 \u0026amp; åå°å¯åŠ¨sms.py\nnohup python sms.py \u0026gt; sms.log 2\u0026gt;\u0026amp;1 \u0026amp; or nohup python sms.py \u0026gt; sms.log 2\u0026gt;\u0026amp;1 \u0026amp; (myenv) root@sms:~# ä¸Šé¢çš„ä¸¤æ¡å‘½ä»¤èƒ½ä¸èƒ½åšæˆè„šæœ¬ï¼Œè®¾ç½®ä¸ºå¼€æœºè‡ªå¯åŠ¨\nå¯ä»¥çš„ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª systemd æœåŠ¡ æˆ–è€… ç¼–å†™ä¸€ä¸ª shell è„šæœ¬ æ¥å®ç° Python è™šæ‹Ÿç¯å¢ƒçš„æ¿€æ´» å¹¶ è¿è¡Œ sms.py è„šæœ¬ï¼ŒåŒæ—¶è®¾ç½®ä¸º å¼€æœºè‡ªå¯åŠ¨ã€‚\næ–¹æ³• 1ï¼šä½¿ç”¨ systemd (æ¨è) é€‚ç”¨äº Debian/Ubuntu åŠå¤§å¤šæ•° Linux å‘è¡Œç‰ˆã€‚\næ­¥éª¤ 1ï¼šåˆ›å»º systemd æœåŠ¡æ–‡ä»¶ è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œåˆ›å»º sms.serviceï¼š\nnano /etc/systemd/system/sms.service å¡«å…¥ä»¥ä¸‹å†…å®¹ï¼š\n[Unit] Description=SMS Python Service After=network.target [Service] User=root WorkingDirectory=/root ExecStart=/root/myenv/bin/python /root/sms.py Restart=always StandardOutput=append:/root/sms.log StandardError=append:/root/sms.log [Install] WantedBy=multi-user.target âš  æ³¨æ„ï¼š\nWorkingDirectory=/root éœ€è¦ä¿®æ”¹æˆä½ çš„ Python è™šæ‹Ÿç¯å¢ƒå’Œ sms.py æ‰€åœ¨ç›®å½•ã€‚\nExecStart=/root/myenv/bin/python /root/sms.py ç¡®ä¿è·¯å¾„æ­£ç¡®ã€‚\nRestart=always è®©è¿›ç¨‹å´©æºƒåè‡ªåŠ¨é‡å¯ã€‚\næ­¥éª¤ 2ï¼šå¯ç”¨å¹¶å¯åŠ¨æœåŠ¡\nsystemctl daemon-reload systemctl enable sms systemctl start sms æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ï¼š systemctl status sms å¦‚æœ æ˜¾ç¤º active (running) è¯´æ˜æˆåŠŸã€‚ ","permalink":"https://hanigege.github.io/posts/other/telegram-sms-bot2/","tags":null,"title":"å‡ºå›½è‡ªå»ºvoip(ä¸‰.2ï¼‰Telegramæœºå™¨äººè¿æ¥ç¨‹åºè‡ªå¯åŠ¨(è¡¥å……ç¯‡)"},{"categories":["other"],"contents":"å‰ææ˜¯telegramè‡ªå·±çš„æœºå™¨äººæå‰ç”Ÿæˆå¥½ï¼Œå¹¶è·å–ç›¸åº”çš„å¯†é’¥ æ‰“å¼€ä¸€å°è™šæ‹Ÿæœºï¼ˆå»ºè®®debian12) æ–¹æ³• 1ï¼šä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ åˆ›å»ºä¸€ä¸ª Python è™šæ‹Ÿç¯å¢ƒï¼Œå¹¶åœ¨å…¶ä¸­å®‰è£…æ‰€éœ€çš„åº“ã€‚è¿™æ ·å¯ä»¥é¿å…ç³»ç»Ÿçº§ Python ç¯å¢ƒçš„å†²çªã€‚\nå®‰è£… python3-venvï¼ˆå¦‚æœæœªå®‰è£…ï¼‰\napt update apt install python3-venv åˆ›å»ºä¸€ä¸ªæ–°çš„è™šæ‹Ÿç¯å¢ƒ\npython3 -m venv myenv æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ\nsource myenv/bin/activate åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£… python-telegram-bot\npip install python-telegram-bot smpplib è¿è¡Œè„šæœ¬ï¼šä½ å¯ä»¥åœ¨è™šæ‹Ÿç¯å¢ƒä¸­è¿è¡Œä½ çš„ Telegram æœºå™¨äººè„šæœ¬,è„šæœ¬sms.pyä¸‹è½½ å‘½ä»¤ï¼š\npython sms.py é€€å‡ºè™šæ‹Ÿç¯å¢ƒï¼š\ndeactivate è¿è¡Œè„šæœ¬æœ‰ä¸‰ç§æ–¹æ¡ˆï¼Œä¸€ç§æ˜¯è¿è¡Œåœ¨tmuxè™šæ‹Ÿçª—å£ä¸‹ï¼ŒäºŒç§æ˜¯ç›´æ¥æœ¬åœ°åå°è¿è¡Œï¼Œä¸‰ç§systemdè¿›è¡Œç®¡ç† ï¼ˆå»ºè®®ç¬¬ä¸‰ç§ï¼‰ ä»¥ä¸Šè¦è¿è¡Œåœ¨è™šæ‹Ÿçª—å£ä¸‹ï¼Œå»ºè®®ä½¿ç”¨tmux\n1.ä½¿ç”¨ tmux å®‰è£…ï¼ˆå¦‚æœæœªå®‰è£…ï¼‰ï¼š\napt-get install tmux # Debian/Ubuntu yum install tmux # CentOS/RHEL å¯åŠ¨ Tmux ä¼šè¯ï¼š tmux æŒ‰ Ctrl+Bï¼Œç„¶åæŒ‰ Dï¼Œä¼šè¿”å›ç»ˆç«¯ã€‚\nå…³é—­ SSHï¼Œç¨‹åºç»§ç»­è¿è¡Œã€‚\né‡æ–°è¿æ¥ï¼š\nåˆ—å‡ºä¼šè¯ï¼š\ntmux ls è¾“å‡ºç¤ºä¾‹ï¼š\n0: 1 windows (created ...) æ¢å¤ä¼šè¯ï¼š\ntmux attach -t 0 åœæ­¢ç¨‹åºï¼š\nè¿›å…¥ä¼šè¯åï¼ŒæŒ‰ Ctrl+Cï¼Œç„¶åï¼š\nexit 2.ä½¿ç”¨ nohup nohup python sms.py \u0026gt; sms.log 2\u0026gt;\u0026amp;1 \u0026amp; nohupï¼šè®©è¿›ç¨‹ä¸å—ç»ˆç«¯é€€å‡ºå½±å“\nsms.log 2\u0026gt;\u0026amp;1ï¼šå°†æ—¥å¿—è¾“å‡ºåˆ° sms.log\n\u0026amp;ï¼šè®©è¿›ç¨‹åœ¨åå°è¿è¡Œ\næŸ¥çœ‹æ—¥å¿—ï¼š\ntail -f sms.log å¦‚æœéœ€è¦åœæ­¢è¿›ç¨‹ï¼š\npkill -f \u0026#34;python sms.py\u0026#34; 3.ä½¿ç”¨ systemdï¼ˆæ¨èé•¿æœŸè¿è¡Œï¼‰ åˆ›å»º systemd æœåŠ¡ï¼Œè®© sms.py éšç³»ç»Ÿå¯åŠ¨ï¼š\nnano /etc/systemd/system/sms.service æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n[Unit] Description=SMS Bot Service After=network.target [Service] ExecStart=/usr/bin/python3 /root/sms.py WorkingDirectory=/root Restart=always User=root [Install] WantedBy=multi-user.target ç„¶åæ‰§è¡Œï¼š\nsystemctl daemon-reload systemctl enable sms systemctl start sms systemctl status sms æŸ¥çœ‹æ—¥å¿—ï¼š\njournalctl -u sms -f é‡å¯æœåŠ¡ï¼š\nsystemctl restart sms åœæ­¢æœåŠ¡ï¼š\nsystemctl stop sms ","permalink":"https://hanigege.github.io/posts/other/telegram-sms-bot/","tags":null,"title":"å‡ºå›½è‡ªå»ºvoip(ä¸‰ï¼‰è¿æ¥Telegramæœºå™¨äººæœ¬åœ°å®‰è£…"},{"categories":["routers"],"contents":"ä½ å¯ä»¥ä½¿ç”¨ delete å’Œ set å‘½ä»¤æ¥ä¿®æ”¹ network-group çš„å­ç½‘ã€‚ ä¿®æ”¹ LAN-v4 çš„ç½‘ç»œ\nåˆ é™¤åŸæ¥çš„ 192.168.10.0/24 delete firewall group network-group LAN-v4 network 192.168.10.0/24 æ·»åŠ æ–°çš„ 192.168.100.0/24 set firewall group network-group LAN-v4 network 192.168.100.0/24 æäº¤å¹¶ä¿å­˜ commit save éªŒè¯ä¿®æ”¹æ˜¯å¦ç”Ÿæ•ˆ\næ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\nshow firewall group network-group LAN-v4 å¦‚æœè¾“å‡ºå¦‚ä¸‹ï¼Œå°±è¯´æ˜ä¿®æ”¹æˆåŠŸï¼š\nnetwork-group LAN-v4 { network 192.168.100.0/24 } åœ¨ VyOS ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ æ‰€æœ‰é…ç½®ï¼š æ˜¾ç¤ºå®Œæ•´çš„å±‚çº§é…ç½®ï¼ˆæ¨èï¼‰\nshow configuration è¿™ä¸ªå‘½ä»¤ä¼šä»¥ å±‚çº§ç»“æ„ æ˜¾ç¤ºæ•´ä¸ªé…ç½®ï¼Œç±»ä¼¼äº show running-configã€‚\næ˜¾ç¤ºæ‰€æœ‰é…ç½®å‘½ä»¤ï¼ˆé€‚åˆå¤åˆ¶ï¼‰($ æ¨¡å¼ä¸‹ï¼‰\nshow configuration commands è¿™ä¸ªå‘½ä»¤ä¼šä»¥ show å‘½ä»¤çš„æ ¼å¼ å±•ç¤ºæ‰€æœ‰é…ç½®ï¼Œé€‚ç”¨äºå¤‡ä»½æˆ–å¤åˆ¶é…ç½®ï¼š\næŒ‰å±‚çº§å±•å¼€æŸ¥çœ‹ï¼ˆäº¤äº’å¼ï¼‰\nshow configuration level 2 level 2 ä»£è¡¨å±•å¼€åˆ°ç¬¬ 2 å±‚ï¼Œä½ å¯ä»¥è°ƒæ•´ level æ•°å€¼æ¥æ§åˆ¶æ˜¾ç¤ºçš„è¯¦ç»†ç¨‹åº¦ã€‚\nè¿‡æ»¤ç‰¹å®šé…ç½®ï¼ˆåŒ¹é…å…³é”®å­—ï¼‰ å¦‚æœä½ åªæƒ³æŸ¥çœ‹é˜²ç«å¢™ç›¸å…³çš„é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨ï¼š\nshow configuration | match firewall æˆ–è€…ï¼š\nshow configuration commands | grep firewall è¿™å¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿæ‰¾åˆ°ç‰¹å®šçš„é…ç½®ã€‚\nå¯¼å‡ºé…ç½®åˆ°æ–‡ä»¶ å¦‚æœä½ æƒ³æŠŠé…ç½®ä¿å­˜åˆ°æ–‡ä»¶ï¼š\nshow configuration commands \u0026gt; /config/my-backup.conf ç„¶åå¯ä»¥ç”¨ cat æŸ¥çœ‹ï¼š\ncat /config/my-backup.conf æ€»ç»“\n| å‘½ä»¤ | ä½œç”¨ |\nshow configuration ä»¥å±‚çº§ç»“æ„æ˜¾ç¤ºæ‰€æœ‰é…ç½®\nshow configuration commands ä»¥ set å‘½ä»¤æ ¼å¼æ˜¾ç¤ºæ‰€æœ‰é…ç½®ï¼ˆé€‚åˆå¤åˆ¶ï¼‰\nshow configuration level N å±•å¼€åˆ°æŒ‡å®šå±‚çº§ï¼ˆN æ§åˆ¶è¯¦ç»†ç¨‹åº¦ï¼‰\nshow configuration match å…³é”®å­—`\nshow configuration commands \u0026gt; /config/backup.conf å¤‡ä»½é…ç½®åˆ°æ–‡ä»¶\nä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³• åˆ é™¤ VyOS ä¸­æ‰€æœ‰é˜²ç«å¢™è§„åˆ™ï¼š æ–¹æ³• 1ï¼šé€ä¸ªåˆ é™¤ å¦‚æœä½ çŸ¥é“é˜²ç«å¢™è§„åˆ™çš„åå­—ï¼ˆä¾‹å¦‚ WAN_INã€LAN_OUTï¼‰ï¼Œå¯ä»¥è¿è¡Œï¼š\ndelete firewall name WAN_IN delete firewall name LAN_OUT delete firewall name \u0026lt;å…¶ä»–è§„åˆ™å\u0026gt; commit save ç„¶åè¿è¡Œï¼š show firewall ç¡®è®¤è§„åˆ™å·²åˆ é™¤ã€‚ æ–¹æ³• 2ï¼šåˆ é™¤æ•´ä¸ª firewall é…ç½® å¦‚æœä½ æƒ³ å½»åº•åˆ é™¤é˜²ç«å¢™çš„æ‰€æœ‰è§„åˆ™ï¼Œå¯ä»¥ç›´æ¥åˆ é™¤ firewall {}ï¼š\ndelete firewall commit save ç„¶åè¿è¡Œï¼š show firewall å¦‚æœ firewall {} ä¸å†æ˜¾ç¤ºï¼Œå°±è¯´æ˜æ‰€æœ‰é˜²ç«å¢™è§„åˆ™å·²åˆ é™¤ã€‚ æ–¹æ³• 3ï¼šé‡ç½® VyOS é…ç½®ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ å¦‚æœä½ å¸Œæœ›æ¢å¤åˆ°æœ€åˆçš„é»˜è®¤é…ç½®ï¼ˆä¼šå½±å“æ‰€æœ‰è®¾ç½®ï¼Œä¸ä»…ä»…æ˜¯é˜²ç«å¢™ï¼‰ï¼Œå¯ä»¥è¿è¡Œï¼š\nload factory-default commit save ç„¶åé‡æ–°é…ç½®ä½ çš„ç³»ç»Ÿã€‚\nå¦‚æœåªæ˜¯æƒ³ æ¸…ç†é˜²ç«å¢™è§„åˆ™ï¼Œæ¨è æ–¹æ³• 2ï¼Œä½†å¦‚æœä½ æƒ³é‡ç½®æ•´ä¸ªç³»ç»Ÿé…ç½®ï¼Œå†è€ƒè™‘ æ–¹æ³• 3ã€‚ä½ æƒ³è¦å®Œå…¨é‡ç½®è¿˜æ˜¯åªæ˜¯æ¸…ç©ºé˜²ç«å¢™è§„åˆ™ï¼Ÿ\n","permalink":"https://hanigege.github.io/posts/routers/vyos-jiqiao-3/","tags":null,"title":"Vyosä¸Šç½‘ç³»ç»Ÿä¹‹-vyoså‘½ä»¤æŠ€å·§é›†(3)"},{"categories":["routers"],"contents":"å¯¹äºç»ˆç«¯ç½‘å…³æ˜¯vyosçš„ï¼Œé€šè¿‡mosdnsæ¥åˆ†æµrealipå’Œfakeipçš„æµé‡, å¯è¿™æ ·é…ç½®: (vyosçš„groupåˆ†ä¸ºaddress-group,network-groupç­‰)\nå®šä¹‰ç»„ IPä¾‹: set firewall group address-group Telegram-v4 address \u0026#39;157.148.47.204\u0026#39; set firewall group address-group Telegram-v4 address \u0026#39;182.43.124.6\u0026#39; ... å®šä¹‰ç»„ç½‘æ®µV4ä¾‹ï¼š set firewall group network-group Telegram-v4 network \u0026#39;91.108.56.0/22\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;91.108.4.0/22\u0026#39; ... å®šä¹‰ç»„telegram V4:\nset firewall group network-group Telegram-v4 network \u0026#39;91.108.56.0/22\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;91.108.4.0/22\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;91.108.8.0/22\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;91.108.16.0/22\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;91.108.12.0/22\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;149.154.160.0/20\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;91.105.192.0/23\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;91.108.20.0/22\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;185.76.151.0/24\u0026#39; å®šä¹‰ç»„ip-V6ä¾‹ï¼š set firewall group ipv6-address-group Telegram-v6 address \u0026#39;2a00:1098:80:2::1004\u0026#39; set firewall group ipv6-address-group Telegram-v6 address \u0026#39;2a00:1098:80:2::1001\u0026#39; ... å®šä¹‰ç»„ç½‘æ®µV6ä¾‹ï¼š\nset firewall group ipv6-network-group Telegram-v6 network \u0026#39;2001:b28:f23d::/48\u0026#39; set firewall group ipv6-network-group Telegram-v6 network \u0026#39;2001:b28:f23f::/48\u0026#39; ... å®šä¹‰ç»„V6 Telegram-V6\nset firewall group ipv6-network-group Telegram-v6 network \u0026#39;2001:b28:f23d::/48\u0026#39; set firewall group ipv6-network-group Telegram-v6 network \u0026#39;2001:b28:f23f::/48\u0026#39; set firewall group ipv6-network-group Telegram-v6 network \u0026#39;2001:67c:4e8::/48\u0026#39; set firewall group ipv6-network-group Telegram-v6 network \u0026#39;2001:b28:f23c::/48\u0026#39; set firewall group ipv6-network-group Telegram-v6 network \u0026#39;2a0a:f280::/32\u0026#39; å®šä¹‰ç»„fakeip:\nset firewall group network-group FAKEIP-v4 network \u0026#39;198.18.0.0/15\u0026#39; # fakeip set firewall group ipv6-network-group FAKEIP-v6 network \u0026#39;f2b0::/18\u0026#39; # fakeip6 é…ç½®ç­–ç•¥è·¯ç”±:(ç±»ä¼¼rosä¸­mangleéƒ¨åˆ†) IPV4\nset policy route Route-to-SB interface \u0026#39;eth0\u0026#39; # eth0æ˜¯lanå£ set policy route Route-to-SB rule 10 set table \u0026#39;100\u0026#39; # table 100æ˜¯to-sbçš„è¡¨ set policy route Route-to-SB rule 10 destination group network-group \u0026#39;Telegram-v4\u0026#39; set policy route Route-to-SB rule 20 set table \u0026#39;100\u0026#39; # table 100æ˜¯to-sbçš„è¡¨ set policy route Route-to-SB rule 20 destination group network-group \u0026#39;FAKEIP-v4\u0026#39; IPV6\nset policy route6 FAKE6-to-SB interface \u0026#39;eth0\u0026#39; set policy route6 FAKE6-to-SB rule 10 set table \u0026#39;106\u0026#39; # table 106æ˜¯to-sbçš„è¡¨ (v6) set policy route6 FAKE6-to-SB rule 10 destination group network-group \u0026#39;FAKEIP-v6\u0026#39; set policy route6 FAKE6-to-SB rule 20 set table \u0026#39;106\u0026#39; # table 106æ˜¯to-sbçš„è¡¨ (v6) set policy route6 FAKE6-to-SB rule 20 destination group network-group \u0026#39;Telegram-v6\u0026#39; é…ç½®è·¯ç”±è¡¨\nset protocols static table 100 route 0.0.0.0/0 next-hop 192.168.100.9 # sbçš„å†…ç½‘ip set protocols static table 106 route6 ::/0 next-hop fd88::9999 # sbçš„ula voysè‡ªå·±å¦‚è¦ç§‘å­¦ä¸Šç½‘, ä¸€èˆ¬æ˜¯åœ¨pullå®¹å™¨é•œåƒ, ä¸‹è½½æ›´æ–°çš„iosç­‰æƒ…å½¢ä¸‹, å¯ä»¥è¿™æ ·é…ç½®,\nset system name-server \u0026#39;192.168.10.90\u0026#39; # 192.168.10.90æ˜¯sbçš„ip, æˆ–mosdnsçš„ip, based on your topology. æ³¨æ„è¿™é‡Œçš„name-server, åªéœ€è¦ä¸€ä¸ª, å°±æ˜¯èƒ½åŒºåˆ†fakeipçš„.\nset policy local-route rule 10 destination address \u0026#39;198.18.0.0/15\u0026#39; set policy local-route rule 10 set table \u0026#39;100\u0026#39; å¯ä»¥äº†ç§‘å­¦äº†ï¼Œä¸‹é¢æµ‹è¯•\ncurl www.google.com ä¹±ç ï¼Œæå®š pingæ˜¯pingä¸é€šå¤–ç½‘çš„ã€‚ç”¨ä¸Šé¢çš„curlçœ‹\né…ä¸é…ipv6çš„local-route, å–å†³äºä½ çš„éœ€è¦, ä¸é…ç½®ä¹Ÿè¡Œ, å› ä¸ºvyosè‡ªå·±çš„éœ€è¦, è¾ƒä¸ºç®€å•\ndone!\ntips:\nåœ¨\u0026rsquo;#\u0026lsquo;çŠ¶æ€ä¸‹ å¯ç”¨run show config, æ¥è¿è¡Œ\u0026rsquo;$\u0026lsquo;çŠ¶æ€ä¸‹çš„å‘½ä»¤ æˆ‘å¸¸ç”¨çš„å‘½ä»¤ è¿˜æœ‰ \u0026lsquo;monitor\u0026rsquo; (\u0026rsquo;$\u0026lsquo;ä¸‹), ç›‘è§†åŠ¨æ€å˜åŒ– \u0026lsquo;compare\u0026rsquo; (\u0026rsquo;#\u0026lsquo;ä¸‹), æœªcommitå‰æ¯”è¾ƒeditçš„å˜åŒ– ","permalink":"https://hanigege.github.io/posts/routers/vyos-fakeip-2/","tags":null,"title":"Vyosä¸Šç½‘ç³»åˆ—ä¹‹-Fakeipé…ç½®(2)"},{"categories":["routers"],"contents":"vyosçš„å‘½ä»¤è¡Œç•Œé¢æ˜¯åŸºäºshellçš„ï¼Œæ²¡æœ‰å›¾å½¢ç•Œé¢, ä½†æ˜¯å¯ä»¥ç”¨tabè‡ªåŠ¨è¡¥å…¨. æœ¬æ–‡çš„vyoså‘½ä»¤æ˜¯åŸºäºvyosçš„vyos-rolling-nightly-buildsçš„1.5.xç‰ˆæœ¬.\n**ç‰¹åˆ«æ„Ÿè°¢å¤§å«ä½¬ç»™äºˆçš„æŒ‡å¯¼ä¸å¸®åŠ©**\npveå®‰è£…vyos: ä¸‹è½½nightly-build: https://github.com/vyos/vyos-nightly-build/releases pveçš„è™šæ‹Ÿæœºè®¾ç½®å’Œå®‰è£…(ç•¥), å»ºè®®å†…å­˜2G, ç£ç›˜10Gæˆ–æ›´å¤§, å› ä¸ºvyoså¯ä»¥è¿è¡Œå®¹å™¨, vyosç”¨podmanç®¡ç†å®¹å™¨.\nvmè¿è¡Œå, ç”¨vyos:vyosç™»å½•. ç”¨å‘½ä»¤\ninstall image å®‰è£…vyos.\nè¿›å…¥é…ç½®æ¨¡å¼ï¼š\nconfigure ç”Ÿæ•ˆï¼š\ncommit ä¿å­˜é…ç½®ï¼š\nsave å–æ¶ˆç”Ÿæ•ˆçš„,æœªä¿å­˜çš„é…ç½®ï¼š\ndiscard ä¸‹é¢å¼€å§‹é…ç½®ï¼Œéšæ—¶éƒ½å¯ä»¥è¾“å…¥ç”Ÿæ•ˆå‘½ä»¤ï¼Œå¦‚æœä¸ä¿å­˜ï¼Œé‡å¯åé…ç½®ä¼šå¤±æ•ˆ è®¾ç½®sshç™»å½•:\nset service ssh port \u0026#39;22\u0026#39; åˆ›å»ºç”¨æˆ·gary:\nset system login user gary full-name gary set system login user gary authentication plaintext-password \u0026#39;å¯†ç \u0026#39; å»ºè®®sshå¯†é’¥ç™»å½•:\nset system login user gary authentication public-keys gary@laptop key \u0026#39;your-public-key\u0026#39; set system login user gary authentication public-keys gary@laptop type \u0026#39;ssh-rsa\u0026#39; ç¦ç”¨é»˜è®¤çš„vyosç”¨æˆ·:\nset system login user vyos disable è®¾ç½®ç³»ç»Ÿçš„hostname:\nset system host-name \u0026#39;vyos\u0026#39; æŸ¥çœ‹ç³»ç»Ÿçš„hostname\nshow system host-name è®¾ç½®æ—¶åŒº:\nset system time-zone \u0026#39;Asia/Shanghai\u0026#39; è®¾ç½®ntp:\nset service ntp server 129.250.35.251 set service ntp server 203.107.6.88 (æ³¨: å¯ä»¥è®¾ç½®å¤šä¸ªntpæœåŠ¡å™¨, å»ºè®®ç”¨è¿è¥å•†çš„ntpæœåŠ¡å™¨, æœ€å¥½æ˜¯çº¯ip, å¯åˆ é™¤é»˜è®¤çš„ntpæœåŠ¡å™¨)\nè®¾ç½®æ¥å£ç»„(å¯é€‰ä½†å»ºè®®):\nset firewall group interface-group LAN interface \u0026#39;eth0\u0026#39; set firewall group interface-group WAN interface \u0026#39;eth1\u0026#39; è®¾ç½®ç½‘ç»œç»„(å¯é€‰):\nset firewall group network-group LAN-v4 network \u0026#39;192.168.100.0/24\u0026#39; è®¾ç½®ip:\nset interfaces ethernet eth0 address 192.168.100.1/24 é…ç½®dhcp server:\nset service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 subnet-id 1 set service dhcp-server hostfile-update set service dhcp-server shared-network-name VYOS authoritative #å¼€å¯ç‰¹å®šå…±äº«ç½‘ç»œçš„æˆæƒï¼Œé˜²æ­¢å‡ºç°å†²çªå’Œæ··ä¹±(ç¬¬ä¸‰æ–¹åŠ çš„ï¼‰ set service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 lease \u0026#39;86400\u0026#39; set service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 option default-router \u0026#39;192.168.100.1\u0026#39; #dhcp option é»˜è®¤ç½‘å…³ set service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 option name-server \u0026#39;192.168.100.1\u0026#39; #dhcp option dns set service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 option ntp-server \u0026#39;192.168.100.1\u0026#39; #dhcp option ntp set service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 range 0 start \u0026#39;192.168.100.101\u0026#39; set service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 range 0 stop \u0026#39;192.168.100.200\u0026#39; è¡¥å……ï¼ˆå¯é€‰ï¼‰ï¼š æ·»åŠ ä¸€ä¸ªdhcpä¸‹çš„dns\nset service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 option name-server \u0026#39;192.168.100.2\u0026#39; åˆ é™¤ä¸€ä¸ªdpcpä¸‹çš„dns delete service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 option name-server \u0026#39;192.168.100.1\u0026#39; æ›´æ”¹dhcpä¸‹çš„ç½‘å…³åœ°å€ set service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 option default-router \u0026#39;192.168.100.2\u0026#39; è®¾ç½®å¤–ç½‘ç½‘å£ä¸ºdhcpå®¢æˆ·ç«¯ï¼Œä»ä¸Šçº§è·¯ç”±è·å– ï¼ˆå¯é€‰ï¼‰ï¼š\nset interfaces ethernet eth1 address dhcp è®¾ç½®pppoe1å‚è€ƒé…ç½®ï¼ˆä¸€ï¼‰ å½“eth1æ˜¯pppoeæ—¶ï¼Œé…ç½® PPPoE æ‹¨å·:\nset interfaces pppoe pppoe0 source-interface \u0026#39;eth1\u0026#39; set interfaces pppoe pppoe0 authentication username \u0026#39;054546å¸å·6266\u0026#39; set interfaces pppoe pppoe0 authentication password \u0026#39;24å¯†ç 502\u0026#39; set interfaces pppoe pppoe0 mtu \u0026#39;1492\u0026#39; set interfaces pppoe pppoe0 ip adjust-mss \u0026#39;clamp-mss-to-pmtu\u0026#39; set interfaces pppoe pppoe1 no-default-route (æ³¨: å½“è®¾ç½®no-default-routeæ—¶, éœ€è¦åœ¨åé¢æŒ‡å®šé™æ€è·¯ç”±, æˆ–è€…ä¹Ÿå¯ä¸è®¾ç½®no-default-routeè¿™æ¡, vyosä¼šè‡ªåŠ¨æ·»åŠ é»˜è®¤è·¯ç”±) å°æŠ€å·§ï¼šåœ¨ VyOS ä¸­ï¼Œè¦åˆ é™¤ä¸€æ¡å·²æœ‰çš„é…ç½®ï¼Œéœ€è¦ä½¿ç”¨ delete å‘½ä»¤ã€‚ å¯¹äº set interfaces pppoe pppoe0 source-interface 'eth1'ï¼Œå¯ä»¥è¿™æ ·åˆ é™¤ï¼š\nconfigure delete interfaces pppoe pppoe1 source-interface commit save exit è®¾ç½®å‡ºWanå£çš„é»˜è®¤é™æ€è·¯ç”±:\nset protocols static route 0.0.0.0/0 interface pppoe0 set protocols static route6 ::/0 interface pppoe0 (æ³¨: å‰é¢è®¾ç½®äº†no-default-route, æ‰€ä»¥è¿™é‡Œéœ€è¦è®¾ç½®é»˜è®¤è·¯ç”±) è®¾ç½®dns: set system name-server \u0026#39;223.5.5.5\u0026#39; set service dns forwarding cache-size \u0026#39;0\u0026#39; ## å…³é—­äº†ç¼“å­˜ï¼Œé»˜è®¤æ˜¯150 set service dns forwarding listen-address \u0026#39;192.168.100.1\u0026#39; ## ç›‘å¬ LAN å£ # 3. é™åˆ¶ DNS è§£æèŒƒå›´ï¼Œä»…å…è®¸å†…ç½‘ä½¿ç”¨ set service dns forwarding allow-from \u0026#39;192.168.100.0/24\u0026#39; è®¾ç½®ç«¯å£è½¬å‘(DNAT):\nset nat destination rule 10 description \u0026#39;DSTNAT-wg\u0026#39; set nat destination rule 10 destination port \u0026#39;53822\u0026#39; set nat destination rule 10 inbound-interface group \u0026#39;WAN\u0026#39; #å¯ç”¨interface eth1ä»£æ›¿ set nat destination rule 10 protocol \u0026#39;udp\u0026#39; set nat destination rule 10 translation address \u0026#39;192.168.10.145\u0026#39; set nat destination rule 10 translation port \u0026#39;53822\u0026#39; #å¯çœç•¥, å¦‚æœç«¯å£ç›¸åŒ è®¾ç½®é˜²ç«å¢™: è®¾ç½®masquerade(SNAT):\nset nat source rule 100 translation address \u0026#39;masquerade\u0026#39; æŒ‡å®šç½‘æ®µï¼š\nset nat source rule 100 source address \u0026#39;192.168.100.0/24\u0026#39; è®¾ç½®å›æµ: ç”±äºä¸Šé¢masquerade(SNAT)çš„è§„åˆ™, è¿™é‡Œä¸éœ€è¦è®¾ç½®å›æµ. --------------------------------------------- è¿™é‡Œé˜²ç«å¢™rule æ•°å­—å¯è‡ªå®š, åŒä¸€æ•°å­—ä¸ºä¸€ç»„, å»ºè®®è®¾ç½®æ•°å­—æ—¶, ç•™å‡ºç©ºéš™, ä»¥ä¾¿ä»¥åæ·»åŠ æ–°çš„è§„åˆ™. é’ˆå¯¹ä¸Šé¢è¿™æ¡nat source rule 100 è§„åˆ™, å»ºè®®ä¸è¦é™åˆ¶æ¥å£, å°±åªç”¨ä¸Šé¢ä¸€æ¡, è¿™å¯¹ä»¥åçš„ç«¯å£è½¬å‘å’Œå›æµè®¾ç½®, éƒ½å¾ˆæ–¹ä¾¿.\nè®¾ç½®é˜²ç«å¢™è§„åˆ™: å…¨å±€ï¼š\nset firewall global-options state-policy established action \u0026#39;accept\u0026#39; set firewall global-options state-policy invalid action \u0026#39;drop\u0026#39; set firewall global-options state-policy related action \u0026#39;accept\u0026#39; #ä¸‹é¢ä¸€æ¡æ˜¯å®¹å™¨ä¸å†…ç½‘äº’é€š set firewall global-options apply-to-bridged-traffic invalid-connections è®¾ç½®ipv4å…¥ç«™(inputé“¾)è§„åˆ™:\nset firewall ipv4 name WAN_LOCAL default-action \u0026#39;drop\u0026#39; #é»˜è®¤æ‹’ç» set firewall ipv4 name WAN_LOCAL rule 10 action \u0026#39;accept\u0026#39; #å…è®¸å·²å»ºç«‹å’Œç›¸å…³è¿æ¥ set firewall ipv4 name WAN_LOCAL rule 10 state \u0026#39;established\u0026#39; set firewall ipv4 name WAN_LOCAL rule 10 state \u0026#39;related\u0026#39; set firewall ipv4 name WAN_LOCAL rule 30 action \u0026#39;accept\u0026#39; #å…è®¸icmp set firewall ipv4 name WAN_LOCAL rule 30 protocol \u0026#39;icmp\u0026#39; ä¸‹é¢æ˜¯wireguardæ”¾è¡Œç«¯å£ï¼ˆå¯é€‰ï¼‰\nset firewall ipv4 name WAN_LOCAL rule 20 action \u0026#39;accept\u0026#39; #å…è®¸è¿æ¥wg0 set firewall ipv4 name WAN_LOCAL rule 20 destination port \u0026#39;11133\u0026#39; set firewall ipv4 name WAN_LOCAL rule 20 protocol \u0026#39;udp\u0026#39; set firewall ipv4 name WAN_LOCAL rule 40 action \u0026#39;accept\u0026#39; #è¿ç»­ç«¯å£æ ·ä¾‹ set firewall ipv4 name WAN_LOCAL rule 40 destination port \u0026#39;10000-10100\u0026#39; set firewall ipv4 name WAN_LOCAL rule 40 protocol \u0026#39;udp\u0026#39; è®¾ç½®ipv6å…¥ç«™(inputé“¾)è§„åˆ™:\nset firewall ipv6 name WAN_LOCAL default-action \u0026#39;drop\u0026#39; #é»˜è®¤æ‹’ç» set firewall ipv6 name WAN_LOCAL rule 10 action \u0026#39;accept\u0026#39; #å…è®¸å·²å»ºç«‹å’Œç›¸å…³è¿æ¥ set firewall ipv6 name WAN_LOCAL rule 10 state \u0026#39;established\u0026#39; set firewall ipv6 name WAN_LOCAL rule 10 state \u0026#39;related\u0026#39; set firewall ipv6 name WAN_LOCAL rule 20 action \u0026#39;accept\u0026#39; #å…è®¸icmpv6 set firewall ipv6 name WAN_LOCAL rule 20 protocol \u0026#39;icmpv6\u0026#39; set firewall ipv6 name WAN_LOCAL rule 30 action \u0026#39;accept\u0026#39; #å…è®¸ä»ISPå¤„è·å–çš„dhcp6çš„ä¿¡æ¯ set firewall ipv6 name WAN_LOCAL rule 30 destination port \u0026#39;546\u0026#39; set firewall ipv6 name WAN_LOCAL rule 30 protocol \u0026#39;udp\u0026#39; set firewall ipv6 name WAN_LOCAL rule 30 source port \u0026#39;547\u0026#39; ä¸‹é¢æ˜¯wireguardæ”¾è¡Œç«¯å£ï¼ˆå¯é€‰ï¼‰\nset firewall ipv6 name WAN_LOCAL rule 40 action \u0026#39;accept\u0026#39; #å…è®¸è¿æ¥wg0 set firewall ipv6 name WAN_LOCAL rule 40 destination port \u0026#39;11133\u0026#39; set firewall ipv6 name WAN_LOCAL rule 40 protocol \u0026#39;udp\u0026#39; è®¾ç½®ipv4è½¬å‘(forwardé“¾)è§„åˆ™:\nset firewall ipv4 name WAN_IN default-action \u0026#39;drop\u0026#39; #é»˜è®¤æ‹’ç» set firewall ipv4 name WAN_IN rule 10 action \u0026#39;accept\u0026#39; #å…è®¸å·²å»ºç«‹å’Œç›¸å…³è¿æ¥ set firewall ipv4 name WAN_IN rule 10 state \u0026#39;established\u0026#39; set firewall ipv4 name WAN_IN rule 10 state \u0026#39;related\u0026#39; å¦‚æœ‰ipv4è¿›æ¥åçš„ç«¯å£è½¬å‘åŠ ä¸‹é¢ä¸‰æ¡\nset firewall ipv4 name WAN_IN rule 20 action \u0026#39;accept\u0026#39; #å…è®¸å·²DNATçš„è¿æ¥ set firewall ipv4 name WAN_IN rule 20 connection-status nat \u0026#39;destination\u0026#39; set firewall ipv4 name WAN_IN rule 20 state \u0026#39;new\u0026#39; å¦‚æœ‰ipv6è¿›æ¥åçš„ç«¯å£è½¬å‘ ä¹Ÿéœ€è¦å’Œv4ä¸€æ · åŠ è¿™æ¡\nset firewall ipv6 name WAN_IN rule 40 action \u0026#39;accept\u0026#39; set firewall ipv6 name WAN_IN rule 40 connection-status nat \u0026#39;destination\u0026#39; set firewall ipv6 name WAN_IN rule 40 state \u0026#39;new\u0026#39; è®¾ç½®ipv6è½¬å‘(forwardé“¾)è§„åˆ™:\nset firewall ipv6 name WAN_IN default-action \u0026#39;drop\u0026#39; #é»˜è®¤æ‹’ç» set firewall ipv6 name WAN_IN rule 10 action \u0026#39;accept\u0026#39; #å…è®¸å·²å»ºç«‹å’Œç›¸å…³è¿æ¥ set firewall ipv6 name WAN_IN rule 10 state \u0026#39;established\u0026#39; set firewall ipv6 name WAN_IN rule 10 state \u0026#39;related\u0026#39; set firewall ipv6 name WAN_IN rule 20 action \u0026#39;accept\u0026#39; #å…è®¸icmpv6 set firewall ipv6 name WAN_IN rule 20 protocol \u0026#39;icmpv6\u0026#39; set firewall ipv6 name WAN_IN rule 30 action \u0026#39;accept\u0026#39; #å…è®¸ipsec set firewall ipv6 name WAN_IN rule 30 destination port \u0026#39;500,4500\u0026#39; set firewall ipv6 name WAN_IN rule 30 protocol \u0026#39;udp\u0026#39; ç„¶ååˆ†åˆ«ä»inputå’Œforwardé“¾, è°ƒç”¨WAN_LOCALå’ŒWAN_IN:\nset firewall ipv4 input filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv4 input filter rule 10 inbound-interface group \u0026#39;WAN\u0026#39; set firewall ipv4 input filter rule 10 jump-target \u0026#39;WAN_LOCAL\u0026#39; set firewall ipv4 forward filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv4 forward filter rule 10 inbound-interface group \u0026#39;WAN\u0026#39; set firewall ipv4 forward filter rule 10 jump-target \u0026#39;WAN_IN\u0026#39; set firewall ipv6 input filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv6 input filter rule 10 inbound-interface group \u0026#39;WAN\u0026#39; set firewall ipv6 input filter rule 10 jump-target \u0026#39;WAN_LOCAL\u0026#39; set firewall ipv6 forward filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv6 forward filter rule 10 inbound-interface group \u0026#39;WAN\u0026#39; set firewall ipv6 forward filter rule 10 jump-target \u0026#39;WAN_IN\u0026#39; æ³¨: DNATæ˜¯æµé‡è¿›å…¥å, æœ€å…ˆå¤„ç†çš„, ç„¶åè¿›å…¥forwardé“¾, è€ŒSNATæ˜¯æµé‡å‡ºç«™å‰, æœ€åå¤„ç†çš„.\né…ç½®wireguard: set interfaces wireguard wg0 address \u0026#39;10.20.20.1/24\u0026#39; set interfaces wireguard wg0 peer iphone allowed-ips \u0026#39;10.20.20.2/32\u0026#39; set interfaces wireguard wg0 peer iphone preshared-key \u0026#39;preshared-key\u0026#39; set interfaces wireguard wg0 peer iphone public-key \u0026#39;public-key\u0026#39; set interfaces wireguard wg0 port \u0026#39;11133\u0026#39; set interfaces wireguard wg0 private-key \u0026#39;private-key\u0026#39; é…ç½®ddns: cloudflare ddns: set service dns dynamic name DDNS-CF-v4 address interface \u0026#39;pppoe1\u0026#39; set service dns dynamic name DDNS-CF-v4 host-name \u0026#39;ddns.example.com\u0026#39; set service dns dynamic name DDNS-CF-v4 ip-version \u0026#39;ipv4\u0026#39; set service dns dynamic name DDNS-CF-v4 password \u0026#39;token\u0026#39; set service dns dynamic name DDNS-CF-v4 protocol \u0026#39;cloudflare\u0026#39; set service dns dynamic name DDNS-CF-v4 zone \u0026#39;example.com\u0026#39; set service dns dynamic name DDNS-CF-v6 address interface \u0026#39;eth0\u0026#39; set service dns dynamic name DDNS-CF-v6 host-name \u0026#39;ddns6.example.com\u0026#39; set service dns dynamic name DDNS-CF-v6 ip-version \u0026#39;ipv6\u0026#39; set service dns dynamic name DDNS-CF-v6 password \u0026#39;token\u0026#39; set service dns dynamic name DDNS-CF-v6 protocol \u0026#39;cloudflare\u0026#39; set service dns dynamic name DDNS-CF-v6 zone \u0026#39;example.com\u0026#39; dnspod ddns:\nset service dns dynamic name DNSPOD-v4 address interface \u0026#39;pppoe1\u0026#39; set service dns dynamic name DNSPOD-v4 host-name \u0026#39;ddns.example.com\u0026#39; set service dns dynamic name DNSPOD-v4 password \u0026#39;token\u0026#39; set service dns dynamic name DNSPOD-v4 protocol \u0026#39;dyndns2\u0026#39; set service dns dynamic name DNSPOD-v4 server \u0026#39;dnsapi.cn\u0026#39; set service dns dynamic name DNSPOD-v4 username \u0026#39;id\u0026#39; ä¸ªäººä½¿ç”¨ä¸‹æ¥, ä¸Šè¿°é…ç½®å¹¶ä¸éœ€è¦è®¾ç½®interval, ipå˜åŒ–ä¹Ÿä¼šè‡ªåŠ¨æ›´æ–°. è®¾ç½®ç­–ç•¥è·¯ç”±: ä¸¾ä¾‹: è®©wg0çš„æµé‡èµ°100å·è·¯ç”±è¡¨, 100å·è·¯ç”±è¡¨æ˜¯sbçš„è·¯ç”±è¡¨\nset policy route WG0-to-SB interface \u0026#39;wg0\u0026#39; set policy route WG0-to-SB rule 10 destination group network-group \u0026#39;!LAN-v4\u0026#39; set policy route WG0-to-SB rule 10 set table \u0026#39;100\u0026#39; è·¯ç”±è¡¨\nset protocols static table 100 route 0.0.0.0/0 next-hop 192.168.10.90 Happy Routing!\n","permalink":"https://hanigege.github.io/posts/routers/vyos-jibenshangwang-1/","tags":null,"title":"Vyosä¸Šç½‘ç³»åˆ—ä¹‹-ä¸Šç½‘é…ç½®ï¼ˆ1ï¼‰"},{"categories":null,"contents":" ","permalink":"https://hanigege.github.io/about/","tags":null,"title":"About"},{"categories":["routers"],"contents":"ä¸€.åŸºæœ¬ä¸Šç½‘é…ç½® vyosçš„å‘½ä»¤è¡Œç•Œé¢æ˜¯åŸºäºshellçš„ï¼Œæ²¡æœ‰å›¾å½¢ç•Œé¢, ä½†æ˜¯å¯ä»¥ç”¨tabè‡ªåŠ¨è¡¥å…¨ æœ¬æ–‡çš„vyoså‘½ä»¤æ˜¯åŸºäºvyosçš„vyos-rolling-nightly-buildsçš„1.5.xç‰ˆæœ¬.\npveå®‰è£…vyos: ä¸‹è½½å®‰è£…åŒ… pveçš„è™šæ‹Ÿæœºè®¾ç½®å’Œå®‰è£…(ç•¥), å»ºè®®å†…å­˜2G, ç£ç›˜10Gæˆ–æ›´å¤§, å› ä¸ºvyoså¯ä»¥è¿è¡Œå®¹å™¨, vyosé™¤è‡ªå·±çš„å®¹å™¨ç®¡ç†å·¥å…·ä»¥å¤–ï¼Œä¹Ÿå¯ä»¥ç”¨podmanç®¡ç†å®¹å™¨. vmè¿è¡Œå, ç”¨vyos:vyosç™»å½•. ç”¨ä¸‹é¢å‘½ä»¤å®‰è£…:\ninstall image 2.å®‰è£…vyos. è¿›å…¥é…ç½®æ¨¡å¼ï¼š\nconfigure ç”Ÿæ•ˆï¼š\ncommit ä¿å­˜é…ç½®ï¼š\nsave å–æ¶ˆæœªcommitç”Ÿæ•ˆçš„,æœªä¿å­˜çš„é…ç½®ï¼š\ndiscard å»¶æ—¶ç¡®è®¤ï¼šå¦‚2åˆ†é’Ÿåä¸ç¡®è®¤ï¼Œé…ç½®å›æ»šåˆ°ä¸Šä¸€é…ç½®\ncommit-confirm 2 å›æ»šå dircard æ¸…é™¤ä¸Šæ¬¡æ²¡æœ‰commité…ç½®ã€‚(å› ä¸ºcommit-confirm 2åå·²ç»è¾“å…¥è¿‡äº†ï¼Œåªæ˜¯æ²¡æœ‰commitæäº¤) å¦‚æœæå‰ææ•ˆç¡®è®¤ï¼Œç›´æ¥è¾“å…¥ï¼š\nconfirm è®¾ç½®sshç™»å½•:\nset service ssh port \u0026#39;22\u0026#39; åˆ›å»ºç”¨æˆ·gary:\nset system login user gary full-name gary set system login user gary authentication plaintext-password \u0026#39;å¯†ç \u0026#39; å»ºè®®sshå¯†é’¥ç™»å½•:(å¯é€‰ï¼Œéå¿…é¡»ï¼Œç†Ÿç»ƒåå†ä½¿ç”¨ï¼‰\nset system login user gary authentication public-keys gary@laptop key \u0026#39;your-public-key\u0026#39; set system login user gary authentication public-keys gary@laptop type \u0026#39;ssh-rsa\u0026#39; ç¦ç”¨é»˜è®¤çš„vyosç”¨æˆ·:\nset system login user vyos disable è®¾ç½®ç³»ç»Ÿçš„hostname:\nset system host-name \u0026#39;vyos\u0026#39; æŸ¥çœ‹ç³»ç»Ÿçš„hostname\nshow system host-name è®¾ç½®æ—¶åŒº:\nset system time-zone \u0026#39;Asia/Shanghai\u0026#39; è®¾ç½®ntp:\nset service ntp server 129.250.35.251 set service ntp server 203.107.6.88 (æ³¨: å¯ä»¥è®¾ç½®å¤šä¸ªntpæœåŠ¡å™¨, å»ºè®®ç”¨è¿è¥å•†çš„ntpæœåŠ¡å™¨, æœ€å¥½æ˜¯çº¯ip, å¯åˆ é™¤é»˜è®¤çš„ntpæœåŠ¡å™¨)\nå…ˆçœ‹ä¸‹è‡ªå·±çš„æ¥å£æƒ…å†µï¼Œæœ‰çš„ä¸æ˜¯eht0å’Œeth1ã€‚ã€‚ã€‚æœ‰çš„ç›´æ¥å°±æ˜¯eth0å’Œeht2,æ‰€ä»¥è¯·æ ¹æ®è‡ªå·±å°ä¸»æœºçš„æƒ…å†µè°ƒæ•´åé¢çš„å‘½ä»¤æ¥å£ã€‚\nshow interface ä¸‹é¢çš„æ•™ç¨‹æŒ‰æ ‡å‡†çš„eht0,eth1,eth2,eth3å››ç½‘å£æ¥è¯´æ˜ï¼š WAN/LAN æ¥å£é…ç½® è¿›å…¥é…ç½®æ¨¡å¼ é¦–å…ˆï¼Œè¿›å…¥ VyOS é…ç½®æ¨¡å¼ï¼š\nconfigure åˆ›å»ºæ¡¥æ¥æ¥å£ï¼ˆbr0ï¼‰ æ¥ç€ï¼Œåˆ›å»ºä¸€ä¸ªæ¡¥æ¥æ¥å£ br0ï¼Œå¹¶å°† eth0ã€eth1 å’Œ eth2 åŠ å…¥è¯¥æ¡¥æ¥ç»„ï¼š\nset interfaces bridge br0 address \u0026#39;10.20.20.1/24\u0026#39; set interfaces bridge br0 address \u0026#39;fd88::1111/64\u0026#39; set interfaces bridge br0 member interface \u0026#39;eth0\u0026#39; set interfaces bridge br0 member interface \u0026#39;eth1\u0026#39; set interfaces bridge br0 member interface \u0026#39;eth2\u0026#39; 3. ã€ LAN é…ç½® DHCP 3.1 å¯ç”¨ LAN å£çš„ DHCP server LAN çš„ç½‘æ®µæ˜¯ 10.20.20.0/24ï¼ŒDHCP çš„åˆ†é… IP èŒƒå›´æ˜¯ 10.20.20.100-200ï¼ŒåŒæ—¶ä¸‹å‘äº† dns server å’Œ ntp serverã€‚\nset service dhcp-server hostfile-update set service dhcp-server shared-network-name LAN_br0 authoritative set service dhcp-server shared-network-name LAN_br0 option ntp-server \u0026#39;10.20.20.1\u0026#39; set service dhcp-server shared-network-name LAN_br0 option time-zone \u0026#39;Asia/Shanghai\u0026#39; set service dhcp-server shared-network-name LAN_br0 subnet 10.20.20.0/24 lease \u0026#39;86400\u0026#39; set service dhcp-server shared-network-name LAN_br0 subnet 10.20.20.0/24 option default-router \u0026#39;10.20.20.1\u0026#39; set service dhcp-server shared-network-name LAN_br0 subnet 10.20.20.0/24 option name-server \u0026#39;10.20.20.6\u0026#39; set service dhcp-server shared-network-name LAN_br0 subnet 10.20.20.0/24 range 100 start \u0026#39;10.20.20.100\u0026#39; set service dhcp-server shared-network-name LAN_br0 subnet 10.20.20.0/24 range 100 stop \u0026#39;10.20.20.200\u0026#39; set service dhcp-server shared-network-name LAN_br0 subnet 10.20.20.0/24 subnet-id \u0026#39;1\u0026#39; è®¾ç½®å›ºå®šIP set service dhcp-server shared-network-name LAN_br0 subnet 10.20.20.0/24 static-mapping freepbx16 ip-address \u0026#39;10.20.20.103\u0026#39; set service dhcp-server shared-network-name LAN_br0 subnet 10.20.20.0/24 static-mapping freepbx16 mac \u0026#39;bc:24:11:c4:6f:eb\u0026#39; è¡¥å……ï¼š(è¿™ä¸‹é¢çš„å‘½ä»¤åªæ˜¯æ–¹ä¾¿æ›´æ”¹å¤åˆ¶ä½¿ç”¨ï¼‰\n# æ·»åŠ ä¸€ä¸ªdns (è¿™ä¸ªdnsæ˜¯æˆ‘åç»­ä¸æŠ˜è…¾ä½¬çš„smboxçš„IPï¼‰ set service dhcp-server shared-network-name LAN_br0 subnet 10.20.20.0/24 option name-server \u0026#39;172.23.0.99\u0026#39; # æ·»åŠ ä¸€ä¸ªdns (è¿™ä¸ªdnsæ˜¯æˆ‘åç»­è‡ªå·±è™šæ‹Ÿæœºmosdnsçš„ip) set service dhcp-server shared-network-name LAN_br0 subnet 10.20.20.0/24 option name-server \u0026#39;10.20.20.6\u0026#39; # åˆ é™¤ä¸€ä¸ªdns delete service dhcp-server shared-network-name LAN_br0 subnet 10.20.20.0/24 option name-server \u0026#39;10.20.20.1\u0026#39; # æ›´æ”¹ç½‘å…³ ï¼ˆè¿™ä¸ªç½‘å…³æ˜¯æˆ‘åç»­sing-boxçš„IPï¼‰ set service dhcp-server shared-network-name LAN_br0 subnet 10.20.20.0/24 option default-router \u0026#39;10.20.20.9\u0026#39; 3.2 å±€åŸŸç½‘ DNS é…ç½® set system name-server \u0026#39;223.5.5.5\u0026#39; set service dns forwarding allow-from \u0026#39;10.20.20.0/24\u0026#39; set service dns forwarding listen-address \u0026#39;10.20.20.1\u0026#39; set service dns forwarding cache-size \u0026#39;0\u0026#39; ## å…³é—­äº†ç¼“å­˜ 3.4 å†…ç½‘è®¾å¤‡éšè—ä¸Šç½‘ masquerade(SNAT): masquerade\nset nat source rule 100 translation address \u0026#39;masquerade\u0026#39; æŒ‡å®šç½‘æ®µï¼šï¼ˆå¯é€‰ï¼‰ å¯ä»¥ä¸ç”¨ï¼ç”¨äº†ä¼šé™åˆ¶wg.æˆ–è€…å†æ·»åŠ wgç½‘æ®µç­‰ï¼Œä¸ä¼šå°±ä¸è¦ç”¨ï¼\nset nat source rule 100 source address \u0026#39;10.20.20.0/24\u0026#39; è®¾ç½®å›æµ: ç”±äºä¸Šé¢masquerade(SNAT)çš„è§„åˆ™, è¿™é‡Œä¸éœ€è¦è®¾ç½®å›æµ.\nåˆ°è¿™ä¸€æ­¥åŸºæœ¬çš„å±€åŸŸç½‘é…ç½®å°±å·²ç»å¯ä»¥äº†ï¼Œå…¶ä»–è®¾å¤‡åŠ å…¥å°±å¯ä»¥è‡ªåŠ¨dhcpè·å– ip å¹¶ä¸Šç½‘äº†ã€‚\nå››ã€QoS æµé‡ç®¡ç†ï¼ˆå¯é€‰ï¼‰\nVyos æä¾›äº†éå¸¸å®Œå–„çš„ Qos Policyï¼Œå¸¸è§çš„æµé‡ç­–ç•¥éƒ½æ”¯æŒã€‚å®¶ç”¨ä¸ç”¨é‚£ä¹ˆéº»çƒ¦ç›´æ¥ä½¿ç”¨ Cake ä»…éœ€è¦è®¾ç½®ä¸€ä¸‹å¸¦å®½ï¼Œè¦æ³¨æ„çš„æ˜¯å¯ç”¨ Qos ä¼šå ç”¨ CPUï¼ŒåŒæ—¶å¯èƒ½ä¼šå¯¼è‡´å¸¦å®½è·‘ä¸æ»¡ã€‚å¥½å¤„æ˜¯å¤šäººå ç”¨å¸¦å®½æ—¶ï¼Œå¯ä»¥ä¸ºæ¯ä¸€ä¸ªäººåˆç†åˆ†é…å®½å¸¦èµ„æºã€‚\nset qos policy cake Qos_Cake_Lan bandwidth \u0026#39;1gbit\u0026#39; set qos policy cake Qos_Cake_Lan description \u0026#39;Qos For Lan interface br0\u0026#39; set qos policy cake Qos_Cake_Lan flow-isolation dual-src-host set qos policy cake Qos_Cake_Lan rtt \u0026#39;100\u0026#39; set qos interface br0 egress \u0026#39;Qos_Cake_Lan\u0026#39; äº”ã€é˜²ç«å¢™ è¿™é‡Œé˜²ç«å¢™rule æ•°å­—å¯è‡ªå®š, åŒä¸€æ•°å­—ä¸ºä¸€ç»„, å»ºè®®è®¾ç½®æ•°å­—æ—¶, ç•™å‡ºç©ºéš™, ä»¥ä¾¿ä»¥åæ·»åŠ æ–°çš„è§„åˆ™. é’ˆå¯¹ä¸Šé¢è¿™æ¡nat source rule 100 è§„åˆ™, å»ºè®®ä¸è¦é™åˆ¶æ¥å£, å°±åªç”¨ä¸Šé¢ä¸€æ¡, è¿™å¯¹ä»¥åçš„ç«¯å£è½¬å‘å’Œå›æµè®¾ç½®, éƒ½å¾ˆæ–¹ä¾¿. è®¾ç½®é˜²ç«å¢™è§„åˆ™:\nå…¨å±€ï¼š\nset firewall global-options state-policy established action \u0026#39;accept\u0026#39; set firewall global-options state-policy invalid action \u0026#39;drop\u0026#39; set firewall global-options state-policy related action \u0026#39;accept\u0026#39; set firewall global-options apply-to-bridged-traffic invalid-connections ä¸Šé¢ç¬¬å››æ¡ä¹Ÿå°±æ˜¯æœ€åä¸€æ¡ï¼Œä½œç”¨æ˜¯å®¹å™¨ä¸å†…ç½‘äº’é€šï¼ˆæ¡¥æ¥ï¼‰\nè®¾ç½®ipv4å…¥ç«™(inputé“¾)è§„åˆ™:\nset firewall ipv4 name WAN_LOCAL default-action \u0026#39;drop\u0026#39; #é»˜è®¤æ‹’ç» set firewall ipv4 name WAN_LOCAL rule 10 action \u0026#39;accept\u0026#39; #å…è®¸å·²å»ºç«‹å’Œç›¸å…³è¿æ¥ set firewall ipv4 name WAN_LOCAL rule 10 state \u0026#39;established\u0026#39; set firewall ipv4 name WAN_LOCAL rule 10 state \u0026#39;related\u0026#39; set firewall ipv4 name WAN_LOCAL rule 30 action \u0026#39;accept\u0026#39; #å…è®¸icmp set firewall ipv4 name WAN_LOCAL rule 30 protocol \u0026#39;icmp\u0026#39; ä¸‹é¢æ˜¯wireguardæ”¾è¡Œç«¯å£ï¼ˆå¯é€‰ï¼‰\nset firewall ipv4 name WAN_LOCAL rule 20 description \u0026#34;Allow WireGuard\u0026#34; set firewall ipv4 name WAN_LOCAL rule 20 action \u0026#39;accept\u0026#39; #å…è®¸è¿æ¥wg0 set firewall ipv4 name WAN_LOCAL rule 20 destination port \u0026#39;11133\u0026#39; set firewall ipv4 name WAN_LOCAL rule 20 protocol \u0026#39;udp\u0026#39; #ä¸‹é¢æ˜¯æ”¾è¡Œè¿ç»­ç«¯å£æ ·ä¾‹ï¼šï¼ˆä¾‹ï¼‰\nset firewall ipv4 name WAN_LOCAL rule 40 action \u0026#39;accept\u0026#39; #è¿ç»­ç«¯å£æ ·ä¾‹ set firewall ipv4 name WAN_LOCAL rule 40 destination port \u0026#39;10000-10100\u0026#39; set firewall ipv4 name WAN_LOCAL rule 40 protocol \u0026#39;udp\u0026#39; è®¾ç½®ipv6å…¥ç«™(inputé“¾)è§„åˆ™:\nset firewall ipv6 name WAN_LOCAL default-action \u0026#39;drop\u0026#39; #é»˜è®¤æ‹’ç» set firewall ipv6 name WAN_LOCAL rule 10 action \u0026#39;accept\u0026#39; #å…è®¸å·²å»ºç«‹å’Œç›¸å…³è¿æ¥ set firewall ipv6 name WAN_LOCAL rule 10 state \u0026#39;established\u0026#39; set firewall ipv6 name WAN_LOCAL rule 10 state \u0026#39;related\u0026#39; set firewall ipv6 name WAN_LOCAL rule 20 action \u0026#39;accept\u0026#39; #å…è®¸icmpv6 set firewall ipv6 name WAN_LOCAL rule 20 protocol \u0026#39;icmpv6\u0026#39; set firewall ipv6 name WAN_LOCAL rule 30 action \u0026#39;accept\u0026#39; #å…è®¸ä»ISPå¤„è·å–çš„dhcp6çš„ä¿¡æ¯ set firewall ipv6 name WAN_LOCAL rule 30 destination port \u0026#39;546\u0026#39; set firewall ipv6 name WAN_LOCAL rule 30 protocol \u0026#39;udp\u0026#39; set firewall ipv6 name WAN_LOCAL rule 30 source port \u0026#39;547\u0026#39; ä¸‹é¢æ˜¯wireguardæ”¾è¡Œç«¯å£ï¼ˆå¯é€‰)\nset firewall ipv6 name WAN_LOCAL rule 40 description \u0026#34;Allow WireGuard set firewall ipv6 name WAN_LOCAL rule 40 action \u0026#39;accept\u0026#39; #å…è®¸è¿æ¥wg0 set firewall ipv6 name WAN_LOCAL rule 40 destination port \u0026#39;11133\u0026#39; set firewall ipv6 name WAN_LOCAL rule 40 protocol \u0026#39;udp\u0026#39; è®¾ç½®ipv4è½¬å‘(forwardé“¾)è§„åˆ™:\nset firewall ipv4 name WAN_IN default-action \u0026#39;drop\u0026#39; #é»˜è®¤æ‹’ç» set firewall ipv4 name WAN_IN rule 10 action \u0026#39;accept\u0026#39; #å…è®¸å·²å»ºç«‹å’Œç›¸å…³è¿æ¥ set firewall ipv4 name WAN_IN rule 10 state \u0026#39;established\u0026#39; set firewall ipv4 name WAN_IN rule 10 state \u0026#39;related\u0026#39; è®¾ç½®ipv6è½¬å‘(forwardé“¾)è§„åˆ™:\nset firewall ipv6 name WAN_IN default-action \u0026#39;drop\u0026#39; #é»˜è®¤æ‹’ç» set firewall ipv6 name WAN_IN rule 10 action \u0026#39;accept\u0026#39; #å…è®¸å·²å»ºç«‹å’Œç›¸å…³è¿æ¥ set firewall ipv6 name WAN_IN rule 10 state \u0026#39;established\u0026#39; set firewall ipv6 name WAN_IN rule 10 state \u0026#39;related\u0026#39; set firewall ipv6 name WAN_IN rule 20 action \u0026#39;accept\u0026#39; #å…è®¸icmpv6 set firewall ipv6 name WAN_IN rule 20 protocol \u0026#39;icmpv6\u0026#39; ä¸‹é¢ä¸‰æ¡è¾“å…¥ï¼Œnatç«¯å£åä¸ç”¨å†åœ¨é˜²ç«å¢™é‡Œæ‰“å¼€æ”¾è¡Œç«¯å£ï¼Œnatä¼˜å…ˆæ”¾è¡Œ\nIPV4ï¼š\nset firewall ipv4 name WAN_IN rule 20 action \u0026#39;accept\u0026#39; #å…è®¸å·²DNATçš„è¿æ¥ set firewall ipv4 name WAN_IN rule 20 connection-status nat \u0026#39;destination\u0026#39; set firewall ipv4 name WAN_IN rule 20 state \u0026#39;new\u0026#39; ä¸‹é¢ä¸‰æ¡è¾“å…¥ï¼Œnatç«¯å£åä¸ç”¨å†åœ¨é˜²ç«å¢™é‡Œæ‰“å¼€æ”¾è¡Œç«¯å£ï¼Œnatä¼˜å…ˆæ”¾è¡Œ IPV6ï¼š\nset firewall ipv6 name WAN_IN rule 40 action \u0026#39;accept\u0026#39; set firewall ipv6 name WAN_IN rule 40 connection-status nat \u0026#39;destination\u0026#39; set firewall ipv6 name WAN_IN rule 40 state \u0026#39;new\u0026#39; æ”¾è¡Œipsecç«¯å£ï¼ˆä¸¾ä¾‹ï¼šï¼‰\nset firewall ipv6 name WAN_IN rule 30 action \u0026#39;accept\u0026#39; #å…è®¸ipsec set firewall ipv6 name WAN_IN rule 30 destination port \u0026#39;500,4500\u0026#39; set firewall ipv6 name WAN_IN rule 30 protocol \u0026#39;udp\u0026#39; ç„¶ååˆ†åˆ«ä»inputå’Œforwardé“¾, è°ƒç”¨WAN_LOCALå’ŒWAN_IN: è®¾ç½®æ¥å£ç»„:\nset firewall group interface-group WAN interface \u0026#39;eth3\u0026#39; set firewall group interface-group WAN interface \u0026#39;pppoe1\u0026#39; ç„¶ååˆ†åˆ«ä»inputå’Œforwardé“¾, è°ƒç”¨WAN_LOCALå’ŒWAN_IN:\nset firewall ipv4 input filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv4 input filter rule 10 inbound-interface group \u0026#39;WAN\u0026#39; set firewall ipv4 input filter rule 10 jump-target \u0026#39;WAN_LOCAL\u0026#39; set firewall ipv4 forward filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv4 forward filter rule 10 inbound-interface group \u0026#39;WAN\u0026#39; set firewall ipv4 forward filter rule 10 jump-target \u0026#39;WAN_IN\u0026#39; set firewall ipv6 input filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv6 input filter rule 10 inbound-interface group \u0026#39;WAN\u0026#39; set firewall ipv6 input filter rule 10 jump-target \u0026#39;WAN_LOCAL\u0026#39; set firewall ipv6 forward filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv6 forward filter rule 10 inbound-interface group \u0026#39;WAN\u0026#39; set firewall ipv6 forward filter rule 10 jump-target \u0026#39;WAN_IN\u0026#39; è¯´æ˜: DNATï¼ˆè½¬å‘çš„ç«¯å£ï¼‰æ˜¯æµé‡è¿›å…¥å, æœ€å…ˆå¤„ç†çš„, ç„¶åè¿›å…¥forwardé“¾, è€ŒSNATæ˜¯æµé‡å‡ºç«™å‰, æœ€åå¤„ç†çš„. ä¸‹é¢åªæ˜¯æ ¹æ®è‡ªå·±çš„æƒ…å†µå¤åˆ¶é€‰ç”¨ï¼š\nç•™ä¸ªpppoeæ¥å£ï¼ˆä¾‹ï¼‰ set firewall ipv4 input filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv4 input filter rule 10 inbound-interface name pppoe1 set firewall ipv4 input filter rule 10 jump-target \u0026#39;WAN_LOCAL\u0026#39; set firewall ipv4 forward filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv4 forward filter rule 10 inbound-interface name pppoe1 set firewall ipv4 forward filter rule 10 jump-target \u0026#39;WAN_IN\u0026#39; set firewall ipv6 input filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv6 input filter rule 10 inbound-interface name pppoe1 set firewall ipv6 input filter rule 10 jump-target \u0026#39;WAN_LOCAL\u0026#39; set firewall ipv6 forward filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv6 forward filter rule 10 inbound-interface name pppoe1 set firewall ipv6 forward filter rule 10 jump-target \u0026#39;WAN_IN\u0026#39; ETH3 wanå£ï¼ˆä¾‹ï¼‰ set firewall ipv4 input filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv4 input filter rule 10 inbound-interface name eth3 set firewall ipv4 input filter rule 10 jump-target \u0026#39;WAN_LOCAL\u0026#39; set firewall ipv4 forward filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv4 forward filter rule 10 inbound-interface name eth3 set firewall ipv4 forward filter rule 10 jump-target \u0026#39;WAN_IN\u0026#39; set firewall ipv6 input filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv6 input filter rule 10 inbound-interface name eth3 set firewall ipv6 input filter rule 10 jump-target \u0026#39;WAN_LOCAL\u0026#39; v set firewall ipv6 forward filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv6 forward filter rule 10 inbound-interface name eth3 set firewall ipv6 forward filter rule 10 jump-target \u0026#39;WAN_IN\u0026#39; IPV4ç«¯å£è½¬å‘ï¼ˆæ ·ä¾‹é…ç½®ï¼‰ï¼šNATç«¯å£è½¬å‘ (é…ç½®æ ·ä¾‹ï¼‰ï¼ˆä¸ç”¨ä¸‹æ¥å£ï¼‰\nconfigure # Synapse (TCP 12335) set nat destination rule 10 description \u0026#39;synapse\u0026#39; set nat destination rule 10 destination port \u0026#39;12335\u0026#39; set nat destination rule 10 protocol \u0026#39;tcp\u0026#39; set nat destination rule 10 translation address \u0026#39;10.20.20.8\u0026#39; set nat destination rule 10 translation port \u0026#39;12335\u0026#39; # åŒä¸€ä¸ªç«¯å£ä¸å¡«ä¹Ÿå¯ä»¥ # SB_home (UDP 20521) set nat destination rule 20 description \u0026#39;SB_home\u0026#39; set nat destination rule 20 destination port \u0026#39;20521\u0026#39; set nat destination rule 20 protocol \u0026#39;udp\u0026#39; set nat destination rule 20 translation address \u0026#39;10.20.20.9\u0026#39; set nat destination rule 20 translation port \u0026#39;20521\u0026#39; # åŒä¸€ä¸ªç«¯å£ä¸å¡«ä¹Ÿå¯ä»¥ # L2TP VPN (UDP 1701) set nat destination rule 30 description \u0026#39;L2TP\u0026#39; set nat destination rule 30 destination port \u0026#39;1701\u0026#39; set nat destination rule 30 protocol \u0026#39;udp\u0026#39; set nat destination rule 30 translation address \u0026#39;10.20.20.4\u0026#39; set nat destination rule 30 translation port \u0026#39;1701\u0026#39; # åŒä¸€ä¸ªç«¯å£ä¸å¡«ä¹Ÿå¯ä»¥ # ISAKMP (UDP 500) - ç”¨äº IKEï¼ˆIPSec å¯†é’¥äº¤æ¢ï¼‰ set nat destination rule 40 description \u0026#39;ISAKMP\u0026#39; set nat destination rule 40 destination port \u0026#39;500\u0026#39; set nat destination rule 40 protocol \u0026#39;udp\u0026#39; set nat destination rule 40 translation address \u0026#39;10.20.20.4\u0026#39; set nat destination rule 40 translation port \u0026#39;500\u0026#39; # åŒä¸€ä¸ªç«¯å£ä¸å¡«ä¹Ÿå¯ä»¥ # IPSEC NAT-T (UDP 4500) - NAT ç©¿é€ set nat destination rule 50 description \u0026#39;IPSEC\u0026#39; set nat destination rule 50 destination port \u0026#39;4500\u0026#39; set nat destination rule 50 protocol \u0026#39;udp\u0026#39; set nat destination rule 50 translation address \u0026#39;10.20.20.4\u0026#39; set nat destination rule 50 translation port \u0026#39;4500\u0026#39; # åŒä¸€ä¸ªç«¯å£ä¸å¡«ä¹Ÿå¯ä»¥ # OpenVPN (TCP 1194) set nat destination rule 60 description \u0026#39;OPENVPN\u0026#39; set nat destination rule 60 destination port \u0026#39;1194\u0026#39; set nat destination rule 60 protocol \u0026#39;tcp\u0026#39; set nat destination rule 60 translation address \u0026#39;10.20.20.4\u0026#39; set nat destination rule 60 translation port \u0026#39;1194\u0026#39; # åŒä¸€ä¸ªç«¯å£ä¸å¡«ä¹Ÿå¯ä»¥ # SIP (UDP 5060) set nat destination rule 70 description \u0026#39;SIP\u0026#39; set nat destination rule 70 destination port \u0026#39;5060\u0026#39; set nat destination rule 70 protocol \u0026#39;udp\u0026#39; set nat destination rule 70 translation address \u0026#39;10.20.20.17\u0026#39; set nat destination rule 70 translation port \u0026#39;5060\u0026#39; # åŒä¸€ä¸ªç«¯å£ä¸å¡«ä¹Ÿå¯ä»¥ # SIP RTP (UDP 10000-10100) set nat destination rule 80 description \u0026#39;SIP_RTP\u0026#39; set nat destination rule 80 destination port \u0026#39;10000-10100\u0026#39; set nat destination rule 80 protocol \u0026#39;udp\u0026#39; set nat destination rule 80 translation address \u0026#39;10.20.20.17\u0026#39; set nat destination rule 80 translation port \u0026#39;10000-10100\u0026#39; # åŒä¸€ä¸ªç«¯å£ä¸å¡«ä¹Ÿå¯ä»¥ commit save IPV6ç«¯å£è½¬å‘ï¼ˆæ ·ä¾‹é…ç½®ï¼‰ï¼šNATç«¯å£è½¬å‘ (é…ç½®æ ·ä¾‹ï¼‰ï¼ˆä¸ç”¨ä¸‹æ¥å£ï¼‰\nset nat66 destination rule 10 description \u0026#39;gohome\u0026#39; set nat66 destination rule 10 destination port \u0026#39;10521\u0026#39; set nat66 destination rule 10 protocol \u0026#39;udp\u0026#39; set nat66 destination rule 10 translation address \u0026#39;fd99::9999\u0026#39; é˜²ç«å¢™èŒƒå›´é…ç½®ç»“æŸï¼\nå…­ã€WAN å£ PPPoE æ‹¨å·é…ç½® 6.1 æ‹¨å·é…ç½® å‰ææ˜¯å…‰çŒ«è¦æ”¹æ¡¥æ¥ï¼Œå¹¶ä¸”æœ‰å®½å¸¦çš„æ‹¨å·ä¿¡æ¯ï¼Œå…ˆä»å…‰çŒ«çš„ LAN å£æ¥ä¸€æ¡ç½‘çº¿åˆ° vyos çš„eth3æ¥å£(wanå£ï¼‰ï¼Œå¹¶å¯ç”¨ä¸€ä¸ªpppoe1çš„æ¥å£ï¼Œ è‡ªåŠ¨é…ç½® MTU ï¼š\nset interfaces pppoe pppoe1 description \u0026#39;China Telecom\\China Unicom\u0026#39; #ç”µä¿¡è¿˜æ˜¯è”é€šï¼ŒäºŒé€‰ä¸€ï¼Œä¸æ˜¯çš„åˆ é™¤ set interfaces pppoe pppoe1 source-interface \u0026#39;eth3\u0026#39; set interfaces pppoe pppoe1 authentication username \u0026#39;å¸å·\u0026#39; set interfaces pppoe pppoe1 authentication password \u0026#39;å¯†ç \u0026#39; set interfaces pppoe pppoe1 mtu \u0026#39;1492\u0026#39; set interfaces pppoe pppoe1 ip adjust-mss \u0026#39;clamp-mss-to-pmtu\u0026#39; ####PPPOEæµ‹è¯•æ—¶å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ pppoeæ–­å¼€ï¼š\nrun disconnect interface pppoe1 å†è¿ï¼š\nrun connect interface pppoe1 æŸ¥çœ‹ï¼š\nrun show int 6.2 IPv6 PD é…ç½® é¦–å…ˆè®¾ç½®éœ€è¦è®¾ç½® prefixï¼Œæˆ‘çš„è¿è¥å•†æ˜¯ç»™çš„æ˜¯/60\n#set interfaces pppoe pppoe1 dhcpv6-options pd 0 interface br0 sla-id \u0026#39;0\u0026#39; #ç¬¬ä¸€æ¡ç¬¬äºŒæ¡äºŒé€‰ä¸€ï¼Œéƒ½è¡Œï¼Œipv6åœ°å€çš„å½¢æ€ä¸ä¸€æ · set interfaces pppoe pppoe1 dhcpv6-options pd 0 interface br0 address \u0026#39;1\u0026#39; set interfaces pppoe pppoe1 dhcpv6-options pd 0 length \u0026#39;62\u0026#39; # è¿™æ˜¯perxi set interfaces pppoe pppoe1 ipv6 adjust-mss \u0026#39;clamp-mss-to-pmtu\u0026#39; set interfaces pppoe pppoe1 ipv6 address autoconf è®¾ç½®è·¯ç”±å™¨å…¬å‘ŠRAï¼š\nset service router-advert interface br0 prefix fd88::/64 valid-lifetime \u0026#39;172800\u0026#39; 6.3 å¤šæ‹¨(å¯é€‰ï¼‰ å¤šæ‹¨éœ€è¦è¿è¥å•†æ”¯æŒï¼Œvyos çš„å¤šæ‹¨éå¸¸ç®€å•ï¼Œæ–°å¯ç”¨ä¸€ä¸ª pppoe çš„æ¥å£æ‹¨å·å³å¯ï¼š\nset interfaces pppoe pppoe1 authentication password \u0026#39;å®½å¸¦å¯†ç \u0026#39; set interfaces pppoe pppoe1 authentication username \u0026#39;å®½å¸¦è´¦å·\u0026#39; set interfaces pppoe pppoe1 description \u0026#39;China Unicom WAN multi-pppoe-2\u0026#39; set interfaces pppoe pppoe1 source-interface \u0026#39;eth3\u0026#39; è‡³æ­¤ WAN-pppoe çš„é…ç½®å…¨éƒ¨ç»“æŸã€‚\nå¦‚æœå…¬ç½‘å£æ˜¯dhcpè·å–ï¼š(æ­¤å¤„æ˜¯å…‰çŒ«pppoeæ‹¨å·DHCPä¸‹å‘ä½¿ç”¨ï¼‰ set interfaces ethernet eth3 address dhcp ç°åœ¨åº”è¯¥å¯ä»¥ä¸Šç½‘äº†ï¼\nfakeipçš„æ”¯æŒ é€šè¿‡ MoS DNS æ¥åˆ†æµ Real IP å’Œ Fake IP çš„æµé‡ï¼Œå¯è¿™æ ·é…ç½®:\nå®šä¹‰ Telegram IPv4 ç»„\nset firewall group network-group Telegram-v4 network \u0026#39;91.108.56.0/22\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;91.108.4.0/22\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;91.108.8.0/22\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;91.108.16.0/22\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;91.108.12.0/22\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;149.154.160.0/20\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;91.105.192.0/23\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;91.108.20.0/22\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;185.76.151.0/24\u0026#39; å®šä¹‰ Telegram IPv6 ç»„\nset firewall group ipv6-network-group Telegram-v6 network \u0026#39;2001:b28:f23d::/48\u0026#39; set firewall group ipv6-network-group Telegram-v6 network \u0026#39;2001:b28:f23f::/48\u0026#39; set firewall group ipv6-network-group Telegram-v6 network \u0026#39;2001:67c:4e8::/48\u0026#39; set firewall group ipv6-network-group Telegram-v6 network \u0026#39;2001:b28:f23c::/48\u0026#39; set firewall group ipv6-network-group Telegram-v6 network \u0026#39;2a0a:f280::/32\u0026#39; å®šä¹‰ Fake IP ç»„\nset firewall group network-group FAKEIP-v4 network \u0026#39;198.18.0.0/15\u0026#39; # Fake IPv4 set firewall group ipv6-network-group FAKEIP-v6 network \u0026#39;f2b0::/18\u0026#39; # Fake IPv6 é…ç½®ç­–ç•¥è·¯ç”± (ç±»ä¼¼ RouterOS ä¸­çš„ Mangle è§„åˆ™)\nset policy route Route-to-SB interface br0 # br0 æ˜¯ LAN set policy route Route-to-SB rule 10 set table \u0026#39;100\u0026#39; # Table 100 æ˜¯ to-sb çš„è¡¨ set policy route Route-to-SB rule 10 destination group network-group \u0026#39;Telegram-v4\u0026#39; set policy route Route-to-SB rule 20 set table \u0026#39;100\u0026#39; set policy route Route-to-SB rule 20 destination group network-group \u0026#39;FAKEIP-v4\u0026#39; set policy route6 FAKE6-to-SB interface br0 set policy route6 FAKE6-to-SB rule 10 set table \u0026#39;106\u0026#39; # Table 106 æ˜¯ to-sb çš„è¡¨ (IPv6) set policy route6 FAKE6-to-SB rule 10 destination group network-group \u0026#39;FAKEIP-v6\u0026#39; set policy route6 FAKE6-to-SB rule 20 set table \u0026#39;106\u0026#39; set policy route6 FAKE6-to-SB rule 20 destination group network-group \u0026#39;Telegram-v6\u0026#39; é…ç½®è·¯ç”±è¡¨\nset protocols static table 100 route 0.0.0.0/0 next-hop 10.20.20.9 # sb çš„å†…ç½‘ IP set protocols static table 106 route6 ::/0 next-hop fd88::9999 # sb çš„ ULA IPV6 Nat ï¼ˆå¯¼å®Œæ”¯æŒipv6ä¼˜å…ˆï¼‰(æ³¨æ„ä¿®æ”¹è‡ªå·±çš„fakeip)\nset nat66 source rule 10 description \u0026#39;MASQ-FAKE6\u0026#39; set nat66 source rule 10 destination prefix \u0026#39;f2b0::/18\u0026#39; set nat66 source rule 10 translation address \u0026#39;masquerade\u0026#39; # set interfaces bridge br0 address \u0026#39;fd88::1111/64\u0026#39; #å¼€å§‹è®¾ç½®è¿‡å°±ä¸è¦å†è®¾ç½®äº† å®Œäº†ï¼okäº†ï¼\nå¯¹äº†ï¼Œåˆ«å¿˜äº†ï¼ŒæŠŠdnsçš„è®¾ç½®æ”¹ä¸ºï¼Œä½ æ‡‚çš„ï½ï¼Œä¸Šé¢DNSè®¾ç½®é‚£å—æœ‰å‘½ä»¤ï½å‡†å¤‡å¥½äº†ï½\né™„ï¼\nVyOS è‡ªå·±è¦ç§‘å­¦ä¸Šç½‘ ä¸€èˆ¬åœ¨ pull å®¹å™¨é•œåƒã€ä¸‹è½½æ›´æ–°æ—¶å¯ä»¥è¿™æ ·é…ç½®:\nset system name-server \u0026#39;172.23.0.99\u0026#39; # 172.23.0.99 æ˜¯ sb çš„ IP æˆ– MoS DNS çš„ IP or\nset system name-server \u0026#39;10.20.20.9\u0026#39; # 10.20.20.9 æ˜¯ sb çš„ IP æˆ– MoS DNS çš„ IP æ³¨æ„: name-server åªéœ€è¦ä¸€ä¸ªï¼Œç¡®ä¿èƒ½åŒºåˆ† Fake IPã€‚\nset policy local-route rule 10 destination address \u0026#39;198.18.0.0/15\u0026#39; set policy local-route rule 10 set table \u0026#39;100\u0026#39; #åªæƒ³è®© TCP æµé‡ ä½¿ç”¨ table 100ï¼Œè€Œ å…¶ä»–åè®®ï¼ˆå¦‚ UDPã€ICMPï¼‰ä»èµ°é»˜è®¤è·¯ç”±è¡¨(å¯é€‰ï¼‰ #set policy local-route rule 10 protocol \u0026#39;tcp\u0026#39; è¿™ä¸‰æ¡é…ç½®ä½œç”¨å¦‚ä¸‹ï¼š\nset policy local-route rule 10 destination address \u0026lsquo;198.18.0.0/15\u0026rsquo; â€¢ è¯¥è§„åˆ™åŒ¹é… ç›®çš„åœ°å€ åœ¨ 198.18.0.0/15 ç½‘æ®µå†…çš„æµé‡ã€‚\nset policy local-route rule 10 set table \u0026lsquo;100\u0026rsquo; â€¢ è®©åŒ¹é…è¯¥è§„åˆ™çš„æµé‡ä½¿ç”¨ è·¯ç”±è¡¨ 100 è¿›è¡Œè·¯ç”±æŸ¥æ‰¾ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„ mainï¼ˆ254ï¼‰è·¯ç”±è¡¨ã€‚\nset policy local-route rule 10 protocol \u0026rsquo;tcp' â€¢ é™åˆ¶è¯¥è§„åˆ™ä»…é€‚ç”¨äº TCP æµé‡ï¼Œå³ åªæœ‰ TCP åè®®çš„æ•°æ®åŒ…ä¼šåŒ¹é…æ­¤è§„åˆ™ã€‚\nç¬¬ä¸‰æ¡ï¼ˆprotocol \u0026rsquo;tcp\u0026rsquo;ï¼‰æ˜¯å¦å¿…è¦ï¼Ÿ\nâ€¢ å¦‚æœä½ çš„ç›®æ ‡æ˜¯ è®©æ‰€æœ‰å»å¾€ 198.18.0.0/15 çš„æµé‡ éƒ½ä½¿ç”¨ table 100ï¼Œé‚£ä¹ˆ ç¬¬ä¸‰æ¡æ˜¯ä¸å¿…è¦çš„ã€‚ â€¢ ä½†å¦‚æœä½  åªæƒ³è®© TCP æµé‡ ä½¿ç”¨ table 100ï¼Œè€Œ å…¶ä»–åè®®ï¼ˆå¦‚ UDPã€ICMPï¼‰ä»èµ°é»˜è®¤è·¯ç”±è¡¨ï¼Œé‚£ä¹ˆ ç¬¬ä¸‰æ¡æ˜¯æœ‰ç”¨çš„ã€‚\nå› æ­¤ï¼š å®Œæ•´æœ¬åœ°ç§‘å­¦çš„å‘½ä»¤:\nset system name-server \u0026#39;172.23.0.99\u0026#39; delete system name-server \u0026#39;223.5.5.5\u0026#39; delete system name-server \u0026#39;119.29.29.29\u0026#39; set policy local-route rule 10 destination address \u0026#39;198.18.0.0/15\u0026#39; set policy local-route rule 10 set table \u0026#39;100\u0026#39; or(æˆ–è€…ï¼‰ï¼ˆåªæ˜¯ipçš„åŒºåˆ«ï¼Œæ–¹ä¾¿å¤åˆ¶çš„ï¼Œä½ æ¢æˆä½ è‡ªå·±çš„ip)\nset system name-server \u0026#39;10.20.20.6\u0026#39; delete system name-server \u0026#39;223.5.5.5\u0026#39; delete system name-server \u0026#39;119.29.29.29\u0026#39; set policy local-route rule 10 destination address \u0026#39;198.18.0.0/15\u0026#39; set policy local-route rule 10 set table \u0026#39;100\u0026#39; é…ç½®wireguard: set interfaces wireguard wg0 address \u0026#39;10.20.20.1/24\u0026#39; set interfaces wireguard wg0 peer iphone allowed-ips \u0026#39;10.20.20.2/32\u0026#39; set interfaces wireguard wg0 peer iphone preshared-key \u0026#39;preshared-key\u0026#39; set interfaces wireguard wg0 peer iphone public-key \u0026#39;public-key\u0026#39; set interfaces wireguard wg0 port \u0026#39;11133\u0026#39; set interfaces wireguard wg0 private-key \u0026#39;private-key\u0026#39; å¦‚æœè®©wgç§‘å­¦ï¼Œä¸‹é¢æ¥ç€æ“ä½œï¼š\næ·»åŠ ç»„ï¼šï¼ˆè¾“å…¥å†…ç½‘IPæ®µï¼Œä¸Šé¢å¦‚æœè®¾ç½®è¿‡äº†å°±ä¸éœ€è¦é‡å¤è®¾ç½®ï¼Œè¿™é‡Œåªæ˜¯æ³¨æ˜è¿™å—éœ€è¦ï¼‰\nset firewall group network-group LAN-v4 network \u0026#39;10.20.20.0/24\u0026#39; è®¾ç½®ç­–ç•¥è·¯ç”±: ä¸¾ä¾‹: è®©wg0çš„æµé‡èµ°100å·è·¯ç”±è¡¨, 100å·è·¯ç”±è¡¨æ˜¯sbçš„è·¯ç”±è¡¨\nset policy route WG0-to-SB interface \u0026#39;wg0\u0026#39; set policy route WG0-to-SB rule 10 destination group network-group \u0026#39;!LAN-v4\u0026#39; set policy route WG0-to-SB rule 10 set table \u0026#39;100\u0026#39; #è·¯ç”±è¡¨ï¼ˆä¹‹å‰æ·»åŠ è¿‡å°±ä¸è¦é‡å¤æ·»åŠ ï¼‰(10.20.20.9æ˜¯æˆ‘sing-boxçš„ip)\nset protocols static table 100 route 0.0.0.0/0 next-hop 10.20.20.9 ##é…ç½®ddns: cloudflare ddns:\nset service dns dynamic name DDNS-CF-v4 address interface \u0026#39;pppoe1\u0026#39; set service dns dynamic name DDNS-CF-v4 host-name \u0026#39;ddns.example.com\u0026#39; set service dns dynamic name DDNS-CF-v4 ip-version \u0026#39;ipv4\u0026#39; set service dns dynamic name DDNS-CF-v4 password \u0026#39;token\u0026#39; set service dns dynamic name DDNS-CF-v4 protocol \u0026#39;cloudflare\u0026#39; set service dns dynamic name DDNS-CF-v4 zone \u0026#39;example.com\u0026#39; set service dns dynamic name DDNS-CF-v6 address interface \u0026#39;eth0\u0026#39; set service dns dynamic name DDNS-CF-v6 host-name \u0026#39;ddns6.example.com\u0026#39; set service dns dynamic name DDNS-CF-v6 ip-version \u0026#39;ipv6\u0026#39; set service dns dynamic name DDNS-CF-v6 password \u0026#39;token\u0026#39; set service dns dynamic name DDNS-CF-v6 protocol \u0026#39;cloudflare\u0026#39; set service dns dynamic name DDNS-CF-v6 zone \u0026#39;example.com\u0026#39; dnspod ddns:\nset service dns dynamic name DNSPOD-v4 address interface \u0026#39;pppoe1\u0026#39; set service dns dynamic name DNSPOD-v4 host-name \u0026#39;ddns.example.com\u0026#39; set service dns dynamic name DNSPOD-v4 password \u0026#39;token\u0026#39; set service dns dynamic name DNSPOD-v4 protocol \u0026#39;dyndns2\u0026#39; set service dns dynamic name DNSPOD-v4 server \u0026#39;dnsapi.cn\u0026#39; set service dns dynamic name DNSPOD-v4 username \u0026#39;id\u0026#39; ä¸ªäººä½¿ç”¨ä¸‹æ¥, ä¸Šè¿°é…ç½®å¹¶ä¸éœ€è¦è®¾ç½®interval, ipå˜åŒ–ä¹Ÿä¼šè‡ªåŠ¨æ›´æ–°.\næœ€åç»™ä¸ªå°å‘½ä»¤çŸ¥è¯†ç‚¹ï¼š ç¡®ä¿ NAT è§„åˆ™å®Œæ•´,æŸ¥çœ‹å‘½ä»¤ï¼Œå¦‚: æ£€æŸ¥è§„åˆ™\nshow configuration commands | match \u0026#39;nat destination\u0026#39; ç”¨showå‘½ä»¤çš„æ—¶å€™è¦æ³¨æ„ï¼Œåœ¨é…ç½®æ¨¡å¼#ä¸‹ï¼Œå¦‚çœ‹æŸ¥çœ‹æ¨¡å¼$ä¸‹çš„show,éœ€è¦åœ¨showå‰é¢åŠ ä¸ªrunå‘½ä»¤ã€‚ ç¥å›ä½¿ç”¨æ„‰å¿«ï½\n","permalink":"https://hanigege.github.io/posts/routers/vyos-qiaojie-4kou/","tags":null,"title":"vyoså¤šç½‘å£å°ä¸»æœºæ¡¥æ¥é…ç½®(å®Œæ•´)"},{"categories":null,"contents":"","permalink":"https://hanigege.github.io/search/","tags":null,"title":"æœç´¢"}]