[{"categories":["linux"],"contents":"è¯´æ˜ï¼šæ”¯æŒipv4\u0026amp;ipv6,è‡ªåŠ¨æ£€æµ‹æœ‰æ— ipv6ï¼Œæ·»åŠ mss.è‡ªåŠ¨æ£€æµ‹sshç«¯å£ç­‰ï¼Œå¾ˆæ–¹ä¾¿ æˆåŠŸçš„æ­¥éª¤ä¸æ–¹æ³• nano iptables_manager.sh ç›´æ¥å¤åˆ¶å¹¶æ‰§è¡Œä»¥ä¸‹å®Œæ•´ä»£ç è¦†ç›–åŸè„šæœ¬ï¼š cat \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; \u0026gt; iptables_manager.sh #!/bin/bash # ========================================================== # è„šæœ¬åç§°ï¼šé«˜çº§é˜²ç«å¢™ç®¡ç†å·¥å…· (Debian/Ubuntu ä¸“å±è‡ªé€‚åº”ç‰ˆ V4.1) # æ ¸å¿ƒå‡çº§ï¼šåŸºäºè½¯ä»¶å’Œå†…æ ¸æ¨¡å—çš„æ·±åº¦æ™ºèƒ½æ£€æµ‹ï¼Œæ¶ˆé™¤å†—ä½™è§„åˆ™ # ========================================================== gl_lv=\u0026#39;\\033[32m\u0026#39; gl_huang=\u0026#39;\\033[33m\u0026#39; gl_hong=\u0026#39;\\033[31m\u0026#39; gl_bai=\u0026#39;\\033[0m\u0026#39; root_use() { [ \u0026#34;$EUID\u0026#34; -ne 0 ] \u0026amp;\u0026amp; echo -e \u0026#34;${gl_huang}æç¤º: ${gl_bai}éœ€ root æƒé™è¿è¡Œï¼\u0026#34; \u0026amp;\u0026amp; exit 1 } check_deps() { if ! dpkg -l | grep -qw iptables-persistent; then echo -e \u0026#34;${gl_huang}æ£€æµ‹åˆ°æœªå®‰è£…æŒä¹…åŒ–ç»„ä»¶ï¼Œæ­£åœ¨è‡ªåŠ¨å®‰è£…...${gl_bai}\u0026#34; apt-get update DEBIAN_FRONTEND=noninteractive apt-get install -y iptables iptables-persistent netfilter-persistent echo -e \u0026#34;${gl_lv}ä¾èµ–å®‰è£…å®Œæˆï¼${gl_bai}\u0026#34; sleep 1 fi } root_use check_deps if command -v ip6tables \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 \u0026amp;\u0026amp; ip addr 2\u0026gt;/dev/null | grep -q \u0026#34;inet6 .* global\u0026#34;; then CMDS=\u0026#34;iptables ip6tables\u0026#34; HAS_IPV6=true else CMDS=\u0026#34;iptables\u0026#34; HAS_IPV6=false fi save_rules() { echo -e \u0026#34;${gl_huang}æ­£åœ¨æŒä¹…åŒ–è§„åˆ™...${gl_bai}\u0026#34; mkdir -p /etc/iptables netfilter-persistent save \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 || { iptables-save \u0026gt; /etc/iptables/rules.v4 [ \u0026#34;$HAS_IPV6\u0026#34; == true ] \u0026amp;\u0026amp; ip6tables-save \u0026gt; /etc/iptables/rules.v6 } echo -e \u0026#34;${gl_lv}è§„åˆ™ä¿å­˜æˆåŠŸã€‚${gl_bai}\u0026#34; } get_ssh_port() { local port=$(grep -i \u0026#34;^Port\u0026#34; /etc/ssh/sshd_config 2\u0026gt;/dev/null | awk \u0026#39;{print $2}\u0026#39; | head -n 1) [ -z \u0026#34;$port\u0026#34; ] \u0026amp;\u0026amp; port=22 echo \u0026#34;$port\u0026#34; } view_rules() { for cmd in $CMDS; do echo -e \u0026#34;\\n${gl_lv}=== $cmd filter è¡¨çŠ¶æ€ ===${gl_bai}\u0026#34; $cmd -L INPUT -n -v --line-numbers echo -e \u0026#34;${gl_huang}--- FORWARD è½¬å‘çŠ¶æ€ ---${gl_bai}\u0026#34; $cmd -L FORWARD -n -v --line-numbers echo -e \u0026#34;${gl_huang}--- MSS é’³åˆ¶çŠ¶æ€ (mangle è¡¨) ---${gl_bai}\u0026#34; $cmd -t mangle -L FORWARD -n -v --line-numbers done read -p \u0026#34;æŒ‰å›è½¦ç»§ç»­...\u0026#34; } allow_port_flexible() { read -e -p \u0026#34;è¯·è¾“å…¥è¦æ”¾è¡Œçš„ç«¯å£å·: \u0026#34; port [ -z \u0026#34;$port\u0026#34; ] \u0026amp;\u0026amp; return echo -e \u0026#34;1. TCP 2. UDP 3. åŒæ—¶æ”¾è¡Œ\u0026#34; read -p \u0026#34;é€‰æ‹© (1-3): \u0026#34; p_choice for cmd in $CMDS; do case $p_choice in 1) $cmd -I INPUT 4 -p tcp --dport \u0026#34;$port\u0026#34; -j ACCEPT ;; 2) $cmd -I INPUT 4 -p udp --dport \u0026#34;$port\u0026#34; -j ACCEPT ;; 3) $cmd -I INPUT 4 -p tcp --dport \u0026#34;$port\u0026#34; -j ACCEPT $cmd -I INPUT 4 -p udp --dport \u0026#34;$port\u0026#34; -j ACCEPT ;; esac done save_rules } block_ip() { read -e -p \u0026#34;è¾“å…¥è¦å±è”½çš„ IP: \u0026#34; tip [ -z \u0026#34;$tip\u0026#34; ] \u0026amp;\u0026amp; return if [[ \u0026#34;$tip\u0026#34; == *\u0026#34;:\u0026#34;* ]]; then if [ \u0026#34;$HAS_IPV6\u0026#34; == true ]; then ip6tables -I INPUT 1 -s \u0026#34;$tip\u0026#34; -j DROP else echo -e \u0026#34;${gl_hong}ç³»ç»Ÿæœªå¼€å¯ IPv6ï¼Œæ— æ³•æ·»åŠ è¯¥è§„åˆ™ã€‚${gl_bai}\u0026#34; sleep 2 return fi else iptables -I INPUT 1 -s \u0026#34;$tip\u0026#34; -j DROP fi save_rules } delete_rule() { echo -e \u0026#34;1. IPv4 (iptables)\u0026#34; [ \u0026#34;$HAS_IPV6\u0026#34; == true ] \u0026amp;\u0026amp; echo \u0026#34;2. IPv6 (ip6tables)\u0026#34; read -p \u0026#34;é€‰æ‹©åè®®: \u0026#34; p_choice local cmd=\u0026#34;iptables\u0026#34; if [ \u0026#34;$p_choice\u0026#34; == \u0026#34;2\u0026#34; ] \u0026amp;\u0026amp; [ \u0026#34;$HAS_IPV6\u0026#34; == true ]; then cmd=\u0026#34;ip6tables\u0026#34; elif [ \u0026#34;$p_choice\u0026#34; == \u0026#34;2\u0026#34; ]; then echo -e \u0026#34;${gl_hong}ç³»ç»Ÿä¸æ”¯æŒ IPv6ã€‚${gl_bai}\u0026#34; sleep 2 return fi $cmd -L INPUT -n --line-numbers read -p \u0026#34;è¾“å…¥è¦åˆ é™¤çš„ filter/INPUT è§„åˆ™ç¼–å·: \u0026#34; num [ -n \u0026#34;$num\u0026#34; ] \u0026amp;\u0026amp; $cmd -D INPUT \u0026#34;$num\u0026#34; \u0026amp;\u0026amp; save_rules } close_all_but_ssh() { local ssh_p=$(get_ssh_port) echo -e \u0026#34;${gl_huang}å¼€å§‹æ‰§è¡Œè‡ªé€‚åº”æ·±åº¦åŠ å›º...${gl_bai}\u0026#34; sysctl -w net.ipv4.ip_forward=1 \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 [ \u0026#34;$HAS_IPV6\u0026#34; == true ] \u0026amp;\u0026amp; sysctl -w net.ipv6.conf.all.forwarding=1 \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 || true for cmd in $CMDS; do $cmd -P INPUT ACCEPT $cmd -P FORWARD ACCEPT $cmd -L INPUT --line-numbers | grep -vE \u0026#34;ts-|DOCKER\u0026#34; | awk \u0026#39;/^[0-9]/ {print $1}\u0026#39; | sort -nr | xargs -r -I{} $cmd -D INPUT {} 2\u0026gt;/dev/null $cmd -F FORWARD $cmd -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT $cmd -A INPUT -i lo -j ACCEPT if $cmd -L ts-input \u0026gt;/dev/null 2\u0026gt;\u0026amp;1; then $cmd -D INPUT -j ts-input 2\u0026gt;/dev/null || true $cmd -I INPUT 3 -j ts-input fi $cmd -A INPUT -p tcp --dport \u0026#34;$ssh_p\u0026#34; -j ACCEPT # è§„èŒƒ ICMP if [ \u0026#34;$cmd\u0026#34; == \u0026#34;iptables\u0026#34; ]; then $cmd -A INPUT -p icmp --icmp-type echo-request -m limit --limit 1/s --limit-burst 5 -j ACCEPT $cmd -A INPUT -p icmp --icmp-type 3 -j ACCEPT $cmd -A INPUT -p icmp --icmp-type 11 -j ACCEPT $cmd -A INPUT -p icmp -j DROP else for type in 2 133 134 135 136 137; do $cmd -A INPUT -p ipv6-icmp --icmpv6-type $type -j ACCEPT done $cmd -A INPUT -p ipv6-icmp --icmpv6-type echo-request -m limit --limit 1/s --limit-burst 5 -j ACCEPT $cmd -A INPUT -p ipv6-icmp -j DROP fi if $cmd -L ts-forward \u0026gt;/dev/null 2\u0026gt;\u0026amp;1; then $cmd -D FORWARD -j ts-forward 2\u0026gt;/dev/null || true $cmd -I FORWARD 1 -j ts-forward fi # æ ¸å¿ƒä¼˜åŒ–ï¼šæ™ºèƒ½ç¯å¢ƒæ£€æµ‹ (æ£€æµ‹è½¯ä»¶å®‰è£…çŠ¶æ€è€Œéç½‘å¡çŠ¶æ€) if command -v docker \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 || command -v dockerd \u0026gt;/dev/null 2\u0026gt;\u0026amp;1; then $cmd -A FORWARD -i docker+ -j ACCEPT $cmd -A FORWARD -o docker+ -j ACCEPT fi if command -v tailscaled \u0026gt;/dev/null 2\u0026gt;\u0026amp;1; then $cmd -A FORWARD -i tailscale+ -j ACCEPT $cmd -A FORWARD -o tailscale+ -j ACCEPT fi if command -v wg \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 || lsmod | grep -q wireguard; then $cmd -A FORWARD -i wg+ -j ACCEPT $cmd -A FORWARD -o wg+ -j ACCEPT fi if command -v openvpn \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 || [ -c /dev/net/tun ]; then $cmd -A FORWARD -i tun+ -j ACCEPT $cmd -A FORWARD -o tun+ -j ACCEPT fi if command -v pppd \u0026gt;/dev/null 2\u0026gt;\u0026amp;1; then $cmd -A FORWARD -i ppp+ -j ACCEPT $cmd -A FORWARD -o ppp+ -j ACCEPT fi $cmd -A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT $cmd -P INPUT DROP $cmd -P FORWARD DROP # åŒæ ˆ MSS é’³åˆ¶ $cmd -t mangle -F FORWARD $cmd -t mangle -A FORWARD -p tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu 2\u0026gt;/dev/null || true done save_rules echo -e \u0026#34;${gl_lv}æ·±åº¦åŠ å›ºåŠ MSS ç½‘ç»œä¼˜åŒ–å®Œæˆï¼å†—ä½™è§„åˆ™å·²æ¸…ç†ã€‚${gl_bai}\u0026#34; sleep 2 } open_all_ports() { for cmd in iptables ip6tables; do command -v $cmd \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 || continue $cmd -P INPUT ACCEPT $cmd -P FORWARD ACCEPT $cmd -P OUTPUT ACCEPT $cmd -F $cmd -X 2\u0026gt;/dev/null || true $cmd -t mangle -F FORWARD 2\u0026gt;/dev/null || true done save_rules echo -e \u0026#34;${gl_lv}é˜²ç«å¢™å·²é‡ç½®å…¨å¼€æ¨¡å¼ï¼ŒMSS é’³åˆ¶å·²æ¸…é™¤ã€‚${gl_bai}\u0026#34; sleep 2 } iptables_panel() { while true; do clear echo -e \u0026#34;${gl_lv}===========================================${gl_bai}\u0026#34; echo -e \u0026#34; é«˜çº§é˜²ç«å¢™ç®¡ç† (Debian/Ubuntu è‡ªé€‚åº”ç‰ˆ V4.1) \u0026#34; echo -e \u0026#34; å½“å‰ IPv6 çŠ¶æ€: \\c\u0026#34; if [ \u0026#34;$HAS_IPV6\u0026#34; == true ]; then echo -e \u0026#34;${gl_lv}å·²å¯ç”¨${gl_bai}\u0026#34;; else echo -e \u0026#34;${gl_huang}æœªå¯ç”¨${gl_bai}\u0026#34;; fi echo -e \u0026#34;${gl_lv}===========================================${gl_bai}\u0026#34; echo \u0026#34; 1. æŸ¥çœ‹è§„åˆ™ (å« MSS é’³åˆ¶çŠ¶æ€)\u0026#34; echo \u0026#34; 2. æ”¾è¡Œç«¯å£\u0026#34; echo \u0026#34; 3. å±è”½åœ°å€\u0026#34; echo \u0026#34; 4. åˆ é™¤è§„åˆ™\u0026#34; echo -e \u0026#34; 5. ${gl_hong}æ‰§è¡Œæ·±åº¦åŠ å›º (æ™ºèƒ½æ£€æµ‹ç¯å¢ƒï¼Œæ‹’ç»å†—ä½™è§„åˆ™)${gl_bai}\u0026#34; echo -e \u0026#34; 6. ${gl_huang}ç´§æ€¥æ¢å¤å…¨å¼€ (é‡ç½®æ‰€æœ‰ç­–ç•¥)${gl_bai}\u0026#34; echo \u0026#34; 7. æ‰‹åŠ¨æŒä¹…åŒ–ä¿å­˜\u0026#34; echo \u0026#34; 0. é€€å‡ºè„šæœ¬\u0026#34; echo \u0026#34;-------------------------------------------\u0026#34; read -e -p \u0026#34;è¯·é€‰æ‹©: \u0026#34; choice case $choice in 1) view_rules ;; 2) allow_port_flexible ;; 3) block_ip ;; 4) delete_rule ;; 5) close_all_but_ssh ;; 6) open_all_ports ;; 7) save_rules; sleep 2 ;; 0) exit 0 ;; *) echo \u0026#34;æ— æ•ˆé€‰æ‹©\u0026#34;; sleep 1 ;; esac done } iptables_panel EOF chmod +x iptables_manager.sh ./iptables_manager.sh ä½¿ç”¨æ³¨æ„ æ‰§è¡Œåé€‰æ‹© 5ï¼Œç³»ç»Ÿå°†åªæ ¹æ®ä½ çœŸå®å®‰è£…çš„ç»„ä»¶å†™å…¥å¿…éœ€çš„è½¬å‘è§„åˆ™ã€‚ ","permalink":"https://hanigege.github.io/posts/linux/ubuntu2026iptables+mss%E9%98%B2%E7%81%AB%E5%A2%99%E7%AE%A1%E7%90%86%E4%B8%80%E9%94%AE%E8%84%9A%E6%9C%AC/","tags":null,"title":"2026ç‰ˆUbuntu\u0026Debianä¸‹iptables+mssé˜²ç«å¢™ç®¡ç†ä¸€é”®è„šæœ¬"},{"categories":["linux"],"contents":"\nå®‰è£… Neovim (\u003e= 0.10.0) 1. å®‰è£…neovim (Debian13\u0026amp;Ubuntu25.10+)(è‡ªåŠ¨è·å–æœ€æ–°ç‰ˆï¼Œå¿…é¡»æ˜¯é»˜è®¤ \u0026gt;= 0.10.x) apt update \u0026amp;\u0026amp; apt install neovim éªŒè¯ç‰ˆæœ¬ä¿¡æ¯ nvim --version | grep ^NVIM å®‰è£…æ ¼å¼åŒ–ä¸å‰ªè´´æ¿ä¾èµ–ç¯å¢ƒ è¦è®© conform.nvim æˆåŠŸè°ƒç”¨ prettierï¼Œä»¥åŠä¿è¯ç³»ç»Ÿä¸ Neovim ä¹‹é—´çš„å‰ªè´´æ¿äº¤äº’é¡ºç•…ï¼Œå¿…é¡»åœ¨æ“ä½œç³»ç»Ÿå±‚é¢å®‰è£…ä»¥ä¸‹å·¥å…·ï¼š\n\u0026ndash;Debian13\u0026ndash;:\n2. å®‰è£… Node.js å’Œ npm (æä¾›è¿è¡Œç¯å¢ƒ), xclip (æä¾›å‰ªè´´æ¿æ”¯æŒ) sudo apt update \u0026amp;\u0026amp; sudo apt install -y nodejs npm xclip 3. å…¨å±€å®‰è£… Prettier sudo npm install -g prettier 4. æ¸…ç†æ—§ç¯å¢ƒ rm -rf ~/.config/nvim ~/.local/share/nvim ~/.local/state/nvim ~/.cache/nvim mkdir -p ~/.config/nvim 5. å†™å…¥é…ç½® cat \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; \u0026gt; ~/.config/nvim/init.lua -- [åŸºç¡€è®¾ç½®] vim.g.mapleader = \u0026#34;;\u0026#34; local opt = vim.opt opt.number = true opt.relativenumber = true opt.cursorline = true opt.termguicolors = true opt.encoding = \u0026#34;utf-8\u0026#34; opt.mouse = \u0026#34;a\u0026#34; opt.timeoutlen = 300 opt.splitright = true opt.splitbelow = true -- [å®‰è£… lazy.nvim] local lazypath = vim.fn.stdpath(\u0026#34;data\u0026#34;) .. \u0026#34;/lazy/lazy.nvim\u0026#34; if not vim.loop.fs_stat(lazypath) then vim.fn.system({ \u0026#34;git\u0026#34;, \u0026#34;clone\u0026#34;, \u0026#34;--filter=blob:none\u0026#34;, \u0026#34;https://github.com/folke/lazy.nvim.git\u0026#34;, \u0026#34;--branch=stable\u0026#34;, lazypath, }) end vim.opt.rtp:prepend(lazypath) -- [æ’ä»¶é…ç½®] require(\u0026#34;lazy\u0026#34;).setup({ -- 1. ä¸»é¢˜ (Onedark) { \u0026#34;navarasu/onedark.nvim\u0026#34;, lazy = false, priority = 1000, config = function() require(\u0026#34;onedark\u0026#34;).setup({ style = \u0026#39;dark\u0026#39; }) require(\u0026#34;onedark\u0026#34;).load() -- æŠ¤çœ¼æ¨¡å¼ä¿®å¤ local hl = vim.api.nvim_set_hl hl(0, \u0026#34;Normal\u0026#34;, { bg = \u0026#34;#1e2127\u0026#34;, fg = \u0026#34;#abb2bf\u0026#34; }) hl(0, \u0026#34;CursorLine\u0026#34;, { bg = \u0026#34;#2c313a\u0026#34; }) end }, -- 2. æ–‡ä»¶æ ‘ (NvimTree) { \u0026#34;nvim-tree/nvim-tree.lua\u0026#34;, dependencies = { \u0026#34;nvim-tree/nvim-web-devicons\u0026#34; }, config = function() require(\u0026#34;nvim-tree\u0026#34;).setup({ view = { width = 30 }, renderer = { indent_markers = { enable = true } } }) end }, -- 3. è¿œç¨‹å¤åˆ¶ (OSC 52) { \u0026#34;ojroques/nvim-osc52\u0026#34;, config = function() require(\u0026#39;osc52\u0026#39;).setup() vim.api.nvim_create_autocmd(\u0026#34;TextYankPost\u0026#34;, { callback = function() if vim.v.event.operator == \u0026#34;y\u0026#34; and vim.v.event.regname == \u0026#34;\u0026#34; then require(\u0026#39;osc52\u0026#39;).copy_register(\u0026#34;\u0026#34;) end end, }) end }, -- 4. ä»£ç æ ¼å¼åŒ– (Conform) { \u0026#34;stevearc/conform.nvim\u0026#34;, config = function() require(\u0026#34;conform\u0026#34;).setup({ formatters_by_ft = { json = { \u0026#34;prettier\u0026#34; }, yaml = { \u0026#34;prettier\u0026#34; }, html = { \u0026#34;prettier\u0026#34; }, css = { \u0026#34;prettier\u0026#34; }, javascript = { \u0026#34;prettier\u0026#34; }, typescript = { \u0026#34;prettier\u0026#34; }, }, format_on_save = { timeout_ms = 1000, lsp_fallback = true }, }) end } }) -- [å¿«æ·é”®æ˜ å°„] local map = vim.keymap.set -- åŸºç¡€åŠŸèƒ½ map(\u0026#34;n\u0026#34;, \u0026#34;\u0026lt;leader\u0026gt;w\u0026#34;, \u0026#34;:w\u0026lt;CR\u0026gt;\u0026#34;, { silent = true }) map(\u0026#34;n\u0026#34;, \u0026#34;\u0026lt;leader\u0026gt;q\u0026#34;, \u0026#34;:q\u0026lt;CR\u0026gt;\u0026#34;, { silent = true }) map(\u0026#34;n\u0026#34;, \u0026#34;\u0026lt;CR\u0026gt;\u0026#34;, \u0026#34;:noh\u0026lt;CR\u0026gt;\u0026lt;CR\u0026gt;\u0026#34;, { silent = true }) -- æ™ºèƒ½æ–‡ä»¶æ ‘æ¥å›åˆ‡æ¢ (;t) map(\u0026#34;n\u0026#34;, \u0026#34;\u0026lt;leader\u0026gt;t\u0026#34;, function() local view = require(\u0026#34;nvim-tree.view\u0026#34;) if view.is_visible() then if vim.api.nvim_get_current_win() == view.get_winnr() then vim.cmd(\u0026#34;wincmd p\u0026#34;) else vim.cmd(\u0026#34;NvimTreeFocus\u0026#34;) end else vim.cmd(\u0026#34;NvimTreeToggle\u0026#34;) end end, { silent = true }) -- æ ¼å¼åŒ– (;f) map({ \u0026#34;n\u0026#34;, \u0026#34;v\u0026#34; }, \u0026#34;\u0026lt;leader\u0026gt;f\u0026#34;, function() require(\u0026#34;conform\u0026#34;).format({ lsp_fallback = true, timeout_ms = 1000 }) print(\u0026#34;âœ¨ Format executed\u0026#34;) end, { silent = true }) -- çª—å£å¯¼èˆª map(\u0026#34;n\u0026#34;, \u0026#34;\u0026lt;C-h\u0026gt;\u0026#34;, \u0026#34;\u0026lt;C-w\u0026gt;h\u0026#34;) map(\u0026#34;n\u0026#34;, \u0026#34;\u0026lt;C-l\u0026gt;\u0026#34;, \u0026#34;\u0026lt;C-w\u0026gt;l\u0026#34;) map(\u0026#34;n\u0026#34;, \u0026#34;\u0026lt;C-j\u0026gt;\u0026#34;, \u0026#34;\u0026lt;C-w\u0026gt;j\u0026#34;) map(\u0026#34;n\u0026#34;, \u0026#34;\u0026lt;C-k\u0026gt;\u0026#34;, \u0026#34;\u0026lt;C-w\u0026gt;k\u0026#34;) EOF é…ç½®å®Œæˆåï¼Œè¾“å…¥ nvim å¯åŠ¨ï¼ŒæŒ‰å›è½¦è®©å®ƒè‡ªåŠ¨ä¸‹è½½å¹¶éƒ¨ç½²æ‰€æœ‰æ’ä»¶å³å¯ã€‚ æ ¸å¿ƒç‰¹æ€§ï¼š æ™ºèƒ½åˆ‡æ¢ï¼šä½¿ç”¨ ;t åœ¨æ–‡ä»¶æ ‘ä¸ä»£ç ä¹‹é—´æ¥å›è·³è½¬ã€‚\næ ¼å¼åŒ–ï¼šä½¿ç”¨ ;f æ‰‹åŠ¨æ ¼å¼åŒ–ï¼Œæˆ– ;w ä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ– ;qé€€å‡ºï¼Œå…¶å®ƒå’Œvimå‘½ä»¤æ— å¼‚ï¼Œæ”¯æŒè·¨ç»ˆç«¯å¤åˆ¶ç²˜è´´ï¼Œå¤åˆ¶å¿«æ·é”®ä¸€ä¸ªå­—ç¬¦ y ã€‚\n","permalink":"https://hanigege.github.io/posts/linux/debianmac%E4%B8%8Bnvim%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%85%A8%E5%AE%B6%E6%A1%B6%E5%AE%89%E8%A3%85/","tags":null,"title":"Debianä¸‹nvimæ ¼å¼åŒ–å…¨å®¶æ¡¶å®‰è£…"},{"categories":["freebsd"],"contents":"\næ–°å»ºè„šæœ¬æ–‡ä»¶ nvim pf_manager.sh å¤åˆ¶ä¸‹é¢çš„é…ç½® #!/bin/sh # FreeBSD 15 PF äº¤äº’å¼é˜²ç«å¢™ç®¡ç†è„šæœ¬ - ç»ˆæç‰ˆ STATE_FILE=\u0026#34;/etc/pf_ports.list\u0026#34; PF_CONF=\u0026#34;/etc/pf.conf\u0026#34; if [ \u0026#34;$(id -u)\u0026#34; != \u0026#34;0\u0026#34; ]; then echo \u0026#34;é”™è¯¯ï¼šå¿…é¡»ä½¿ç”¨ root æƒé™è¿è¡Œã€‚\u0026#34; exit 1 fi get_active_ssh_ports() { ports=$(sockstat -46 -l -P tcp | grep -E \u0026#39;\\bsshd\\b\u0026#39; | awk \u0026#39;{print $6}\u0026#39; | awk -F\u0026#39;:\u0026#39; \u0026#39;{print $NF}\u0026#39; | sort -u) if [ -z \u0026#34;$ports\u0026#34; ]; then echo \u0026#34;22\u0026#34;; else echo \u0026#34;$ports\u0026#34;; fi } init_env() { if ! grep -q \u0026#34;^pf_enable=\\\u0026#34;YES\\\u0026#34;\u0026#34; /etc/rc.conf; then sysrc pf_enable=\u0026#34;YES\u0026#34; \u0026gt;/dev/null service pf start \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 fi [ ! -f \u0026#34;$STATE_FILE\u0026#34; ] \u0026amp;\u0026amp; init_zero } init_zero() { \u0026gt; \u0026#34;$STATE_FILE\u0026#34; active_ports=$(get_active_ssh_ports) for port in $active_ports; do echo \u0026#34;tcp $port\u0026#34; \u0026gt;\u0026gt; \u0026#34;$STATE_FILE\u0026#34; done apply_rules \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 echo \u0026#34;âœ… å·²æ¸…ç©ºæ‰€æœ‰è‡ªå®šä¹‰è§„åˆ™ã€‚\u0026#34; echo \u0026#34;ğŸ”’ è‡ªåŠ¨æ£€æµ‹å¹¶æ”¾è¡Œå½“å‰æ´»åŠ¨ SSH ç«¯å£: [ $active_ports ]\u0026#34; } apply_rules() { cat \u0026lt;\u0026lt;EOF \u0026gt; \u0026#34;$PF_CONF\u0026#34; # å®å®šä¹‰ä¸å…¨å±€é€‰é¡¹ set skip on lo0 set block-policy drop # æµé‡æ¸…ç† scrub in all fragment reassemble # åŸºç¡€è¿‡æ»¤è§„åˆ™ (çŠ¶æ€æœºåˆ¶å¤„ç†æ–°è€è¿æ¥) block in all pass out all keep state pass in quick inet proto icmp all icmp-type echoreq keep state EOF if grep -q \u0026#34;^ALL PORTS OPEN$\u0026#34; \u0026#34;$STATE_FILE\u0026#34;; then echo \u0026#34;pass in quick all keep state\u0026#34; \u0026gt;\u0026gt; \u0026#34;$PF_CONF\u0026#34; else while read -r proto port; do [ -z \u0026#34;$proto\u0026#34; ] || [ -z \u0026#34;$port\u0026#34; ] \u0026amp;\u0026amp; continue echo \u0026#34;pass in quick inet proto $proto from any to any port $port keep state\u0026#34; \u0026gt;\u0026gt; \u0026#34;$PF_CONF\u0026#34; done \u0026lt; \u0026#34;$STATE_FILE\u0026#34; fi pfctl -nf \u0026#34;$PF_CONF\u0026#34; \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 if [ $? -eq 0 ]; then pfctl -f \u0026#34;$PF_CONF\u0026#34; \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 echo \u0026#34;âœ… è§„åˆ™å·²æˆåŠŸæ›´æ–°å¹¶ç”Ÿæ•ˆï¼\u0026#34; else echo \u0026#34;âŒ è§„åˆ™è¯­æ³•é”™è¯¯ï¼Œæœªåº”ç”¨æ›´æ”¹ï¼\u0026#34; fi } view_rules() { echo \u0026#34;--- å½“å‰ç³»ç»Ÿç”Ÿæ•ˆçš„ PF è§„åˆ™ (pfctl -sr) ---\u0026#34; pfctl -sr echo \u0026#34;------------------------------------------\u0026#34; } open_port() { read -p \u0026#34;è¯·è¾“å…¥è¦å¼€æ”¾çš„ç«¯å£å· (1-65535): \u0026#34; port if ! [ \u0026#34;$port\u0026#34; -eq \u0026#34;$port\u0026#34; ] 2\u0026gt;/dev/null || [ \u0026#34;$port\u0026#34; -lt 1 ] || [ \u0026#34;$port\u0026#34; -gt 65535 ]; then echo \u0026#34;é”™è¯¯ï¼šç«¯å£å·æ— æ•ˆã€‚\u0026#34; return fi echo \u0026#34;è¯·é€‰æ‹©åè®®: 1) TCP 2) UDP 3) TCP å’Œ UDP\u0026#34; read -p \u0026#34;è¾“å…¥é€‰é¡¹ (1/2/3): \u0026#34; proto_opt sed -i \u0026#39;\u0026#39; \u0026#39;/^ALL PORTS OPEN$/d\u0026#39; \u0026#34;$STATE_FILE\u0026#34; case $proto_opt in 1) grep -q \u0026#34;^tcp $port$\u0026#34; \u0026#34;$STATE_FILE\u0026#34; || echo \u0026#34;tcp $port\u0026#34; \u0026gt;\u0026gt; \u0026#34;$STATE_FILE\u0026#34; ;; 2) grep -q \u0026#34;^udp $port$\u0026#34; \u0026#34;$STATE_FILE\u0026#34; || echo \u0026#34;udp $port\u0026#34; \u0026gt;\u0026gt; \u0026#34;$STATE_FILE\u0026#34; ;; 3) grep -q \u0026#34;^tcp $port$\u0026#34; \u0026#34;$STATE_FILE\u0026#34; || echo \u0026#34;tcp $port\u0026#34; \u0026gt;\u0026gt; \u0026#34;$STATE_FILE\u0026#34; grep -q \u0026#34;^udp $port$\u0026#34; \u0026#34;$STATE_FILE\u0026#34; || echo \u0026#34;udp $port\u0026#34; \u0026gt;\u0026gt; \u0026#34;$STATE_FILE\u0026#34; ;; *) echo \u0026#34;é”™è¯¯ï¼šæ— æ•ˆé€‰é¡¹ã€‚\u0026#34; ; return ;; esac apply_rules } delete_port() { read -p \u0026#34;è¯·è¾“å…¥è¦å…³é—­çš„ç«¯å£å·: \u0026#34; port if grep -q \u0026#34; $port$\u0026#34; \u0026#34;$STATE_FILE\u0026#34;; then sed -i \u0026#39;\u0026#39; \u0026#34;/ $port$/d\u0026#34; \u0026#34;$STATE_FILE\u0026#34; apply_rules else echo \u0026#34;è¯¥ç«¯å£æœªåœ¨ç®¡ç†åˆ—è¡¨ä¸­ã€‚\u0026#34; fi } open_all_ports() { echo \u0026#34;âš ï¸ è­¦å‘Šï¼šè¿™å°†æ”¾è¡Œæ‰€æœ‰å…¥ç«™æµé‡ï¼\u0026#34; read -p \u0026#34;ç¡®è®¤æ‰§è¡Œï¼Ÿ(y/n): \u0026#34; confirm [ \u0026#34;$confirm\u0026#34; = \u0026#34;y\u0026#34; ] || [ \u0026#34;$confirm\u0026#34; = \u0026#34;Y\u0026#34; ] \u0026amp;\u0026amp; { echo \u0026#34;ALL PORTS OPEN\u0026#34; \u0026gt; \u0026#34;$STATE_FILE\u0026#34;; apply_rules; } } init_env while true; do echo \u0026#34;\u0026#34; echo \u0026#34;=== PF é˜²ç«å¢™ç®¡ç†èœå• ===\u0026#34; echo \u0026#34;1. æŸ¥çœ‹å½“å‰åº•å±‚ç”Ÿæ•ˆè§„åˆ™\u0026#34; echo \u0026#34;2. æŸ¥çœ‹å·²å¼€æ”¾ç«¯å£åˆ—è¡¨\u0026#34; echo \u0026#34;3. å¼€æ”¾æ–°ç«¯å£ (æ”¯æŒ TCP/UDP)\u0026#34; echo \u0026#34;4. åˆ é™¤/å…³é—­ç«¯å£\u0026#34; echo \u0026#34;5. å…³é—­æ‰€æœ‰ç«¯å£å¹¶ä»é›¶å¼€å§‹ (ä¿ç•™å½“å‰æ´»åŠ¨ SSH ç«¯å£)\u0026#34; echo \u0026#34;6. å¼€æ”¾æ‰€æœ‰ç«¯å£ (é«˜å±)\u0026#34; echo \u0026#34;0. é€€å‡º\u0026#34; read -p \u0026#34;è¯·é€‰æ‹©æ“ä½œ [0-6]: \u0026#34; choice case $choice in 1) view_rules ;; 2) echo \u0026#34;--- å½“å‰ç®¡ç†çš„ç«¯å£ ---\u0026#34;; cat \u0026#34;$STATE_FILE\u0026#34; ;; 3) open_port ;; 4) delete_port ;; 5) echo \u0026#34;âš ï¸ è­¦å‘Šï¼šè¿™å°†æ¸…é™¤æ‰€æœ‰è®°å½•ï¼Œå¹¶é‡æ–°æŠ“å–å½“å‰ SSH ç«¯å£ä½œä¸ºå”¯ä¸€æ”¾è¡Œè§„åˆ™ï¼\u0026#34; read -p \u0026#34;ç¡®è®¤æ‰§è¡Œï¼Ÿ(y/n): \u0026#34; confirm [ \u0026#34;$confirm\u0026#34; = \u0026#34;y\u0026#34; ] || [ \u0026#34;$confirm\u0026#34; = \u0026#34;Y\u0026#34; ] \u0026amp;\u0026amp; init_zero ;; 6) open_all_ports ;; 0) exit 0 ;; *) echo \u0026#34;æ— æ•ˆé€‰é¡¹ã€‚\u0026#34; ;; esac done æ·»åŠ æƒé™å¹¶æ‰§è¡Œ chmod +x iptables_manager.sh ./iptables_manager.sh ","permalink":"https://hanigege.github.io/posts/freebsd/freebsd15-pf-js/","tags":null,"title":"FreeBSD 15 PF ç»ˆæäº¤äº’å¼ç®¡ç†è„šæœ¬"},{"categories":["routers"],"contents":"vyosä¸Šé…ç½®wireguard ï¼ˆIPV4ï¼‰ 1. ç”Ÿæˆ WireGuard å¯†é’¥ wg genkey | tee privatekey | wg pubkey \u0026gt; publickey â€¢ privatekey æ–‡ä»¶ä¸­å­˜å‚¨ ç§é’¥\nâ€¢ publickey æ–‡ä»¶ä¸­å­˜å‚¨ å…¬é’¥\nç„¶åä½¿ç”¨ï¼š\ncat privatekey æŠŠç§é’¥å¡«å…¥ ç¬¬ä¸€æ­¥ çš„ \u0026lt;æœåŠ¡å™¨ç§é’¥\u0026gt; ä½ç½®ã€‚\né…ç½®wireguard:\nset interfaces wireguard wg0 address \u0026#39;10.20.30.1/24\u0026#39; set interfaces wireguard wg0 port \u0026#39;11133\u0026#39; set interfaces wireguard wg0 private-key \u0026#39;private-key\u0026#39; set interfaces wireguard wg0 peer iphone allowed-ips \u0026#39;10.20.30.2/32\u0026#39; set interfaces wireguard wg0 peer iphone public-key \u0026#39;public-key\u0026#39; set interfaces wireguard wg0 peer iphone preshared-key \u0026#39;preshared-key\u0026#39; ä¸Šé¢è¿™æ˜¯æ·»åŠ è¿‡peerçš„ã€‚\nå¦‚æœè®©wgç§‘å­¦ï¼Œä¸‹é¢æ¥ç€æ“ä½œï¼š\næ·»åŠ ç»„ï¼š set firewall group network-group LAN-v4 network \u0026#39;10.20.20.0/24\u0026#39; # å†…ç½‘æ®µ set firewall group network-group LAN-v4 network \u0026#39;10.20.23.0/24\u0026#39; # wgç½‘æ®µ set firewall group ipv6-network-group LAN-v6 network \u0026#39;fd88::/64\u0026#39; è®¾ç½®ç­–ç•¥è·¯ç”±: ä¸¾ä¾‹: è®©wg0çš„æµé‡èµ°100å·è·¯ç”±è¡¨, 100å·è·¯ç”±è¡¨æ˜¯sbçš„è·¯ç”±è¡¨ set policy route WG0-to-SB interface \u0026#39;wg0\u0026#39; set policy route WG0-to-SB rule 10 destination group network-group \u0026#39;!LAN-v4\u0026#39; set policy route WG0-to-SB rule 10 set table \u0026#39;100\u0026#39; # è¿™ä¸‹é¢ä¸‰æ¡ä»…ä¾›å‚è€ƒï¼Œæ·»åŠ åç”µæŠ¥å®¹æ˜“æ–­è¿ã€‚ set policy route6 WG0-to-SB interface \u0026#39;wg0\u0026#39; set policy route6 WG0-to-SB rule 10 destination group network-group \u0026#39;!LAN-v6\u0026#39; set policy route6 WG0-to-SB rule 10 set table \u0026#39;106\u0026#39; #è·¯ç”±è¡¨ï¼ˆä¹‹å‰æ·»åŠ è¿‡å°±ä¸è¦é‡å¤æ·»åŠ ï¼‰ set protocols static table 100 route 0.0.0.0/0 next-hop 10.20.20.9 or set protocols static table 100 route 0.0.0.0/0 next-hop 172.23.0.99 set protocols static table 100 route 0.0.0.0/0 next-hop 192.168.100.9 set protocols static table 106 route6 ::/0 next-hop fd88::9999 ----- Happy Routing! 2.vyosä¸Šé…ç½®wireguard ï¼ˆIPV4ï¼‰é¢„å…±äº«å¯†é’¥ é…ç½® WireGuard çš„ é¢„å…±äº«å¯†é’¥ï¼ˆPreshared Keyï¼Œç®€ç§° PSKï¼‰ï¼Œå¯ä»¥ä¸ºç°æœ‰çš„å…¬ç§é’¥æ¡æ‰‹å†åŠ ä¸€å±‚åŠ å¯†ï¼Œæå‡å®‰å…¨æ€§ã€‚\nğŸ§© PSK æ˜¯ä»€ä¹ˆï¼Ÿ é¢„å…±äº«å¯†é’¥æ˜¯åœ¨é€šä¿¡åŒæ–¹ç§ä¸‹å…±äº«çš„é¢å¤–å¯†é’¥ï¼Œç”¨ä½œå¯¹ç§°åŠ å¯†ï¼ˆæ··æ·† DH å¯†é’¥åå•†ç»“æœï¼‰ï¼Œæé«˜æŠµæŠ—é‡å­è®¡ç®—ç ´è§£çš„èƒ½åŠ›\nâœ… å¦‚ä½•ç”Ÿæˆ PSK åœ¨ VyOS æˆ–å®¢æˆ·ç«¯ï¼ˆéƒ½å¯ä»¥ï¼‰æ‰§è¡Œï¼š\nwg genpsk \u0026gt; psk.key æŸ¥çœ‹å†…å®¹ï¼š\ncat psk.key ä¼šè¾“å‡ºä¸€ä¸² Base64 ç¼–ç çš„å¯†é’¥ï¼Œæ¯”å¦‚ï¼š\nzT4XEDXe9qJpKRgqz0VjdRm2Vu+I+ZYoY7vI99aAv0Q= ğŸ§© åœ¨ VyOS ä¸­æ·»åŠ  PSK å‡è®¾ä½ å·²æœ‰å¦‚ä¸‹ WireGuard é…ç½®ï¼š\nset interfaces wireguard wg0 address \u0026#39;10.20.30.1/24\u0026#39; set interfaces wireguard wg0 port \u0026#39;51820\u0026#39; set interfaces wireguard wg0 peer iphone public-key \u0026#39;xxx...=\u0026#39; åŠ å…¥ PSK çš„å‘½ä»¤å¦‚ä¸‹ï¼š\nset interfaces wireguard wg0 peer iphone preshared-key \u0026#39;zT4XEDXe9qJpKRgqz0VjdRm2Vu+I+ZYoY7vI99aAv00= ","permalink":"https://hanigege.github.io/posts/routers/vyos-wireguard-ipv4/","tags":null,"title":"Vyos Wireguard Ipv4"},{"categories":["linux"],"contents":"\npveä¸‹å®‰è£…ubuntuæˆ–è€…debian.ç„¶åçœ‹ä¸‹é¢ckä½¬çš„æ•™ç¨‹æ“ä½œï¼š\nwg-easy.zip\nå®‰è£…æ•™ç¨‹ 1ã€è¿ç§»ä»£ç  å¤åˆ¶appæ–‡ä»¶å¤¹åˆ° /app 2ã€å®‰è£…ä¾èµ– apt update apt install -y wireguard iptables curl -fsSL https://deb.nodesource.com/setup_22.x | sudo bash - sudo apt-get install -y nodejs sudo npm install -g npm@11.3.0 bcryptjs debug express-session h3 qrcode 3ã€é…ç½®ç¯å¢ƒ export NODE_PATH=/usr/lib/node_modules echo \u0026#34;export NODE_PATH=/usr/lib/node_modules\u0026#34; \u0026gt;\u0026gt; ~/.bashrc source ~/.bashrc 4ã€å¯ç”¨ IPv4 å’Œ IPv6 è½¬å‘ sudo sysctl -w net.ipv4.ip_forward=1 sudo sysctl -w net.ipv6.conf.all.forwarding=1 sudo bash -c \u0026#39;echo \u0026#34;net.ipv4.ip_forward = 1\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.conf\u0026#39; sudo bash -c \u0026#39;echo \u0026#34;net.ipv6.conf.all.forwarding = 1\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.conf\u0026#39; sudo sysctl -p 5ã€é…ç½® systemd æœåŠ¡ å¤åˆ¶wg-easy.serviceåˆ° /etc/systemd/system/ chmod +x /etc/systemd/system/wg-easy.service systemctl enable wg-easy.service systemctl start wg-easy.service systemctl status wg-easy.service ç™»å½•WebUIï¼š http://ip:51821/ è¯¦ç»†å‚æ•°è¯·ä¿®æ”¹ /app/config.js ç‰¹åˆ«è¯´æ˜ï¼šè·¯ç”±è¿™é‡Œå¦‚æœæœ‰é‡åˆ°å±è”½å¤§é™†çš„ç½‘é¡µæ‰“ä¸å¼€çš„ï¼Œå°±å»ºè®®å¡«å†™ï¼š\n0.0.0.0/0ï¼Œ::/0 ","permalink":"https://hanigege.github.io/posts/linux/ck%E4%BD%AC%E7%9A%84wg-easy%E4%B8%80%E9%94%AE%E8%84%9A%E6%9C%AC%E7%A8%8B%E5%BA%8F/","tags":null,"title":"CKä½¬çš„wg-Easyä¸€é”®è„šæœ¬ç¨‹åº"},{"categories":["freebsd"],"contents":"FreeBSD14ä¸‹é…ç½®æœåŠ¡å™¨ç«¯Hysteria2 æˆ‘çš„ç³»ç»Ÿæ˜¯FreeBSD14çš„ï¼Œå®˜æ–¹æä¾›çš„æ— æ³•æ­£å¸¸è¿è¡Œï¼Œä¸çŸ¥é“ï¼Œæ˜¯ä»€ä¹ˆåŸå› ã€‚\nåªå¥½åœ¨è‡ªå·±çš„buildä¸€ä¸ªï¼Œä¸è¿‡è¿˜å¥½å¾ˆç®€å•ã€‚å»ºè®®ç”¨å¥½ä¸€ç‚¹çš„VPSæ¥buildï¼Œç”¨å›½å†…çš„ï¼Œå„ç§time outã€‚\nå‡†å¤‡\n1ï¼Œè½¯ä»¶å‡†å¤‡ pkg install python39 go121 git æ³¨æ„goç‰ˆæœ¬ä¸€å®šè¦121çš„ï¼Œå‰é¢æˆ‘å®‰è£…120ï¼Œä¸è¡Œï¼Œåªèƒ½é‡æ–°å®‰è£…121ç‰ˆæœ¬çš„ã€‚(æˆ‘åæœŸç”¨çš„æ˜¯è‡ªç¼–è¯‘1.23çš„go)\nè¿˜è¦è®°å¾—å»ºä¸ªé“¾æ‹‰ï¼Œè¦ä¸ï¼Œç³»ç»Ÿè€æç¤ºGoæ²¡å®‰è£…\ncd /usr/local/bin ln -s go121 go ```bash ## 2ï¼ŒåŒæ­¥ä»£ç  ```bash git clone https://github.com/apernet/hysteria.git ```bash ## 3,ç¼–è¯‘ è¿›å…¥æºä»£ç ç›®å½•æ‰§è¡Œï¼š ```bash python hyperbole.py build ç­‰å¾…å‡ åˆ†é’Ÿï¼Œå°±OKäº†ï¼Œç¼–è¯‘çš„ç¨‹åºåœ¨buildç›®å½•ä¸‹é¢ã€‚\né…ç½®æœåŠ¡å™¨ç«¯ 1ï¼Œé…ç½®config.yaml åªè¦åˆ›å»ºä¸€ä¸ªconfig.yamlæ–‡ä»¶ï¼Œè¾“å…¥ç›¸å…³ä¿¡æ¯ï¼Œç„¶åæŠŠæ–‡ä»¶æ”¾åˆ°/usr/local/etcç›®å½•ä¸‹é¢ã€‚\nconfig.yamlä¿¡æ¯å¦‚ä¸‹ï¼š\n# listen: :443 tls: cert: æ”¹æˆä½ çš„certè·¯å¾„ key: æ”¹æˆä½ çš„Keyè·¯å¾„ auth: type: password password: æ”¹æˆä½ çš„å¯†ç  bandwidth: up: 1 gbps #æ”¹æˆä½ çš„VPSä¸Šè¡Œå¸¦å®½ down: 1 gbps #æ”¹æˆä½ PVSä¸‹è¡Œå¸¦å®½ masquerade: type: proxy proxy: url: https://www.bing.com/ #æ”¹æˆä½ ä¼ªè£…çš„ç½‘ç«™ rewriteHost: true listenHTTP: :80 #å®˜æ–¹çš„è§£é‡Šï¼šæœ¬åŠŸèƒ½ä»…ä¸ºæ‰§ç€äº \u0026#34;åšæˆåšå…¨å¥—\u0026#34; çš„ç”¨æˆ·æä¾›ã€‚æ—¢ç„¶è¦ \u0026#34;åšæˆåšå…¨å¥—\u0026#34;ï¼Œå°±æ²¡æœ‰ç†ç”±å°† HTTP/HTTPS ç›‘å¬åœ¨ 80/443 ä¹‹å¤–çš„è‡ªå®šä¹‰ç«¯å£ä¸Šï¼ˆè™½ç„¶ Hysteria å…è®¸è‡ªå®šä¹‰ç›‘å¬åœ°å€ï¼‰ã€‚ listenHTTPS: :443 forceHTTPS: true 2, é…ç½®è‡ªåŠ¨å¯åŠ¨è„šæœ¬ æˆ‘ä¸ä¼šå†™ï¼Œä¹Ÿæ²¡å»æ‰¾ï¼Œéšä¾¿æ‰¾äº†ä¸ªç³»ç»Ÿè„šæœ¬ä¹±æ”¹ä¸€æ°”ã€‚è®°å¾—è„šæœ¬è¦æ”¾åˆ°/usr/local/etc/rc.dç›®å½•ä¸‹\næ³¨æ„ï¼šç¼–è¯‘çš„æ–‡ä»¶åæ˜¯ï¼šhysteria-freebsd-amd64ï¼Œæˆ‘å«Œå®ƒå¤ªé•¿äº†ï¼Œæ‹·è´äº†ä»½çŸ­æ–‡ä»¶åçš„æ¥ç”¨:\ncp hysteria-freebsd-amd64 hysteria cp hysteria /usr/local/bin #!/bin/sh # PROVIDE: hysteria # REQUIRE: LOGIN # KEYWORD: shutdown # Add these lines to /etc/rc.conf.local or /etc/rc.conf to enable `hysteria\u0026#39;: # # hysteria_enable (bool): Set to \u0026#34;NO\u0026#34; by default. # Set it to \u0026#34;YES\u0026#34; to enable hysteria # hysteria_config (path): Set to \u0026#34;/usr/local/etc/hysteria/config.json\u0026#34; by default # Set it to the hysteria server config # hysteria_logdir (path): Set to \u0026#34;/var/log/hysteria\u0026#34; by default. # Set it to the directory of hysteria log files # hysteria_env (str): Set to \u0026#34;\u0026#34; by default. # Set it to the desired environment variables . /etc/rc.subr name=\u0026#34;hysteria\u0026#34; rcvar=\u0026#34;${name}_enable\u0026#34; : ${hysteria_enable=\u0026#34;NO\u0026#34;} : ${hysteria_logdir=\u0026#34;/var/log/${name}\u0026#34;} : ${hysteria_env=\u0026#34;\u0026#34;} : ${hysteria_user=\u0026#34;root\u0026#34;} : ${hysteria_group=\u0026#34;wheel\u0026#34;} pidfile=\u0026#34;/var/run/$name.pid\u0026#34; procname=\u0026#34;/usr/local/bin/$name\u0026#34; command=\u0026#34;/usr/sbin/daemon\u0026#34; command_args=\u0026#34;-c -p ${pidfile} /usr/bin/env ${asset_env} ${hysteria_env} ${procname} server -c /usr/local/etc/config.yaml\u0026#34; start_precmd=\u0026#34;hysteria_startprecmd\u0026#34; hysteria_startprecmd() { touch \u0026#34;${pidfile}\u0026#34; chown ${hysteria_user}:${hysteria_group} \u0026#34;${pidfile}\u0026#34; } load_rc_config \u0026#34;$name\u0026#34; run_rc_command \u0026#34;$1\u0026#34; 3ï¼Œ è®¾ç½®è‡ªåŠ¨å¯åŠ¨ sysrc hysteria_enable=\u0026ldquo;YES\u0026rdquo;\n4, å¯åŠ¨æœåŠ¡ service hysteria start ```bash å¦‚æœè¾“å‡ºä»¥ä¸‹ä¿¡æ¯ï¼Œå°±è¯´æ˜æœåŠ¡å¯åŠ¨äº†ï¼š ```bash Starting hysteria. root@vps:~/HY # 2024-03-03T10:37:15+08:00 INFO server mode 2024-03-03T10:37:15+08:00 INFO server up and running {\u0026#34;listen\u0026#34;: \u0026#34;:443\u0026#34;} 2024-03-03T10:37:15+08:00 INFO masquerade HTTPS server up and running {\u0026#34;listen\u0026#34;: \u0026#34;:443\u0026#34;} 2024-03-03T10:37:15+08:00 INFO masquerade HTTP server up and running {\u0026#34;listen\u0026#34;: \u0026#34;:80\u0026#34;} ```bash ## Linuxä¸‹çš„æœåŠ¡å™¨ç«¯é…ç½® å®˜æ–¹æœ‰è‡ªåŠ¨è„šæœ¬ï¼Œè¿™ä¸ªå°±çœå¿ƒå¤šäº†ã€‚ æˆ‘è¯•äº†ä¸‹Debian12ã€‚ å®‰è£…æˆ–å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ï¼š ```bash bash \u0026lt;(curl -fsSL https://get.hy2.sh/) ç­‰å¾…ä¸€ä¼šï¼Œå°±è‡ªåŠ¨å®‰è£…å¥½äº†ï¼Œconfig.yamlå’ŒFreeBSSDçš„ä¸€æ ·ã€‚æŒ‰è„šæœ¬æœ€åè¾“å‡ºçš„ä¿¡æ¯æ¥å¯åŠ¨æœåŠ¡å™¨å°±OKäº†ã€‚\nå®¢æˆ·ç«¯é…ç½® Windowsé…ç½®V2rayN 1ï¼Œæ ¹æ®æœåŠ¡å™¨ä¿¡æ¯ï¼Œå…ˆåˆ›å»ºä¸ªå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ï¼Œæ–‡ä»¶åéšä¾¿èµ·ä¸€ä¸ªï¼Œå†…å®¹å¦‚ä¸‹ï¼š\nserver: æ”¹æˆä½ æœåŠ¡å™¨çš„åŸŸå:ç«¯å£å· auth: æ”¹æˆä½ æœåŠ¡å™¨çš„å¯†ç  bandwidth: up: 0 mbps #0 mbpsè¡¨ç¤ºï¼Œä¸é™é€Ÿ down: 0 mbps tls: sni: æ”¹æˆä½ æœåŠ¡å™¨åŸŸå insecure: false socks5: listen: 127.0.0.1:1080 #è¿™ä¸ªå’Œä¸‹é¢çš„é»˜è®¤å°±å¥½ http: listen: 127.0.0.1:8080 2ï¼Œé…ç½®V2rayN\n1)ç‚¹å‡»V2rayNå·¦ä¸Šè§’çš„â€æœåŠ¡å™¨â€ã€‚\n2)é€‰æ‹©â€æ·»åŠ è‡ªå®šä¹‰æœåŠ¡å™¨â€ã€‚\n3)æœåŠ¡å™¨â€åˆ«åâ€ï¼Œèµ·ä¸ªè‡ªå·±åªå–œæ¬¢çš„ï¼Œæ¯”å¦‚HYã€‚\nâ€œåœ°å€â€ï¼Œç‚¹å‡»æµè§ˆï¼Œæ‰¾åˆ°åˆšæ‰æˆ‘ä»¬åˆ›å»ºçš„å®¢æˆ·ç«¯é…ç½®æ–‡æ¡£ï¼Œwindowsä¸‹é»˜è®¤æ˜¯txtæ–‡ä»¶ï¼Œæ‰€ä»¥è¦é€‰æ‹©(All .)æ‰èƒ½çœ‹åˆ°æ–‡ä»¶ã€‚\nâ€œCoreç±»å‹â€,é€‰æ‹©â€hysteria2â€ã€‚\nâ€œSocksç«¯å£â€ï¼Œå¡«ä¸Šå‰é¢æŒ‡å®šçš„1080\n3, æ·»åŠ å®ŒæœåŠ¡å™¨ï¼Œåªè¦æ¿€æ´»æœåŠ¡å™¨ï¼Œç³»ç»Ÿä»£ç†é€‰â€è‡ªåŠ¨é…ç½®ç³»ç»Ÿä»£ç†â€ï¼Œè·¯ç”±å…ˆä½ å–œæ¬¢çš„ï¼Œæˆ‘è¦æµ‹é€Ÿï¼Œé€‰äº†â€å…¨å±€â€ã€‚\nè¾“å‡ºä»¥ä¸‹ä¿¡æ¯è¯´æ˜å¤§åŠŸå‘Šæˆäº†\n[Custom] HY å¯åŠ¨æœåŠ¡(2024/03/03 10:55:27)... 2024-03-03T10:55:27+08:00 [34mINFO[0m client mode 2024-03-03T10:55:27+08:00 [34mINFO[0m connected to server {\u0026#34;udpEnabled\u0026#34;: true, \u0026#34;tx\u0026#34;: 0, \u0026#34;count\u0026#34;: 1} 2024-03-03T10:55:27+08:00 [34mINFO[0m use this URI to share your server {\u0026#34;uri\u0026#34;: \u0026#34;***\u0026#34;} 2024-03-03T10:55:27+08:00 [34mINFO[0m HTTP proxy server listening {\u0026#34;addr\u0026#34;: \u0026#34;127.0.0.1:8080\u0026#34;} 2024-03-03T10:55:27+08:00 [34mINFO[0m SOCKS5 server listening {\u0026#34;addr\u0026#34;: \u0026#34;127.0.0.1:1080\u0026#34;} 2024/03/03 10:55:29 ç³»ç»Ÿä»£ç†è®¾ç½®æ”¹å˜ForcedChange å®‰å“æ‰‹æœºç«¯ æˆ‘åŸæ¥ç”¨çš„V2rayNGä¸æ”¯æŒï¼Œå®˜æ–¹åˆ—è¡¨ä¸­æ¨èçš„NekoBoxã€‚å¾ˆä¸é”™ï¼Œç•Œé¢å’Œv2rayNGå·®ä¸å¤šã€‚\nFreeBSD14ç³»ç»Ÿï¼Œä¸æƒ³è‡ªå·±buildçš„å…„å¼Ÿï¼Œå¯ä»¥ä¸‹è½½ï¼Œæˆ‘ç¼–è¯‘å¥½çš„ã€‚\nè€æ¢æä¾› hysteria.tar.bz2\nâ–‘â–ˆâ–‘â–ˆâ–‘â–ˆâ–‘â–ˆâ–‘â–ˆâ–€â–€â–‘â–€â–ˆâ–€â–‘â–ˆâ–€â–€â–‘â–ˆâ–€â–„â–‘â–€â–ˆâ–€â–‘â–ˆâ–€â–ˆâ–‘â–‘â–‘â–€â–€â–„ â–‘â–ˆâ–€â–ˆâ–‘â–‘â–ˆâ–‘â–‘â–€â–€â–ˆâ–‘â–‘â–ˆâ–‘â–‘â–ˆâ–€â–€â–‘â–ˆâ–€â–„â–‘â–‘â–ˆâ–‘â–‘â–ˆâ–€â–ˆâ–‘â–‘â–‘â–„â–€â–‘ â–‘â–€â–‘â–€â–‘â–‘â–€â–‘â–‘â–€â–€â–€â–‘â–‘â–€â–‘â–‘â–€â–€â–€â–‘â–€â–‘â–€â–‘â–€â–€â–€â–‘â–€â–‘â–€â–‘â–‘â–‘â–€â–€â–€ a powerful, lightning fast and censorship resistant proxy Aperture Internet Laboratory \u0026lt;https://github.com/apernet\u0026gt; Version: v2.2.4-11-g84d72ef BuildDate: 2024-03-02T12:20:39Z BuildType: dev CommitHash: 84d72ef0b37a2a261cf89e0307bd966afdc1be3b Platform: freebsd Architecture: amd64 ","permalink":"https://hanigege.github.io/posts/freebsd/freebsd%E5%AE%89%E8%A3%85hysteria2%E6%9C%8D%E5%8A%A1%E7%AB%AF/","tags":null,"title":"Freebsdå®‰è£…Hysteria2æœåŠ¡ç«¯"},{"categories":["freebsd"],"contents":"å‰ææ˜¯æ–°ç¼–è¾‘å™¨å·²ç»å®‰è£… FreeBSD ä¸‹ä½ å¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ EDITOR æ¥æ›´æ”¹ crontab -e ä½¿ç”¨çš„é»˜è®¤ç¼–è¾‘å™¨ã€‚ä¸‹é¢æ˜¯å‡ ç§å¸¸è§æ–¹æ³•ï¼š\nâœ… ä¸´æ—¶æ›´æ”¹ï¼ˆå½“å‰ shell æœ‰æ•ˆï¼‰ EDITOR=nano crontab -e æˆ–è€…ç”¨å…¶ä»–ä½ å–œæ¬¢çš„ç¼–è¾‘å™¨ï¼Œå¦‚ï¼š\nEDITOR=micro crontab -e EDITOR=ee crontab -e EDITOR=vim crontab -e âœ… æ°¸ä¹…æ›´æ”¹ï¼ˆåŠ åˆ° shell å¯åŠ¨æ–‡ä»¶ï¼‰ å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ sh æˆ– bashï¼Œå¯ä»¥å°†ä»¥ä¸‹å†…å®¹åŠ åˆ° ~/.profile æˆ– ~/.bashrcæˆ– ~/bash_profileï¼š\nexport EDITOR=nano å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ tcshï¼ˆFreeBSD é»˜è®¤ï¼‰ï¼Œè¯·åŠ åˆ° ~/.cshrc æ–‡ä»¶ä¸­ï¼š\nsetenv EDITOR nano ç„¶åæ‰§è¡Œï¼š\nsource ~/.cshrc ğŸ“¦ è¡¥å……æç¤ºï¼šå®‰è£…ç®€æ˜“ç¼–è¾‘å™¨ å¦‚æœä½ æƒ³ç”¨ nano ä½†ç³»ç»Ÿæ²¡æœ‰ï¼Œå¯ä»¥ç”¨ pkg å®‰è£…ï¼š\nsudo pkg install nano ","permalink":"https://hanigege.github.io/posts/freebsd/freebsd%E6%9B%B4%E6%94%B9%E9%BB%98%E8%AE%A4%E7%BC%96%E8%BE%91%E5%99%A8vi/","tags":null,"title":"Freebsdæ›´æ”¹é»˜è®¤ç¼–è¾‘å™¨vi"},{"categories":["freebsd"],"contents":"IPFIREWALL (IPFWï¼ŒIP é˜²ç«å¢™) æ˜¯ä¸€æ¬¾ç”± FreeBSD å‘èµ·çš„é˜²ç«å¢™åº”ç”¨è½¯ä»¶ï¼Œå®ƒç”± FreeBSD é¡¹ç›®ç¼–å†™å’Œç»´æŠ¤ã€‚ ipfw åœ¨åŸºæœ¬ç³»ç»Ÿçš„å†…æ ¸ï¼ˆGENERICï¼‰ä½œä¸ºå¯åŠ è½½æ¨¡å—è€Œå­˜åœ¨ã€‚\nè­¦å‘Š IPFW é»˜è®¤ä¼šæœ‰ä¸€æ¡è§„åˆ™ï¼Œè§„åˆ™å·ä¸º 65535ï¼Œæ˜¯ä¸å¯ä»¥åˆ é™¤çš„ï¼šè¿™æ¡è§„åˆ™ä¼šæŠŠæ‰€æœ‰æµé‡éƒ½åˆ‡æ–­ã€‚æ•…åœ¨æœªé…ç½®å¥½é˜²ç«å¢™å‰ï¼Œè¯·å‹¿å¯åŠ¨ IPFWï¼Œå¦åˆ™å°±ä¼šé¢ä¸´è¢«é˜»æŒ¡åœ¨é˜²ç«å¢™ä¹‹å¤–çš„éº»çƒ¦ã€‚\næœåŠ¡é¡¹ å¼€æœºè‡ªåŠ¨å¯åŠ¨é˜²ç«å¢™ç›¸åº”çš„å†…æ ¸æ¨¡å—ï¼š\n# sysrc firewall_enable=\u0026#34;YES\u0026#34; å‚è§ å®˜æ–¹ç½‘å€\næˆ–è€…\n# service ipfw enable # é¡»é‡å¯åç”Ÿæ•ˆ ä¿å­˜æ‰€éœ€ç¼–è¾‘åï¼Œå¯åŠ¨é˜²ç«å¢™ã€‚è¦ç«‹å³å¯ç”¨æ—¥å¿—è®°å½•é™åˆ¶ï¼Œè¿˜è¯·è®¾ç½®sysctlä¸Šé¢æŒ‡å®šçš„å€¼ï¼š\n# service ipfw start å¯åŠ¨ ipfwï¼šï¼ˆå¯åŠ¨å‰éœ€è¦å…ˆæ·»åŠ æ”¾å¼€22ç«¯å£çš„è§„åˆ™ï¼Œå…ˆæ‰§è¡Œä¸‹é¢çš„ï¼‰\n# service ipfw start Firewall rules loaded. Firewall logging enabled. ifconfig: interface ipfw0 already exists Firewall logging pseudo-interface (ipfw0) created. æŸ¥çœ‹ ipfw çŠ¶æ€ï¼š\n# service ipfw status ipfw is enabled å…¶ä»– RC é…ç½®\n# sysrc firewall_type=\u0026#34;open\u0026#34; # å…è®¸ä»»ä½•è®¿é—®ã€‚å¦‚æœä¸è¿™ä¹ˆåšï¼Œä¼šè°ƒç”¨é»˜è®¤è§„åˆ™ 65535â€”â€”deny ip from any to anyï¼Œæ‹’ç»æ‰€æœ‰ IPã€‚ä½ å°±åªèƒ½å»ç‰©ç†æœºä¸Šå†æ“ä½œäº†ã€‚åŸºæœ¬ç­‰åŒäº net.inet.ip.fw.default_to_accept=\u0026#34;1\u0026#34; # sysrc firewall_script=\u0026#34;/usr/local/etc/ipfw.rules\u0026#34; # æŒ‡å®š ipfw è§„åˆ™çš„è·¯å¾„ï¼Œåœ¨æ­¤å¤„ç¼–è¾‘è§„åˆ™ # sysrc firewall_logging=\u0026#34;YES\u0026#34; # è¿™æ · ipfw å°±å¯ä»¥æ‰“å°æ—¥å¿— # sysrc firewall_logif=\u0026#34;YES\u0026#34; # æŠŠæ—¥å¿—æ‰“å°åˆ° `ipfw0` è¿™ä¸ªè®¾å¤‡é‡Œ sysrc firewall_type=\u0026quot;open\u0026quot; è®¾ç½®åä¸ä¼šç›´æ¥å†™å…¥ allow ip from any to any åˆ°é…ç½®æ–‡ä»¶ã€‚\nç»æµ‹è¯•ï¼Œèƒ½æ§åˆ¶é˜²ç«å¢™å…¨å¼€æ”¾æ˜¯ï¼š\nä½ æŠŠnet.inet.ip.fw.default_to_accept=1æ”¾åˆ°/boot/loader.confé‡å¯æ‰èƒ½ç”Ÿæ•ˆ ï¼Œæ‰‹åŠ¨æ”¹æ–‡ä»¶æ”¾è¿›å»ã€‚ç„¶åé‡å¯ç³»ç»Ÿæ‰èƒ½ç”Ÿæ•ˆï¼Œä¼šåœ¨é…ç½®æ–‡ä»¶é‡Œç”Ÿæˆï¼šallow ip from any to any # æ³¨æ„æ­¤å¤„\næˆ–è€…ï¼š\nsysctl net.inet.ip.fw.default_to_accept=1 ä½†ç³»ç»Ÿå¯åŠ¨æ—¶ä¼šåŠ è½½ç­‰æ•ˆçš„è§„åˆ™ï¼Œä½œç”¨å°±æ˜¯å®Œå…¨å¼€æ”¾é˜²ç«å¢™ã€‚\næŒ‰ä¸Šé¢çš„é…ç½®åçš„è§„åˆ™ï¼š\n# ipfw list 00100 allow ip from any to any via lo0 00200 deny ip from any to 127.0.0.0/8 00300 deny ip from 127.0.0.0/8 to any 00400 deny ip from any to ::1 00500 deny ip from ::1 to any 00600 allow ipv6-icmp from :: to ff02::/16 00700 allow ipv6-icmp from fe80::/10 to fe80::/10 00800 allow ipv6-icmp from fe80::/10 to ff02::/16 00900 allow ipv6-icmp from any to any icmp6types 1 01000 allow ipv6-icmp from any to any icmp6types 2,135,136 65000 allow ip from any to any # æ³¨æ„æ­¤å¤„ 65535 deny ip from any to any ç¼–è¾‘ /usr/local/etc/ipfw.rules æ–‡ä»¶ æŒ‡å®šé˜²ç«å¢™è§„åˆ™ï¼š\nipfw -q -f flush # -q é€‰é¡¹è¡¨ç¤ºé™é»˜æ¨¡å¼ï¼Œé¿å…è¾“å‡ºå†—ä½™ä¿¡æ¯, åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰æ¸…é™¤åˆ—è¡¨ã€‚ cmd=\u0026#34;ipfw -q add\u0026#34; # â€‹å®šä¹‰ä¸€ä¸ªå˜é‡ cmdï¼Œç”¨äºç®€åŒ–åç»­æ·»åŠ è§„åˆ™çš„å‘½ä»¤ã€‚ # loopback $cmd 10 allow all from any to any via lo0 # å…è®¸æ‰€æœ‰é€šè¿‡å›ç¯æ¥å£ lo0 çš„æµé‡ã€‚ $cmd 20 deny all from any to 127.0.0.0/8 # æ‹’ç»ä»»ä½•è¯•å›¾è®¿é—®æœ¬åœ°å›ç¯åœ°å€èŒƒå›´ï¼ˆ127.0.0.0/8ï¼‰çš„å¤–éƒ¨æµé‡ï¼Œé˜²æ­¢ä¼ªé€ çš„å›ç¯åœ°å€é€šä¿¡ã€‚ $cmd 30 deny all from 127.0.0.0/8 to any # æ‹’ç»æ¥è‡ªå›ç¯åœ°å€èŒƒå›´çš„ä»»ä½•æµé‡ç¦»å¼€æœ¬åœ°ä¸»æœºï¼Œè¿›ä¸€æ­¥ç¡®ä¿å›ç¯åœ°å€çš„å®‰å…¨æ€§ã€‚ $cmd 40 deny tcp from any to any frag # â€‹æ‹’ç»æ‰€æœ‰åˆ†ç‰‡çš„ TCP æ•°æ®åŒ…ï¼Œæœ‰åŠ©äºé˜²èŒƒæŸäº›ç±»å‹çš„æ”»å‡»ã€‚ # statefull $cmd 50 check-state # æ£€æŸ¥ç°æœ‰çš„ä¼šè¯çŠ¶æ€ï¼Œå…è®¸å·²å»ºç«‹çš„ä¼šè¯ç»§ç»­é€šä¿¡ã€‚ $cmd 60 allow tcp from any to any established # å…è®¸æ‰€æœ‰å·²å»ºç«‹çš„ TCP è¿æ¥çš„æ•°æ®åŒ…é€šè¿‡ã€‚ $cmd 70 allow all from any to any out keep-state # å…è®¸æ‰€æœ‰å‘å¤–çš„æµé‡ï¼Œå¹¶å¯¹å…¶åˆ›å»ºçŠ¶æ€è®°å½•ï¼Œä»¥ä¾¿å“åº”æµé‡èƒ½å¤Ÿè‡ªåŠ¨é€šè¿‡ã€‚ $cmd 80 allow icmp from any to any # å…è®¸æ‰€æœ‰ ICMP æ•°æ®åŒ…ï¼Œæ”¯æŒç½‘ç»œè¯Šæ–­å’Œé”™è¯¯æŠ¥å‘ŠåŠŸèƒ½ã€‚â€‹ # open port for ssh $cmd 110 allow tcp from any to any 22 out # å…è®¸æ‰€æœ‰å‘å¤–çš„ SSH æµé‡ $cmd 120 allow tcp from any to any 22 in # ç¡®ä¿å¯ä»¥é€šè¿‡ SSH è®¿é—®è¯¥ä¸»æœºã€‚ # open port for samba # å…è®¸ä¸ Samba æ–‡ä»¶å…±äº«æœåŠ¡ç›¸å…³çš„ç«¯å£ï¼ˆ137-139 å’Œ 445ï¼‰çš„è¿›å‡ºæµé‡ï¼Œç¡®ä¿ Samba æœåŠ¡æ­£å¸¸è¿è¡Œã€‚ $cmd 130 allow tcp from any to any 139 out $cmd 140 allow tcp from any to any 139 in $cmd 150 allow tcp from any to any 445 out $cmd 160 allow tcp from any to any 445 in $cmd 170 allow udp from any to any 137 out $cmd 180 allow udp from any to any 137 in $cmd 190 allow udp from any to any 138 out $cmd 200 allow udp from any to any 138 in # deny and log everything # æ‹’ç»æ‰€æœ‰æœªæ˜ç¡®å…è®¸çš„æµé‡ï¼Œå¹¶å°†å…¶è®°å½•åˆ°æ—¥å¿—ä¸­ï¼Œä¾¿äºå®¡è®¡å’Œæ•…éšœæ’æŸ¥ã€‚ $cmd 500 deny log all from any to any æ¯ä¸€æ¡è§„åˆ™çš„ç»“æ„åŸºæœ¬éƒ½æ˜¯ï¼š\n# ipfw add [è§„åˆ™ç¼–å·] â‘  [åŠ¨ä½œ] [åè®®] from [æºåœ°å€] to [ç›®æ ‡åœ°å€] [å…¶ä»–æ¡ä»¶] â‘  æŒ‰ä¼˜å…ˆçº§æ’åºï¼Œæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼Œå¯ä¼˜å…ˆè¦†ç›–ç›¸åŒçš„ã€æ•°å­—å¤§çš„è§„åˆ™ã€‚\n$cmd 500 deny log all from any to any â€”â€”\u0026gt; ipfw add 500 deny log all from any to any\næ³¨æ„ `ipfw å‘½ä»¤æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œå®ƒä¼šåœ¨æ‰§è¡Œæ—¶å³æ—¶ç”Ÿæ•ˆï¼Œä½†ä¸ä¼šæ°¸ä¹…ä¿å­˜è§„åˆ™ã€‚ä½ é¡»å†™å…¥æŒ‡å®šçš„è§„åˆ™æ–‡ä»¶ã€‚\næˆ‘ä»¬å¯ä»¥æŠŠé»˜è®¤æ‹’ç»çš„è§„åˆ™ 65535 deny ip from any to any æ”¹æˆé»˜è®¤å…è®¸`\n# echo net.inet.ip.fw.default_to_accept=\u0026#34;1\u0026#34; \u0026gt;\u0026gt; /boot/loader.conf æŸ¥çœ‹ ipfw è§„åˆ™ # ipfw list 00100 allow ip from any to any via lo0 00200 deny ip from any to 127.0.0.0/8 00300 deny ip from 127.0.0.0/8 to any 00400 deny ip from any to ::1 00500 deny ip from ::1 to any 00600 allow ipv6-icmp from :: to ff02::/16 00700 allow ipv6-icmp from fe80::/10 to fe80::/10 00800 allow ipv6-icmp from fe80::/10 to ff02::/16 00900 allow ipv6-icmp from any to any icmp6types 1 01000 allow ipv6-icmp from any to any icmp6types 2,135,136 65535 allow ip from any to any # æ³¨æ„æ­¤å¤„æ˜¯é»˜è®¤å…è®¸äº†ï¼Œåé¢æ²¡äº† ","permalink":"https://hanigege.github.io/posts/freebsd/freebsd-ipfirewallipfw/","tags":null,"title":"Freebsd-Ipfirewall(IPFW)é˜²ç«å¢™ä»‹ç»"},{"categories":["freebsd"],"contents":"åœ¨ pf.conf ä¸­ï¼ŒPF è§„åˆ™çš„é¡ºåºæ˜¯éå¸¸ä¸¥æ ¼çš„ã€‚æ­£ç¡®çš„é¡ºåºåº”è¯¥æ˜¯ï¼š options â€” è®¾ç½® PF çš„å…¨å±€é€‰é¡¹ã€‚\nethernet â€” è®¾ç½®ç½‘ç»œæ¥å£ã€‚\nnormalization â€” è®¾ç½®æ•°æ®åŒ…çš„è§„èŒƒåŒ–ã€‚\nqueueing â€” è®¾ç½®é˜Ÿåˆ—ï¼ˆå¯é€‰ï¼‰ã€‚\ntranslation â€” NAT æˆ– RDR è®¾ç½®ã€‚\nfiltering â€” åŒ…è¿‡æ»¤è§„åˆ™ã€‚\nPFï¼ˆPacket Filterï¼ŒåŒ…è¿‡æ»¤å™¨ï¼‰æ˜¯ä¸€æ¬¾ç”± OpenBSD ç§»æ¤è€Œæ¥çš„é˜²ç«å¢™ï¼Œæä¾›äº†å¤§é‡åŠŸèƒ½ï¼ŒåŒ…æ‹¬ ALTQ (Alternate Queuingï¼Œäº¤é”™é˜Ÿåˆ—) ç­‰ã€‚ å¯ç”¨ PF\n# kldload pf # â‘  åŠ è½½å†…æ ¸æ¨¡å— # ç¤ºä¾‹æ–‡ä»¶ä½œä¸ºé»˜è®¤é…ç½®è§„åˆ™é›†æ–‡ä»¶ï¼Œå¦åˆ™ pf æ— æ³•å¯åŠ¨ â‘¡ # cp /usr/share/examples/pf/pf.conf /etc/ # service pf enable # è®¾ç½® pf å¼€æœºå¯åŠ¨ # service pf start # å¯åŠ¨ pf â‘  å¦‚ä¸åšï¼Œåˆ™æç¤º pfctl: /dev/pf: No such file or directoryã€‚æˆ–è€…ä½ é‡å¯å† service pf startã€‚\nâ‘¡ å¦åˆ™æç¤ºï¼š\n/etc/rc.d/pf: WARNING: /etc/pf.conf is not readable. pfctlå‘½ä»¤è¯¦è§£ pf çš„ç®¡ç†å‘½ä»¤ä¸º pfctlï¼Œå¸¸ç”¨æ“ä½œç¤ºä¾‹å¦‚ä¸‹ï¼š\n# å¯åŠ¨ pfï¼Œç›¸å½“äº service pf start # pfctl -e # å³ç¦æ­¢è§„åˆ™ã€‚å‡ ä¹ç›¸å½“äº service pf stopï¼ˆåœæ­¢é˜²ç«å¢™ï¼‰ # pfctl -d # åŠ è½½è§„åˆ™é›†æ–‡ä»¶ä¸­çš„è§„åˆ™ # pfctl -f /etc/pf.conf # è§£æè§„åˆ™ï¼Œä½†ä¸åŠ è½½ã€‚-f å‚æ•°è¿˜å¯ä»¥ä¸å…¶ä»–å‚æ•°é…åˆï¼Œå¦‚ -N è¡¨ç¤ºåªè½½å…¥ NAT è§„åˆ™ï¼Œ-R è¡¨ç¤ºåªè½½å…¥è¿‡æ»¤è§„åˆ™ï¼Œ-A åªè½½å…¥é˜Ÿåˆ—è§„åˆ™ï¼Œ-O åªè½½å…¥é€‰é¡¹è§„åˆ™ # pfctl -nf /etc/pf.conf # æŸ¥çœ‹ pf æ‰€æœ‰å¯¹è±¡ä¿¡æ¯ã€‚å¦‚æœæƒ³æŸ¥çœ‹ç‰¹å®šå¯¹è±¡ä¿¡æ¯ï¼Œå¯ä»¥ç”¨ natã€queueã€rulesã€Anchorsã€statesã€Sourcesã€infoã€Runningã€labelsã€timeoutsã€memoryã€Tablesã€osfpã€Interfaces æ›¿æ¢ all # pfctl -s all # æ¸…ç† pf æ‰€æœ‰è§„åˆ™ # pfctl -F all å¦‚æœæƒ³æŸ¥çœ‹ç‰¹å®šè§„åˆ™ï¼Œå¯ä»¥ç”¨ natã€queueã€rulesã€statesã€Sourcesã€infoã€Tablesã€osfp æ›¿æ¢ allã€‚\nä¸è¿‡ä»¥ä¸Šæ“ä½œå¹¶æ²¡æœ‰å¯¹è§„åˆ™çš„ç®¡ç†ï¼Œå› æ­¤è¿˜éœ€è¦ä¿®æ”¹è§„åˆ™é›†æ–‡ä»¶ï¼Œå¸¸ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š\n# æ•´ç†æ‰€æœ‰è¾“å…¥çš„æ•°æ® scrub in all # æ‹’ç»æ‰€æœ‰è®¿é—® block all # é»˜è®¤æ˜ç¤ºç¦æ­¢æ‰€æœ‰è®¿é—®ã€‚block æ˜¯åŠ¨ä½œï¼Œall æ˜¯ä»ä»»ä½•æºåˆ°ä»»ä½•ç›®æ ‡çš„ç®€å†™ï¼Œè¡¨ç¤ºä»æºåœ°å€åˆ°ç›®æ ‡åœ°å€ã€‚ # æ”¾å¼€å›ç¯æ¥å£çš„è®¿é—®æƒé™ï¼Œå›ç¯æ¥å£ä¸å¯¹å¤–éƒ¨ pass quick on lo0 all # quick å…³é”®å­—è¡¨ç¤ºè‹¥è§„åˆ™åŒ¹é…ï¼Œå°±åœæ­¢æ‰§è¡Œï¼Œä¸ä¼šå†æ‰§è¡Œåç»­è§„åˆ™ # å¢åŠ  TCP åè®®è®¿é—® 80 ç«¯å£çš„è§„åˆ™ï¼Œå…è®¸ä»»ä½•è®¾å¤‡ä»¥ TCP åè®®è®¿é—®æœ¬æœº 80 ç«¯å£ pass in quick proto tcp from any to 192.168.1.184 port 80 # proto tcp æ˜¯è®¿é—®åè®®ï¼Œport 80 æ˜¯ç›®æ ‡ç«¯å£ # å…è®¸å›æ˜¾ä¿¡æ¯ç»™ä»»ä½•è®¿é—®çš„è®¾å¤‡ pass out quick proto tcp from 192.168.1.184 port 80 to any # å…è®¸æœ¬æœºå‘å¤–å‘é€ 80 ç«¯å£çš„å“åº” # å¢åŠ  80 ç«¯å£åˆ° 8080 ç«¯å£æµé‡è½¬å‘çš„è§„åˆ™ rdr pass on em0 inet proto tcp from any to 192.168.1.184 port 80 -\u0026gt; 192.168.1.166 port 8080 # è½¬å‘æµé‡åˆ°å†…ç½‘åœ°å€ 192.168.1.166 ç«¯å£ 8080 # å…è®¸æœ¬æœºä¸å¤–éƒ¨è®¾å¤‡äº’ ping pass quick inet proto icmp all icmp-type 8 code 0 # icmp-type 8 æ˜¯æŸ¥è¯¢è¯·æ±‚ï¼Œcode 0 è¡¨ç¤ºè¿”å›ç ä¸º 0 # å…è®¸ traceroute å‘½ä»¤ä»¥ ICMP åè®®æ‰§è¡Œ pass out quick inet proto icmp from 192.168.1.184 to any icmp-type 11 code 0 # icmp-type 11 ç”¨äºæ—¶é—´è¶…æ—¶ # å…è®¸ traceroute ä½¿ç”¨ UDP åè®®æ‰§è¡Œï¼Œç«¯å£å·ä» 33434 å¼€å§‹ pass out quick proto udp from 192.168.1.184 to any port 33434 \u0026gt;\u0026lt; 34500 # é»˜è®¤ UDP åè®®ï¼Œç«¯å£å·ä» 33434 å¼€å§‹ï¼Œæ¯è½¬å‘ä¸€æ¬¡ç«¯å£å·åŠ  1 å¯èƒ½ç”¨åˆ°çš„è§„åˆ™é›†æ–‡ä»¶ /etc/pf.conf å¦‚ä¸‹ï¼š # æµé‡æ•´å½¢ scrub in all # è½¬å‘è§„åˆ™ rdr pass on em0 inet proto tcp from any to 192.168.1.184 port 8080 -\u0026gt; 192.168.1.184 port 80 # æ³¨æ„è§„åˆ™æ¬¡åºï¼Œæ ¹æ® pf.conf è§„åˆ™ï¼Œè½¬å‘è§„åˆ™åº”ä½äºè¿‡æ»¤è§„åˆ™ä¹‹å‰ï¼Œç›¸å…³å†…å®¹è¯·å‚è€ƒå¸®åŠ© # è¿‡æ»¤è§„åˆ™ block all pass quick on lo0 all # é˜»æ­¢æ‰€æœ‰æµé‡ï¼Œä½†å…è®¸å›ç¯æ¥å£ï¼ˆlo0ï¼‰ä¸Šçš„æµé‡ # è®¾ç½®ä»»ä½•è®¾å¤‡å¯ä»¥è®¿é—®æœåŠ¡å™¨çš„ 22ã€80ã€443ã€4200ã€10000 ç«¯å£ pass in quick proto tcp from any to 192.168.1.184 port { 22, 80, 443, 4200, 10000 } # è®¾ç½®æœåŠ¡å™¨å¯ä»¥è®¿é—®å¤–éƒ¨è®¾å¤‡çš„ 22ã€80ã€443ã€4200ã€10000 ç«¯å£ pass out quick proto tcp from 192.168.1.184 port { 22, 80, 443, 4200, 10000 } to any # è®¾ç½®æœåŠ¡å™¨è®¿é—®ä»»ä½•ç½‘ç»œè®¾å¤‡çš„ 80ã€443 ç«¯å£ï¼Œå¹¶ä¿æŒçŠ¶æ€ pass out quick proto tcp from 192.168.1.184 to any port { 80, 443 } keep state # è®¾ç½®æœåŠ¡å™¨è®¿é—® DNS æœåŠ¡å™¨ï¼ˆUDP ç«¯å£ 53ï¼‰ pass out quick proto udp from any to any port 53 keep state # è®¾ç½®æœåŠ¡å™¨è®¿é—® DHCP æœåŠ¡å™¨ï¼ˆUDP ç«¯å£ 67ï¼‰ pass out quick proto udp from any to any port 67 keep state # å…è®¸æœåŠ¡å™¨å‘é€ ICMP è¯·æ±‚ pass quick inet proto icmp all icmp-type 8 code 0 # å…è®¸æœåŠ¡å™¨å‘é€ ICMP è¶…æ—¶æ¶ˆæ¯ï¼ˆTTL è¶…è¿‡ï¼‰ pass out quick inet proto icmp from 192.168.1.184 to any icmp-type 11 code 0 # å…è®¸æœåŠ¡å™¨è®¿é—® UDP èŒƒå›´ç«¯å£ 33434 åˆ° 34500 pass out quick proto udp from 192.168.1.184 to any port 33434 \u0026gt;\u0026lt; 34500 ä¿å­˜æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥åœ¨ç»ˆç«¯æ‰§è¡Œå‘½ä»¤ï¼š\n# åŠ è½½è§„åˆ™é›†æ–‡ä»¶ä¸­çš„è§„åˆ™ å°±å¯ä»¥çœ‹åˆ°æ•ˆæœäº†ã€‚ # pfctl -Fa -f /etc/pf.conf ----------------------------------------------------------------\nè¦å–æ¶ˆï¼ˆå¸è½½ï¼‰å·²ç»åŠ è½½çš„å†…æ ¸æ¨¡å— pfï¼Œå¯ä»¥ä½¿ç”¨ kldunload å‘½ä»¤ã€‚å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š kldunload pf è§£é‡Šï¼š kldunload pf ä¼šå¸è½½å·²åŠ è½½çš„ pfï¼ˆPacket Filterï¼‰å†…æ ¸æ¨¡å—ã€‚å¦‚æœè¿™ä¸ªæ¨¡å—æ­£åœ¨è¢«ä½¿ç”¨ï¼ˆä¾‹å¦‚ï¼Œé…ç½®äº†é˜²ç«å¢™è§„åˆ™ï¼‰ï¼Œå¸è½½æ—¶å¯èƒ½ä¼šäº§ç”Ÿä¸€äº›å½±å“ã€‚\nè¯·ç¡®ä¿åœ¨å¸è½½æ¨¡å—å‰æ²¡æœ‰ç›¸å…³æœåŠ¡æˆ–è§„åˆ™åœ¨è¿è¡Œã€‚\næŸ¥çœ‹å½“å‰åŠ è½½çš„å†…æ ¸æ¨¡å—ï¼š ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å½“å‰åŠ è½½çš„å†…æ ¸æ¨¡å—ï¼š\nkldstat è¿™ä¼šåˆ—å‡ºå½“å‰åŠ è½½çš„æ‰€æœ‰å†…æ ¸æ¨¡å—ï¼ŒåŒ…æ‹¬ pfã€‚\næ³¨æ„ï¼š å¦‚æœä½ å¸Œæœ›åœ¨ç³»ç»Ÿé‡å¯åä¸å†åŠ è½½ pf æ¨¡å—ï¼Œå¯ä»¥ç§»é™¤ç›¸å…³çš„é…ç½®æ–‡ä»¶ä¸­çš„ kldload pf æŒ‡ä»¤ï¼Œä¾‹å¦‚ /etc/rc.conf æ–‡ä»¶ä¸­çš„è®¾ç½®ã€‚\n","permalink":"https://hanigege.github.io/posts/freebsd/freebsd-packet-filterpf%E9%98%B2%E7%81%AB%E5%A2%99%E4%BB%8B%E7%BB%8D/","tags":null,"title":"Freebsd-Packet-Filterï¼ˆPFï¼‰é˜²ç«å¢™ä»‹ç»"},{"categories":["freebsd"],"contents":"åœ¨ FreeBSD ä¸Šç¼–è¯‘å¹¶å®‰è£… sing-boxï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œã€‚æˆ‘ä»¬å°†ä½¿ç”¨ git æ‹‰å–æºä»£ç å¹¶ç¼–è¯‘ï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†æ­¥éª¤ï¼š 1. å®‰è£…ä¾èµ–å·¥å…· é¦–å…ˆï¼Œä½ éœ€è¦å®‰è£…ä¸€äº›åŸºç¡€å·¥å…·ï¼Œä¾‹å¦‚ git å’Œ goï¼ˆGo è¯­è¨€ç¯å¢ƒï¼‰ï¼Œä»¥ä¾¿èƒ½ç¼–è¯‘å’Œæ„å»º sing-boxã€‚\npkg update pkg install git ç‚¹å‡»å®‰è£…æœ€æ–°ç‰ˆæœ¬go1.23.1\n2. è·å– Sing-Box æºä»£ç  ç„¶åï¼Œä½¿ç”¨ git å…‹éš† sing-box çš„æºç åº“ï¼š\n# ä¸‹é¢æ˜¯rootç”¨æˆ·å®‰è£… mkdir /usr/local/opt git clone https://github.com/SagerNet/sing-box.git /usr/local/opt/sing-box cd /usr/local/opt/sing-box # ä¸‹é¢æ˜¯æ™®é€šç”¨æˆ·å®‰è£…ï¼Œåªèƒ½å®‰è£…æœ¬çº§ç›®å½•ä¸‹~/ mkdir .usr/local/opt git clone https://github.com/SagerNet/sing-box.git .usr/local/opt/sing-box cd .usr/local/opt/sing-box 3. ç¼–è¯‘ Sing-Box ç¡®ä¿ä½ çš„ç³»ç»Ÿä¸Šå®‰è£…äº† Go è¯­è¨€ç¯å¢ƒåï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥ç¼–è¯‘ sing-boxï¼š\n# æ‰§è¡Œæ„å»ºï¼Œæ²¡æœ‰ä»»ä½•è¾“å‡ºå°±æ˜¯æ„å»ºå®Œ go build -tags \u0026#34;with_quic with_dhcp with_wireguard with_utls with_acme with_clash_api with_gvisor with_grpc with_v2ray_api\u0026#34; ./cmd/sing-box # è¿™ä¼šç¼–è¯‘ sing-box å¹¶å¯ç”¨ QUICåè®®æ”¯æŒã€‚ # ä½ ç°åœ¨åº”è¯¥å¯ä»¥åœ¨å½“å‰ç›®å½•çœ‹åˆ°å¯æ‰§è¡Œæ–‡ä»¶äº† ls -lh sing-box # å¦‚æœä½ è¿˜æƒ³æŠŠå®ƒå®‰è£…åˆ°ç³»ç»Ÿè·¯å¾„ä¸­ï¼Œå¯ä»¥æ‰§è¡Œï¼ˆéœ€è¦ root æƒé™ï¼‰ï¼š sudo install -m 755 sing-box /usr/local/bin/sing-box # æ™®é€šç”¨æˆ·æ‰§è¡Œ go build -tags \u0026#34;with_quic with_dhcp with_wireguard with_utls with_acme with_clash_api with_gvisor with_grpc with_v2ray_api\u0026#34; ./cmd/sing-box # è¿™ä¼šç¼–è¯‘ sing-box å¹¶å¯ç”¨ QUICåè®®æ”¯æŒã€‚ # ä½ ç°åœ¨åº”è¯¥å¯ä»¥åœ¨å½“å‰ç›®å½•çœ‹åˆ°å¯æ‰§è¡Œæ–‡ä»¶äº† ls -lh sing-box # æˆ‘è£…åœ¨äº†ä¹‹å‰goçš„binæ–‡ä»¶å¤¹é‡Œï¼Œå¯ä»¥æ‰§è¡Œï¼š install -m 755 sing-box ~/.usr/local/opt/go/bin/sing-box æˆ–è€…ï¼šï¼ˆæ˜ç™½åŸç†ï¼Œè£…å“ªé‡Œå°±éšå¿ƒæ‰€æ¬²äº†ï¼‰ å¦‚æœä½ æ˜¯ æ™®é€šç”¨æˆ·ï¼ˆé rootï¼‰å¹¶æƒ³ä¸ä½¿ç”¨ sudo å®‰è£… sing-boxï¼Œå¯ä»¥å°†å…¶å®‰è£…åˆ°ä½ è‡ªå·±çš„ $HOME ç›®å½•ä¸‹çš„ bin/ å­ç›®å½•ä¸­ï¼Œè¿™æ˜¯ Unix ç³»ç»Ÿå¸¸ç”¨çš„åšæ³•ä¹‹ä¸€ã€‚\nâœ… æ¨èåšæ³•ï¼š\nmkdir -p ~/bin install -m 755 sing-box ~/bin/sing-box è¿™ä¼šå°† sing-box å®‰è£…åˆ°ä½ çš„ ~/bin/ ç›®å½•ä¸‹ã€‚\nâœ… æ·»åŠ åˆ° PATHï¼ˆå¦‚æœè¿˜æ²¡æ·»åŠ ï¼‰\nå¦‚æœä½ å°šæœªæŠŠ ~/bin åŠ å…¥ç¯å¢ƒå˜é‡ PATHï¼Œè¯·åœ¨ä½ çš„ shell é…ç½®æ–‡ä»¶é‡ŒåŠ ä¸€å¥ï¼š\nå¯¹äº bashï¼š(è£…å¥½bashå°±ç”¨è¿™ä¸ªï¼‰\necho \u0026#39;export PATH=\u0026#34;$HOME/bin:$PATH\u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.bash_profile source ~/.bash_profile å¯¹äº tcshï¼ˆFreeBSD é»˜è®¤ï¼‰ï¼š\necho \u0026#39;setenv PATH \u0026#34;$HOME/bin:$PATH\u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.cshrc source ~/.cshrc å¯¹äº zshï¼š\necho \u0026#39;export PATH=\u0026#34;$HOME/bin:$PATH\u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.zshrc source ~/.zshrc ğŸ” éªŒè¯å®‰è£…\nwhich sing-box sing-box version ç¡®è®¤è¾“å‡ºæ­£ç¡®ç‰ˆæœ¬ä¿¡æ¯å³å¯ã€‚\n4. é…ç½® Sing-Box ä½ éœ€è¦é…ç½® sing-boxï¼Œé€šå¸¸å¯ä»¥å°†é…ç½®æ–‡ä»¶æ”¾ç½®åœ¨ ~/.config/sing-box/ æˆ– /usr/local/etc/sing-box/ ç›®å½•ä¸‹ã€‚ä½ å¯ä»¥åœ¨ sing-box é…ç½®æ–‡ä»¶æ–‡æ¡£ ä¸­æ‰¾åˆ°è¯¦ç»†çš„é…ç½®è¯´æ˜ã€‚\nåˆ›å»ºé…ç½®ç›®å½•ï¼š\n# rootç”¨æˆ· mkdir -p /usr/local/etc/sing-box \u0026amp;\u0026amp; echo \u0026#34;{}\u0026#34; \u0026gt; /usr/local/etc/sing-box/config.json # æ™®é€šç”¨æˆ· mkdir -p ~/.usr/local/etc/sing-box \u0026amp;\u0026amp; echo \u0026#34;{}\u0026#34; \u0026gt; ~/.usr/local/etc/sing-box/config.json å°†é…ç½®æ–‡ä»¶æ”¾åˆ°è¯¥ç›®å½•ä¸‹ï¼Œæˆ–è€…æ ¹æ®å®é™…æƒ…å†µè‡ªå®šä¹‰é…ç½®ã€‚\nsocksé…ç½®å®ä¾‹ï¼š { \u0026#34;log\u0026#34;: { \u0026#34;disabled\u0026#34;: false, \u0026#34;level\u0026#34;: \u0026#34;info\u0026#34;, \u0026#34;timestamp\u0026#34;: true }, \u0026#34;dns\u0026#34;: { \u0026#34;servers\u0026#34;: [ { \u0026#34;tag\u0026#34;: \u0026#34;alidns\u0026#34;, \u0026#34;address\u0026#34;: \u0026#34;https://223.5.5.5/dns-query\u0026#34;, \u0026#34;strategy\u0026#34;: \u0026#34;ipv4_only\u0026#34;, \u0026#34;detour\u0026#34;: \u0026#34;direct\u0026#34; }, { \u0026#34;tag\u0026#34;: \u0026#34;cloudflare\u0026#34;, \u0026#34;address\u0026#34;: \u0026#34;https://1.1.1.1/dns-query\u0026#34;, \u0026#34;strategy\u0026#34;: \u0026#34;ipv4_only\u0026#34;, \u0026#34;detour\u0026#34;: \u0026#34;proxy\u0026#34; }, { \u0026#34;tag\u0026#34;: \u0026#34;block\u0026#34;, \u0026#34;address\u0026#34;: \u0026#34;rcode://success\u0026#34; } ], \u0026#34;rules\u0026#34;: [ { \u0026#34;outbound\u0026#34;: [ \u0026#34;any\u0026#34; ], \u0026#34;server\u0026#34;: \u0026#34;alidns\u0026#34; }, { \u0026#34;domain_suffix\u0026#34;: [ \u0026#34;.cn\u0026#34; ], \u0026#34;server\u0026#34;: \u0026#34;alidns\u0026#34; }, { \u0026#34;rule_set\u0026#34;: [ \u0026#34;geosite-cn\u0026#34; ], \u0026#34;server\u0026#34;: \u0026#34;alidns\u0026#34; }, { \u0026#34;rule_set\u0026#34;: [ \u0026#34;geosite-category-ads-all\u0026#34; ], \u0026#34;server\u0026#34;: \u0026#34;block\u0026#34; } ], \u0026#34;final\u0026#34;: \u0026#34;cloudflare\u0026#34;, \u0026#34;strategy\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;disable_cache\u0026#34;: false, \u0026#34;disable_expire\u0026#34;: false }, \u0026#34;inbounds\u0026#34;: [ { \u0026#34;type\u0026#34;: \u0026#34;socks\u0026#34;, \u0026#34;tag\u0026#34;: \u0026#34;socks-in\u0026#34;, \u0026#34;listen\u0026#34;: \u0026#34;0.0.0.0\u0026#34;, \u0026#34;listen_port\u0026#34;: 1080, \u0026#34;users\u0026#34;: [ ] } ], \u0026#34;outbounds\u0026#34;: [ { \u0026#34;tag\u0026#34;: \u0026#34;proxy\u0026#34;, \u0026#34;server\u0026#34;: \u0026#34;167.232\u0026#34;, // æ”¹åœ°å€ \u0026#34;server_port\u0026#34;: 449, //æ”¹ç«¯å£ \u0026#34;up_mbps\u0026#34;: 50, \u0026#34;down_mbps\u0026#34;: 500, \u0026#34;type\u0026#34;: \u0026#34;hysteria2\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;iry\u0026#34;, //æ”¹å¯†ç  \u0026#34;tls\u0026#34;: { \u0026#34;insecure\u0026#34;: true, \u0026#34;enabled\u0026#34;: true, \u0026#34;server_name\u0026#34;: \u0026#34;bing.com\u0026#34; }, \u0026#34;tcp_fast_open\u0026#34;: false }, { \u0026#34;type\u0026#34;: \u0026#34;direct\u0026#34;, \u0026#34;tag\u0026#34;: \u0026#34;direct\u0026#34; } ], \u0026#34;route\u0026#34;: { \u0026#34;rules\u0026#34;: [ { \u0026#34;action\u0026#34;: \u0026#34;sniff\u0026#34; }, { \u0026#34;protocol\u0026#34;: \u0026#34;dns\u0026#34;, \u0026#34;action\u0026#34;: \u0026#34;hijack-dns\u0026#34; }, { \u0026#34;ip_is_private\u0026#34;: true, \u0026#34;outbound\u0026#34;: \u0026#34;direct\u0026#34; }, { \u0026#34;domain_suffix\u0026#34;: [ \u0026#34;.cn\u0026#34; ], \u0026#34;outbound\u0026#34;: \u0026#34;direct\u0026#34; }, { \u0026#34;rule_set\u0026#34;: [ \u0026#34;geoip-cn\u0026#34;, \u0026#34;geosite-cn\u0026#34;, \u0026#34;geosite-private\u0026#34; ], \u0026#34;outbound\u0026#34;: \u0026#34;direct\u0026#34; }, { \u0026#34;rule_set\u0026#34;: [ \u0026#34;geosite-category-ads-all\u0026#34; ], \u0026#34;action\u0026#34;: \u0026#34;reject\u0026#34; } ], \u0026#34;rule_set\u0026#34;: [ { \u0026#34;tag\u0026#34;: \u0026#34;geoip-cn\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;remote\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;binary\u0026#34;, \u0026#34;url\u0026#34;: \u0026#34;https://raw.githubusercontent.com/SagerNet/sing-geoip/rule-set/geoip-cn.srs\u0026#34;, \u0026#34;download_detour\u0026#34;: \u0026#34;proxy\u0026#34; }, { \u0026#34;tag\u0026#34;: \u0026#34;geosite-cn\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;remote\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;binary\u0026#34;, \u0026#34;url\u0026#34;: \u0026#34;https://raw.githubusercontent.com/SagerNet/sing-geosite/rule-set/geosite-cn.srs\u0026#34;, \u0026#34;download_detour\u0026#34;: \u0026#34;proxy\u0026#34; }, { \u0026#34;tag\u0026#34;: \u0026#34;geosite-private\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;remote\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;binary\u0026#34;, \u0026#34;url\u0026#34;: \u0026#34;https://raw.githubusercontent.com/SagerNet/sing-geosite/rule-set/geosite-private.srs\u0026#34;, \u0026#34;download_detour\u0026#34;: \u0026#34;proxy\u0026#34; }, { \u0026#34;tag\u0026#34;: \u0026#34;geosite-category-ads-all\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;remote\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;binary\u0026#34;, \u0026#34;url\u0026#34;: \u0026#34;https://raw.githubusercontent.com/SagerNet/sing-geosite/rule-set/geosite-category-ads-all.srs\u0026#34;, \u0026#34;download_detour\u0026#34;: \u0026#34;proxy\u0026#34; } ], \u0026#34;auto_detect_interface\u0026#34;: true, \u0026#34;final\u0026#34;: \u0026#34;proxy\u0026#34; }, \u0026#34;experimental\u0026#34;: { \u0026#34;cache_file\u0026#34;: { \u0026#34;enabled\u0026#34;: true, \u0026#34;path\u0026#34;: \u0026#34;cache.db\u0026#34;, \u0026#34;cache_id\u0026#34;: \u0026#34;mycacheid\u0026#34;, \u0026#34;store_fakeip\u0026#34;: true } } } 6. è¿è¡Œ Sing-Box é…ç½®å¥½åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ sing-boxï¼š\n# rootç”¨æˆ· sing-box run -C /usr/local/etc/sing-box/ # æ™®é€šç”¨æˆ· sing-box run -C ~/.usr/local/etc/sing-box/ 7. rootç”¨æˆ·ä¸‹è®¾ç½®ä¸ºæœåŠ¡ï¼ˆå¯é€‰ï¼‰ å¦‚æœä½ å¸Œæœ›å°† sing-box è®¾ç½®ä¸ºç³»ç»ŸæœåŠ¡ï¼Œæ–¹ä¾¿å¼€æœºå¯åŠ¨ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæœåŠ¡è„šæœ¬ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ rc.d æœåŠ¡è„šæœ¬ç¤ºä¾‹ï¼š\nåˆ›å»ºæœåŠ¡è„šæœ¬æ–‡ä»¶ /usr/local/etc/rc.d/sing-boxï¼š\nnano /usr/local/etc/rc.d/sing-box æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\næœ‰é‡å®šå‘æ—¥å¿—åŠŸèƒ½ #!/bin/sh # # PROVIDE: sing_box # REQUIRE: NETWORKING # KEYWORD: shutdown . /etc/rc.subr name=\u0026#34;sing_box\u0026#34; rcvar=sing_box_enable command=\u0026#34;/usr/local/bin/sing-box\u0026#34; pidfile=\u0026#34;/var/run/${name}.pid\u0026#34; command_args=\u0026#34;run -C /usr/local/etc/sing-box/ \u0026gt;\u0026gt; /var/log/singbox.log 2\u0026gt;\u0026amp;1 \u0026amp; echo \\$! \u0026gt; ${pidfile}\u0026#34; load_rc_config $name : ${sing_box_enable:=\u0026#34;NO\u0026#34;} run_rc_command \u0026#34;$1\u0026#34; æ— æ—¥å¿—é‡å®šå‘ç‰ˆæœ¬ï¼š #!/bin/sh # # PROVIDE: sing_box # REQUIRE: NETWORKING # KEYWORD: shutdown . /etc/rc.subr name=\u0026#34;sing_box\u0026#34; rcvar=sing_box_enable command=\u0026#34;/usr/local/bin/sing-box\u0026#34; pidfile=\u0026#34;/var/run/${name}.pid\u0026#34; command_args=\u0026#34;run -C /usr/local/etc/sing-box/ \u0026amp; echo \\$! \u0026gt; ${pidfile}\u0026#34; load_rc_config $name : ${sing_box_enable:=\u0026#34;NO\u0026#34;} run_rc_command \u0026#34;$1\u0026#34; load_rc_config $name ç”¨äºåŠ è½½æœåŠ¡çš„é…ç½®æ–‡ä»¶ï¼Œè€Œ ${sing_box_enable:=\u0026quot;NO\u0026quot;} æ˜¯ä¸ºå˜é‡è®¾ç½®é»˜è®¤å€¼ã€‚è¿™é‡Œçš„é€»è¾‘æ˜¯ï¼š\nâ¦ å¿…é¡»æ·»åŠ ï¼šå¦åˆ™åœ¨ sing_box_enable æœªæ˜ç¡®è®¾ç½®ä¸º YES æ—¶ï¼Œè„šæœ¬ä¼šå› å˜é‡ç¼ºå¤±å¯¼è‡´å¯åŠ¨å¤±è´¥ï¼ˆå¦‚ /etc/rc é”™è¯¯æç¤ºï¼‰\nè®¾ç½®è„šæœ¬ä¸ºå¯æ‰§è¡Œï¼š chmod +x /usr/local/etc/rc.d/sing-box å¯ç”¨æœåŠ¡ï¼š\nsysrc sing_box_enable=YES å¯åŠ¨æœåŠ¡ï¼š\nservice sing-box start æ£€æŸ¥æœåŠ¡çŠ¶æ€ ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š service sing-box status æ™®é€šç”¨æˆ·å¯åŠ¨ç®¡ç†ï¼ˆå¯é€‰ï¼‰ FreeBSD ä¸‹çš„æ™®é€šç”¨æˆ·å¯ä»¥ä¸ºæ”¾åœ¨ç”¨æˆ·ç›®å½•ä¸‹çš„ sing-box è®¾ç½®ç”¨æˆ·çº§åˆ«çš„å¯åŠ¨æœåŠ¡ï¼Œæ›´æ ‡å‡†åšæ³•æ˜¯ä½¿ç”¨ cron @reboot æˆ– login.conf å¯åŠ¨æœºåˆ¶ã€‚ ä¸è¿‡ï¼ŒFreeBSD å¹¶ä¸åƒ Linuxï¼ˆæœ‰ systemd çš„ \u0026ndash;user æ¨¡å¼ï¼‰é‚£æ ·å¯¹ç”¨æˆ·æœåŠ¡æ”¯æŒé‚£ä¹ˆæ ‡å‡†åŒ–ï¼Œä½†ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼å®ç°ï¼š\nâœ… æ–¹æ³•ä¸€ï¼šä½¿ç”¨ crontab å®ç°å¼€æœºè‡ªå¯\n# ç³»ç»Ÿé»˜è®¤çš„æ˜¯vi crontab -e # ä¸´æ—¶æŒ‡å®švimæ‰“å¼€crontab -e EDITOR=vim crontab -e æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼ˆç¡®ä¿ sing-box å¯æ‰§è¡Œï¼‰ï¼š\n@reboot sh -c \u0026#39;$HOME/.usr/local/opt/go/bin/sing-box run -c $HOME/.usr/local/etc/sing-box/config.json \u0026gt; $HOME/.sing-box.log 2\u0026gt;\u0026amp;1 \u0026amp;\u0026#39; è¿™ä¸ªæ–¹å¼ç®€å•æœ‰æ•ˆï¼Œæ— éœ€ root æƒé™ã€‚\nâœ… æ–¹æ³•äºŒï¼šå†™ä¸ªç”¨æˆ·è‡ªå¯è„šæœ¬æ”¾åˆ° .login\nä¾‹å¦‚ï¼Œå¦‚æœä½ ç™»å½•ä½¿ç”¨çš„æ˜¯ç»ˆç«¯ï¼Œå¯ä»¥åœ¨ ~/.login åŠ ä¸€è¡Œï¼š\n$HOME/.usr/local/opt/go/bin/sing-box run -c $HOME.usr/local/etc/sing-box/config.json \u0026gt; $HOME/.sing-box.log 2\u0026gt;\u0026amp;1 \u0026amp; é™„æ™®é€šç”¨æˆ·å¯åŠ¨ç¨‹åºçŸ¥è¯†ç‚¹ï¼š æŸ¥çœ‹è¿›ç¨‹ï¼š pgrep -a sing-box å¦‚æœåœ¨è¿è¡Œä¼šçœ‹ç”¨IDï¼Œæ€è¡Œè¿›ç¨‹å‘½ä»¤ï¼š\nkill -9 ID è¦å°† sing-box run -C ~/.usr/local/etc/sing-box å‘½ä»¤æ”¹ä¸ºåå°è¿è¡Œï¼Œä½ å¯ä»¥æœ‰å‡ ç§æ–¹å¼é€‰æ‹©ï¼š\nâœ… æ–¹æ³• 1ï¼šåŠ  \u0026amp; ç›´æ¥åå°è¿è¡Œ sing-box run -C ~/.usr/local/etc/sing-box \u0026amp; è¿™ä¼šå°†è¿›ç¨‹æ”¾åˆ°åå°è¿è¡Œï¼Œä½†å…³é—­ç»ˆç«¯åä¼šé€€å‡ºï¼Œä¸æ¨èç”¨äºé•¿æœŸæœåŠ¡ã€‚\nâœ… æ–¹æ³• 2ï¼šä½¿ç”¨ nohup ä¿æŒåå°è¿è¡Œï¼ˆæ¨èï¼‰ nohup sing-box run -C ~/.usr/local/etc/sing-box \u0026gt; ~/sing-box.log 2\u0026gt;\u0026amp;1 \u0026amp; è§£é‡Šï¼š\nnohupï¼šé˜²æ­¢è¿›ç¨‹éšç»ˆç«¯é€€å‡ºï¼› \u0026gt; ~/sing-box.logï¼šå°†è¾“å‡ºä¿å­˜åˆ°æ—¥å¿—æ–‡ä»¶ï¼› 2\u0026gt;\u0026amp;1ï¼šåˆå¹¶æ ‡å‡†é”™è¯¯è¾“å‡ºï¼› \u0026amp;ï¼šåå°è¿è¡Œã€‚ ---\nâœ… æ–¹æ³• 3ï¼šä½¿ç”¨ tmux æˆ– screen ç®¡ç†åå°ä»»åŠ¡ï¼ˆé€‚åˆè°ƒè¯•ï¼‰ tmux new -s singbox sing-box run -C ~/.usr/local/etc/sing-box # æŒ‰ Ctrl+B ç„¶å D å¯åå° detach è¿™æ ·ä½ å¯ä»¥éšæ—¶æ¢å¤æ§åˆ¶å°æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ã€‚\n---\nâœ… æ–¹æ³• 4ï¼šå†™å…¥ crontab @reboot å¯åŠ¨ï¼ˆä½ ä¹‹å‰æåˆ°è¿‡ï¼‰ @reboot nohup $HOME/.usr/local/bin/sing-box run -C $HOME/.usr/local/etc/sing-box \u0026gt; $HOME/sing-box.log 2\u0026gt;\u0026amp;1 \u0026amp; `\u0026mdash;\næ€»ç»“ï¼š å®‰è£…ä¾èµ–å·¥å…·ï¼ˆgit å’Œ goï¼‰ã€‚\nå…‹éš† sing-box æºä»£ç å¹¶ç¼–è¯‘ã€‚\nå°†äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…åˆ° /usr/local/bin/ã€‚\né…ç½®å¹¶è¿è¡Œ sing-boxã€‚\nsing-box ä¸­ -C å’Œ -c æ˜¯ä¸åŒçš„å‚æ•°ï¼Œå®ƒä»¬çš„ä½œç”¨å¦‚ä¸‹ï¼š\nâœ… -c ï¼šæŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„ sing-box run -c /usr/local/etc/sing-box/config.json è¿™æ˜¯æœ€å¸¸ç”¨çš„å‚æ•°ã€‚\nç›´æ¥å‘Šè¯‰ sing-box ä½ è¦ç”¨å“ªä¸ªé…ç½®æ–‡ä»¶æ¥å¯åŠ¨ã€‚\né™„ï¼šPFé˜²ç«å¢™å¯ç”¨ï½ ç¼–è¾‘ pf é…ç½®æ–‡ä»¶ æ‰“å¼€ /etc/pf.conf æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n# å®šä¹‰æ¥å£ ext_if = \u0026#34;em0\u0026#34; # ä½ çš„å¤–ç½‘æ¥å£åç§°ï¼Œé€šå¸¸ä¸º em0 æˆ–è€… eth0ï¼Œå…·ä½“çœ‹ä½ çš„ç³»ç»Ÿ # å…è®¸æµé‡é€šè¿‡loopbackæ¥å£ set skip on lo0 # é»˜è®¤æ‹’ç»æ‰€æœ‰å…¥ç«™è¿æ¥ block all # å…è®¸æ‰€æœ‰å‡ºç«™æµé‡ pass out all # å…è®¸æ¥è‡ªæœ¬åœ°ç½‘ç»œçš„æµé‡åˆ°è¾¾22ç«¯å£å’Œ1080ç«¯å£ pass in on $ext_if proto tcp from any to any port 22 keep state pass in on $ext_if proto tcp from any to any port 1080 keep state # å…è®¸å…¶ä»–å·²ç»å»ºç«‹çš„è¿æ¥çš„æ•°æ®åŒ…é€šè¿‡ pass in all keep state å¯ç”¨ pf é˜²ç«å¢™ é…ç½®æ–‡ä»¶å®Œæˆåï¼Œå¯ç”¨ pf é˜²ç«å¢™å¹¶åº”ç”¨è§„åˆ™ï¼š\npfctl -f /etc/pf.conf # åŠ è½½ pf é…ç½®æ–‡ä»¶ pfctl -e # å¯ç”¨ pf é˜²ç«å¢™ éªŒè¯ pf é…ç½® ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥é˜²ç«å¢™è§„åˆ™æ˜¯å¦å·²æˆåŠŸåŠ è½½ï¼š\npfctl -sr ç¡®è®¤è¿æ¥ å…è®¸ 22 ç«¯å£ï¼šä½ å¯ä»¥é€šè¿‡ ssh è¿æ¥åˆ°è¿™å°æœºå™¨ï¼Œç¡®è®¤ 22 ç«¯å£æ˜¯å¦å¼€æ”¾ã€‚\nå…è®¸ 1080 ç«¯å£ï¼šä½ å¯ä»¥é€šè¿‡ SOCKS å®¢æˆ·ç«¯è¿æ¥åˆ°ä½ çš„ SOCKS ä»£ç†ï¼Œç¡®è®¤ 1080 ç«¯å£æ˜¯å¦å¼€æ”¾ã€‚\nå…¶ä»–ç«¯å£ï¼šå…¶ä»–ç«¯å£çš„è¿æ¥ä¼šè¢«é˜»æ­¢ã€‚\né…ç½®è§£é‡Šï¼š å…è®¸æ‰€æœ‰å‡ºç«™æµé‡ï¼š pass out all è§„åˆ™æ”¾è¡Œæ‰€æœ‰ä»æœ¬æœºå‡ºå»çš„æµé‡ã€‚è¿™æ ·ä½ å°±å¯ä»¥è‡ªç”±è®¿é—®å¤–éƒ¨ç½‘ç»œã€‚\nå…è®¸è¿›ç«™æµé‡çš„é™åˆ¶ï¼š pass in on $ext_if proto tcp from any to any port 22 keep state åªå…è®¸å¤–éƒ¨è®¿é—® 22 ç«¯å£ï¼ˆSSHï¼‰ã€‚\npass in on $ext_if proto tcp from any to any port 1080 keep state åªå…è®¸å¤–éƒ¨è®¿é—® 1080 ç«¯å£ï¼ˆä½ çš„ SOCKS æœåŠ¡ï¼‰ã€‚\né»˜è®¤é˜»æ­¢æ‰€æœ‰å…¥ç«™æµé‡ï¼š block all è¿™æ¡è§„åˆ™é˜»æ­¢æ‰€æœ‰æœªè¢«æ˜ç¡®å…è®¸çš„å…¥ç«™æµé‡ï¼Œç¡®ä¿æœåŠ¡å™¨æ›´åŠ å®‰å…¨ã€‚\nä¿æŒè¿æ¥çŠ¶æ€ï¼š keep state ä¿è¯äº†å…è®¸çš„è¿æ¥çŠ¶æ€ï¼ˆå¦‚ SSH å’Œ SOCKSï¼‰çš„æŒç»­æ€§ã€‚æ„å‘³ç€ä½ å»ºç«‹çš„è¿æ¥ä¸ä¼šå› ä¸ºé˜²ç«å¢™è§„åˆ™çš„å˜åŠ¨è€Œè¢«æ„å¤–ä¸­æ–­ã€‚\nè¿™æ ·ï¼Œä½ çš„é˜²ç«å¢™ä¼šå…è®¸å¤–éƒ¨çš„ SSH å’Œ SOCKS æµé‡ï¼Œä½†æ‹’ç»å…¶ä»–ç«¯å£çš„è®¿é—®ï¼ŒåŒæ—¶å…è®¸æ‰€æœ‰çš„å‡ºç«™æµé‡ã€‚\n","permalink":"https://hanigege.github.io/posts/freebsd/freebsd14.2%E6%8B%89%E5%8F%96%E6%BA%90%E7%A0%81%E5%AE%89%E8%A3%85sing-box/","tags":null,"title":"Freebsd14.2æ‹‰å–æºç å®‰è£…sing-Box(åŒ…å«pfé˜²ç«å¢™é…ç½®)"},{"categories":["freebsd"],"contents":"freebsd14.2å®‰è£…go1.23.1æœ€æ–°ç‰ˆ 1. å®‰è£…ä¾èµ– Mihomo ä¾èµ–ä¸€äº›åŸºç¡€çš„å·¥å…·å’Œåº“ï¼Œé¦–å…ˆéœ€è¦ç¡®ä¿ä½ çš„ç³»ç»Ÿå·²å®‰è£…è¿™äº›ä¾\npkg update pkg install -y git cmake libevent # pkg install -y go ä»ä½ æä¾›çš„é”™è¯¯ä¿¡æ¯æ¥çœ‹ï¼Œç¼–è¯‘å¤±è´¥çš„åŸå› æ˜¯ go.mod æ–‡ä»¶è¦æ±‚ Go ç‰ˆæœ¬è‡³å°‘ä¸º 1.23.1ï¼Œè€Œå½“å‰ç³»ç»Ÿä¸Šå®‰è£…çš„ Go ç‰ˆæœ¬ä¸º 1.21.13ã€‚ä¸ºäº†ç»§ç»­ç¼–è¯‘ sing-boxï¼Œä½ éœ€è¦æ›´æ–° Go è¯­è¨€ç‰ˆæœ¬ã€‚\næ›´æ–° Go è¯­è¨€ç‰ˆæœ¬çš„æ­¥éª¤ï¼š å¸è½½å½“å‰çš„ Go ç‰ˆæœ¬ï¼ˆå¦‚æœæ˜¯é€šè¿‡åŒ…ç®¡ç†å™¨å®‰è£…çš„ï¼‰ï¼š\npkg delete go å®‰è£…æœ€æ–°ç‰ˆçš„ Go è¯­è¨€ï¼š\nä½ å¯ä»¥é€šè¿‡ FreeBSD çš„ pkg å®‰è£…æœ€æ–°çš„ Go ç‰ˆæœ¬ï¼Œæˆ–è€…ç›´æ¥ä» Go å®˜æ–¹ç½‘ç«™ä¸‹è½½å¹¶å®‰è£…ã€‚\næ–¹æ³• 1ï¼šä½¿ç”¨ pkg å®‰è£…æœ€æ–°ç‰ˆ Go\npkg install go æ–¹æ³• 2ï¼šæ‰‹åŠ¨å®‰è£…æœ€æ–°ç‰ˆæœ¬ Go\nä» Go å®˜æ–¹ç½‘ç«™ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ Go è¯­è¨€ï¼š\nè®¿é—® Go è¯­è¨€å®˜ç½‘ ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ Goã€‚é€‰æ‹©é€‚åˆ FreeBSD çš„ç‰ˆæœ¬ï¼Œä¾‹å¦‚ go1.23.1.freebsd-amd64.tar.gzã€‚\nrootç”¨æˆ·çš„ä¸¤ç§å®‰è£…æ–¹æ³•ï¼š è§£å‹å¹¶å®‰è£…ï¼š\nåŸæ–¹å¼ï¼š\nfetch https://golang.org/dl/go1.23.1.freebsd-amd64.tar.gz tar -C /usr/local -xzf go1.23.1.freebsd-amd64.tar.gz æ”¹è·¯å¾„ï¼š\nmkdir -p /usr/local/opt/ fetch -o /usr/local/opt/go1.23.1.freebsd-amd64.tar.gz https://golang.org/dl/go1.23.1.freebsd-amd64.tar.gz cd /usr/local/opt/ tar -C /usr/local/opt/ -xzf go1.23.1.freebsd-amd64.tar.gz æ™®é€šç”¨æˆ·çš„å®‰è£…æ–¹æ³•ï¼š(åªèƒ½åœ¨è‡ªå·±ç›®å½•ä¸­æ“ä½œï¼Œå¥½å¤„:å®‰å…¨ï¼Œéš”ç¦»ï¼‰{æ¨è} mkdir -p .usr/local/opt/ fetch -o .usr/local/opt/go1.23.1.freebsd-amd64.tar.gz https://golang.org/dl/go1.23.1.freebsd-amd64.tar.gz cd .usr/local/opt/ tar -C ~/.usr/local/opt/ -xzf go1.23.1.freebsd-amd64.tar.gz è®¾ç½® Go ç¯å¢ƒå˜é‡ï¼š\næ‰“å¼€~/.profile æ–‡ä»¶ï¼Œæ·»åŠ  Go çš„ç¯å¢ƒå˜é‡ï¼š\nåŸæ–¹å¼ï¼š\nexport PATH=$PATH:/usr/local/go/bin æ”¹è·¯å¾„åï¼š\nexport PATH=$PATH:/usr/local/opt/go/bin æ™®é€šç”¨æˆ·ä¸‹ï¼šåœ¨.bash_profile æ–‡ä»¶ä¸­æ·»åŠ å˜é‡ï¼ˆæ™®é€šç”¨æˆ·å·²æ”¹ä¸ºbashæŒ‡ä»¤ï¼‰å¦‚ç”¨æshæŒ‡ä»¤ï¼Œé‚£å°±åœ¨.profileæ–‡ä»¶ä¸­æ”¹ï¼š export PATH=$PATH:~/.usr/local/opt/go/bin åˆ·æ–°é…ç½®æˆ–é‡å¯ç»ˆç«¯ï¼šåœ¨ FreeBSD ä¸­ï¼Œé»˜è®¤ä½¿ç”¨çš„ shell æ˜¯ shï¼Œè€Œ sh ä¸æ”¯æŒ source å‘½ä»¤ã€‚ç›¸åï¼Œsh ä½¿ç”¨ . æ¥ä»£æ›¿ sourceã€‚å› æ­¤ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ shï¼Œéœ€è¦æ”¹ä¸ºä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥åŠ è½½é…ç½®æ–‡ä»¶ï¼š\n. ~/.profile or\n. .bash_profile éªŒè¯ Go ç‰ˆæœ¬æ˜¯å¦æ›´æ–°æˆåŠŸï¼š\ngo version è¾“å‡ºåº”æ˜¾ç¤ºæœ€æ–°çš„ Go ç‰ˆæœ¬ï¼Œä¾‹å¦‚ï¼š\ngo version go1.23.1 freebsd/amd64 é‡æ–°ç¼–è¯‘Sing-Boxï¼š\nå®Œæˆ Go è¯­è¨€ç‰ˆæœ¬çš„æ›´æ–°åï¼Œè¿”å›åˆ° sing-box ç›®å½•å¹¶é‡æ–°è¿è¡Œ make å‘½ä»¤ï¼š\ncd ~/sing-box make å¦‚æœæ‰€æœ‰ä¾èµ–é¡¹éƒ½æ­£ç¡®å®‰è£…ï¼Œå¹¶ä¸”ç¯å¢ƒé…ç½®æ— è¯¯ï¼Œè¿™æ—¶åº”è¯¥èƒ½å¤ŸæˆåŠŸç¼–è¯‘ sing-boxã€‚\næ€»ç»“ï¼š æ›´æ–° Go ç‰ˆæœ¬åˆ° 1.23.1 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚\nå¦‚æœ Go ç‰ˆæœ¬æ›´æ–°æˆåŠŸï¼Œå†æ¬¡å°è¯•è¿è¡Œ make æ¥ç¼–è¯‘ sing-boxã€‚\n","permalink":"https://hanigege.github.io/posts/freebsd/freebsd-install-go1231/","tags":null,"title":"Freebsd Install Go1231"},{"categories":["linux"],"contents":"acme.shè„šæœ¬ç”³è¯·cloudflareçš„è¯ä¹¦ æ”¯æŒæ³›åŸŸå å‰è¨€ï¼šacme.shæ˜¯ä¸€ä¸ªéå¸¸å¥½ç”¨çš„ç”¨äºç”³è¯·è¯ä¹¦çš„è„šæœ¬ï¼Œå®ƒå¼€æºåœ¨Githubï¼Œå®ƒæå¤§åœ°é™ä½äº†ç”³è¯·è¯ä¹¦çš„éš¾åº¦ï¼Œæ”¯æŒä½¿ç”¨cloudflare apiç­‰å¤šç§apiæ¥ç”³è¯·è¯ä¹¦ã€‚\næœ¬æ–‡ä¸»è¦ä»‹ç»ä½¿ç”¨æ­¤è„šæœ¬æ¥ç”³è¯· ssl è¯ä¹¦ï¼Œç»™ä½ çš„httpè¯·æ±‚åŠ æŠŠé”ï¼Œå…·ä½“å¯ä»¥ç”¨æ¥cloudflare apiä»‹ç»ã€‚\nå‡†å¤‡æ¡ä»¶ï¼š ä¸€å°è¢«åˆ†é…äº†å…¬ç½‘IPçš„ä¸»æœº\nä¸€ä¸ªåŸŸå(å»ºè®®è´­ä¹°æ”¶è´¹åŸŸå)\nç”µè„‘sshå®¢æˆ·ç«¯\nèƒ½è§£å†³ä¸ªä½“çš„é—®é¢˜\nä¸€ã€å…¨çƒAPIç”³è¯·è¯ä¹¦ 1.1ã€å®‰è£…è„šæœ¬æ–‡ä»¶ ä»¥rootç”¨æˆ·sshè¿æ¥åˆ°ä¸»æœºï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å®‰è£…è„šæœ¬ï¼š\napt update \u0026amp;\u0026amp; apt -y install socat //æ›´æ–°æºå¹¶å®‰è£…socat wget -qO- get.acme.sh | bash //å®‰è£…æ­¤è„šæœ¬ source ~/.bashrc //è®©åˆ«åç”Ÿæ•ˆï¼Œæ­¤åæ— è®ºåœ¨å“ªé‡Œç›´æ¥ä½¿ç”¨acme.shï¼Œä¸ç”¨è¾“ç»å¯¹è·¯å¾„ # ç”±äºæœ€æ–°acme.shè„šæœ¬é»˜è®¤caå˜æˆäº†zerosslï¼Œç°## æ‰§è¡Œä¸‹é¢å‘½ä»¤ä¿®æ”¹è„šæœ¬é»˜è®¤caä¸ºletsencrypt acme.sh --set-default-ca --server letsencrypt 1.2ã€è¯ä¹¦é…ç½® 1.2.1 è·å–Cloudflare api key æ³¨å†Œå¥½cloudflareè´¦å·ï¼ŒæŠŠåŸŸåè§£æçš„è§£ææƒé™é”å®šcloudflareå¤„ç†ï¼Œè¿™æ ·ä»¥ååªéœ€è¦åœ¨cloudflareè¿™é‡Œé…ç½®è§£æè®°å½•ã€‚æŒ‰ç…§å›¾æ ‡è·å–cloudflare api keyã€‚ 1.2.2 ç”³è¯·è¯ä¹¦ï¼ˆäºŒé€‰ä¸€ï¼‰ è¿™é‡Œå‡è®¾æ‚¨çš„åŸŸåæ˜¯yourdomain.comï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤ç”³è¯·è¯ä¹¦ï¼š\n1.2.2.1 dnsæ–¹å¼éªŒè¯\nexport CF_Key=\u0026#34;slfjksjffjfhfhkjhfksjf\u0026#34; //æ­¤å¤„æ›¿æ¢æˆä½ è‡ªå·±çš„Key export CF_Email=\u0026#34;yourcloudflare@gmail.com\u0026#34; //æ­¤å¤„å¡«å†™ä½ ç»™Cloudflareç»‘å®šçš„é‚®ç®±è´¦å· acme.sh --issue --dns dns_cf -d yourdomain.com -d www.yourdomain.com -k ec-256 è¯´æ˜ï¼šCloudflare ç›®å‰ä¸æ”¯æŒ.tk .cf .mlç­‰å…è´¹ç”³è¯·æ¥çš„åŸŸååç¼€ä½¿ç”¨æ­¤ DNS éªŒè¯æ–¹å¼ï¼Œä»˜è´¹åŸŸåæ‰å—æ”¯æŒï¼Œå…è´¹åŸŸåä½¿ç”¨ä½äº 2.2.2 æ–¹å¼ã€‚è„šæœ¬ç”³è¯·åˆ°çš„è¯ä¹¦å’Œå¯†é’¥éƒ½æ”¾åœ¨ç›®å½•ä¸‹~/.acme.sh/yourdomain.com_eccã€‚\n1.2.2.2 httpæ–¹å¼éªŒè¯ æ‰§è¡Œä¸‹é¢å‘½ä»¤å‰è¯·ä¿è¯ä½ 80ç«¯å£æ²¡æœ‰è¢«å…¶ä»–ç¨‹åºä½¿ç”¨ï¼Œå¦‚æœæœ‰ï¼Œkillæ‰ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤å‰éœ€è¦ä½ å…ˆåœ¨cloudflare dnsé‚£é‡Œæ·»åŠ å¥½ä¸€æ¡è®°å½•å¯ä»¥ï¼Œå¼€å¯cloudflare cdnï¼ˆcdnæ­¤æ—¶httpæ–¹å¼éªŒè¯æ— ï¼‰å½±å“ï¼‰ï¼š\nacme.sh --issue --standalone -d yourdomain.com -d www.yourdomain.com -k ec-256 è¯´æ˜ï¼šè·Ÿä¸Šé¢ä¸€æ ·ï¼Œè„šæœ¬ç”³è¯·åˆ°çš„è¯ä¹¦æ”¾åœ¨~/.acme.sh/yourdomain.com_eccç›®å½•ä¸‹\n1.2.3 å®‰è£…è¯ä¹¦åˆ°æŒ‡å®šä½ç½® å¦‚æœlinuxä¸»æœºé‡Œå·²æœ‰/root/sslç›®å½•ï¼Œç°åœ¨å·²ç»æŠŠè¯ä¹¦å’Œå¯†é’¥å®‰è£…åˆ°è¿™ä¸ªç›®å½•ä¸‹ï¼Œé‚£ä¹ˆæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å³å¯ï¼š\nacme.sh --installcert -d yourdomain.com -d www.yourdomain.com --fullchain-file /root/ssl/web.crt --key-file /root/ssl/web.key --ecc 1.3ã€è¯ä¹¦æ›´æ–° ä½†ä»letscncryptç”³è¯·è¯ä¹¦åˆ°çš„ç¨‹åº¦æ˜¯90å¤©ï¼Œè„šæœ¬ä¼šæ¯60å¤©åˆ°è¯ä¹¦è¿›è¡Œæ›´æ–°ï¼Œåç»­å¯èƒ½ä¼šæŒç»­è¿™ä¸ªæ—¶é—´ï¼Œéƒ½æ˜¯è‡ªåŠ¨çš„ã€‚\n# æ‰‹åŠ¨å¼ºåˆ¶æ›´æ–°è¯ä¹¦ acme.sh --renew -d yourdomain.com -d www.yourdomain.com --force --ecc äºŒã€å±€éƒ¨API æœ¬æ–‡ä¸»è¦ä»¥Debian10ä¸ºä¾‹ï¼Œä»‹ç»ä½¿ç”¨æ–°çš„cloudflare apiä»¤ç‰Œæ¥ç”³è¯·è¯ä¹¦ï¼Œå…è´¹åŸŸåå·²ä¸å—cloudflareç¬¬ä¸€æ–¹å¼æ¥ç”³è¯·è¯ä¹¦ï¼Œè¯·ä½¿ç”¨ä»˜è´¹åŸŸåã€‚\n2.1ã€å®‰è£…é…ç½®acme.shè„šæœ¬ ä»¥rootç”¨æˆ·sshç™»é™†åˆ°ä¸»æœºï¼Œä½¿ç”¨ä¸‹é¢å‘½ä»¤å®‰è£…é…ç½®è„šæœ¬ï¼š\næ›´æ–°æºå¹¶å®‰è£…socat apt update \u0026amp;\u0026amp; apt -y install socat # å®‰è£…è„šæœ¬ wget -qO- get.acme.sh | bash # è®©è„šæœ¬åœ¨.bashrcæ–‡ä»¶è¿½åŠ çš„ä¸€è¡Œç¯å¢ƒå˜é‡ç”Ÿæ•ˆï¼Œä»¥åæ— è®ºåœ¨å“ªé‡Œç›´æ¥ä½¿ç”¨acme.shï¼Œä¸ç”¨è¾“ç»å¯¹è·¯å¾„ source ~/.bashrc # ç”±äºæœ€æ–°acme.shè„šæœ¬é»˜è®¤caå˜æˆäº†zerosslï¼Œç°æ‰§è¡Œä¸‹é¢å‘½ä»¤ä¿®æ”¹è„šæœ¬é»˜è®¤caä¸ºletsencrypt acme.sh --set-default-ca --server letsencrypt 2.2ã€é…ç½®Cloudflareç§¯åˆ†ä»¤ç‰Œ 2.2.1 åˆ›å»ºä»£å¸ æ ¹æ®acme.shä½œè€…è„šæœ¬æä¾›çš„æ–‡æ¡£ï¼šä½¿ç”¨æ–°çš„cloudflare apiä»¤ç‰Œï¼Œéœ€è¦æ–°åˆ›å»ºæ­¤ä»¤ç‰Œæ–¹å¯ä½¿ç”¨ï¼š å…¶ä¸­å›¾ç‰‡è®¾ç½®å³å¯ï¼Œé€‰æ‹©æ·»åŠ åŒºåŸŸ-DNS-ç¼–è¾‘å’ŒåŒºåŸŸ-åŒºåŸŸ-è¯»å–æƒé™ï¼ŒåŒºåŸŸèµ„æºé‡Œé¢åŒ…æ‹¬-è´¦æˆ·çš„æ‰€æœ‰åŒºåŸŸ-ä½ çš„è´¦æˆ· é…ç½®å¥½ä»¥åï¼Œç‚¹å‡»åˆ›å»ºä»¤ç‰Œï¼Œæ³¨æ„æ­¤ä»¤ç‰Œtokenåªä¼šå‡ºç°ä¸€æ¬¡ï¼Œåˆ‡è®°ä¿å­˜ï¼Œåˆ‡è®°ä¿å­˜ï¼Œåˆ‡è®°ä¿å­˜ï¼ï¼ï¼\n2.2.2 è·å–è´¦æˆ·IDå’ŒåŒºåŸŸID æ ¹æ®acme.shæ–‡æ¡£ï¼Œç”³è¯·è¯ä¹¦å¯èƒ½è¿˜éœ€è¦æä¾›ä¸¤ä¸ªIDï¼Œå…¶ä¸­è´¦æˆ·IDå¿…é¡»ï¼ŒåŒºåŸŸIDå¯æœ‰æ— ï¼Œæ ¹æ®ä¸‹å›¾æ–¹æ³•è·å–è¿™ä¸¤ä¸ªIDï¼š ä¸‹æ‹‰ï¼Œæ‰¾åˆ°APIåŒºåŸŸï¼š\nè‡³æ­¤ï¼Œå³å‡†å¤‡å¥½ç”³è¯·è¯ä¹¦æ‰€éœ€çš„ææ–™ï¼š\n# ä¸Šé¢ç¬¬ä¸€æ­¥åˆ›å»ºçš„ä»¤ç‰Œï¼Œå³ä¸ºtoken CF_Token=\u0026#34;xxxxxxx\u0026#34; # æ ¹æ®ä¸Šå›¾åˆ†åˆ«è·å–è´¦æˆ·IDå’ŒåŒºåŸŸID CF_Account_ID=\u0026#34;aaaaaaaa\u0026#34; CF_Zone_ID=\u0026#34;bbbbbbbbb\u0026#34; //æ­¤é¡¹éå¿…é¡» 2.3ã€ç”³è¯·é…ç½®è¯ä¹¦ 2.3.1 ç”³è¯·è¯ä¹¦ å¦‚æœæ‚¨çš„åŸŸåæ˜¯example.comï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤ç”³è¯·è¯ä¹¦ï¼Œérootç”¨æˆ·ä¹Ÿæ‰§è¡Œï¼š\n# æ‰§è¡Œæ­¤å‘½ä»¤è®¾ç½®å˜é‡çš„å€¼ï¼Œacme.shè„šæœ¬æ‰§è¡Œè¿‡ç¨‹ä¼šè¯»å– export CF_Token=\u0026#34;xxxxxxx\u0026#34; export CF_Account_ID=\u0026#34;aaaaaaa\u0026#34; export CF_Zone_ID=\u0026#34;bbbbbbbb\u0026#34; //æ­¤é¡¹éå¿…é¡»ï¼Œä¸Šé¢ä¸¤é¡¹éœ€è¦æä¾› # ç”³è¯·è¯ä¹¦ acme.sh --issue -d example.com -d *.example.com --dns dns_cf -k ec-256 2.3.2 å®‰è£…è¯ä¹¦åˆ°æŒ‡å®šä½ç½® å¦‚æœlinuxä¸»æœºé‡Œå·²æœ‰/etc/sslç›®å½•ï¼Œç°åœ¨å·²ç»æŠŠè¯ä¹¦å’Œå¯†é’¥å®‰è£…åˆ°è¿™ä¸ªç›®å½•ä¸‹ï¼Œé‚£ä¹ˆæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å³å¯ï¼š\nacme.sh --installcert -d example.com -d *.example.com --fullchain-file /etc/ssl/web.crt --key-file /etc/ssl/web.key --ecc # ç”¨--reloadcmdæŒ‡å®šå®‰è£…è¯ä¹¦åçš„å‘½ä»¤ acme.sh --installcert -d example.com -d *.example.com --fullchain-file /etc/ssl/web.crt --key-file /etc/ssl/web.key --ecc --reloadcmd \u0026#34;systemctl restart webserver\u0026#34; è¯´æ˜ï¼šè„šæœ¬æ›´æ–°å®Œè¯ä¹¦åï¼Œä¼šè‡ªåŠ¨éµå¾ªä¸Šé¢æŒ‡å®šçš„ç»å¯¹è·¯å¾„å°†è¯ä¹¦å’Œå¯†é’¥å®‰è£…åˆ°æŒ‡å®šä½ç½®ï¼Œå¹¶æ ¹æ®\u0026ndash;reloadcmdæ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚\n------------------------\nä¾‹ï¼šæˆ‘çš„sslç›®å½•è·¯å¾„ä¸ºï¼š #nginxgé…ç½®æ–‡ä»¶é‡Œçš„è¯ä¹¦è·¯å¾„ï¼Œåªé™äºæˆ‘è‡ªå·±ä½¿ç”¨ï¼Œä½ ä»¬éšæ„ ssl_certificate /etc/nginx/certs/web.crt; ssl_certificate_key /etc/nginx/certs/web.key; acme.sh --installcert -d 29.xyz -d *.29.xyz --fullchain-file /root/data/docker_data/nginx/certs/web.crt --key-file /root/data/docker_data/nginx/certs/web.key --ecc #å®‰è£…åˆ°æˆ‘æŒ‡å®šçš„è·¯å¾„ -------------------------\n2.3.3 è¯ä¹¦æ›´æ–° ä»letsencryptç”³è¯·åˆ°çš„è¯ä¹¦æœ‰æ•ˆæœŸæ˜¯90å¤©ï¼Œè„šæœ¬æ¯60å¤©å°†è¿›è¡Œè¯ä¹¦æ›´æ–°ï¼Œä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨å¼ºåˆ¶æ›´æ–°ï¼š\n# æŸ¥è¯¢åŸŸåç”³è¯·è¯ä¹¦ä¿¡æ¯ acme.sh --list # è‡ªåŠ¨æ›´æ–°è¯ä¹¦ ~/.acme.sh/acme.sh --upgrade --auto-upgrade # æ‰‹åŠ¨å¼ºåˆ¶æ›´æ–°è¯ä¹¦ acme.sh --renew -d example.com -d *.example.com --force --ecc acme.sh --renew -d example.com -d *.example.com --force //éECCè¯ä¹¦ä½¿ç”¨æ­¤å‘½ä»¤ é™„ä¸€ä»½nginx.confå®Œæ•´çš„åå‘ä»£ç†é…ç½®æ–‡ä»¶ä¾›å‚è€ƒï¼š events { worker_connections 1024; } http { client_max_body_size 4096m; server { listen 80; listen [::]:80; server_name 29.xyz; return 301 https://$host$request_uri; } server { listen 443 ssl; listen [::]:443 ssl; server_name 29.xyz; ssl_certificate /etc/nginx/certs/web.crt; ssl_certificate_key /etc/nginx/certs/web.key; location / { proxy_pass http://192.168.8.8:8008; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; } } server { listen 80; listen [::]:80; server_name s.29.xyz; return 301 https://$host$request_uri; } server { listen 443 ssl; listen [::]:443 ssl; server_name s.29.xyz; ssl_certificate /etc/nginx/certs/web.crt; ssl_certificate_key /etc/nginx/certs/web.key; location / { proxy_pass http://192.168.8.8:12332; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; } } #htmlé™æ€ç½‘é¡µ server { listen 80; server_name hp.29.xyz; return 301 https://$server_name$request_uri; } server { listen 443 ssl; server_name hp.29.xyz; ssl_certificate /etc/nginx/certs/web.crt; ssl_certificate_key /etc/nginx/certs/web.key; charset utf-8; # æ·»åŠ è¿™è¡Œæ¥æŒ‡å®šç¼–ç  location / { #è§£å†³css.jsåŠ è½½ include mime.types; default_type application/octet-stream; ##è§£å†³css.jså®Œæ¯• root /usr/share/nginx/html; index index.html; } } ##é™æ€ç½‘é¡µå®Œ } ","permalink":"https://hanigege.github.io/posts/linux/%E6%89%8B%E5%8A%A8%E7%94%B3%E8%AF%B7%E5%9F%9F%E5%90%8Dssl%E8%AF%81%E4%B9%A6/","tags":null,"title":"æ‰‹åŠ¨ç”³è¯·åŸŸåsslè¯ä¹¦"},{"categories":["other"],"contents":"å‰è¨€ æˆ‘ä¸ªäººæ­å»ºSIPçš„ä¸»è¦ç›®çš„æ˜¯å› ä¸ºæˆ‘ä¸ªäººæœ‰å¾ˆå¤šæ‰‹æœºå¡ï¼Œè€Œæ‰‹æœºåªæœ‰2ä¸ªå¡æ§½ï¼Œå¹¶ä¸”æ¯å¹´å‡ºå›½ç©çš„æ—¶å€™æ‰‹æœºå¸¦å‡ºå»å°±æ˜¯å…¨çƒæ¼«æ¸¸ï¼Œé‚£åŸºæœ¬ä¸æ•¢æ‰“ç”µè¯ã€‚æ‰€ä»¥å†³å®šæ­å»ºä¸€å¥—è‡ªå·±çš„SIP Serveræ¥è¿›è¡Œæ‹¨æ‰“æ¥å¬ç”µè¯ï¼Œæ‰‹æœºé‡Œåªæ”¾ä¸€å¼ æµé‡å¡ï¼Œè€Œä¸”åœ¨ä¸åŒåœ°ç‚¹å¯ä»¥åœ¨æ‰‹æœºåŸç†èº«è¾¹çš„æ—¶å€™åœ¨å…¶ä»–ç»ˆç«¯æ¥å¬ç”µè¯ã€‚è¿˜èƒ½ç ”ç©¶å­¦ä¹ ä¸€é¡¹æ–°æŠ€æœ¯ï¼ˆç¬‘ï¼‰\nç»è¿‡å¤šæ”¾è€ƒè™‘æœ€åæˆ‘é€‰æ‹©äº†Synwayå‡ºå“çš„SMG4004-4LCè¿™æ¬¾GOIPæœºå™¨ï¼Œæ”¯æŒå…¨ç½‘é€šï¼Œ4ä¸ªå¡æ§½ï¼ˆé•¿æœŸåº”è¯¥æ˜¯å¤Ÿç”¨äº†ï¼‰ï¼ŒSMS Over Emailï¼ˆè™½ç„¶ä»–ä¹Ÿæ”¯æŒSMS Over SIPï¼Œä½†ç”±äºFreePBXå®˜æ–¹ä¸æ”¯æŒï¼Œè€Œä¸”æœ¬æ¬¡æˆ‘åˆ†æœºä¸»è¦åˆ›å»ºçš„æ˜¯PJSIPï¼Œè€Œè¿™æ¬¾æœºå™¨çš„SMSæ˜¯é€šè¿‡Chan SIPå‘é€çš„ï¼Œå¤„ç†èµ·æ¥å¾ˆéº»çƒ¦ï¼Œæœ€åé€‰æ‹©äº†ä½¿ç”¨Emailæ¥æ”¶çš„æ–¹å¼ã€ç¨³å®šä¸€äº›ã€‘ï¼Œå½“ç„¶å®˜æ–¹æä¾›äº†å¤§é‡APIæ¥å£ï¼Œåº”è¯¥æ˜¯å¯ä»¥å†™ä¸€äº›æœºå™¨äººå‘é€åˆ°å¦‚Telegramä¹‹ç±»çš„ã€å·²è§£å†³ï¼Œæœ¬ç«™æœ‰æä¾›ã€‘ï¼‰ï¼Œè€Œä¸”å›½å†…è¿˜æœ‰ä»£ç†å•†ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„ä¹°åˆ°ã€‚\nå¡æ§½ç•Œé¢ æ­å»ºFreePBX æˆ‘ç›´æ¥ä½¿ç”¨äº†å®˜æ–¹ISOé•œåƒï¼ˆåŸºäºCentOSï¼‰è¿›è¡Œé»˜è®¤æ­å»ºï¼Œæ­å®Œè¿˜å‡äº†ä¸ªçº§ï¼Œå…³äºFreePBXè®¾ç½®çš„æ•™ç¨‹ç½‘ä¸Šå¾ˆå¤šï¼Œä¸Šå‡ ä¸ªå›¾å¤§å®¶ä¹Ÿå¯ä»¥å‚ç…§æˆ‘å›¾é‡Œçš„è¿›è¡Œè®¾ç½®ã€‚ è¿˜è¦è®¾ç½® PJSIPçš„UDP,TCPåè®®å¼€å¯ è½¯è·¯ç”±å¼€å¯ç«¯å£ å¯¹æ¥ç½‘å…³ é¦–å…ˆè¦å°†ç½‘å…³æ•´æœºæ³¨å†Œåˆ°FreePBXå®ç°SIPäº’é€š\nåˆ›å»ºä¸­ç»§è´¦å· é€‰æ‹©åˆ›å»ºä¸€ä¸ª chan_sip ä¸­ç»§ é¦–å…ˆä»…å¡«å†™ä¸­ç»§å è·¯ç”±è§„åˆ™å†™ X. SIPè®¾ç½®é¡µé¢å¡«å†™ä¸­ç»§åã€å’Œä¸­ç»§é…ç½®ï¼ˆå¯å‚è€ƒä¸‹æ–¹æˆ‘çš„é…ç½®ï¼‰ host=dynamic port=5160 type=peer secret=da*********************éšä¾¿è®¾ç½®ä¸ªå¯†ç  context=from-pstn dtmfmode=rfc2833 insecure=no qualify=3000 è®¾ç½®å‡ºå±€çº¿è·¯ è®¾ç½®å®Œä¸­ç»§ä¹‹åæˆ‘ä»¬è¿˜éœ€è¦è®¾ç½®ä¸€ä¸‹å‡ºå±€çº¿è·¯è®©FreePBXçš„åˆ†æœºå¯ä»¥æˆåŠŸèµ°ç½‘å…³è¿›è¡Œæ‹¨æ‰“ è®¾ç½®ä¸€ä¸‹åŒ¹é…ä¸­ç»§ è®¾ç½®åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ä¸º X. ä¿å­˜FreePBXé…ç½® ç‚¹å‡» æ³¨å†Œç½‘å…³åˆ°FreePBX æ¥åˆ°ç½‘å…³çš„ç®¡ç†ç•Œé¢ï¼Œä¸€å®šè¦é€‰æ‹©æ³¨å†Œæ•´ä¸ªç½‘å…³ï¼Œå¯†ç å°±æ˜¯åˆ›å»ºä¸­ç»§é…ç½®æ–‡ä»¶é‡Œçš„é‚£ä¸ª ","permalink":"https://hanigege.github.io/posts/other/voip-0/","tags":null,"title":"å‡ºå›½è‡ªå»ºvoip(ä¸€.2)FreePBXå¯¹æ¥SMG4004ç½‘å…³å®ç°SIPç½‘ç»œç”µè¯"},{"categories":["routers"],"contents":"1ã€ä»£ç å¯¼å…¥çš„æ–¹æ³• å¯¼å…¥é˜Ÿåˆ—çš„ä»£ç ï¼š\n/queue tree add parent=global packet-mark=dns priority=1 queue=default-small name=Dns add parent=global packet-mark=small-packet priority=1 queue=default-small name=Small-packet add parent=global packet-mark=medium-packet priority=2 queue=default-small name=\u0026#34;Medium-packet\u0026#34; å†å¯¼å…¥mangleçš„ä»£ç ï¼š\n/ip firewall mangle add action=mark-packet chain=prerouting protocol=udp dst-port=53 new-packet-mark=dns passthrough=yes add action=mark-packet chain=prerouting protocol=tcp dst-port=53 new-packet-mark=dns passthrough=yes add action=mark-connection chain=prerouting protocol=tcp dst-port=80,443 new-connection-mark=small passthrough=yes add action=mark-packet chain=prerouting connection-mark=small packet-size=0-128 new-packet-mark=small-packet passthrough=no add action=mark-packet chain=prerouting connection-mark=small packet-size=129-512 new-packet-mark=medium-packet passthrough=no add action=change-mss chain=forward protocol=tcp tcp-flags=syn new-mss=clamp-to-pmtu passthrough=yes add action=mark-connection chain=forward protocol=tcp dst-port=80,443 new-connection-mark=small passthrough=yes add action=mark-packet chain=forward connection-mark=small packet-size=0-128 new-packet-mark=small-packet passthrough=no add action=mark-packet chain=forward connection-mark=small packet-size=129-512 new-packet-mark=medium-packet passthrough=no æœ€åçœ‹æ˜¯å¦ç”Ÿæ•ˆï¼š ","permalink":"https://hanigege.github.io/posts/routers/ros%E7%9A%84mangle%E5%B0%8F%E5%8C%85%E8%A7%84%E5%88%99/","tags":null,"title":"ROSçš„MANGLEå°åŒ…è§„åˆ™"},{"categories":["freebsd"],"contents":"æˆ‘ä¸ªäººä¸å»ºè®®å®‰è£…å¼€å¯sudo,å› ä¸ºæ™®é€šç”¨æˆ·ç”¨è‡ªå·±çš„å¯†ç å°±å¯ä»¥æå‡ç®¡ç†æƒé™ã€‚ä¸ªäººç†è§£è¿˜æ˜¯å®Œå…¨éš”ç¦»çš„å¥½ **ä¸‹é¢åªæä¾›çŸ¥è¯†ç‚¹å‚è€ƒ**ï½\nå®‰è£…freebsdæ—¶å·²ç»æ·»åŠ å¥½æ™®é€šç”¨æˆ·çš„ï¼Œå¯ä»¥ç›´æ¥ä»ä¸‹é¢å¯ä»¥ç”¨ visudo æ‰“å¼€ sudo é…ç½®æ–‡ä»¶ è¿™é‡Œç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶å°±å¯ä»¥äº†ã€‚ ä½ çœ‹åˆ°çš„æç¤ºï¼š\ngary is not in the sudoers file. This incident has been reported to the administrator. æ„æ€æ˜¯ï¼šå½“å‰ç”¨æˆ· gary æ²¡æœ‰æƒé™ä½¿ç”¨ sudoï¼Œå› æ­¤ä¸èƒ½å®‰è£…è½¯ä»¶æˆ–æ‰§è¡Œéœ€è¦ç®¡ç†å‘˜æƒé™çš„æ“ä½œã€‚\nè§£å†³åŠæ³•ï¼ˆéœ€è¦ root ç”¨æˆ·æ“ä½œï¼‰ ä½ éœ€è¦åˆ‡æ¢åˆ° root ç”¨æˆ·ï¼Œç„¶åæŠŠ gary æ·»åŠ åˆ° sudo æƒé™ç»„ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š\nâœ… 1. ç”¨ root ç”¨æˆ·ç™»å½•ï¼Œæˆ–è€…ç”¨ su åˆ‡æ¢åˆ° rootï¼š\nsu - ç³»ç»Ÿä¼šæç¤ºä½ è¾“å…¥ root çš„å¯†ç ï¼Œä¸æ˜¯ gary çš„å¯†ç ã€‚\nâœ… 2. å®‰è£… sudoï¼ˆå¦‚æœè¿˜æ²¡è£…ï¼‰ï¼š\npkg install sudo âœ… 3. æŠŠ gary ç”¨æˆ·æ·»åŠ åˆ° wheel ç»„ï¼š(å¦‚æœå®‰è£…ç³»ç»Ÿæ—¶å·²åŠ å…¥wheelç»„å°±ä¸éœ€è¦ä¸‹é¢çš„å†æ¬¡æ“ä½œï¼‰\npw usermod gary -G wheel é»˜è®¤ FreeBSD çš„ sudoers æ–‡ä»¶å…è®¸ wheel ç»„çš„ç”¨æˆ·ä½¿ç”¨ sudoã€‚\nâœ… 4. ç¡®è®¤ sudoers é…ç½®ä¸­å…è®¸ wheel ç»„ä½¿ç”¨ sudoï¼š\nå¯ä»¥ç”¨ visudo æ‰“å¼€ sudo é…ç½®æ–‡ä»¶ï¼šï¼ˆé»˜è®¤viå‘½ä»¤æ‰“å¼€ï¼‰ visudo æŒ‡å®švimå‘½ä»¤æ‰“å¼€visudoæ–‡ä»¶ï¼š EDITOR=vim visudo ç¡®ä¿æœ‰ä»¥ä¸‹å†…å®¹ï¼ˆæ²¡æœ‰æ³¨é‡Š #ï¼‰ï¼š %wheel ALL=(ALL:ALL) ALL ç‰¹åˆ«è¯´æ˜ï¼šæ‰“å¼€visudoæ–‡ä»¶åï¼Œä¼šçœ‹åˆ°ä¸‹é¢ä¸‰ç§ï¼Œåªéœ€è¦å»æ‰å¸¦%wheel ALL=(ALL:ALL) ALLå‰é¢çš„#å·å°±è¡Œäº†ï¼š root ALL=(ALL:ALL) ALL ## Uncomment to allow members of group wheel to execute any command # %wheel ALL=(ALL:ALL) ALL ## Same thing without a password # %wheel ALL=(ALL:ALL) NOPASSWD: ALL ## Uncomment to allow members of group sudo to execute any command # %sudo ALL=(ALL:ALL) ALL âœ… 5. ç°åœ¨ç”¨ gary ç™»å½•ï¼Œå°±èƒ½ç”¨ sudo äº†ï¼š sudo pkg install bash ..... ","permalink":"https://hanigege.github.io/posts/freebsd/freebsd%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8sudo/","tags":null,"title":"Freebsdæ™®é€šç”¨æˆ·å¦‚ä½•ä½¿ç”¨sudo"},{"categories":["other"],"contents":"dockeræ­å»ºCoturn TURNæœåŠ¡å™¨ å…±ä¸¤ç§æ–¹æ¡ˆï¼š ç¬¬ä¸€ç§æ–¹æ¡ˆï¼ˆè¦äº†è§£ï¼‰ å…ˆå»ºç«‹ä¸€ä¸ªæ–‡ä»¶å¤¹ mkdir -p ~/data/docker_data/coturn/etc/coturn mkdir -p ~/data/docker_data/coturn/var/run mkdir -p ~/data/docker_data/coturn/var/log #å¦‚æœç”¨ä¸‹é¢ç¬¬ä¸€ç§æ–¹æ¡ˆè¿™ä¸ªæ‰éœ€è¦å»ºç«‹ï¼Œç¬¬äºŒç§ä¸éœ€è¦ cd ~/data/docker_data/coturn/etc/coturn touch turnserver.conf cd ~/data/docker_data/coturn/var/run touch turnserver.pid cd ../../ chmod 777 -R var æ‹‰å–é•œåƒ\ndocker pull coturn/coturn ç›´æ¥hostæ–¹å¼è¿è¡Œ\ndocker run -d --network=host \\ -v /root/data/docker_data/coturn/etc/coturn/turnserver.conf:/etc/coturn/turnserver.conf \\ -v /root/data/docker_data/coturn/etc/:/etc/ \\ -v /root/data/docker_data/coturn/var:/var \\ coturn/coturn è¿è¡Œæ—¶ä¸åŠ  -d å…ˆçœ‹è¾“å…¥æœ‰é”™è¯¯å—ï¼ åŒæ—¶æŸ¥çœ‹varä¸‹çš„logçœ‹ç›¸å…³çš„é—®é¢˜ è°ƒè¯•å¯åŠ¨å‘½ä»¤ï¼šåœæ­¢å®¹å™¨åä¼šè‡ªåŠ¨å›¾åˆ é™¤å®¹å™¨ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š\ndocker run --network=host \\ -v /root/data/docker_data/coturn/etc/coturn/turnserver.conf:/etc/coturn/turnserver.conf \\ -v /root/data/docker_data/coturn/etc/:/etc/ \\ -v /root/data/docker_data/coturn/var:/var \\ --rm \\ coturn/coturn å“ªæœå»æ‰äº†é…ç½®æ–‡ä»¶é‡Œçš„æŒ‡å®šlogï¼Œåœç”¨cliåŠŸèƒ½ï¼Œä¸‹é¢æœ‰è¯´æ˜ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å¯åŠ¨å‘½ä»¤ï¼š\ndocker run -d --network=host \\ -e DETECT_EXTERNAL_IP=yes \\ -e DETECT_RELAY_IP=yes \\ -v /root/data/docker_data/coturn/etc/coturn/turnserver.conf:/etc/coturn/turnserver.conf \\ -v /root/data/docker_data/coturn/etc/:/etc/ \\ -v /root/data/docker_data/coturn/var:/var \\ coturn/coturn \\ -n --log-file=stdout ä½ ä¹‹åä¸è¦1~65535å…¨éƒ½å¼€æ”¾ å®è¡Œç™½åå•æ”¾è¡Œæ¨¡å¼\næ¯”å¦‚coturnåªå¼€æ”¾ä»¥ä¸‹\n3478\n5349\nä¸Šé¢ä¸¤ä¸ªtcp udpå…¨æ‰“å¼€\n49152~65535\nç”Ÿæˆè¯ä¹¦ï¼š\nsudo openssl req -x509 -newkey rsa:2048 -keyout /etc/turn_server_pkey.pem -out /etc/turn_server_cert.pem -days 99999 -nodes ç”Ÿæˆçš„ä¸¤ä¸ªè¯ä¹¦ä¼ è¾“åˆ° /root/data/docker_data/coturn/etc/ æ–‡ä»¶å¤¹ä¸‹ã€‚å¯ä»¥å…ˆä¸‹è½½ä¸‹æ¥ï¼Œå†ä¼ åˆ°ç›¸åº”çš„æ–‡ä»¶å¤¹é‡Œã€‚ æˆ–è€…ä¸€æ­¥åˆ°ä½ç›´æ¥ç”Ÿæˆåˆ°ç›®æ ‡æ–‡ä»¶å¤¹\nsudo openssl req -x509 -newkey rsa:2048 -keyout /root/data/docker_data/coturn/etc/turn_server_pkey.pem -out /root/data/docker_data/coturn/etc/turn_server_cert.pem -days 99999 -nodes netstat -anpl | grep turnserver #æ£€æµ‹ Dibianæ²¡æœ‰è¿™ä¸ªå‘½ä»¤ï¼Œå¯ä»¥å®‰è£…ï¼š\napt-get install net-tools æå®šï¼ ç”ŸæˆéªŒè¯å¯†é’¥åˆ°test.confæ–‡ä»¶ï¼Œç”Ÿæˆåæ‰“å¼€æ–‡ä»¶å¤åˆ¶å¯†é’¥æ›¿æ¢ä¸‹é¢é…ç½®æ–‡ä»¶é‡Œçš„å¯†é’¥ï¼šï¼ˆç‰¹åˆ«è¯´æ˜ï¼Œå¯†é’¥çš„é•¿åº¦å¯ä»¥ä¿®æ”¹ä¸‹é¢å‘½ä»¤è¡Œé‡Œçš„256å‚æ•°ï¼Œå»ºè®®è®¾ä¸º68å³å¯ï¼Œä¹Ÿå°±æ˜¯68ä¸ªå­—ç¬¦\necho \u0026#34;static-auth-secret=$(cat /dev/urandom | tr -cd \u0026#39;[:alnum:]\u0026#39; | fold -w 256 | head -n 1)\u0026#34; | sudo tee /root/test.conf å¦‚ä¸‹ï¼š\necho \u0026#34;static-auth-secret=$(cat /dev/urandom | tr -cd \u0026#39;[:alnum:]\u0026#39; | fold -w 68 | head -n 1)\u0026#34; | sudo tee /root/test.conf å…·ä½“é…ç½®æ–‡ä»¶æ˜¯ï¼šturnserver.conf è·¯å¾„ä¸ºï¼š/root/data/docker_data/coturn/etc/coturn\nCOTURN Server é…ç½®æ ·ä¾‹ï¼šturnserver.conf\nuse-auth-secret static-auth-secret=ynojlSEBrJ6VjFHNyjJiyZRnnMUQ0WKAsSzGdMhL8he realm=coturn.1.xyz #æŒ‡å®š Coturn çš„æ—¥å¿—æ–‡ä»¶è·¯å¾„ log-file=/var/log/turnserver.log # VoIP traffic is all UDP. There is no reason to let users connect to arbitrary TCP endpoints via the relay. no-tcp-relay # è°ƒè¯•æ—¥å¿—çº§åˆ« verbose=1 cli-password=8al8la.com # Set a non-empty CLI password # don\u0026#39;t let the relay ever try to connect to private IP address ranges within your network (if any) # given the turn server is likely behind your firewall, remember to include any privileged public IPs too. denied-peer-ip=10.0.0.0-10.255.255.255 denied-peer-ip=192.168.0.0-192.168.255.255 denied-peer-ip=172.16.0.0-172.31.255.255 # special case the turn server itself so that client-\u0026gt;TURN-\u0026gt;TURN-\u0026gt;client flows work allowed-peer-ip=10.0.0.1 listener-ip=coturn.1.xyz relay-ip=coturn.1.xyz # consider whether you want to limit the quota of relayed streams per user (or total) to avoid risk of DoS. user-quota=12 # 4 streams per video call, so 12 streams = 3 simultaneous relayed calls per user. total-quota=1200 # TLS certificates, including intermediate certs. # æŒ‡å®šäº† TLS è¯ä¹¦æ–‡ä»¶çš„è·¯å¾„ cert=/etc/turn_server_cert.pem # æŒ‡å®šäº† TLS ç§é’¥æ–‡ä»¶çš„è·¯å¾„ pkey=/etc/turn_server_pkey.pem pidfile=/var/run/turnserver.pid ä¿®æ”¹ä¸Šé¢çš„åŸŸåï¼Œå’Œé‚£ä¸€ä¸²å¯†ç ï¼Œä¿å­˜åé‡å¯coturnçš„å®¹å™¨ï¼\nè°ƒè¯•æ—¥å¿—è¯´æ˜ åœ¨æ‚¨æä¾›çš„é…ç½®ä¸­ï¼Œæ—¥å¿—è°ƒè¯•çº§åˆ«ç”±verboseå‚æ•°æŒ‡å®šã€‚åœ¨æ‚¨çš„é…ç½®ä¸­ï¼Œverboseè®¾ç½®ä¸º1ï¼Œè¡¨ç¤ºå¯ç”¨äº†æœ€ä½çº§åˆ«çš„è°ƒè¯•æ—¥å¿—ã€‚\nè°ƒè¯•çº§åˆ«é€šå¸¸æœ‰ä¸åŒçš„å€¼ï¼Œç”¨äºæ§åˆ¶æ—¥å¿—çš„è¯¦ç»†ç¨‹åº¦ã€‚å¸¸è§çš„çº§åˆ«åŒ…æ‹¬ï¼š\n0ï¼šå…³é—­è°ƒè¯•æ—¥å¿—ï¼Œåªè®°å½•é”™è¯¯å’Œå…³é”®ä¿¡æ¯ã€‚\n1ï¼šæœ€ä½çº§åˆ«çš„è°ƒè¯•ï¼Œé€šå¸¸ç”¨äºè®°å½•åŸºæœ¬çš„æ“ä½œä¿¡æ¯å’Œè­¦å‘Šã€‚\n2ï¼šä¸­ç­‰çº§åˆ«çš„è°ƒè¯•ï¼Œè®°å½•æ›´å¤šçš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸€äº›å†…éƒ¨æ“ä½œçš„ç»†èŠ‚ã€‚\n3ï¼šæœ€é«˜çº§åˆ«çš„è°ƒè¯•ï¼Œè®°å½•éå¸¸è¯¦ç»†çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¯ä¸ªæ­¥éª¤çš„æ“ä½œå’ŒçŠ¶æ€ã€‚\nåœ¨æ‚¨çš„é…ç½®ä¸­ï¼Œè®¾ç½®ä¸º1çš„è°ƒè¯•çº§åˆ«å°†è®°å½•åŸºæœ¬çš„æ“ä½œä¿¡æ¯å’Œè­¦å‘Šï¼Œä½†ä¸ä¼šè®°å½•è¿‡å¤šçš„ç»†èŠ‚ã€‚è¿™å¯¹äºä¸€èˆ¬æƒ…å†µä¸‹çš„æ—¥å¿—è®°å½•å·²ç»è¶³å¤Ÿã€‚å¦‚æœéœ€è¦æ›´è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥å°†è°ƒè¯•çº§åˆ«è®¾ç½®ä¸ºæ›´é«˜çš„å€¼ï¼Œä¾‹å¦‚2æˆ–3ï¼Œä½†è¿™å¯èƒ½ä¼šç”Ÿæˆæ›´å¤šçš„æ—¥å¿—æ•°æ®ã€‚\næ³¨æ„ä¸Šé¢/etc/turn_*è·¯å½¹æ˜¯æŒ‡å®¹å™¨é‡Œçš„è·¯å¾„ã€‚\nå¦‚æœæƒ³å…³é—­CLIç›‘å¬å™¨åŠŸèƒ½ã€‚è¦ç¦ç”¨CLIåŠŸèƒ½ï¼Œæ‚¨å¯ä»¥åˆ é™¤æˆ–æ³¨é‡Šæ‰ç›¸å…³é…ç½®è¡Œã€‚åœ¨æ‚¨çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œåªéœ€è¦åˆ é™¤æˆ–æ³¨é‡Šæ‰ä»¥ä¸‹ä¸¤è¡Œå³å¯ï¼š\ncli-password=8al8la.com # Set a non-empty CLI password # æŒ‡å®š Coturn çš„æ—¥å¿—æ–‡ä»¶è·¯å¾„ # log-file=/var/log/turnserver.log è¯·æ³¨æ„ï¼Œè¿™äº›é…ç½®æ›´æ”¹å°†ç¦ç”¨CLIå¯†ç å’ŒCLIæ—¥å¿—è®°å½•åŠŸèƒ½ã€‚ä¿å­˜æ›´æ”¹åï¼Œé‡æ–°å¯åŠ¨coturnæœåŠ¡å™¨ä»¥ä½¿æ›´æ”¹ç”Ÿæ•ˆã€‚\næ‰€è°“cliåŠŸèƒ½ï¼š\nCLIç›‘å¬å™¨ï¼ˆCommand Line Interface listenerï¼‰å…è®¸æ‚¨é€šè¿‡å‘½ä»¤è¡Œç•Œé¢ä¸coturnæœåŠ¡å™¨è¿›è¡Œäº¤äº’å’Œç®¡ç†ã€‚é€šè¿‡CLIï¼Œæ‚¨å¯ä»¥æ‰§è¡Œå„ç§ç®¡ç†ä»»åŠ¡ï¼Œä¾‹å¦‚æŸ¥çœ‹å½“å‰æœåŠ¡å™¨çŠ¶æ€ã€æ·»åŠ æˆ–åˆ é™¤ç”¨æˆ·ã€é…ç½®è½¬å‘è§„åˆ™ç­‰ã€‚\nCLIç›‘å¬å™¨å…è®¸ç®¡ç†å‘˜é€šè¿‡å‘½ä»¤è¡Œè¾“å…¥ç‰¹å®šçš„å‘½ä»¤æ¥ä¸coturnæœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œè€Œæ— éœ€é€šè¿‡å›¾å½¢ç•Œé¢æˆ–å…¶ä»–æ–¹å¼è¿›è¡Œæ“ä½œã€‚è¿™ä½¿å¾—ç®¡ç†è€…å¯ä»¥æ›´åŠ çµæ´»å’Œé«˜æ•ˆåœ°ç®¡ç†æœåŠ¡å™¨ï¼Œç‰¹åˆ«æ˜¯åœ¨è‡ªåŠ¨åŒ–å’Œè„šæœ¬åŒ–ç®¡ç†æ–¹é¢ã€‚\næŸ¥çœ‹æ—¥å¿—ï¼šè¿è¡Œæ—¶ä¸åŠ  -d çœ‹è¾“å…¥ï¼\njournalctl -u coturnsystemd è¿™æ˜¯åŠ /root/data/docker_data/synapse/data/homeserver.yamlé…ç½®æ–‡ä»¶é‡Œçš„\n#turnserver# turn_uris: [ \u0026#34;turn:coturn.666.eu.org?transport=udp\u0026#34;, \u0026#34;turn:coturn.666.eu.org?transport=tcp\u0026#34; ] turn_shared_secret: \u0026#34;SdQmVOBTRxViwUhsRsRgpBctFNMYatKUBHIO69wFKxEVuqog1HPPoMKya7YA\u0026#34; turn_user_lifetime: 86400000 turn_allow_guests: True ```bash è®°çš„ä¿®æ”¹åŸŸåå’Œå¯†ç å’Œä¸»æ–‡ä»¶åŒæ­¥ã€‚ ```bash ç¡®ä¿æ‚¨çš„é˜²ç«å¢™å…è®¸æµé‡è¿›å…¥æ‚¨é…ç½®ä¸ºä¾¦å¬çš„ç«¯å£ä¸Šçš„ TURN æœåŠ¡å™¨ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼šTURN æµé‡ä½¿ç”¨ 3478 å’Œ 5349ï¼ˆè¯·è®°ä½åŒæ—¶å…è®¸ TCP å’Œ UDP æµé‡ï¼‰ï¼ŒUDP ä¸­ç»§ä½¿ç”¨ç«¯å£ 49152-65535 .) ç‰¹åˆ«è¯´æ˜ï¼šcoturnæœåŠ¡å™¨ä¹Ÿå¯ä»¥ä¸åšåå‘ä»£ç†\nCoturnæœåŠ¡é€šå¸¸éœ€è¦æ‰“å¼€ä»¥ä¸‹ç«¯å£ä»¥æ”¯æŒTURNåè®®å’Œå®ç°NATéå†ï¼š\nTURN Listening Port (Default: 3478): CoturnæœåŠ¡é€šè¿‡æ­¤ç«¯å£ä¾¦å¬TURNè¯·æ±‚ã€‚æ­¤ç«¯å£æ˜¯TURNåè®®çš„æ ‡å‡†ç«¯å£ã€‚\nDefault TURN Port: 3478 TURN TLS Listening Port (Default: 5349): å¦‚æœå¯ç”¨äº†TURN over TLSï¼ˆåŠ å¯†çš„TURNæµé‡ï¼‰ï¼Œåˆ™éœ€è¦æ‰“å¼€æ­¤ç«¯å£ã€‚ Default TURN TLS Port: 5349 Listening Ports Range for Relayed UDP Traffic (Default: 49152-65535): å½“TURNæœåŠ¡å™¨ç”¨äºä¸­ç»§UDPæµé‡æ—¶ï¼Œå®ƒéœ€è¦ä½¿ç”¨ä¸€ç³»åˆ—UDPç«¯å£ã€‚\nä¸Šé¢çš„é…ç½®é‡Œæˆ‘æŒ‡å®šäº†20000-30000\nDefault UDP Port Range: 49152-65535 è¿™äº›ç«¯å£éœ€è¦åœ¨CoturnæœåŠ¡å™¨é…ç½®ä¸­æŒ‡å®šï¼Œå¹¶ä¸”ç›¸åº”çš„é˜²ç«å¢™è§„åˆ™ä¹Ÿéœ€è¦é…ç½®ï¼Œä»¥å…è®¸æµé‡é€šè¿‡è¿™äº›ç«¯å£ã€‚ç¡®ä¿åœ¨é…ç½®CoturnæœåŠ¡å™¨æ—¶å‚è€ƒæ–‡æ¡£ï¼Œå› ä¸ºå®é™…ç«¯å£é…ç½®å¯èƒ½å› ç‰¹å®šç”¨ä¾‹å’Œå®‰å…¨éœ€æ±‚è€Œæœ‰æ‰€ä¸åŒã€‚\nMatrix Synapse Default Communication Port (TCP): 8448 ç¡®ä¿åœ¨é…ç½®é˜²ç«å¢™è§„åˆ™æ—¶ï¼Œè¿™äº›ç«¯å£æ˜¯å¼€æ”¾çš„ï¼Œä»¥ç¡®ä¿Synapseå’ŒCoturnèƒ½å¤Ÿç›¸äº’é€šä¿¡ã€‚\nç¬¬äºŒç§æ–¹æ¡ˆï¼šï¼ˆä¼˜é€‰ï¼Œæ¨èä½¿ç”¨è¿™ä¸€ç§æ–¹æ¡ˆï¼‰ å…³äºæ—¥å¿—è¾“å…¥ç­‰çº§ï¼Œå¸¸è§çš„é€‰é¡¹åŒ…æ‹¬ï¼š\nverboseï¼šå†—ä½™çš„è¾“å‡ºï¼Œé€šå¸¸åŒ…å«äº†éå¸¸è¯¦ç»†çš„ä¿¡æ¯ï¼Œç”¨äºè°ƒè¯•å’Œæ’æŸ¥é—®é¢˜ã€‚\ndebugï¼šè°ƒè¯•çº§åˆ«çš„è¾“å‡ºï¼Œæä¾›æ¯”è¾ƒè¯¦ç»†ä½†ä¸å¦‚ verbose é‚£ä¹ˆå†—ä½™çš„ä¿¡æ¯ã€‚\ninfoï¼šä¿¡æ¯çº§åˆ«çš„è¾“å‡ºï¼Œæä¾›åŸºæœ¬çš„è¿è¡Œä¿¡æ¯ï¼Œé€‚åˆä¸€èˆ¬æƒ…å†µä¸‹çš„ä½¿ç”¨ã€‚\nwarningï¼šè­¦å‘Šçº§åˆ«çš„è¾“å‡ºï¼Œç”¨äºæŒ‡ç¤ºæ½œåœ¨çš„é—®é¢˜æˆ–é”™è¯¯ã€‚\nerrorï¼šé”™è¯¯çº§åˆ«çš„è¾“å‡ºï¼ŒæŒ‡ç¤ºå‡ºç°çš„é”™è¯¯æƒ…å†µã€‚\næ‚¨å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´æ—¥å¿—è¾“å…¥ç­‰çº§ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé€šå¸¸ä¼šå°†æ—¥å¿—è¾“å…¥ç­‰çº§è®¾ç½®ä¸º info æˆ–æ›´é«˜çº§åˆ«ï¼Œä»¥é¿å…å†—ä½™ä¿¡æ¯è¿‡å¤šï¼Œè€Œåœ¨å¼€å‘æˆ–è°ƒè¯•é˜¶æ®µï¼Œåˆ™å¯èƒ½ä¼šé€‰æ‹© debug æˆ– verbose ç­‰çº§ä»¥ä¾¿æ›´è¯¦ç»†åœ°äº†è§£ç³»ç»Ÿè¿è¡Œæƒ…å†µã€‚\nè‡ªè¡Œå®‰è£…å¥½dockeråŠdocker-compose å¼€å§‹æ“ä½œ mkdir -p ~/data/docker_data/coturn/etc/coturn mkdir -p ~/data/docker_data/coturn/var/run mkdir -p ~/data/docker_data/coturn/var/log #å¦‚æœç”¨ä¸‹é¢ç¬¬ä¸€ç§æ–¹æ¡ˆè¿™ä¸ªæ‰éœ€è¦å»ºç«‹ï¼Œç¬¬äºŒç§ä¸éœ€è¦ cd ~/data/docker_data/coturn/etc/coturn touch turnserver.conf cd ~/data/docker_data/coturn/var/run touch turnserver.pid cd ../../ chmod 777 -R var turnserver.conf:\n#è¿™æ˜¯ç³»ç»Ÿæ—¥å¿— #syslog #å†—ä½™çš„æ—¥å¿—è¾“å‡º verbose use-auth-secret static-auth-secret=ThisIsASharedSecret-ChangeMe realm=example.org cert=/etc/letsencrypt/live/turn.example.org/fullchain.pem pkey=/etc/letsencrypt/live/turn.example.org/privkey.pem no-udp external-ip=1.2.3.4 min-port=64000 max-port=65535 è¯¦è§£ï¼š\n# èµ°ç³»ç»Ÿæ—¥å¿— #syslog # å†—ä½™çš„æ—¥å¿—è¾“å‡º verbose # æŒ‡å®šäº†é•¿æœŸå‡­è¯æœºåˆ¶ï¼Œç”¨äºå®¢æˆ·ç«¯çš„èº«ä»½éªŒè¯å’Œä¸‹é¢çš„äºŒé€‰ä¸€ #lt-cred-mech # å¯ç”¨äº†ä½¿ç”¨é™æ€èº«ä»½éªŒè¯å¯†é’¥è¿›è¡Œèº«ä»½éªŒè¯çš„åŠŸèƒ½ use-auth-secret # è®¾ç½®äº†èº«ä»½éªŒè¯å¯†é’¥å’ŒåŸŸå static-auth-secret=ynojlSEBrJnMUQ0WKAsSzGdMhL8he # è®¾ç½®äº†åŸŸå realm=coturn.1.xyz # æŒ‡å®šäº† TLS è¯ä¹¦æ–‡ä»¶çš„è·¯å¾„ cert=/etc/web.crt # æŒ‡å®šäº† TLS ç§é’¥æ–‡ä»¶çš„è·¯å¾„ pkey=/etc/web.key # Set a non-empty CLI password cli-password=8al8la.com # ç¦ç”¨äº† UDP é€šä¿¡ï¼Œæ„å‘³ç€åªä½¿ç”¨ TCP #no-udp min-port=64000 max-port=65535 æœ€ç»ˆå®ä¾‹ï¼š\n# æ—¥å¿—è¾“å‡ºå‚æ•° info # å¯ç”¨è®¤è¯ use-auth-secret # å€¼ä¸ºè®¤è¯æ—¶ä½¿ç”¨çš„å¯†é’¥ static-auth-secret=ynojlSEBnMUQ0WKAsSzGdMhL8he # å€¼ä¸ºä½ ç»™ coturn å®ä¾‹åˆ†é…çš„åŸŸå (å®ƒå¯ä»¥ä¸å’Œä½ çš„åŸŸåå®Œå…¨ä¸€è‡´, ä½†è‡³å°‘å¿…é¡»æœ‰) realm=coturn.10.xyz # æŒ‡å®šäº† TLS è¯ä¹¦æ–‡ä»¶çš„è·¯å¾„ cert=/etc/web.crt # æŒ‡å®šäº† TLS ç§é’¥æ–‡ä»¶çš„è·¯å¾„ pkey=/etc/web.key # Set a non-empty CLI password cli-password=8a.com #é™å®šæœ€å°æœ€å¤§ç«¯å£ min-port=64000 max-port=65535 ä¸Šé¢é…ç½®é‡Œçš„è¯ä¹¦ï¼š å’ŒåŸŸåç”Ÿæˆæ ‡å‡†è¯ä¹¦ä¸€æ ·ï¼Œæœ¬ç«™æœ‰æä¾›æ•™ç¨‹ã€‚æ­¤è¯ä¹¦ä¸ºcoturnæœåŠ¡å™¨åŸŸåçš„è¯ä¹¦ æµ‹è¯•å¯åŠ¨å‘½ä»¤ï¼š(æ²¡æœ‰åŠ -d ï¼ˆåå°è¿è¡Œï¼‰ æµ‹è¯•æ²¡é—®é¢˜äº†ï¼Œå†åŠ ,è¿˜æœ‰æœ€åçš„\u0026ndash;rmå»é™¤æ‰ï¼Œé€€å‡ºè‡ªåŠ¨åˆ é™¤å®¹å™¨çš„æ„æ€ï¼‰ docker run --network=host \\ -v /root/data/docker_data/coturn/etc/coturn/turnserver.conf:/etc/coturn/turnserver.conf \\ -v /root/data/docker_data/coturn/etc/:/etc/ \\ -v /root/data/docker_data/coturn/var/run/turnserver.pid:/var/run/turnserver.pid \\ --rm \\ coturn/coturn (å°æé†’:åŸŸåè¯ä¹¦ç”ŸæˆåæŒ‰ç…§é…ç½®æ–‡ä»¶è·¯å½¹æ”¾å…¥è¿è¡Œåï¼Œå¯èƒ½ä¼šæç¤ºkeyæ–‡ä»¶æƒé™ä¸å¤Ÿï¼Œç»™ä»–ä¸ªotherè¯»æƒé™ï¼Œé‡å¯å³å¯ï¼‰ æ­£å¼å¯åŠ¨å‘½ä»¤ï¼š\ndocker run -d --network=host \\ -v /root/data/docker_data/coturn/etc/coturn/turnserver.conf:/etc/coturn/turnserver.conf \\ -v /root/data/docker_data/coturn/etc/:/etc/ \\ -v /root/data/docker_data/coturn/var/run/turnserver.pid:/var/run/turnserver.pid \\ coturn/coturn docker-compose.yaml\nservices: coturn: image: coturn/coturn container_name: coturn network_mode: host restart: unless-stopped # å§‹ç»ˆå¯åŠ¨ï¼Œé™¤éæ‰‹åŠ¨åœæ­¢ volumes: - /root/data/docker_data/coturn/etc/coturn/turnserver.conf:/etc/coturn/turnserver.conf - /root/data/docker_data/coturn/etc/:/etc/ - /root/data/docker_data/coturn/var/run/turnserver.pid:/var/run/turnserver.pid ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥åå°è¿è¡Œå®¹å™¨ï¼š\ndocker-compose up -d åœ¨synapseé…ç½®æ–‡ä»¶data/homeserver.yamlé‡ŒåŠ å…¥ #turnserver# turn_uris: [ \u0026#34;turn:cotu10.xyz?transport=udp\u0026#34;, \u0026#34;turn:coturnc10.xyz?transport=tcp\u0026#34; ] turn_shared_secret: \u0026#34;ynojlAOWksiyk1SEBrJ6VjFHNyjJiyZRnnMUQ0WKAsSzGdMhL8he\u0026#34; turn_user_lifetime: 86400000 turn_allow_guests: True ","permalink":"https://hanigege.github.io/posts/other/%E5%AE%B6%E5%BA%AD%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B3%BB%E5%88%973coturn%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/","tags":null,"title":"å®¶åº­èŠå¤©æœåŠ¡å™¨ç³»åˆ—ï¼ˆ3ï¼‰coturnæœåŠ¡æ­å»º"},{"categories":["other"],"contents":"\nntfy æ— éœ€æ³¨å†Œçš„é€šçŸ¥æœåŠ¡ æœ€ä¸‹é¢æ˜¯æ¢å¤å¤‡ä»½çš„æ–¹æ¡ˆï¼š ##â€‹â€‹ ä»€ä¹ˆæ˜¯ ntfy ï¼Ÿ â€‹ntfyâ€‹â€‹â€‹ï¼ˆå‘éŸ³ï¼šnotifyâ€‹â€‹â€‹ï¼‰æ˜¯ä¸€ä¸ªç®€å•çš„åŸºäº HTTPâ€‹â€‹â€‹ çš„ pub-subâ€‹â€‹â€‹ é€šçŸ¥æœåŠ¡ã€‚å®ƒå…è®¸æ‚¨é€šè¿‡ä»»ä½•è®¡ç®—æœºä¸Šçš„è„šæœ¬å‘æ‚¨çš„æ‰‹æœºæˆ–æ¡Œé¢å‘é€é€šçŸ¥ï¼Œå®Œå…¨æ— éœ€æ³¨å†Œæˆ–è´¹ç”¨ã€‚\nå®˜æ–¹æä¾›äº†å…è´¹çš„ç‰ˆæœ¬ï¼šhttps://ntfy.sh/app å®‰è£… æ–°å»ºæ–‡ä»¶ï¼šdocker-compose.yml è„šæœ¬å¦‚ä¸‹ï¼š\nservices: ntfy: image: binwiederhier/ntfy:latest container_name: ntfy command: - serve environment: - TZ=Asia/Shanghai volumes: - /root/data/docker_data/ntfy/data/cache:/var/cache/ntfy - /root/data/docker_data/ntfy/data/config:/etc/ntfy ports: - 12332:80 restart: unless-stopped networks: - matrix networks: matrix: name: matrix ä»£ç ä¸­çš„åå‘ä»£ç†npmè½¬å‘å¤–å‡ºç«¯å£12332 ã€‚\nä¸Šé¢çš„ä»£ç ä¸­ä¼šè‡ªå»º ç½‘ç»œmatrix.\nå¦‚æœå…ˆè¡Œè‡ªå·±å»ºç«‹ç½‘ç»œï¼Œå¦‚ï¼š å»ºç«‹ä¸€ä¸ª docker networkï¼š\ndocker network create matrix é‚£ä¹ˆæ‚¨å¯ä»¥æŒ‰ç…§ä¹‹å‰æåˆ°çš„å»ºè®®åœ¨ Docker Compose æ–‡ä»¶ä¸­å°†ç½‘ç»œå®šä¹‰æ ‡è®°ä¸ºå¤–éƒ¨ç½‘ç»œï¼Œå¹¶ä¸”æŒ‡å®šæ­£ç¡®çš„ç½‘ç»œåç§°ã€‚åœ¨æ‚¨çš„ Docker Compose æ–‡ä»¶ä¸­ï¼Œæ‚¨å¯ä»¥å°†ç½‘ç»œå®šä¹‰ä¿®æ”¹ä¸ºç±»ä¼¼ä»¥ä¸‹å†…å®¹ï¼š\nservices: ntfy: image: binwiederhier/ntfy:latest container_name: ntfy command: - serve environment: - TZ=Asia/Shanghai volumes: - /root/data/docker_data/ntfy/data/cache:/var/cache/ntfy - /root/data/docker_data/ntfy/data/config:/etc/ntfy ports: - 12332:80 restart: unless-stopped networks: matrix: external: true networks: matrix: external: true name: matrix è¿™å°†å‘Šè¯‰ Docker Compose ä½¿ç”¨å¤–éƒ¨ç½‘ç»œ \u0026ldquo;matrix\u0026rdquo;ï¼Œå¹¶ä¸”ä¸ä¼šå°è¯•é‡æ–°åˆ›å»ºå®ƒã€‚\nå¦å¤–ï¼Œå¦‚æœæ‚¨ç¡®å®æƒ³è¦ä½¿ç”¨ Compose åˆ›å»ºä¸€ä¸ªæ–°çš„ç½‘ç»œï¼Œå¹¶ä¸”å¸Œæœ›ä½¿ç”¨ \u0026ldquo;matrix\u0026rdquo; è¿™ä¸ªåç§°ï¼Œæ‚¨éœ€è¦å…ˆåˆ é™¤ç°æœ‰çš„ \u0026ldquo;matrix\u0026rdquo; ç½‘ç»œï¼Œç„¶åå†åˆ›å»ºä¸€ä¸ªæ–°çš„ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥åˆ é™¤ç°æœ‰çš„ç½‘ç»œï¼š\ndocker network rm matrix ç„¶åï¼Œå½“æ‚¨è¿è¡Œ docker-compose up -d æ—¶ï¼ŒCompose å°†åˆ›å»ºä¸€ä¸ªæ–°çš„ \u0026ldquo;matrix\u0026rdquo; ç½‘ç»œã€‚\nè¯·ç¡®ä¿æ‚¨çš„ç½‘ç»œè®¾ç½®ç¬¦åˆæ‚¨çš„é¢„æœŸï¼Œå¹¶ä¸”ä¸ä¼šå½±å“åˆ°å…¶ä»–æœåŠ¡ã€‚\nè¿è¡Œ åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ http://IP:12332â€‹ å°±èƒ½çœ‹åˆ°ä¸»ç•Œé¢\nå…³é”®æ³¨æ„ï¼š è¿›å…¥\ncd /root/data/docker_data/ntfy/data/config:/etc/ntfy ç›¸åº”çš„configæ–‡ä»¶å¤¹ä¸‹ï¼Œéœ€è¦å»ºç«‹ä¸€ä¸ªserver.yml é…ç½®æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\nbase-url: \u0026#34;https://sms.888.org\u0026#34; #listen-http: \u0026#34;\u0026#34; #å¦‚æœä¸Šé¢çš„ç½‘å€æ²¡æœ‰åšåå‘è§£æï¼Œå°±è¦åŠ å…¥ç«¯å£å· behind-proxy: true upstream-base-url: \u0026#34;https://ntfy.sh\u0026#34; log-level: TRACE å®ä¾‹ï¼š\nbase-url: \u0026#34;http://ss.160.xyz:125\u0026#34; #listen-http: \u0026#34;\u0026#34; #å¦‚æœä¸Šé¢çš„ç½‘å€æ²¡æœ‰åšåå‘è§£æï¼Œå°±è¦åŠ å…¥ç«¯å£å· behind-proxy: true upstream-base-url: \u0026#34;https://ntfy.sh\u0026#34; log-level: TRACE ç„¶åé‡å¯å®¹å™¨\ndocker restart â€œå®¹å™¨åâ€ è¿™æ ·elementé‡Œçš„ç½‘å…³å°±å¯ä»¥è‡ªåŠ¨æ”¹ä¸ºæœ¬ç½‘å€ï¼Œæ›´åŠ å®‰å…¨ï¼Œæ–¹ä¾¿ ï¼Œæ•ˆç‡ï¼\nâ€‹ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ POST è¯·æ±‚ï¼ˆé€šè¿‡ curl -dï¼‰å‘å¸ƒæ¶ˆæ¯ï¼š\næ ¼å¼æ¯”è¾ƒç®€å•ï¼šcurl -d \u0026lt;æ¶ˆæ¯\u0026gt; \u0026lt;æœåŠ¡å™¨IP:ç«¯å£\u0026gt;/\u0026lt;ä¸»é¢˜\u0026gt;\nç®€å•æ¶ˆæ¯æµ‹è¯• curl -d \u0026#34;Hi\u0026#34; http://192.168.0.197:3680/laosu_test_ch æ‚¨å¯ä»¥è®¾ç½® é€šçŸ¥ä¼˜å…ˆçº§ã€æ ‡é¢˜å’Œæ ‡ç­¾ æ¶ˆæ¯ã€‚è¿™æ˜¯ä¸€èµ·ä½¿ç”¨å…¶ä¸­ä¸€äº›çš„ç¤ºä¾‹ï¼š\næ›´å¤æ‚çš„æ¶ˆæ¯ç¤ºä¾‹ curl \\ -H \u0026#34;Title: Unauthorized access detected\u0026#34; \\ -H \u0026#34;Priority: urgent\u0026#34; \\ -H \u0026#34;Tags: warning,skull\u0026#34; \\ -d \u0026#34;Remote access to $(hostname) detected. Act right away.\u0026#34; \\ http://192.168.0.197:3680/laosu_test_ch æŸ¥çœ‹pushçš„log.å¦‚æœå‡ºç°elementæµ‹è¯•æ¨é€ä¸ä¸‹å»ï¼Œè½¬åœˆåœˆï¼Œæ­£å¸¸èƒ½å‘æ¶ˆæ¯å°±ä¸ç”¨ç®¡ï¼Œlogé‡Œå¯ä»¥ä¼šå‡ºç°200ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š\ndocker logs -tf --tail 100 \u0026lt;synapseå®¹å™¨idæˆ–åç§°\u0026gt; 2\u0026gt;\u0026amp;1 | grep /_matrix/push/v1/notify å®ä¾‹:\ndocker logs -tf --tail 100 cfb 2\u0026gt;\u0026amp;1 | grep /_matrix/push/v1/notify æ¢å¤å¤‡ä»½çš„docker-compose.ymlçš„é…ç½®æ–‡ä»¶ï¼š services: ntfy: image: binwiederhier/ntfy:latest container_name: ntfy command: - serve environment: - TZ=Asia/Shanghai volumes: - /root/data/docker_data/ntfy/data/cache:/var/cache/ntfy - /root/data/docker_data/ntfy/data/config:/etc/ntfy ports: - 12332:80 restart: unless-stopped networks: - matrix networks: matrix: external: true name: matrix æœ¬ç³»åˆ—æœ€åä¸€ç¯‡æ–‡ç« ä¼šæ•™ä½ å¦‚ä½•å’Œelementå®¢æˆ·ç«¯é…åˆä½¿ç”¨ï¼Œelementå®¢æˆ·å†…ç½®æ˜¯æ”¯æŒçš„ã€‚ ","permalink":"https://hanigege.github.io/posts/other/%E5%AE%B6%E5%BA%AD%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B3%BB%E5%88%972ntfy%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/","tags":null,"title":"å®¶åº­èŠå¤©æœåŠ¡å™¨ç³»åˆ—ï¼ˆ2ï¼‰ntfyæœåŠ¡æ­å»º"},{"categories":["other"],"contents":"\nè®¾è®¡æ€è·¯ æœåŠ¡å™¨éœ€è¦2å°ï¼Œå¤–ç½‘ä¸€å°vpså³å¯ï¼Œæ­å»ºcoturnæœåŠ¡ã€‚æœ¬åœ°ä¸€å°ï¼Œæ­å»ºsynapseåŠntfyæœåŠ¡ï¼Œæ‰€æœ‰æœåŠ¡å‡ä»¥dockerçš„æ–¹å¼æ¥æ­å»º 1. ntfyæœåŠ¡ï¼šå› ä¸ºå¾ˆå¤šçš„é™åˆ¶å¯¼è‡´æ¶ˆæ¯æ— æ³•ä¼ è¾¾ï¼Œç±»ä¼¼äºä½ æ¶ˆæ¯æ¥äº†ï¼Œç¡®æ”¶ä¸åˆ°é€šçŸ¥æé†’. 2. coturn æ˜¯ä¸€ä¸ª STUN/TURN æœåŠ¡å™¨ å®ç°ï¼Œä¸»è¦ç”¨äº WebRTCã€VoIPã€è§†é¢‘ä¼šè®®ç­‰å®æ—¶é€šä¿¡åº”ç”¨ä¸­ï¼Œè§£å†³NAT ç©¿é€é—®é¢˜ã€‚coturn åŒæ—¶å®ç°äº† STUN + TURNï¼Œé€šå¸¸ç”¨ä½œ WebRTC çš„ä¸­ç»§æœåŠ¡å™¨ï¼Œç¡®ä¿è§†é¢‘/è¯­éŸ³è¿æ¥åœ¨å„ç§å¤æ‚ç½‘ç»œç¯å¢ƒä¸‹éƒ½èƒ½å»ºç«‹ã€‚ 3. synapseèŠå¤©æœåŠ¡å™¨ä¸»ä½“ï¼Œæ”¯æŒæ–‡å­—ï¼Œè¯­éŸ³ï¼Œåœ¨çº¿è¯­éŸ³ç”µè¯ï¼Œåœ¨çº¿è§†é¢‘ï¼Œæ–‡ä»¶ä¼ é€ï¼Œæ˜¯ä¸€å¥—å®Œæ•´å¯æŒç»­çš„èŠå¤©æœåŠ¡ã€‚ 4. å®¢æˆ·ç«¯æœ‰å¾ˆå¤šç§ï¼Œå®˜ç½‘ä¸Šéƒ½æœ‰ä»‹ç»ï¼Œè¿™é‡Œåªæ¨èä½¿ç”¨Elementå®¢æˆ·ç«¯ã€‚ æœ€æœ€ä¸‹é¢æ˜¯å¤‡ä»½æ¢å¤çš„æ–¹æ³•ï¼Œå¦‚ä½•å¤‡ä»½ï¼ŒæŠŠç›¸å…³dockeræ–‡ä»¶å¤¹æ‰“åŒ…ä¸‹è½½å°±å¯ä»¥äº†ï¼Œéœ€è¦æ¢å¤çš„æ—¶å€™ï¼Œä¸Šä¼ åˆ°ç›¸å…³çš„æœåŠ¡å™¨ï¼Œæ”¾åœ¨rootæ–‡ä»¶å¤¹ä¸‹ã€‚\nåˆ‡è®°ï¼ŒSYNAPAEæœåŠ¡å™¨ä¸å¯ä»¥ä½¿ç”¨fakeipçš„DNSä»£ç†ä¸Šç½‘ï¼Œåªèƒ½ç”¨æœ¬åœ°çš„ç½‘ç»œï¼Œä¸ç„¶ï¼Œä¼šæ”¶ä¸åˆ°æ¶ˆæ¯NTFYä¼šå‡ºé—®é¢˜ï¼ å‰è¨€ é¦–å…ˆå¿…é¡»ä»‹ç»ä¸‹Matrixã€‚Matrixæ˜¯ä¸€ä¸ªå¼€æºã€å¯äº¤äº’ã€å»ä¸­å¿ƒåŒ–çš„å®æ—¶é€šä¿¡æœåŠ¡æ¡†æ¶ã€‚ä½¿ç”¨Matrixå¯ä»¥æ­å»ºå®‰å…¨çš„é€šä¿¡æœåŠ¡å™¨ï¼Œé…åˆæ”¯æŒ Matrix çš„å®¢æˆ·ç«¯å¯ä»¥å®ç°ä¸ªäººã€å›¢é˜Ÿé—´çš„å®æ—¶èŠå¤©äº¤äº’ã€‚\nä¸å¸¸è§çš„QQã€å¾®ä¿¡ã€é’‰é’‰ç›¸æ¯”ï¼ŒMatrixçš„ç‰¹ç‚¹å°±æ˜¯å¼€æºï¼Œå¯ç§æœ‰åŒ–éƒ¨ç½²ï¼Œä¿è¯é€šä¿¡çš„å®‰å…¨å’Œéšç§ã€‚ä¸Rocket.chatã€MatterMostç›¸æ¯”ï¼Œmatrixçš„ç‰¹ç‚¹è¿˜è¦å†åŠ ä¸Šå»ä¸­å¿ƒåŒ–ã€‚æ¯ä¸ªè¿è¡ŒMatrixçš„æœåŠ¡å™¨éƒ½æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©åœ¨ä»»æ„èŠ‚ç‚¹æ³¨å†Œã€è¿æ¥ï¼ŒåŒä¸€ä¸ªèŠ‚ç‚¹å†…çš„ç”¨æˆ·å¯ä»¥ä»»æ„é€šä¿¡ã€‚åŒæ—¶ï¼ŒèŠ‚ç‚¹ä¸èŠ‚ç‚¹ä¹‹é—´ä¹Ÿå¯ä»¥é€šè¿‡è”é”ï¼ˆFederationï¼‰æœºåˆ¶è¿›è¡Œé€šä¿¡ï¼Œå®ç°ä¸åŒèŠ‚ç‚¹çš„ç”¨æˆ·ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚\nå› ä¸ºMatrixåªæ˜¯ä¸ªæ¡†æ¶ï¼Œå¯ä»¥æœ‰å¾ˆå¤šå®ç°ï¼Œæœ¬æ–‡ä½¿ç”¨çš„synapseå°±æ˜¯å…¶ä¸­ä¸€ä¸ªæœåŠ¡ç«¯å®ç°ã€‚\né™¤äº†å®‰è£…æœåŠ¡ç«¯ï¼Œæœ¬æ–‡è¿˜æœ‰å®‰è£…element webç«¯çš„æ­¥éª¤ã€‚\næ­ä¸€ä¸ªdemoå¹¶ä¸è€—èµ„æºï¼ŒåŠ ä¸Špostgresqlæ•°æ®åº“æ‰ç”¨äº†200MBå†…å­˜ä¸åˆ°ï¼Œå¦‚æœç”¨é»˜è®¤çš„sqliteæ•°æ®åº“ä¼šæ›´çœå†…å­˜ã€‚\nå®‰è£…æœåŠ¡ç«¯ æ›´æ–°ç¯å¢ƒ apt update -y \u0026amp;\u0026amp; apt upgrade -y \u0026amp;\u0026amp; apt install -y curl wget sudo socat å®‰è£… Docker curl -fsSL https://get.docker.com -o get-docker.sh \u0026amp;\u0026amp; sh get-docker.sh curl -L \u0026#34;https://github.com/docker/compose/releases/download/v2.16.0/docker-compose-$(uname -s)-$(uname -m)\u0026#34; -o /usr/local/bin/docker-compose chmod +x /usr/local/bin/docker-compose æ­å»ºSynapse æŒ‰ç…§æ•™ç¨‹å»ºç«‹/data/synapse/ä¸‹çš„ä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼š\nmkdir ~/data/docker_data/synapse -p mkdir ~/data/docker_data/synapse/data -p mkdir ~/data/docker_data/synapse/postgres -p mkdir ~/data/docker_data/synapse/html -p å…·ä½“å¦‚ä¸‹ï¼š\né¦–å…ˆï¼Œé€‰æ‹©ä¸€ä¸ªå®¿ä¸»æœºæ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜æ”¾synapseæ‰€æœ‰çš„æ•°æ®ï¼Œæˆ‘çš„è§„åˆ’å¦‚ä¸‹ï¼š\nSynapseæ•°æ®ï¼š/root/data/docker_data/synapse/data\nPostgreSQLæ•°æ®ï¼š /root/data/docker_data/synapse/postgres\nä¸ºäº†è®©æ¡¥æ¥ç”¨çš„å®¹å™¨å’Œ synapse å®¹å™¨èƒ½å¤Ÿäº’ç›¸é€šè®¯ï¼Œå»ºç«‹ä¸€ä¸ª docker networkï¼š\ndocker network create matrix PostgreSQL pgåº“æˆ‘é€‰æ‹©äº†16ç‰ˆæœ¬ï¼Œé€‰æ‹©çš„é•œåƒæ˜¯postgres:16-alpineã€‚\ndocker run --name postgres16 --network matrix --restart=always -v /root/data/docker_data/synapse/postgres:/var/lib/postgresql/data -e POSTGRES_PASSWORD=è‡ªå®šä¹‰PostgreSQLå¯†ç  -p 5432:5432 -d postgres:16-alpine ç•Œé¢ä¼šæ˜¾ç¤ºå®¹å™¨çš„hashå€¼ï¼Œæ¥ç€æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤åˆ›å»ºä¸€ä¸ªç”¨äºè¿æ¥æ•°æ®åº“çš„synapseç”¨æˆ·å¹¶è¾“å…¥ä½ çš„å¯†ç \ndocker exec -it postgres16 createuser -U postgres --pwprompt synapse_user æ‰§è¡Œä¸‹é¢çš„è¯­å¥è¿›å…¥psql\ndocker exec -it postgres16 psql -U postgres æ‰§è¡Œä¸‹é¢çš„å»ºåº“è¯­å¥ç”¨äºå»ºç«‹ä¸€ä¸ªsynapseåº“\nCREATE DATABASE synapse ENCODING \u0026#39;UTF8\u0026#39; LC_COLLATE=\u0026#39;C\u0026#39; LC_CTYPE=\u0026#39;C\u0026#39; template=template0 OWNER synapse_user; æ‰§è¡Œå®Œæ¯•åè¾“å…¥\\qé€€å‡º *åç»­è¿æ¥å¦‚æœæœ‰é—®é¢˜ï¼Œå¯ä»¥åœ¨postgres/pg_hba.confä¸­ æ·»åŠ  host synapse synapse_user all trust\nå®‰è£…synapse å…ˆæ‹‰å–dockeré•œåƒ\ndocker pull matrixdotorg/synapse:latest ç”Ÿæˆé…ç½®æ–‡ä»¶ã€‚æ³¨æ„æ ¹æ®å®é™…ä¿®æ”¹å®¿ä¸»æœºæŒ‚è½½ç›®å½•è·¯å¾„å’Œmatrixçš„host\ndocker run -it --rm -v /root/data/docker_data/synapse/data:/data -e SYNAPSE_SERVER_NAME=matrix.demo.com -e SYNAPSE_REPORT_STATS=yes matrixdotorg/synapse:latest generate ä¸Šé¢çš„åŸŸåï¼ˆä¾‹ï¼‰ï¼Œæ”¹ä¸ºä½ è‡ªå·±çš„åŸŸå\nåœ¨postgresqlä¸­åˆ›å»ºç”¨æˆ·å’Œæ•°æ®åº“ï¼ˆé»˜è®¤ä½¿ç”¨sqliteï¼Œåªæ˜¯ä½“éªŒçš„è¯å¯ä»¥è·³è¿‡ï¼‰\nä¿®æ”¹é…ç½®æ–‡ä»¶/root/data/docker_data/synapse/data/homeserver.yaml\nï¼Œæ³¨é‡Šæ‰åŸå…ˆçš„sqlite3é…ç½®ï¼Œä¿®æ”¹ä¸ºpostgresé…ç½®\nå…ˆæ³¨é‡Šæ–‡ä»¶ä¸­ä¸‹é¢çš„ï¼š\n#database: #name: sqlite3 #args: # database: /data/homeserver.db æ¢æˆï¼š\ndatabase: name: psycopg2 args: user: synapse_user password: \u0026lt;pass\u0026gt; database: synapse host: \u0026lt;host\u0026gt; #ç›´æ¥å¡«å…¥å†…ç½‘ipå³å¯ cp_min: 5 cp_max: 10 åœ¨/root/data/docker_data/synapseæ–‡ä»¶å¤¹ä¸‹æ–°å»ºdocker-compose.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹\nservices: synapse: image: matrixdotorg/synapse:latest container_name: matrix-synapse ports: - \u0026#34;8008:8008\u0026#34; volumes: - ./data:/data - ./html:/usr/local/lib/python3.11/site-packages/synapse/static networks: - matrix restart: always environment: - \u0026#34;TZ=Asia/Shanghai\u0026#34; networks: matrix: name: matrix ä¸Šé¢çš„ä»£ç æœ‰å…³docker ç½‘ç»œçš„çŸ¥é“ï¼Œæ ¹æ®ä¸Šé¢çš„ä»£ç ä¸‹é¢è¯´æ˜ä¸€ä¸‹ï¼š\nåœ¨ä½ çš„Docker Composeæ–‡ä»¶ä¸­ï¼Œä½ å®šä¹‰äº†ä¸€ä¸ªåä¸º\u0026quot;matrix\u0026quot;çš„ç½‘ç»œã€‚å½“ä½ è¿è¡Œdocker-compose up -dæ—¶ï¼ŒDocker Composeä¼šä¸ºæ¯ä¸ªæœåŠ¡è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ¡¥æ¥ç½‘ç»œï¼Œå¹¶åœ¨ç½‘ç»œåç§°å‰åŠ ä¸ŠæœåŠ¡åç§°çš„å‰ç¼€ã€‚\nå› æ­¤ï¼Œç”±äºä½ çš„æœåŠ¡åæ˜¯\u0026quot;synapse\u0026quot;ï¼Œå®é™…åˆ›å»ºçš„æ¡¥æ¥ç½‘ç»œåç§°ä¼šæ˜¯\u0026quot;synapse_matrix\u0026quot;ï¼Œï¼ˆå¦‚æœä¸åŠ name: matrixå°±æ˜¯è¿™æ ·ï¼‰è€Œä¸æ˜¯ä»…ä»…æ˜¯\u0026quot;matrix\u0026quot;ã€‚è¿™æ˜¯Docker Composeçš„é»˜è®¤è¡Œä¸ºã€‚\nä»£ç ä¸­ï¼š - ./html:/usr/local/lib/python3.11/site-packages/synapse/static è¿™æ˜¯æŒ‡å‘synapseçš„ä¸»é¡µç½‘é¡µ\nå¦‚æœä½ æƒ³æ˜¾å¼åœ°æŒ‡å®šç½‘ç»œåç§°ï¼Œå¯ä»¥åœ¨networkséƒ¨åˆ†çš„å®šä¹‰ä¸­ä½¿ç”¨nameå±æ€§ï¼Œä¾‹å¦‚ï¼š\nservices: synapse: image: matrixdotorg/synapse:latest container_name: matrix-synapse ports: - \u0026#34;8008:8008\u0026#34; volumes: - ./data:/data - ./html:/usr/local/lib/python3.11/site-packages/synapse/static networks: - matrix restart: always environment: - \u0026#34;TZ=Asia/Shanghai\u0026#34; networks: matrix: name: my_custom_matrix_network #å› æ­¤è¿™ä¸ªname,æˆ‘å°±å†™ä¸ºä¸Šé¢çš„ï¼šmatrix\nå¯åŠ¨å®¹å™¨ docker-compose up -d é…ç½®nginxåå‘ä»£ç†httpæˆ–httpsï¼ˆç•¥è¿‡ï¼‰\nåˆ›å»ºç”¨æˆ·ï¼ˆé»˜è®¤ç¦æ­¢å…¬å¼€æ³¨å†Œï¼‰\næ ¹æ®æç¤ºè¾“å…¥ç”¨æˆ·åã€å¯†ç ã€æ˜¯å¦è®¾ç½®ä¸ºç®¡ç†å‘˜ register_new_matrix_user -c /data/homeserver.yaml \u0026lt;your matrix server host\u0026gt; cd /root/data/docker_data/synapse docker-compose exec synapse register_new_matrix_user -c /data/homeserver.yaml http://localhost:8008 å®‰è£…element webå®¢æˆ·ç«¯ è®¿é—®githubä¸‹è½½releaseåŒ…\nè§£å‹åï¼Œåˆ›å»ºé…ç½®æ–‡ä»¶\ncp config.sample.json config.json ç¼–è¾‘config.jsonï¼Œè®¾ç½®default_server_config.m.homeserver.base_urlä¸ºè‡ªå·±çš„matrixæœåŠ¡ç«¯åœ°å€\né…ç½®nginxæŒ‡å‘è§£å‹åçš„ç›®å½•\nè®¿é—®è‡ªå»ºçš„element webå®¢æˆ·ç«¯æµ‹è¯•\nè¡¥å…… å…è®¸å…¬å¼€æ³¨å†Œ ä¿®æ”¹synapseçš„homeserver.yamlæ–‡ä»¶ï¼Œè®¾ç½®ä»¥ä¸‹å‚æ•°\nenable_registration: True é‡å¯synapse\nElementçš„Windowså®¢æˆ·ç«¯æŒ‡å®šé»˜è®¤æœåŠ¡å™¨åœ°å€ åœ¨èµ„æºç®¡ç†å™¨ä¸­æ‰“å¼€ç›®å½• %AppData\\Roaming\\Element%\næ–°å»ºæ–‡ä»¶ config.jsonï¼Œè¾“å…¥ä»¥ä¸‹å†…å®¹\n{ \u0026#34;default_server_config\u0026#34;: { \u0026#34;m.homeserver\u0026#34;: { \u0026#34;base_url\u0026#34;: \u0026#34;\u0026lt;your matrix server host\u0026gt;\u0026#34; } } } å¤‡ä»½æ¢å¤çš„æ–¹æ³•ï¼š ä¸ºäº†è®©æ¡¥æ¥ç”¨çš„å®¹å™¨å’Œ synapse å®¹å™¨èƒ½å¤Ÿäº’ç›¸é€šè®¯ï¼Œ å»ºç«‹ä¸€ä¸ª docker networkï¼š\ndocker network create matrix PostgreSQL pgåº“æˆ‘é€‰æ‹©äº†16ç‰ˆæœ¬ï¼Œé€‰æ‹©çš„é•œåƒæ˜¯postgres:16-alpineã€‚\ndocker run --name postgres16 --network matrix --restart=always -v /root/data/docker_data/synapse/postgres:/var/lib/postgresql/data -e POSTGRES_PASSWORD=è‡ªå®šä¹‰PostgreSQLå¯†ç  -p 5432:5432 -d postgres:16-alpine æ›´æ”¹synapseæ–‡ä»¶å¤¹ä¸‹é‡Œçš„docker-compose.ymlé‡Œçš„å†…å®¹å¦‚ä¸‹ï¼Œç›´æ¥å¤åˆ¶æ›¿æ¢ï¼š\nservices: synapse: image: matrixdotorg/synapse:latest container_name: matrix-synapse ports: - \u0026#34;8008:8008\u0026#34; volumes: - /root/data/docker_data/synapse/data/:/data/ - /root/data/docker_data/synapse/html/:/usr/local/lib/python3.11/site-packages/synapse/static/ networks: - matrix restart: always environment: - \u0026#34;TZ=Asia/Shanghai\u0026#34; networks: matrix: driver: bridge è¿è¡Œï¼š\ndocker-compose up -d æå®šï¼\n","permalink":"https://hanigege.github.io/posts/other/%E5%AE%B6%E5%BA%AD%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B3%BB%E5%88%971synapse%E6%90%AD%E5%BB%BA/","tags":null,"title":"å®¶åº­èŠå¤©æœåŠ¡å™¨ç³»åˆ—ï¼ˆ1ï¼‰synapseæ­å»º"},{"categories":["routers"],"contents":"\nè¿™é‡Œä½¿ç”¨vyosè‡ªç®¡ç†å®¹å™¨çš„æ–¹æ³•,å¯ä»¥è·å–åˆ°ç½‘å¡å…¬ç½‘ip æ“ä½œå‰ï¼Œvyosæœ¬æœºå…ˆç§‘å­¦ï¼Œä¸ç„¶æ²¡æ³•æ¥dockeré•œåƒ è¿™ç§æ¨¡å¼ä¸å¯ä»¥è®¾ç½®å•ç‹¬çš„IP,å› ä¸ºä½¿ç”¨çš„æ˜¯vyosä¸»æœºçš„ip\næ¡¥æ¥çš„ç½‘ç»œå¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥å»ºä¸€ä¸ªçš„ï¼šåŸå› æ˜¯æ–¹ä¾¿ ddns-goä½¿ç”¨å†…ç½‘çš„ç½‘å€ç™»å½• ï¼š172.23.0.1 (å¯é€‰ï¼Œéå¿…é¡»ï¼Œä¹Ÿå¯ä»¥ç”¨å†…å¤–ç½‘å£ipç™»å½•)\nåˆ›å»ºæ¡¥æ¥ç½‘ç»œ set container network ct-network prefix \u0026#39;172.23.0.0/24\u0026#39; æå‰å»ºç«‹å¥½ddnsçš„æ˜ å°„æœ¬åœ°æŒä¹…ç›®å½•ï¼š mkdir -p /config/containers/ddns æ‹‰å–å®¹å™¨é•œåƒ $ add container image \u0026#39;jeessy/ddns-go\u0026#39; æ­å»ºddns-go set container name ddns-go allow-host-networks #å…è®¸å®¹å™¨ä½¿ç”¨ä¸»æœºç½‘ç»œï¼ˆhost networkï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®¹å™¨ä¸ä¼šæœ‰ç‹¬ç«‹çš„ç½‘ç»œæ¥å£ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ VyOS ä¸»æœºçš„ç½‘ç»œ set container name ddns-go image \u0026#39;docker.io/jeessy/ddns-go\u0026#39; #æŒ‡å®šè¯¥å®¹å™¨ä½¿ç”¨çš„ Docker é•œåƒ set container name ddns-go restart \u0026#39;always\u0026#39; set container name ddns-go volume config destination \u0026#39;/root/\u0026#39; #æ˜ å°„å®¹å™¨å†…çš„è·¯å¾„ set container name ddns-go volume config source \u0026#39;/config/containers/ddns\u0026#39; #æ˜ å°„æœ¬åœ°çš„è·¯å½¹ æŸ¥çœ‹è¿è¡Œæ˜¯å¦æˆåŠŸæœ‰UPå³æˆåŠŸ sudo podman ps -s sudo podman ps -a ç™»å½•ç®¡ç†å¹³å° http://IP:9876 ç™»å½•ç”¨æˆ·åï¼šadmin\n","permalink":"https://hanigege.github.io/posts/routers/vyos%E4%B8%8B%E5%AE%89%E8%A3%85ddns-go/","tags":null,"title":"Vyosä¸‹å®‰è£…ddns-Go"},{"categories":["freebsd"],"contents":"\npkg æ¢æº è‹¥è¦è·å–æ»šåŠ¨æ›´æ–°çš„åŒ…ï¼Œè¯·å°† quarterly ä¿®æ”¹ä¸º latestã€‚äºŒè€…åŒºåˆ«è§ FreeBSD æ‰‹å†Œã€‚è¯·æ³¨æ„ï¼ŒCURRENT ç‰ˆæœ¬åªæœ‰ latestã€‚\nä½¿ç”¨å‘½ä»¤ä¿®æ”¹ç³»ç»Ÿçº§ pkg æºä½¿ç”¨ latestï¼š\nsed -i \u0026#39;\u0026#39; \u0026#39;s/quarterly/latest/g\u0026#39; /etc/pkg/FreeBSD.conf åˆ›å»ºç”¨æˆ·çº§æºç›®å½•å’Œæ–‡ä»¶ï¼š\n# mkdir -p /usr/local/etc/pkg/repos # nano /usr/local/etc/pkg/repos/mirrors.conf ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™ï¼ˆUSTCï¼‰\nå†™å…¥ä»¥ä¸‹å†…å®¹ï¼š\nustc: { url: \u0026#34;http://mirrors.ustc.edu.cn/freebsd-pkg/${ABI}/latest\u0026#34;, } FreeBSD: { enabled: no } å—äº¬å¤§å­¦å¼€æºé•œåƒç«™\nå†™å…¥ä»¥ä¸‹å†…å®¹ï¼š\nnju: { url: \u0026#34;http://mirrors.nju.edu.cn/freebsd-pkg/${ABI}/latest\u0026#34;, } FreeBSD: { enabled: no } ç½‘æ˜“å¼€æºé•œåƒç«™\nå†™å…¥ä»¥ä¸‹å†…å®¹ï¼š\n163: { url: \u0026#34;http://mirrors.163.com/freebsd-pkg/${ABI}/latest\u0026#34;, } FreeBSD: { enabled: no } ports æºï¼šä»¥æºä»£ç æ–¹å¼ç¼–è¯‘å®‰è£…è½¯ä»¶çš„åŒ…ç®¡ç†å™¨ ä¸‹è½½ ports è¿™ä¸ªæºæ˜¯ä¸‹è½½ ports æœ¬èº«çš„æºã€‚ç­‰åŒäºä»¥å‰çš„ portsnapã€‚\nGit æ–¹æ³• é¡»æå‰å®‰è£… gitï¼š\n# pkg install git æˆ–\n# cd /usr/ports/devel/git # make install clean ç„¶åï¼š(å¦‚æœå·²ç»å®‰è£…äº†portsï¼Œç›´æ¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤ä¼šæŠ¥é”™ï¼Œè¯·ç»§ç»­å¾€ä¸‹çœ‹ï¼‰\n# git clone --filter=tree:0 https://mirrors.ustc.edu.cn/freebsd-ports/ports.git /usr/ports æ³¨æ„\n\u0026ndash;depth 1 ä¼šç»™æœåŠ¡å™¨å¸¦æ¥è¾ƒå¤§è®¡ç®—å‹åŠ›ï¼Œè¯·å°½é‡ä½¿ç”¨å‚æ•° \u0026ndash;filter=tree:0ã€‚\nä½ æ”¶åˆ°çš„é”™è¯¯ä¿¡æ¯è¡¨æ˜ï¼Œç›®æ ‡è·¯å¾„ /usr/ports å·²ç»å­˜åœ¨ï¼Œå¹¶ä¸”è¯¥ç›®å½•ä¸æ˜¯ç©ºçš„ã€‚è¿™æ„å‘³ç€åœ¨å°è¯• git clone æ—¶ï¼ŒGit å‘ç°ç›®æ ‡ç›®å½•å·²ç»æœ‰å†…å®¹ï¼Œå› æ­¤æ— æ³•æ‰§è¡Œå…‹éš†æ“ä½œã€‚\nè§£å†³æ–¹æ³•ï¼š ä½ å¯ä»¥é€‰æ‹©ä»¥ä¸‹å‡ ç§æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š\nåˆ é™¤ç°æœ‰çš„ /usr/ports ç›®å½• å¦‚æœä½ ç¡®è®¤ /usr/ports ç›®å½•ä¸­çš„å†…å®¹ä¸å†éœ€è¦ï¼Œå¯ä»¥åˆ é™¤è¯¥ç›®å½•å¹¶é‡æ–°æ‰§è¡Œ git cloneï¼š\nrm -rf /usr/ports git clone --filter=tree:0 https://mirrors.ustc.edu.cn/freebsd-ports/ports.git /usr/ports æ³¨æ„ï¼š åˆ é™¤ç›®å½•å‰è¯·ç¡®ä¿è¯¥ç›®å½•ä¸­çš„å†…å®¹ä¸å†éœ€è¦ï¼Œå› ä¸ºè¿™ä¼šå®Œå…¨æ¸…é™¤ç›®å½•åŠå…¶å†…å®¹ã€‚\nä½¿ç”¨å·²æœ‰çš„ /usr/ports ç›®å½• å¦‚æœ /usr/ports ç›®å½•å·²ç»åŒ…å«äº†ä¸€éƒ¨åˆ†å†…å®¹ï¼ˆæ¯”å¦‚å·²ç»å­˜åœ¨çš„ Ports æ ‘ï¼‰ï¼Œä½ å¯ä»¥é€‰æ‹©ç›´æ¥åœ¨è¯¥ç›®å½•ä¸­è¿›è¡Œ Git æ›´æ–°ï¼Œè€Œä¸æ˜¯é‡æ–°å…‹éš†ã€‚ é¦–å…ˆï¼Œè¿›å…¥ /usr/ports ç›®å½•ï¼š\ncd /usr/ports ç„¶åï¼Œè¿è¡Œ Git æ‹‰å–æ›´æ–°ï¼š\ngit fetch --all è¿™å°†æ›´æ–°ç°æœ‰çš„ Ports æ ‘ï¼Œè€Œä¸æ˜¯é‡æ–°å…‹éš†ã€‚\nä½¿ç”¨ä¸€ä¸ªä¸åŒçš„ç›®å½•ä½œä¸ºç›®æ ‡ å¦‚æœä½ å¸Œæœ›ä¿ç•™ /usr/ports ä¸­çš„ç°æœ‰å†…å®¹ï¼Œå¯ä»¥å°† Ports æ ‘å…‹éš†åˆ°å¦ä¸€ä¸ªç›®å½•ï¼Œé¿å…å†²çªã€‚ä¾‹å¦‚ï¼š git clone --filter=tree:0 https://mirrors.ustc.edu.cn/freebsd-ports/ports.git /path/to/another/directory è¿™æ ·ï¼Œä½ å°±å¯ä»¥åœ¨æ–°çš„ç›®å½•ä¸­è·å– Ports æ ‘ï¼Œè€Œä¸å½±å“ç°æœ‰çš„ /usr/portsã€‚\næ€»ç»“ï¼š å¦‚æœ /usr/ports ç›®å½•çš„å†…å®¹ä¸å†éœ€è¦ï¼Œå¯ä»¥åˆ é™¤å¹¶é‡æ–°å…‹éš†ã€‚\nå¦‚æœæƒ³ä¿ç•™ç°æœ‰å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨ Git æ›´æ–°å·²æœ‰çš„ä»“åº“ã€‚\nå¦‚æœä¸æƒ³å½±å“ç°æœ‰å†…å®¹ï¼Œå¯ä»¥å°† Ports æ ‘å…‹éš†åˆ°å¦ä¸€ä¸ªç›®å½•ã€‚\n","permalink":"https://hanigege.github.io/posts/freebsd/%E8%AE%A9freebsd%E5%9C%A8%E7%BB%88%E7%AB%AF%E4%B8%8B%E6%8D%A2%E6%BA%90/","tags":null,"title":"è®©freebsdåœ¨ç»ˆç«¯ä¸‹æ¢æº"},{"categories":["freebsd"],"contents":"\nç¼–è¾‘/etc/login.confï¼Œç»“å°¾å¤„ï¼ˆæˆ‘ä¸€èˆ¬åœ¨russianæ®µè½åé¢ï¼‰æ·»åŠ  chinese|Chinese Users Accounts:\\ :charset=UTF-8:\\ :lang=zh_CN.UTF-8:\\ :setenv=LC_ALL=zh_CN.UTF-8:\\ :tc=default: ä¹‹åè¿è¡Œ cap_mkdb /etc/login.conf pw usermod root -L chinese ","permalink":"https://hanigege.github.io/posts/freebsd/%E8%AE%A9freebsd%E5%9C%A8%E7%BB%88%E7%AB%AF%E4%B8%8B%E6%94%AF%E6%8C%81%E4%B8%AD%E6%96%87/","tags":null,"title":"è®©freebsdåœ¨ç»ˆç«¯ä¸‹æ”¯æŒä¸­æ–‡"},{"categories":["freebsd"],"contents":"\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;freebsdç³»ç»Ÿæˆ‘å»ºè®®æ˜¯ç”¨æ™®é€šç”¨æˆ·ç™»å½•ä½¿ç”¨ï¼ŒbashæŒ‡ä»¤é›†åªä¿®æ”¹æ™®é€šç”¨æˆ·ä½¿ç”¨ï¼Œrootç”¨æˆ·ä¸è¦æ”¹ã€‚ \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;ğŸ§± åŸå› ä¸€ï¼šbash é€šå¸¸å®‰è£…åœ¨ /usr/local/binï¼Œè€Œä¸æ˜¯ /bin \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;FreeBSD éµå¾ªä¼ ç»Ÿ Unix çš„ç›®å½•ç»“æ„ï¼Œç³»ç»Ÿæ ¸å¿ƒå·¥å…·ä½äº /binã€/sbinã€/usr/bin ç­‰ï¼Œè€Œ /usr/local/bin æ˜¯ç”¨äºç¬¬ä¸‰æ–¹è½¯ä»¶çš„ã€‚\nå¦‚æœä½ å°† root çš„ shell æ”¹ä¸º /usr/local/bin/bashï¼Œä½† /usr/local æ²¡æŒ‚è½½æˆ–å‡ºæ•…éšœäº†ï¼Œå°±æ— æ³•ç™»å½•æˆ–ä¿®å¤ç³»ç»Ÿã€‚\nè¿™åœ¨ å•ç”¨æˆ·æ¨¡å¼ï¼ˆsingle user modeï¼‰æˆ–ç³»ç»Ÿä¿®å¤ç¯å¢ƒä¸­ æ˜¯ä¸ªå¤§é—®é¢˜ï¼šç³»ç»Ÿé€šå¸¸åªæŒ‚è½½äº†æ ¹åˆ†åŒº /ï¼Œå¹¶ä¸ä¼šæŒ‚è½½ /usrã€‚\nâ¸»\nğŸ§¯ åŸå› äºŒï¼šç³»ç»Ÿå¯åŠ¨æ—¶çš„æœ€å°å¯ç”¨ç¯å¢ƒä¸­æ²¡æœ‰ bash\nç³»ç»Ÿå¯åŠ¨æ—©æœŸå¯èƒ½ bash è¿˜æ²¡è¢«åŠ è½½ï¼Œroot å°±å¿…é¡»ä¾èµ– /bin/sh ä¹‹ç±»çš„æœ€åŸºæœ¬ shellã€‚ å¦‚æœä½ ç”¨çš„æ˜¯ bashï¼Œè€Œ bash åˆä¸å¯ç”¨ï¼Œé‚£ä½ ç”šè‡³è¿ shell éƒ½æ‰“ä¸å¼€ã€‚\n1.å®‰è£…bash cd /usr/ports/shells/bash make install clean åœ¨/binç›®å½•ä¸‹é¢åšä¸€ä¸ªç¬¦å·è¿æ¥ã€‚ï¼ˆè¿™ä¸€æ­¥å¯ä»¥ä¸åšï¼Œå¯é€‰ï¼‰\nln -s /usr/local/bin/bash /bin/bash åŠ å…¥bash,å¦‚æœä¸Šä¸€æ­¥åšäº† echo \u0026#39;/bin/bash\u0026#39; \u0026gt;\u0026gt; /etc/shells ä¿æŒé»˜è®¤è·¯å¾„çš„ç”¨ä¸‹é¢çš„\necho \u0026#39;/usr/local/bin/bash\u0026#39; | sudo tee -a /etc/shells 4.æ›´æ”¹ç”¨æˆ·shell(rootç”¨æˆ·ä¸å»ºè®®ä¿®æ”¹ï¼‰\nchsh -s /bin/bash root ä¿æŒé»˜è®¤è·¯å¾„çš„ç”¨ä¸‹é¢çš„ ï¼ˆæ¨èä¸‹é¢æ™®èƒ½ç”¨æˆ·ç›´æ¥ä½¿ç”¨ï¼‰\nchsh -s /usr/local/bin/bash # sudo chsh -s /usr/local/bin/bash gary 5.é…ç½® (root)\n# vi ~/.profile æˆ–è€…-ä¿æŒé»˜è®¤è·¯å¾„çš„ç”¨ä¸‹é¢çš„(æ™®é€šç”¨æˆ·ï¼‰\n$ vim .bash_profile alias ls=\u0026#39;ls -G\u0026#39; #æ˜¾ç¤ºé¢œè‰² alias ll=\u0026#39;ls -al\u0026#39; alias rm=\u0026#39;rm -i\u0026#39; #ç¡®è®¤åˆ é™¤ alias del=\u0026#39;rm -r\u0026#39; #ç¡®è®¤åˆ é™¤ alias mv=\u0026#39;mv -i\u0026#39; #ç¡®è®¤ç§»åŠ¨ 6.é€€å‡ºé‡æ–°ç™»å½•å³ç”Ÿæ•ˆ è¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ‡æ¢ä¸º bashï¼š\nexec /usr/local/bin/bash -l trzszä¸‹éœ€æ”¹ä¸ºï¼š ä½¿ç”¨bash /usr/local/bin/bash -1 ","permalink":"https://hanigege.github.io/posts/freebsd/freebsd%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8bash/","tags":null,"title":"Freebsdç¼–è¯‘å®‰è£…å’Œä½¿ç”¨bash"},{"categories":["freebsd"],"contents":"\nå¼€å§‹å®‰è£…ï¼Œå›è½¦ ç›´æ¥å›è½¦ å¡«å†™ä¸»æœºå ï¼ˆå¯ç›´æ¥å›è½¦ï¼‰ é»˜è®¤çš„åŸºç¡€ä¸Šå¤šåŠ ä¸€ä¸ªå®‰è£…ports è¿™é‡Œæˆ‘é€‰æ‹©UFSï¼ˆè™šæ‹Ÿæœºæˆ‘å»ºè®®é€‰UFSï¼‰ ç›´æ¥å›è½¦ é€‰æ‹©GPT finish commit å¼€å§‹å®‰è£… å®‰è£…å¥½åä¼šæç¤ºè®¾å®šrootå¯†ç  ok è®¾ç½®ç½‘ç»œ é€‰no ,è‡ªè®¾ç½®ipåœ°å€ è®¾ç½®å®Œç‚¹ok ipv6ç›´æ¥yes è®¾ç½®dns æ ¹æ®è‡ªå·±çš„æ‰€åœ¨åœ°é€‰æ—¶åŒº åé¢æ˜¯è®¾ç½®æ—¶é—´ï¼Œä¸€è·¯å›è½¦ æ·»åŠ ä¸Šä¸¤ä¸ªè‡ªåŠ¨æ ¡å‡†ç½‘ç»œæ—¶é—´çš„ç»„ä»¶ntp ç¬¬ä¸€ä¸ªä¹Ÿå¯ä»¥åŠ ä¸Šunboundè¿™æ˜¯æœ¬åœ°dns (13.1ç³»ç»Ÿï¼‰ç³»ç»Ÿé‚®ä»¶ç”¨ä¸ä¸Šï¼Œå…³é—­sendmailï¼Œæ–°ç‰ˆæœ¬å·²ç»æ²¡æœ‰è¿™ä¸€ä¸ªé€‰é¡¹äº†ï¼Œï¼ˆ14.2ç³»ç»Ÿï¼‰éƒ½ä¸é€‰ï¼š æ·»åŠ æ–°ç”¨æˆ·ï¼š ç”¨æˆ·è®¾ç½®ç‰¹åˆ«æ³¨æ„ï¼Œç”¨æˆ·åå¯†ç è‡ªè¡Œè®¾ç½®ï¼Œç”¨æˆ·ç»„åŠ å…¥wheelå¤–ï¼ˆè¿™æ ·æ‰å¯ä»¥ç”¨sudoï¼‰ï¼Œå…¶å®ƒå…¨éƒ¨é»˜è®¤å›è½¦ è¾“å…¥å®Œå¯†ç åï¼Œåé¢çš„é€‰é¡¹é€‰no,ç›´æ¥å›è½¦å³å¯ æœ€åç¡®è®¤ï¼Œè¾“å…¥yes ","permalink":"https://hanigege.github.io/posts/freebsd/freebsd-install/","tags":null,"title":"å®‰è£…freebsd13.1æµç¨‹(14.2ç‰ˆæœ¬çš„ä¸€æ ·)"},{"categories":["linux"],"contents":"\nç°åœ¨æœ‰å¾ˆå¤šä¾¿å®œNATé¸¡å› ä¸ºé…ç½®è¾ƒä½ï¼Œæ‰€ä»¥åªé€‰ç”¨çš„æ˜¯Alpine Linux,æ‰€ä»¥æˆ‘å°±éšä¾¿å†™äº†ä¸ªæ•™ç¨‹æ–¹ä¾¿ä½¿ç”¨ã€‚ å®‰è£…ä¾èµ– é¦–å…ˆå…ˆå®‰è£…singbox,è¿˜æœ‰vimï¼ˆæ–¹ä¾¿ç¼–è¾‘ï¼‰\necho \u0026#34;@testing https://dl-cdn.alpinelinux.org/alpine/edge/testing\u0026#34; \u0026gt;\u0026gt; /etc/apk/repositories apk add sing-box@testing apk add vim rc-update add sing-box default è®¾ç½®è‡ªå¯. 1.è¿™é‡Œè¦è¯´æ˜ä¸€ä¸‹ï¼Œä¸Šé¢å®‰è£…å¥½åé»˜è®¤ä¼šè‡ªåŠ¨ç”Ÿæˆå¯åŠ¨æ–‡ä»¶/etc/init.d/sing-box , é…ç½®æ–‡ä»¶åœ¨ /etc/sing-box/config.json\n2.å¦‚æœç”¨ä¸‹é¢è‡ªå»ºçš„ï¼Œé»˜è®¤çš„å°±ä¸ç”¨å¯åŠ¨å°±è¡Œäº†ï¼Œæ›´ä¸è¦è®¾ç½®è‡ªå¯åŠ¨ï¼Œä»¥å…å†²çªã€‚ ç¼–è¾‘è¿™ä¸ªæ–‡ä»¶ï¼švim /etc/init.d/singbox\n#!/sbin/openrc-run command=\u0026#34;/usr/bin/sing-box\u0026#34; command_args=\u0026#34;run -c /root/config.json\u0026#34; #æ˜¯æ‚¨çš„é…ç½®æ–‡ä»¶ä½ç½® description=\u0026#34;singbox service\u0026#34; depend() { need net use logger } start() { ebegin \u0026#34;Starting singbox\u0026#34; start-stop-daemon --start --background --exec $command -- $command_args eend $? } stop() { ebegin \u0026#34;Stopping singbox\u0026#34; start-stop-daemon --stop --exec $command eend $? } ç„¶ååŠ å…¥OpenRCè‡ªå¯åŠ¨\nchmod +x /etc/init.d/singbox rc-update add singbox default service singbox start è‡ªç­¾è¯ä¹¦ï¼Œæ³¨æ„è·¯å¾„ï¼š\nmkdir -p /etc/hysteria \u0026amp;\u0026amp; openssl ecparam -genkey -name prime256v1 -out /etc/hysteria/private.key \u0026amp;\u0026amp; openssl req -new -x509 -days 3650 -key /etc/hysteria/private.key -out /etc/hysteria/cert.pem -subj \u0026#34;/CN=bing.com\u0026#34; é…ç½®hy2å…¥ç«™æœåŠ¡ç«¯ï¼š { \u0026#34;log\u0026#34;: { \u0026#34;level\u0026#34;: \u0026#34;info\u0026#34; }, \u0026#34;dns\u0026#34;: { \u0026#34;servers\u0026#34;: [ {\u0026#34;address\u0026#34;: \u0026#34;8.8.8.8\u0026#34;}, {\u0026#34;address\u0026#34;: \u0026#34;1.1.1.1\u0026#34;} ] }, \u0026#34;inbounds\u0026#34;: [ { \u0026#34;type\u0026#34;: \u0026#34;hysteria2\u0026#34;, \u0026#34;listen\u0026#34;: \u0026#34;::\u0026#34;, \u0026#34;listen_port\u0026#34;: 449, \u0026#34;users\u0026#34;: [ { \u0026#34;password\u0026#34;: \u0026#34;your-strong-random-password-123\u0026#34; } ], \u0026#34;tls\u0026#34;: { \u0026#34;enabled\u0026#34;: true, \u0026#34;alpn\u0026#34;: [\u0026#34;h3\u0026#34;], \u0026#34;certificate_path\u0026#34;: \u0026#34;/etc/hysteria/cert.pem\u0026#34;, \u0026#34;key_path\u0026#34;: \u0026#34;/etc/hysteria/private.key\u0026#34; } } ], \u0026#34;outbounds\u0026#34;: [ { \u0026#34;type\u0026#34;: \u0026#34;direct\u0026#34; } ], \u0026#34;route\u0026#34;: { \u0026#34;rules\u0026#34;: [ { \u0026#34;protocol\u0026#34;: \u0026#34;dns\u0026#34;, \u0026#34;action\u0026#34;: \u0026#34;direct\u0026#34; } ] } } é…ç½®hy2å‡ºç«™å®¢æˆ·ç«¯ï¼š { \u0026#34;tag\u0026#34;: \u0026#34;sg-hy2\u0026#34;, \u0026#34;server\u0026#34;: \u0026#34;IPåœ°å€æˆ–è€…åŸŸå\u0026#34;, \u0026#34;server_port\u0026#34;: 449, \u0026#34;up_mbps\u0026#34;: 50, \u0026#34;down_mbps\u0026#34;: 500, \u0026#34;type\u0026#34;: \u0026#34;hysteria2\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;å¯†ç \u0026#34;, \u0026#34;tls\u0026#34;: { \u0026#34;insecure\u0026#34;: true, \u0026#34;enabled\u0026#34;: true, \u0026#34;server_name\u0026#34;: \u0026#34;\u0026#34; }, \u0026#34;tcp_fast_open\u0026#34;: false }, ","permalink":"https://hanigege.github.io/posts/linux/alpine-linux-sing-box/","tags":null,"title":"Alpine Linuxæ­å»ºsing-boxæœåŠ¡ç«¯"},{"categories":["routers"],"contents":"æœåŠ¡ç«¯ï¼š { \u0026#34;type\u0026#34;: \u0026#34;shadowsocks\u0026#34;, \u0026#34;listen\u0026#34;: \u0026#34;::\u0026#34;, \u0026#34;listen_port\u0026#34;: 58442, \u0026#34;method\u0026#34;: \u0026#34;chacha20-ietf-poly1305\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;Um5zktQDo6GKqM1L/lLzwg==\u0026#34;, \u0026#34;multiplex\u0026#34;: { \u0026#34;enabled\u0026#34;: true } }, å®¢æˆ·ç«¯ï¼š { \u0026#34;type\u0026#34;: \u0026#34;shadowsocks\u0026#34;, \u0026#34;tag\u0026#34;: \u0026#34;ss-in-jygg-ros\u0026#34;, \u0026#34;server\u0026#34;: \u0026#34;ä½ çš„åŸŸå.xyz\u0026#34;, \u0026#34;server_port\u0026#34;: 58442, \u0026#34;network_strategy\u0026#34;: \u0026#34;hybrid\u0026#34;, \u0026#34;method\u0026#34;: \u0026#34;chacha20-ietf-poly1305\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;Um5zktQDo6GKqM1L/lLzwg==\u0026#34;, \u0026#34;udp_over_tcp\u0026#34;: false }, ","permalink":"https://hanigege.github.io/posts/routers/sing-box-ss-server/","tags":null,"title":"Sing-Boxä¸­çš„ssæœåŠ¡çš„å†™æ³•é…ç½®"},{"categories":null,"contents":"ä¸‰æ±‡SMG4004-4LCçš„å‡çº§æ–‡ä»¶ 1ã€å…ˆå‡çº§webå›ºä»¶åŒ… install4_2.2.8_2020092516.tar.gz\n2ã€å†å‡çº§åº•å±‚å›ºä»¶åŒ… install4_FPGA_1.11_2.11_3.032018122015.tar.gz\nè™šæ‹Ÿæœºæ‰¿æ¥ä¸‰æ±‡å’Œtelegramæ”¶å‘çŸ­ä¿¡çš„æœºå™¨äººå¯åŠ¨æ–‡ä»¶ è®°çš„ä¿®æ”¹å¯åŠ¨æ–‡ä»¶ä¸­çš„å‚æ•°ï¼Œé‡Œé¢æœ‰æ ‡æ³¨ã€‚sms.py\n","permalink":"https://hanigege.github.io/downloads/","tags":null,"title":"Downloads"},{"categories":["other"],"contents":"æˆ‘ä½¿ç”¨çš„æ˜¯ä¸‰æ±‡SMG4004-4LCï¼ˆç®—æ˜¯æ¡åƒåœ¾äº†ï¼Œè¿™æ˜¯ä»¥å‰çš„è€æ¬¾ï¼‰ï¼Œ4å£è¯­éŸ³ç½‘å…³ï¼Œç›®å‰è¿™æ¬¾åªèƒ½æ”¯æŒ2gç½‘ç»œå’ŒçŸ­ä¿¡ï¼Œæˆ‘æµ‹è¯•æˆ‘è¿™ä¸ªåœ°åŒºåªæ”¯æŒç§»åŠ¨å’Œè”é€šã€‚ä¸è¿‡ä¹Ÿå¤Ÿç”¨äº†ã€‚ ä½¿ç”¨å‰éœ€è¦å…ˆå‡èƒ½è¿™æ¬¾è®¾å¤‡çš„å›ºä»¶ï¼Œç›¸å…³å‡çº§æ–‡ä»¶ï¼Œæœ¬ç«™æœ‰æä¾›ä¸‹è½½ã€‚ ç…§ç€ä¸‹é¢è®¾ç½®ï¼Œå°±å¯ä»¥æµ‹è¯•ç”µè¯å‘¼å«äº†ï¼š ","permalink":"https://hanigege.github.io/posts/other/sanhui-smg4004-4lc-set/","tags":null,"title":"å‡ºå›½è‡ªå»ºvoip(äºŒ.2)ä¸‰æ±‡SMG4004-4LCçš„é…ç½®æ–¹æ³•æµ‹è¯•ç”µè¯å‘¼å«"},{"categories":["other"],"contents":"è¦é€šè¿‡ Telegram æœºå™¨äºº å¯¹æ¥ ä¸‰æ±‡è¯­éŸ³ç½‘å…³ï¼ˆSMG4000-C1LCï¼‰ çš„çŸ­ä¿¡åŠŸèƒ½ï¼Œæ‚¨éœ€è¦å®Œæˆä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š\næ­¥éª¤ 1ï¼š æ‰“å¼€ Telegramï¼Œæœç´¢å¹¶ä¸ BotFather èŠå¤©ã€‚\nå‘é€å‘½ä»¤ /newbot æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„æœºå™¨äººã€‚\nç»™æœºå™¨äººèµ·ä¸ªåå­—å¹¶è®¾ç½®ç”¨æˆ·åã€‚\nBotFather ä¼šç»™ä½ ä¸€ä¸ª API Tokenï¼Œç”¨æ¥ä¸ Telegram æœºå™¨äººè¿›è¡Œäº¤äº’ã€‚ä¿å­˜å¥½è¿™ä¸ª Tokenã€‚\næ­¥éª¤ 2ï¼šé…ç½®ä¸‰æ±‡ç½‘å…³å‘é€çŸ­ä¿¡ ä¸‰æ±‡è¯­éŸ³ç½‘å…³ä¸€èˆ¬æ”¯æŒé€šè¿‡ HTTP API æˆ– SMTP å‘é€çŸ­ä¿¡ã€‚é¦–å…ˆï¼Œç¡®ä¿ä¸‰æ±‡ç½‘å…³çš„çŸ­ä¿¡æœåŠ¡å·²ç»å¯ç”¨ï¼Œå¹¶ä¸”èƒ½å¤Ÿé€šè¿‡æ¥å£å‘é€çŸ­ä¿¡ã€‚\næ­¥éª¤ 3ï¼šç¼–å†™ Telegram æœºå™¨äººå’Œä¸‰æ±‡ç½‘å…³çš„å¯¹æ¥è„šæœ¬ ï¼ˆæœ¬ç«™æœ‰æä¾›ä¸‹è½½ï¼‰ ä½ éœ€è¦ç¼–å†™ä¸€ä¸ªè„šæœ¬ï¼Œä½¿ç”¨ Telegram æœºå™¨äººè·å–ä¿¡æ¯ï¼Œå¹¶é€šè¿‡ HTTP è¯·æ±‚å°†çŸ­ä¿¡å‘é€åˆ°ä¸‰æ±‡ç½‘å…³ã€‚\næ­¥éª¤ 3.1ï¼šå®‰è£… Telegram Bot åº“ï¼ˆä¾‹å¦‚ Python çš„ python-telegram-botï¼‰ï¼ˆè¯¦æƒ…ï¼Œè¯·çœ‹voipå‡ºå›½ç³»åˆ—ä¸‰ï¼‰\n","permalink":"https://hanigege.github.io/posts/other/sanhui-telegram-bot-4/","tags":null,"title":"å‡ºå›½è‡ªå»ºvoip(äºŒï¼‰åˆ›å»º Telegram æœºå™¨äºº"},{"categories":["freebsd"],"contents":"\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;ä¸ºä»€ä¹ˆè¦å»ºå›å®¶voipç³»ç»Ÿï¼Œå‡ºå›½åï¼Œç”µè¯å°±æ˜¯å›½é™…é•¿é€”ï¼Œæ‰“ç”µè¯æ”¶å‘çŸ­ä¿¡éƒ½ä¸æ–¹ä¾¿ï¼Œæœ‰æ²¡æœ‰åŠæ³•å¯ä»¥åšåˆ°é€šè¿‡ç½‘ç»œä¼ é€’è¯­éŸ³å’Œæ”¶å‘çŸ­ä¿¡ï¼ˆåˆ©ç”¨telegramæœºå™¨äººï¼‰ï¼Œå½“ç„¶å¯ä»¥ï¼Œæ‰‹æœºå¡å¯ä»¥æ”¾åœ¨å›½å†…çš„å°è®¾å¤‡ä¸Šï¼Œè‡ªå·±æ‰‹æœºä¸Šè£…ä¸€ä¸ªsipè½¯ç”µè¯å®¢æˆ·ç«¯ï¼Œå³å¯å®Œå…¨å®ç°ï¼Œæ¥å¬æ‹¨æ‰“ç”µè¯ï¼Œæ”¶å‘çŸ­ä¿¡ï¼Œå¹¶ä¸”ä¸ä¼šå†å—åœ°åŸŸé™åˆ¶ï¼Œä»…é™å­¦ä¹ äº¤æµï¼Œå‹æƒ…æé†’ï¼Œä¸è¦åšè¿åå½“åœ°æ³•å¾‹æ³•è§„çš„äº‹ã€‚ å¼€å§‹æ“ä½œ æ¶æ„ freepbx16é¦–å…ˆä¿®æ”¹ipä¸ºå›ºå®šip å®‰è£…å¥½åï¼Œç³»ç»Ÿå…¶å®æ˜¯dhcpåŠ¨æ€è·å¾—ipçš„ï¼Œè¿›å…¥çœ‹äº†çœ‹ï¼Œæ˜¯Centosï¼Œæˆ‘ä»¬ä¸éœ€è¦dhcpï¼ŒæŠŠIPç»™å›ºå®šæ­»\nvi /etc/sysconfig/network-scripts/ifcfg-eth0 ä¸‹é¢çš„å†…å®¹è·Ÿå®é™…é…ç½®æ–‡ä»¶é‡Œçš„å†…å®¹ç›¸å¯¹æ›¿æ¢ï¼Œä¸€ä¸€å¯¹åº”æ›¿æ¢ï¼ŒåŸæ–‡ä»¶é‡Œçš„å†…å®¹å¯èƒ½æ›´å¤šä¸€äº›ï¼Œåªä¿®æ”¹ä¸‹é¢æœ‰çš„ï¼Œæ²¡æ¶‰åŠçš„ä¿æŒåŸæ¥çš„ï¼Œdnsä¸å¯ä»¥ç”¨ç§‘å­¦çš„ï¼Œåªå…è®¸ç”¨æœ¬åœ°ï¼Œä¸ç„¶ä¼šå½±å“åé¢ç³»ç»Ÿé‡Œnat-ipè·å–çš„å‡†ç¡®æ€§\nTYPE=\u0026#34;Ethernet\u0026#34; BOOTPROTO=\u0026#34;static\u0026#34; IPADDR=10.8.2.60 NETMASK=255.255.255.0 GATEWAY=10.8.2.1 DNS1=114.114.114.114 DEFROUTE=\u0026#34;yes\u0026#34; NAME=\u0026#34;eth0\u0026#34; DEVICE=\u0026#34;eth0\u0026#34; ONBOOT=\u0026#34;yes\u0026#34; é‡å¯ï½\nfreepbx16é…ç½®å›¾ä¾‹ freepbx16é»˜è®¤å®‰è£…åœ¨pveç³»ç»Ÿä¸Šå°±å¥½ï¼Œç™»å½•ç³»ç»Ÿå ï¼š\nå…ˆè¿›è¡Œasterisk sip è®¾ç½® ç°åœ¨å¼€å§‹è®¾ç½®ç³»ç»Ÿä¸­æ–‡åœ°åŒºæ—¶é—´ é€‰æ‹©é«˜çº§è®¾ç½®ï¼š\né«˜çº§è®¾ç½®é‡Œä¸€å¼€å§‹è¿˜æœ‰ä¸€ä¸ªé€‰é¡¹æ˜¯å¯`chan_sip`,è¿™ä¸ªè®°çš„è¦æ‰“å¼€ï¼Œä¸ç„¶åé¢è®¾ç½®ä¸­ç»§æˆ–è€…æ˜¯sipæœ‰äº›é€‰é¡¹ä¸æ˜¾ç¤º å¼€å¯ä¸­ç»§é…ç½® ï¼ˆè¿™å—è®¾ç½®æ˜¯è¿æ¥ä¸‰æ±‡è¯­éŸ³ç½‘å…³çš„ï¼‰ host=dynamic port=5160 type=peer secret=666 context=from-pstn dtmfmode=rfc2833 insecure=no qualify=3000 ç…§å›¾å¡«å†™å°±å¥½ï¼Œè¿™é‡Œæ˜¯å†…ç½‘ä¼ è¾“ä½¿ç”¨çš„ï¼Œç«¯å£ä¸å½±å“å•¥\nå…¥å±€çº¿è·¯ï¼ˆä¸éœ€è¦ï¼‰ è®¾ç½®å‡ºå±€çº¿è·¯ ä¸Šå›¾X.çš„æ„æ€æ˜¯ï¼Œæ‹¨æ‰“ç”µè¯æ—¶å¯ä»¥ç›´æ¥è¾“å…¥å¯¹æ–¹æ‰‹æœºå·ç ï¼Œä¸éœ€è¦åŠ 9å†æ‹¨å•¥çš„ï¼Œæ²¡å¿…è¦ã€‚ å…¶å®ƒä¸åŠ¨é»˜è®¤å°±å¥½ã€‚\næ·»åŠ ä¸­æ–‡è¯­éŸ³æé†’ ![CleanShot 2025-05-11 at 10.53.55@2x](assets/CleanShot%202025-05-11%20at%2010.53.55@2 x.png) åœ¨ä¸Šå›¾æ·»åŠ ä¸Šä¼ è¯­éŸ³æ–‡ä»¶ï¼Œå…·ä½“è¯­éŸ³æ–‡ä»¶è‡ªå·±å¯ä»¥googleæœç´¢freepbxä¸“ç”¨çš„ä¸­æ–‡è¯­éŸ³ éƒ½ä¸Šä¼ å®Œï¼Œåœ¨è®¾ç½®é‡Œé€‰æ‹©china å¼€å§‹é…ç½®åˆ†æœº å¯†ç æ¨èç”¨linuxç”Ÿæˆ32ä½çš„å¯†ç  âœ… 1. opensslï¼ˆæ¨èï¼Œå¸¸è§ç³»ç»Ÿé»˜è®¤æœ‰ï¼‰\nopenssl rand -base64 24 | cut -c1-32 â€¢ 24 å­—èŠ‚çš„ base64 ç¼–ç å¤§æ¦‚ç­‰äº 32 ä¸ªå­—ç¬¦ï¼› â€¢ cut -c1-32 ä¿è¯é•¿åº¦æ­£å¥½æ˜¯ 32ã€‚\nâœ… 2. pwgenï¼ˆä¸“é—¨ç”¨äºç”Ÿæˆå¯†ç ï¼‰\npwgen -s 32 1 -s è¡¨ç¤º secureï¼ˆæ›´éšæœºï¼‰ï¼Œ32 æ˜¯é•¿åº¦ï¼Œ1 è¡¨ç¤ºç”Ÿæˆä¸€ä¸ªã€‚\nå¦‚æœæ²¡æœ‰ pwgenï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å®‰è£…ï¼š\n# Debian / Ubuntu sudo apt install pwgen # RHEL / CentOS / Rocky sudo dnf install pwgen è¯­éŸ³é‚®ä»¶æ‰“å¼€ï¼Œä¹Ÿå°±æ˜¯è¯­è¨€ç•™è¨€åŠŸèƒ½ï¼Œè‡ªå·±è®¾ç½®ä¸€ä¸ªç®€å•å¯†ç å³å¯\næŸ¥çœ‹åŠŸèƒ½ä»£ç äº†è§£è‡ªå·±è¿˜èƒ½ä½¿ç”¨ä»€ä¹ˆåŠŸèƒ½ï¼Œå¦‚ç”µè¯ä¼šè®®ï¼Œé—¹é“ƒå›æ‹¨æé†’ï¼Œå°±è·Ÿé…’åº—ä¸€æ ·ã€‚ ","permalink":"https://hanigege.github.io/posts/freebsd/freepbx16-set-all-1/","tags":null,"title":"å‡ºå›½è‡ªå»ºvoip(ä¸€)Freepbx16é…ç½®"},{"categories":["other"],"contents":"root@sms:~# source myenv/bin/activate æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ source myenv/bin/activate (myenv) root@sms:~# nohup python sms.py \u0026gt; sms.log 2\u0026gt;\u0026amp;1 \u0026amp; åå°å¯åŠ¨sms.py\nnohup python sms.py \u0026gt; sms.log 2\u0026gt;\u0026amp;1 \u0026amp; or nohup python sms.py \u0026gt; sms.log 2\u0026gt;\u0026amp;1 \u0026amp; (myenv) root@sms:~# ä¸Šé¢çš„ä¸¤æ¡å‘½ä»¤èƒ½ä¸èƒ½åšæˆè„šæœ¬ï¼Œè®¾ç½®ä¸ºå¼€æœºè‡ªå¯åŠ¨\nå¯ä»¥çš„ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª systemd æœåŠ¡ æˆ–è€… ç¼–å†™ä¸€ä¸ª shell è„šæœ¬ æ¥å®ç° Python è™šæ‹Ÿç¯å¢ƒçš„æ¿€æ´» å¹¶ è¿è¡Œ sms.py è„šæœ¬ï¼ŒåŒæ—¶è®¾ç½®ä¸º å¼€æœºè‡ªå¯åŠ¨ã€‚\næ–¹æ³• 1ï¼šä½¿ç”¨ systemd (æ¨è) é€‚ç”¨äº Debian/Ubuntu åŠå¤§å¤šæ•° Linux å‘è¡Œç‰ˆã€‚\næ­¥éª¤ 1ï¼šåˆ›å»º systemd æœåŠ¡æ–‡ä»¶ è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œåˆ›å»º sms.serviceï¼š\nnano /etc/systemd/system/sms.service å¡«å…¥ä»¥ä¸‹å†…å®¹ï¼š\n[Unit] Description=SMS Python Service After=network.target [Service] User=root WorkingDirectory=/root ExecStart=/root/myenv/bin/python /root/sms.py Restart=always StandardOutput=append:/root/sms.log StandardError=append:/root/sms.log [Install] WantedBy=multi-user.target âš  æ³¨æ„ï¼š\nWorkingDirectory=/root éœ€è¦ä¿®æ”¹æˆä½ çš„ Python è™šæ‹Ÿç¯å¢ƒå’Œ sms.py æ‰€åœ¨ç›®å½•ã€‚\nExecStart=/root/myenv/bin/python /root/sms.py ç¡®ä¿è·¯å¾„æ­£ç¡®ã€‚\nRestart=always è®©è¿›ç¨‹å´©æºƒåè‡ªåŠ¨é‡å¯ã€‚\næ­¥éª¤ 2ï¼šå¯ç”¨å¹¶å¯åŠ¨æœåŠ¡\nsystemctl daemon-reload systemctl enable sms systemctl start sms æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ï¼š systemctl status sms å¦‚æœ æ˜¾ç¤º active (running) è¯´æ˜æˆåŠŸã€‚ ","permalink":"https://hanigege.github.io/posts/other/telegram-sms-bot2/","tags":null,"title":"å‡ºå›½è‡ªå»ºvoip(ä¸‰.2ï¼‰Telegramæœºå™¨äººè¿æ¥ç¨‹åºè‡ªå¯åŠ¨(è¡¥å……ç¯‡)"},{"categories":["other"],"contents":"å‰ææ˜¯telegramè‡ªå·±çš„æœºå™¨äººæå‰ç”Ÿæˆå¥½ï¼Œå¹¶è·å–ç›¸åº”çš„å¯†é’¥ æ‰“å¼€ä¸€å°è™šæ‹Ÿæœºï¼ˆå»ºè®®debian12) æ–¹æ³• 1ï¼šä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ åˆ›å»ºä¸€ä¸ª Python è™šæ‹Ÿç¯å¢ƒï¼Œå¹¶åœ¨å…¶ä¸­å®‰è£…æ‰€éœ€çš„åº“ã€‚è¿™æ ·å¯ä»¥é¿å…ç³»ç»Ÿçº§ Python ç¯å¢ƒçš„å†²çªã€‚\nå®‰è£… python3-venvï¼ˆå¦‚æœæœªå®‰è£…ï¼‰\napt update apt install python3-venv åˆ›å»ºä¸€ä¸ªæ–°çš„è™šæ‹Ÿç¯å¢ƒ\npython3 -m venv myenv æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ\nsource myenv/bin/activate åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£… python-telegram-bot\npip install python-telegram-bot smpplib è¿è¡Œè„šæœ¬ï¼šä½ å¯ä»¥åœ¨è™šæ‹Ÿç¯å¢ƒä¸­è¿è¡Œä½ çš„ Telegram æœºå™¨äººè„šæœ¬,è„šæœ¬sms.pyä¸‹è½½ å‘½ä»¤ï¼š\npython sms.py é€€å‡ºè™šæ‹Ÿç¯å¢ƒï¼š\ndeactivate è¿è¡Œè„šæœ¬æœ‰ä¸‰ç§æ–¹æ¡ˆï¼Œä¸€ç§æ˜¯è¿è¡Œåœ¨tmuxè™šæ‹Ÿçª—å£ä¸‹ï¼ŒäºŒç§æ˜¯ç›´æ¥æœ¬åœ°åå°è¿è¡Œï¼Œä¸‰ç§systemdè¿›è¡Œç®¡ç† ï¼ˆå»ºè®®ç¬¬ä¸‰ç§ï¼‰ ä»¥ä¸Šè¦è¿è¡Œåœ¨è™šæ‹Ÿçª—å£ä¸‹ï¼Œå»ºè®®ä½¿ç”¨tmux\n1.ä½¿ç”¨ tmux å®‰è£…ï¼ˆå¦‚æœæœªå®‰è£…ï¼‰ï¼š\napt-get install tmux # Debian/Ubuntu yum install tmux # CentOS/RHEL å¯åŠ¨ Tmux ä¼šè¯ï¼š tmux æŒ‰ Ctrl+Bï¼Œç„¶åæŒ‰ Dï¼Œä¼šè¿”å›ç»ˆç«¯ã€‚\nå…³é—­ SSHï¼Œç¨‹åºç»§ç»­è¿è¡Œã€‚\né‡æ–°è¿æ¥ï¼š\nåˆ—å‡ºä¼šè¯ï¼š\ntmux ls è¾“å‡ºç¤ºä¾‹ï¼š\n0: 1 windows (created ...) æ¢å¤ä¼šè¯ï¼š\ntmux attach -t 0 åœæ­¢ç¨‹åºï¼š\nè¿›å…¥ä¼šè¯åï¼ŒæŒ‰ Ctrl+Cï¼Œç„¶åï¼š\nexit 2.ä½¿ç”¨ nohup nohup python sms.py \u0026gt; sms.log 2\u0026gt;\u0026amp;1 \u0026amp; nohupï¼šè®©è¿›ç¨‹ä¸å—ç»ˆç«¯é€€å‡ºå½±å“\nsms.log 2\u0026gt;\u0026amp;1ï¼šå°†æ—¥å¿—è¾“å‡ºåˆ° sms.log\n\u0026amp;ï¼šè®©è¿›ç¨‹åœ¨åå°è¿è¡Œ\næŸ¥çœ‹æ—¥å¿—ï¼š\ntail -f sms.log å¦‚æœéœ€è¦åœæ­¢è¿›ç¨‹ï¼š\npkill -f \u0026#34;python sms.py\u0026#34; 3.ä½¿ç”¨ systemdï¼ˆæ¨èé•¿æœŸè¿è¡Œï¼‰ åˆ›å»º systemd æœåŠ¡ï¼Œè®© sms.py éšç³»ç»Ÿå¯åŠ¨ï¼š\nnano /etc/systemd/system/sms.service æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n[Unit] Description=SMS Bot Service After=network.target [Service] ExecStart=/usr/bin/python3 /root/sms.py WorkingDirectory=/root Restart=always User=root [Install] WantedBy=multi-user.target ç„¶åæ‰§è¡Œï¼š\nsystemctl daemon-reload systemctl enable sms systemctl start sms systemctl status sms æŸ¥çœ‹æ—¥å¿—ï¼š\njournalctl -u sms -f é‡å¯æœåŠ¡ï¼š\nsystemctl restart sms åœæ­¢æœåŠ¡ï¼š\nsystemctl stop sms ","permalink":"https://hanigege.github.io/posts/other/telegram-sms-bot/","tags":null,"title":"å‡ºå›½è‡ªå»ºvoip(ä¸‰ï¼‰è¿æ¥Telegramæœºå™¨äººæœ¬åœ°å®‰è£…"},{"categories":["routers"],"contents":"ä½ å¯ä»¥ä½¿ç”¨ delete å’Œ set å‘½ä»¤æ¥ä¿®æ”¹ network-group çš„å­ç½‘ã€‚ ä¿®æ”¹ LAN-v4 çš„ç½‘ç»œ\nåˆ é™¤åŸæ¥çš„ 192.168.10.0/24 delete firewall group network-group LAN-v4 network 192.168.10.0/24 æ·»åŠ æ–°çš„ 192.168.100.0/24 set firewall group network-group LAN-v4 network 192.168.100.0/24 æäº¤å¹¶ä¿å­˜ commit save éªŒè¯ä¿®æ”¹æ˜¯å¦ç”Ÿæ•ˆ\næ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\nshow firewall group network-group LAN-v4 å¦‚æœè¾“å‡ºå¦‚ä¸‹ï¼Œå°±è¯´æ˜ä¿®æ”¹æˆåŠŸï¼š\nnetwork-group LAN-v4 { network 192.168.100.0/24 } åœ¨ VyOS ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ æ‰€æœ‰é…ç½®ï¼š æ˜¾ç¤ºå®Œæ•´çš„å±‚çº§é…ç½®ï¼ˆæ¨èï¼‰\nshow configuration è¿™ä¸ªå‘½ä»¤ä¼šä»¥ å±‚çº§ç»“æ„ æ˜¾ç¤ºæ•´ä¸ªé…ç½®ï¼Œç±»ä¼¼äº show running-configã€‚\næ˜¾ç¤ºæ‰€æœ‰é…ç½®å‘½ä»¤ï¼ˆé€‚åˆå¤åˆ¶ï¼‰($ æ¨¡å¼ä¸‹ï¼‰\nshow configuration commands è¿™ä¸ªå‘½ä»¤ä¼šä»¥ show å‘½ä»¤çš„æ ¼å¼ å±•ç¤ºæ‰€æœ‰é…ç½®ï¼Œé€‚ç”¨äºå¤‡ä»½æˆ–å¤åˆ¶é…ç½®ï¼š\næŒ‰å±‚çº§å±•å¼€æŸ¥çœ‹ï¼ˆäº¤äº’å¼ï¼‰\nshow configuration level 2 level 2 ä»£è¡¨å±•å¼€åˆ°ç¬¬ 2 å±‚ï¼Œä½ å¯ä»¥è°ƒæ•´ level æ•°å€¼æ¥æ§åˆ¶æ˜¾ç¤ºçš„è¯¦ç»†ç¨‹åº¦ã€‚\nè¿‡æ»¤ç‰¹å®šé…ç½®ï¼ˆåŒ¹é…å…³é”®å­—ï¼‰ å¦‚æœä½ åªæƒ³æŸ¥çœ‹é˜²ç«å¢™ç›¸å…³çš„é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨ï¼š\nshow configuration | match firewall æˆ–è€…ï¼š\nshow configuration commands | grep firewall è¿™å¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿæ‰¾åˆ°ç‰¹å®šçš„é…ç½®ã€‚\nå¯¼å‡ºé…ç½®åˆ°æ–‡ä»¶ å¦‚æœä½ æƒ³æŠŠé…ç½®ä¿å­˜åˆ°æ–‡ä»¶ï¼š\nshow configuration commands \u0026gt; /config/my-backup.conf ç„¶åå¯ä»¥ç”¨ cat æŸ¥çœ‹ï¼š\ncat /config/my-backup.conf æ€»ç»“\n| å‘½ä»¤ | ä½œç”¨ |\nshow configuration ä»¥å±‚çº§ç»“æ„æ˜¾ç¤ºæ‰€æœ‰é…ç½®\nshow configuration commands ä»¥ set å‘½ä»¤æ ¼å¼æ˜¾ç¤ºæ‰€æœ‰é…ç½®ï¼ˆé€‚åˆå¤åˆ¶ï¼‰\nshow configuration level N å±•å¼€åˆ°æŒ‡å®šå±‚çº§ï¼ˆN æ§åˆ¶è¯¦ç»†ç¨‹åº¦ï¼‰\nshow configuration match å…³é”®å­—`\nshow configuration commands \u0026gt; /config/backup.conf å¤‡ä»½é…ç½®åˆ°æ–‡ä»¶\nä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³• åˆ é™¤ VyOS ä¸­æ‰€æœ‰é˜²ç«å¢™è§„åˆ™ï¼š æ–¹æ³• 1ï¼šé€ä¸ªåˆ é™¤ å¦‚æœä½ çŸ¥é“é˜²ç«å¢™è§„åˆ™çš„åå­—ï¼ˆä¾‹å¦‚ WAN_INã€LAN_OUTï¼‰ï¼Œå¯ä»¥è¿è¡Œï¼š\ndelete firewall name WAN_IN delete firewall name LAN_OUT delete firewall name \u0026lt;å…¶ä»–è§„åˆ™å\u0026gt; commit save ç„¶åè¿è¡Œï¼š show firewall ç¡®è®¤è§„åˆ™å·²åˆ é™¤ã€‚ æ–¹æ³• 2ï¼šåˆ é™¤æ•´ä¸ª firewall é…ç½® å¦‚æœä½ æƒ³ å½»åº•åˆ é™¤é˜²ç«å¢™çš„æ‰€æœ‰è§„åˆ™ï¼Œå¯ä»¥ç›´æ¥åˆ é™¤ firewall {}ï¼š\ndelete firewall commit save ç„¶åè¿è¡Œï¼š show firewall å¦‚æœ firewall {} ä¸å†æ˜¾ç¤ºï¼Œå°±è¯´æ˜æ‰€æœ‰é˜²ç«å¢™è§„åˆ™å·²åˆ é™¤ã€‚ æ–¹æ³• 3ï¼šé‡ç½® VyOS é…ç½®ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ å¦‚æœä½ å¸Œæœ›æ¢å¤åˆ°æœ€åˆçš„é»˜è®¤é…ç½®ï¼ˆä¼šå½±å“æ‰€æœ‰è®¾ç½®ï¼Œä¸ä»…ä»…æ˜¯é˜²ç«å¢™ï¼‰ï¼Œå¯ä»¥è¿è¡Œï¼š\nload factory-default commit save ç„¶åé‡æ–°é…ç½®ä½ çš„ç³»ç»Ÿã€‚\nå¦‚æœåªæ˜¯æƒ³ æ¸…ç†é˜²ç«å¢™è§„åˆ™ï¼Œæ¨è æ–¹æ³• 2ï¼Œä½†å¦‚æœä½ æƒ³é‡ç½®æ•´ä¸ªç³»ç»Ÿé…ç½®ï¼Œå†è€ƒè™‘ æ–¹æ³• 3ã€‚ä½ æƒ³è¦å®Œå…¨é‡ç½®è¿˜æ˜¯åªæ˜¯æ¸…ç©ºé˜²ç«å¢™è§„åˆ™ï¼Ÿ\n","permalink":"https://hanigege.github.io/posts/routers/vyos-jiqiao-3/","tags":null,"title":"Vyosä¸Šç½‘ç³»ç»Ÿä¹‹-vyoså‘½ä»¤æŠ€å·§é›†(3)"},{"categories":["routers"],"contents":"å¯¹äºç»ˆç«¯ç½‘å…³æ˜¯vyosçš„ï¼Œé€šè¿‡mosdnsæ¥åˆ†æµrealipå’Œfakeipçš„æµé‡, å¯è¿™æ ·é…ç½®: (vyosçš„groupåˆ†ä¸ºaddress-group,network-groupç­‰)\nå®šä¹‰ç»„ IPä¾‹: set firewall group address-group Telegram-v4 address \u0026#39;157.148.47.204\u0026#39; set firewall group address-group Telegram-v4 address \u0026#39;182.43.124.6\u0026#39; ... å®šä¹‰ç»„ç½‘æ®µV4ä¾‹ï¼š set firewall group network-group Telegram-v4 network \u0026#39;91.108.56.0/22\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;91.108.4.0/22\u0026#39; ... å®šä¹‰ç»„telegram V4:\nset firewall group network-group Telegram-v4 network \u0026#39;91.108.56.0/22\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;91.108.4.0/22\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;91.108.8.0/22\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;91.108.16.0/22\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;91.108.12.0/22\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;149.154.160.0/20\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;91.105.192.0/23\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;91.108.20.0/22\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;185.76.151.0/24\u0026#39; å®šä¹‰ç»„ip-V6ä¾‹ï¼š set firewall group ipv6-address-group Telegram-v6 address \u0026#39;2a00:1098:80:2::1004\u0026#39; set firewall group ipv6-address-group Telegram-v6 address \u0026#39;2a00:1098:80:2::1001\u0026#39; ... å®šä¹‰ç»„ç½‘æ®µV6ä¾‹ï¼š\nset firewall group ipv6-network-group Telegram-v6 network \u0026#39;2001:b28:f23d::/48\u0026#39; set firewall group ipv6-network-group Telegram-v6 network \u0026#39;2001:b28:f23f::/48\u0026#39; ... å®šä¹‰ç»„V6 Telegram-V6\nset firewall group ipv6-network-group Telegram-v6 network \u0026#39;2001:b28:f23d::/48\u0026#39; set firewall group ipv6-network-group Telegram-v6 network \u0026#39;2001:b28:f23f::/48\u0026#39; set firewall group ipv6-network-group Telegram-v6 network \u0026#39;2001:67c:4e8::/48\u0026#39; set firewall group ipv6-network-group Telegram-v6 network \u0026#39;2001:b28:f23c::/48\u0026#39; set firewall group ipv6-network-group Telegram-v6 network \u0026#39;2a0a:f280::/32\u0026#39; å®šä¹‰ç»„fakeip:\nset firewall group network-group FAKEIP-v4 network \u0026#39;198.18.0.0/15\u0026#39; # fakeip set firewall group ipv6-network-group FAKEIP-v6 network \u0026#39;f2b0::/18\u0026#39; # fakeip6 é…ç½®ç­–ç•¥è·¯ç”±:(ç±»ä¼¼rosä¸­mangleéƒ¨åˆ†) IPV4\nset policy route Route-to-SB interface \u0026#39;eth0\u0026#39; # eth0æ˜¯lanå£ set policy route Route-to-SB rule 10 set table \u0026#39;100\u0026#39; # table 100æ˜¯to-sbçš„è¡¨ set policy route Route-to-SB rule 10 destination group network-group \u0026#39;Telegram-v4\u0026#39; set policy route Route-to-SB rule 20 set table \u0026#39;100\u0026#39; # table 100æ˜¯to-sbçš„è¡¨ set policy route Route-to-SB rule 20 destination group network-group \u0026#39;FAKEIP-v4\u0026#39; IPV6\nset policy route6 FAKE6-to-SB interface \u0026#39;eth0\u0026#39; set policy route6 FAKE6-to-SB rule 10 set table \u0026#39;106\u0026#39; # table 106æ˜¯to-sbçš„è¡¨ (v6) set policy route6 FAKE6-to-SB rule 10 destination group network-group \u0026#39;FAKEIP-v6\u0026#39; set policy route6 FAKE6-to-SB rule 20 set table \u0026#39;106\u0026#39; # table 106æ˜¯to-sbçš„è¡¨ (v6) set policy route6 FAKE6-to-SB rule 20 destination group network-group \u0026#39;Telegram-v6\u0026#39; é…ç½®è·¯ç”±è¡¨\nset protocols static table 100 route 0.0.0.0/0 next-hop 192.168.100.9 # sbçš„å†…ç½‘ip set protocols static table 106 route6 ::/0 next-hop fd88::9999 # sbçš„ula voysè‡ªå·±å¦‚è¦ç§‘å­¦ä¸Šç½‘, ä¸€èˆ¬æ˜¯åœ¨pullå®¹å™¨é•œåƒ, ä¸‹è½½æ›´æ–°çš„iosç­‰æƒ…å½¢ä¸‹, å¯ä»¥è¿™æ ·é…ç½®,\nset system name-server \u0026#39;192.168.10.90\u0026#39; # 192.168.10.90æ˜¯sbçš„ip, æˆ–mosdnsçš„ip, based on your topology. æ³¨æ„è¿™é‡Œçš„name-server, åªéœ€è¦ä¸€ä¸ª, å°±æ˜¯èƒ½åŒºåˆ†fakeipçš„.\nset policy local-route rule 10 destination address \u0026#39;198.18.0.0/15\u0026#39; set policy local-route rule 10 set table \u0026#39;100\u0026#39; å¯ä»¥äº†ç§‘å­¦äº†ï¼Œä¸‹é¢æµ‹è¯•\ncurl www.google.com ä¹±ç ï¼Œæå®š pingæ˜¯pingä¸é€šå¤–ç½‘çš„ã€‚ç”¨ä¸Šé¢çš„curlçœ‹\né…ä¸é…ipv6çš„local-route, å–å†³äºä½ çš„éœ€è¦, ä¸é…ç½®ä¹Ÿè¡Œ, å› ä¸ºvyosè‡ªå·±çš„éœ€è¦, è¾ƒä¸ºç®€å•\ndone!\ntips:\nåœ¨\u0026rsquo;#\u0026lsquo;çŠ¶æ€ä¸‹ å¯ç”¨run show config, æ¥è¿è¡Œ\u0026rsquo;$\u0026lsquo;çŠ¶æ€ä¸‹çš„å‘½ä»¤ æˆ‘å¸¸ç”¨çš„å‘½ä»¤ è¿˜æœ‰ \u0026lsquo;monitor\u0026rsquo; (\u0026rsquo;$\u0026lsquo;ä¸‹), ç›‘è§†åŠ¨æ€å˜åŒ– \u0026lsquo;compare\u0026rsquo; (\u0026rsquo;#\u0026lsquo;ä¸‹), æœªcommitå‰æ¯”è¾ƒeditçš„å˜åŒ– ","permalink":"https://hanigege.github.io/posts/routers/vyos-fakeip-2/","tags":null,"title":"Vyosä¸Šç½‘ç³»åˆ—ä¹‹-Fakeipé…ç½®(2)"},{"categories":["routers"],"contents":"vyosçš„å‘½ä»¤è¡Œç•Œé¢æ˜¯åŸºäºshellçš„ï¼Œæ²¡æœ‰å›¾å½¢ç•Œé¢, ä½†æ˜¯å¯ä»¥ç”¨tabè‡ªåŠ¨è¡¥å…¨. æœ¬æ–‡çš„vyoså‘½ä»¤æ˜¯åŸºäºvyosçš„vyos-rolling-nightly-buildsçš„1.5.xç‰ˆæœ¬.\n**ç‰¹åˆ«æ„Ÿè°¢å¤§å«ä½¬ç»™äºˆçš„æŒ‡å¯¼ä¸å¸®åŠ©**\npveå®‰è£…vyos: ä¸‹è½½nightly-build: https://github.com/vyos/vyos-nightly-build/releases pveçš„è™šæ‹Ÿæœºè®¾ç½®å’Œå®‰è£…(ç•¥), å»ºè®®å†…å­˜2G, ç£ç›˜10Gæˆ–æ›´å¤§, å› ä¸ºvyoså¯ä»¥è¿è¡Œå®¹å™¨, vyosç”¨podmanç®¡ç†å®¹å™¨.\nvmè¿è¡Œå, ç”¨vyos:vyosç™»å½•. ç”¨å‘½ä»¤\ninstall image å®‰è£…vyos.\nè¿›å…¥é…ç½®æ¨¡å¼ï¼š\nconfigure ç”Ÿæ•ˆï¼š\ncommit ä¿å­˜é…ç½®ï¼š\nsave å–æ¶ˆç”Ÿæ•ˆçš„,æœªä¿å­˜çš„é…ç½®ï¼š\ndiscard ä¸‹é¢å¼€å§‹é…ç½®ï¼Œéšæ—¶éƒ½å¯ä»¥è¾“å…¥ç”Ÿæ•ˆå‘½ä»¤ï¼Œå¦‚æœä¸ä¿å­˜ï¼Œé‡å¯åé…ç½®ä¼šå¤±æ•ˆ è®¾ç½®sshç™»å½•:\nset service ssh port \u0026#39;22\u0026#39; åˆ›å»ºç”¨æˆ·gary:\nset system login user gary full-name gary set system login user gary authentication plaintext-password \u0026#39;å¯†ç \u0026#39; å»ºè®®sshå¯†é’¥ç™»å½•:\nset system login user gary authentication public-keys gary@laptop key \u0026#39;your-public-key\u0026#39; set system login user gary authentication public-keys gary@laptop type \u0026#39;ssh-rsa\u0026#39; ç¦ç”¨é»˜è®¤çš„vyosç”¨æˆ·:\nset system login user vyos disable è®¾ç½®ç³»ç»Ÿçš„hostname:\nset system host-name \u0026#39;vyos\u0026#39; æŸ¥çœ‹ç³»ç»Ÿçš„hostname\nshow system host-name è®¾ç½®æ—¶åŒº:\nset system time-zone \u0026#39;Asia/Shanghai\u0026#39; è®¾ç½®ntp:\nset service ntp server 129.250.35.251 set service ntp server 203.107.6.88 (æ³¨: å¯ä»¥è®¾ç½®å¤šä¸ªntpæœåŠ¡å™¨, å»ºè®®ç”¨è¿è¥å•†çš„ntpæœåŠ¡å™¨, æœ€å¥½æ˜¯çº¯ip, å¯åˆ é™¤é»˜è®¤çš„ntpæœåŠ¡å™¨)\nè®¾ç½®æ¥å£ç»„(å¯é€‰ä½†å»ºè®®):\nset firewall group interface-group LAN interface \u0026#39;eth0\u0026#39; set firewall group interface-group WAN interface \u0026#39;eth1\u0026#39; è®¾ç½®ç½‘ç»œç»„(å¯é€‰):\nset firewall group network-group LAN-v4 network \u0026#39;192.168.100.0/24\u0026#39; è®¾ç½®ip:\nset interfaces ethernet eth0 address 192.168.100.1/24 é…ç½®dhcp server:\nset service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 subnet-id 1 set service dhcp-server hostfile-update set service dhcp-server shared-network-name VYOS authoritative #å¼€å¯ç‰¹å®šå…±äº«ç½‘ç»œçš„æˆæƒï¼Œé˜²æ­¢å‡ºç°å†²çªå’Œæ··ä¹±(ç¬¬ä¸‰æ–¹åŠ çš„ï¼‰ set service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 lease \u0026#39;86400\u0026#39; set service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 option default-router \u0026#39;192.168.100.1\u0026#39; #dhcp option é»˜è®¤ç½‘å…³ set service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 option name-server \u0026#39;192.168.100.1\u0026#39; #dhcp option dns set service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 option ntp-server \u0026#39;192.168.100.1\u0026#39; #dhcp option ntp set service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 range 0 start \u0026#39;192.168.100.101\u0026#39; set service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 range 0 stop \u0026#39;192.168.100.200\u0026#39; è¡¥å……ï¼ˆå¯é€‰ï¼‰ï¼š æ·»åŠ ä¸€ä¸ªdhcpä¸‹çš„dns\nset service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 option name-server \u0026#39;192.168.100.2\u0026#39; åˆ é™¤ä¸€ä¸ªdpcpä¸‹çš„dns delete service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 option name-server \u0026#39;192.168.100.1\u0026#39; æ›´æ”¹dhcpä¸‹çš„ç½‘å…³åœ°å€ set service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 option default-router \u0026#39;192.168.100.2\u0026#39; è®¾ç½®å¤–ç½‘ç½‘å£ä¸ºdhcpå®¢æˆ·ç«¯ï¼Œä»ä¸Šçº§è·¯ç”±è·å– ï¼ˆå¯é€‰ï¼‰ï¼š\nset interfaces ethernet eth1 address dhcp è®¾ç½®pppoe1å‚è€ƒé…ç½®ï¼ˆä¸€ï¼‰ å½“eth1æ˜¯pppoeæ—¶ï¼Œé…ç½® PPPoE æ‹¨å·:\nset interfaces pppoe pppoe0 source-interface \u0026#39;eth1\u0026#39; set interfaces pppoe pppoe0 authentication username \u0026#39;054546å¸å·6266\u0026#39; set interfaces pppoe pppoe0 authentication password \u0026#39;24å¯†ç 502\u0026#39; set interfaces pppoe pppoe0 mtu \u0026#39;1492\u0026#39; set interfaces pppoe pppoe0 ip adjust-mss \u0026#39;clamp-mss-to-pmtu\u0026#39; set interfaces pppoe pppoe1 no-default-route (æ³¨: å½“è®¾ç½®no-default-routeæ—¶, éœ€è¦åœ¨åé¢æŒ‡å®šé™æ€è·¯ç”±, æˆ–è€…ä¹Ÿå¯ä¸è®¾ç½®no-default-routeè¿™æ¡, vyosä¼šè‡ªåŠ¨æ·»åŠ é»˜è®¤è·¯ç”±) å°æŠ€å·§ï¼šåœ¨ VyOS ä¸­ï¼Œè¦åˆ é™¤ä¸€æ¡å·²æœ‰çš„é…ç½®ï¼Œéœ€è¦ä½¿ç”¨ delete å‘½ä»¤ã€‚ å¯¹äº set interfaces pppoe pppoe0 source-interface 'eth1'ï¼Œå¯ä»¥è¿™æ ·åˆ é™¤ï¼š\nconfigure delete interfaces pppoe pppoe1 source-interface commit save exit è®¾ç½®å‡ºWanå£çš„é»˜è®¤é™æ€è·¯ç”±:\nset protocols static route 0.0.0.0/0 interface pppoe0 set protocols static route6 ::/0 interface pppoe0 (æ³¨: å‰é¢è®¾ç½®äº†no-default-route, æ‰€ä»¥è¿™é‡Œéœ€è¦è®¾ç½®é»˜è®¤è·¯ç”±) è®¾ç½®dns: set system name-server \u0026#39;223.5.5.5\u0026#39; set service dns forwarding cache-size \u0026#39;0\u0026#39; ## å…³é—­äº†ç¼“å­˜ï¼Œé»˜è®¤æ˜¯150 set service dns forwarding listen-address \u0026#39;192.168.100.1\u0026#39; ## ç›‘å¬ LAN å£ # 3. é™åˆ¶ DNS è§£æèŒƒå›´ï¼Œä»…å…è®¸å†…ç½‘ä½¿ç”¨ set service dns forwarding allow-from \u0026#39;192.168.100.0/24\u0026#39; è®¾ç½®ç«¯å£è½¬å‘(DNAT):\nset nat destination rule 10 description \u0026#39;DSTNAT-wg\u0026#39; set nat destination rule 10 destination port \u0026#39;53822\u0026#39; set nat destination rule 10 inbound-interface group \u0026#39;WAN\u0026#39; #å¯ç”¨interface eth1ä»£æ›¿ set nat destination rule 10 protocol \u0026#39;udp\u0026#39; set nat destination rule 10 translation address \u0026#39;192.168.10.145\u0026#39; set nat destination rule 10 translation port \u0026#39;53822\u0026#39; #å¯çœç•¥, å¦‚æœç«¯å£ç›¸åŒ è®¾ç½®é˜²ç«å¢™: è®¾ç½®masquerade(SNAT):\nset nat source rule 100 translation address \u0026#39;masquerade\u0026#39; æŒ‡å®šç½‘æ®µï¼š\nset nat source rule 100 source address \u0026#39;192.168.100.0/24\u0026#39; è®¾ç½®å›æµ: ç”±äºä¸Šé¢masquerade(SNAT)çš„è§„åˆ™, è¿™é‡Œä¸éœ€è¦è®¾ç½®å›æµ. --------------------------------------------- è¿™é‡Œé˜²ç«å¢™rule æ•°å­—å¯è‡ªå®š, åŒä¸€æ•°å­—ä¸ºä¸€ç»„, å»ºè®®è®¾ç½®æ•°å­—æ—¶, ç•™å‡ºç©ºéš™, ä»¥ä¾¿ä»¥åæ·»åŠ æ–°çš„è§„åˆ™. é’ˆå¯¹ä¸Šé¢è¿™æ¡nat source rule 100 è§„åˆ™, å»ºè®®ä¸è¦é™åˆ¶æ¥å£, å°±åªç”¨ä¸Šé¢ä¸€æ¡, è¿™å¯¹ä»¥åçš„ç«¯å£è½¬å‘å’Œå›æµè®¾ç½®, éƒ½å¾ˆæ–¹ä¾¿.\nè®¾ç½®é˜²ç«å¢™è§„åˆ™: å…¨å±€ï¼š\nset firewall global-options state-policy established action \u0026#39;accept\u0026#39; set firewall global-options state-policy invalid action \u0026#39;drop\u0026#39; set firewall global-options state-policy related action \u0026#39;accept\u0026#39; #ä¸‹é¢ä¸€æ¡æ˜¯å®¹å™¨ä¸å†…ç½‘äº’é€š set firewall global-options apply-to-bridged-traffic invalid-connections è®¾ç½®ipv4å…¥ç«™(inputé“¾)è§„åˆ™:\nset firewall ipv4 name WAN_LOCAL default-action \u0026#39;drop\u0026#39; #é»˜è®¤æ‹’ç» set firewall ipv4 name WAN_LOCAL rule 10 action \u0026#39;accept\u0026#39; #å…è®¸å·²å»ºç«‹å’Œç›¸å…³è¿æ¥ set firewall ipv4 name WAN_LOCAL rule 10 state \u0026#39;established\u0026#39; set firewall ipv4 name WAN_LOCAL rule 10 state \u0026#39;related\u0026#39; set firewall ipv4 name WAN_LOCAL rule 30 action \u0026#39;accept\u0026#39; #å…è®¸icmp set firewall ipv4 name WAN_LOCAL rule 30 protocol \u0026#39;icmp\u0026#39; ä¸‹é¢æ˜¯wireguardæ”¾è¡Œç«¯å£ï¼ˆå¯é€‰ï¼‰\nset firewall ipv4 name WAN_LOCAL rule 20 action \u0026#39;accept\u0026#39; #å…è®¸è¿æ¥wg0 set firewall ipv4 name WAN_LOCAL rule 20 destination port \u0026#39;11133\u0026#39; set firewall ipv4 name WAN_LOCAL rule 20 protocol \u0026#39;udp\u0026#39; set firewall ipv4 name WAN_LOCAL rule 40 action \u0026#39;accept\u0026#39; #è¿ç»­ç«¯å£æ ·ä¾‹ set firewall ipv4 name WAN_LOCAL rule 40 destination port \u0026#39;10000-10100\u0026#39; set firewall ipv4 name WAN_LOCAL rule 40 protocol \u0026#39;udp\u0026#39; è®¾ç½®ipv6å…¥ç«™(inputé“¾)è§„åˆ™:\nset firewall ipv6 name WAN_LOCAL default-action \u0026#39;drop\u0026#39; #é»˜è®¤æ‹’ç» set firewall ipv6 name WAN_LOCAL rule 10 action \u0026#39;accept\u0026#39; #å…è®¸å·²å»ºç«‹å’Œç›¸å…³è¿æ¥ set firewall ipv6 name WAN_LOCAL rule 10 state \u0026#39;established\u0026#39; set firewall ipv6 name WAN_LOCAL rule 10 state \u0026#39;related\u0026#39; set firewall ipv6 name WAN_LOCAL rule 20 action \u0026#39;accept\u0026#39; #å…è®¸icmpv6 set firewall ipv6 name WAN_LOCAL rule 20 protocol \u0026#39;icmpv6\u0026#39; set firewall ipv6 name WAN_LOCAL rule 30 action \u0026#39;accept\u0026#39; #å…è®¸ä»ISPå¤„è·å–çš„dhcp6çš„ä¿¡æ¯ set firewall ipv6 name WAN_LOCAL rule 30 destination port \u0026#39;546\u0026#39; set firewall ipv6 name WAN_LOCAL rule 30 protocol \u0026#39;udp\u0026#39; set firewall ipv6 name WAN_LOCAL rule 30 source port \u0026#39;547\u0026#39; ä¸‹é¢æ˜¯wireguardæ”¾è¡Œç«¯å£ï¼ˆå¯é€‰ï¼‰\nset firewall ipv6 name WAN_LOCAL rule 40 action \u0026#39;accept\u0026#39; #å…è®¸è¿æ¥wg0 set firewall ipv6 name WAN_LOCAL rule 40 destination port \u0026#39;11133\u0026#39; set firewall ipv6 name WAN_LOCAL rule 40 protocol \u0026#39;udp\u0026#39; è®¾ç½®ipv4è½¬å‘(forwardé“¾)è§„åˆ™:\nset firewall ipv4 name WAN_IN default-action \u0026#39;drop\u0026#39; #é»˜è®¤æ‹’ç» set firewall ipv4 name WAN_IN rule 10 action \u0026#39;accept\u0026#39; #å…è®¸å·²å»ºç«‹å’Œç›¸å…³è¿æ¥ set firewall ipv4 name WAN_IN rule 10 state \u0026#39;established\u0026#39; set firewall ipv4 name WAN_IN rule 10 state \u0026#39;related\u0026#39; å¦‚æœ‰ipv4è¿›æ¥åçš„ç«¯å£è½¬å‘åŠ ä¸‹é¢ä¸‰æ¡\nset firewall ipv4 name WAN_IN rule 20 action \u0026#39;accept\u0026#39; #å…è®¸å·²DNATçš„è¿æ¥ set firewall ipv4 name WAN_IN rule 20 connection-status nat \u0026#39;destination\u0026#39; set firewall ipv4 name WAN_IN rule 20 state \u0026#39;new\u0026#39; å¦‚æœ‰ipv6è¿›æ¥åçš„ç«¯å£è½¬å‘ ä¹Ÿéœ€è¦å’Œv4ä¸€æ · åŠ è¿™æ¡\nset firewall ipv6 name WAN_IN rule 40 action \u0026#39;accept\u0026#39; set firewall ipv6 name WAN_IN rule 40 connection-status nat \u0026#39;destination\u0026#39; set firewall ipv6 name WAN_IN rule 40 state \u0026#39;new\u0026#39; è®¾ç½®ipv6è½¬å‘(forwardé“¾)è§„åˆ™:\nset firewall ipv6 name WAN_IN default-action \u0026#39;drop\u0026#39; #é»˜è®¤æ‹’ç» set firewall ipv6 name WAN_IN rule 10 action \u0026#39;accept\u0026#39; #å…è®¸å·²å»ºç«‹å’Œç›¸å…³è¿æ¥ set firewall ipv6 name WAN_IN rule 10 state \u0026#39;established\u0026#39; set firewall ipv6 name WAN_IN rule 10 state \u0026#39;related\u0026#39; set firewall ipv6 name WAN_IN rule 20 action \u0026#39;accept\u0026#39; #å…è®¸icmpv6 set firewall ipv6 name WAN_IN rule 20 protocol \u0026#39;icmpv6\u0026#39; set firewall ipv6 name WAN_IN rule 30 action \u0026#39;accept\u0026#39; #å…è®¸ipsec set firewall ipv6 name WAN_IN rule 30 destination port \u0026#39;500,4500\u0026#39; set firewall ipv6 name WAN_IN rule 30 protocol \u0026#39;udp\u0026#39; ç„¶ååˆ†åˆ«ä»inputå’Œforwardé“¾, è°ƒç”¨WAN_LOCALå’ŒWAN_IN:\nset firewall ipv4 input filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv4 input filter rule 10 inbound-interface group \u0026#39;WAN\u0026#39; set firewall ipv4 input filter rule 10 jump-target \u0026#39;WAN_LOCAL\u0026#39; set firewall ipv4 forward filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv4 forward filter rule 10 inbound-interface group \u0026#39;WAN\u0026#39; set firewall ipv4 forward filter rule 10 jump-target \u0026#39;WAN_IN\u0026#39; set firewall ipv6 input filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv6 input filter rule 10 inbound-interface group \u0026#39;WAN\u0026#39; set firewall ipv6 input filter rule 10 jump-target \u0026#39;WAN_LOCAL\u0026#39; set firewall ipv6 forward filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv6 forward filter rule 10 inbound-interface group \u0026#39;WAN\u0026#39; set firewall ipv6 forward filter rule 10 jump-target \u0026#39;WAN_IN\u0026#39; æ³¨: DNATæ˜¯æµé‡è¿›å…¥å, æœ€å…ˆå¤„ç†çš„, ç„¶åè¿›å…¥forwardé“¾, è€ŒSNATæ˜¯æµé‡å‡ºç«™å‰, æœ€åå¤„ç†çš„.\né…ç½®wireguard: set interfaces wireguard wg0 address \u0026#39;10.20.20.1/24\u0026#39; set interfaces wireguard wg0 peer iphone allowed-ips \u0026#39;10.20.20.2/32\u0026#39; set interfaces wireguard wg0 peer iphone preshared-key \u0026#39;preshared-key\u0026#39; set interfaces wireguard wg0 peer iphone public-key \u0026#39;public-key\u0026#39; set interfaces wireguard wg0 port \u0026#39;11133\u0026#39; set interfaces wireguard wg0 private-key \u0026#39;private-key\u0026#39; é…ç½®ddns: cloudflare ddns: set service dns dynamic name DDNS-CF-v4 address interface \u0026#39;pppoe1\u0026#39; set service dns dynamic name DDNS-CF-v4 host-name \u0026#39;ddns.example.com\u0026#39; set service dns dynamic name DDNS-CF-v4 ip-version \u0026#39;ipv4\u0026#39; set service dns dynamic name DDNS-CF-v4 password \u0026#39;token\u0026#39; set service dns dynamic name DDNS-CF-v4 protocol \u0026#39;cloudflare\u0026#39; set service dns dynamic name DDNS-CF-v4 zone \u0026#39;example.com\u0026#39; set service dns dynamic name DDNS-CF-v6 address interface \u0026#39;eth0\u0026#39; set service dns dynamic name DDNS-CF-v6 host-name \u0026#39;ddns6.example.com\u0026#39; set service dns dynamic name DDNS-CF-v6 ip-version \u0026#39;ipv6\u0026#39; set service dns dynamic name DDNS-CF-v6 password \u0026#39;token\u0026#39; set service dns dynamic name DDNS-CF-v6 protocol \u0026#39;cloudflare\u0026#39; set service dns dynamic name DDNS-CF-v6 zone \u0026#39;example.com\u0026#39; dnspod ddns:\nset service dns dynamic name DNSPOD-v4 address interface \u0026#39;pppoe1\u0026#39; set service dns dynamic name DNSPOD-v4 host-name \u0026#39;ddns.example.com\u0026#39; set service dns dynamic name DNSPOD-v4 password \u0026#39;token\u0026#39; set service dns dynamic name DNSPOD-v4 protocol \u0026#39;dyndns2\u0026#39; set service dns dynamic name DNSPOD-v4 server \u0026#39;dnsapi.cn\u0026#39; set service dns dynamic name DNSPOD-v4 username \u0026#39;id\u0026#39; ä¸ªäººä½¿ç”¨ä¸‹æ¥, ä¸Šè¿°é…ç½®å¹¶ä¸éœ€è¦è®¾ç½®interval, ipå˜åŒ–ä¹Ÿä¼šè‡ªåŠ¨æ›´æ–°. è®¾ç½®ç­–ç•¥è·¯ç”±: ä¸¾ä¾‹: è®©wg0çš„æµé‡èµ°100å·è·¯ç”±è¡¨, 100å·è·¯ç”±è¡¨æ˜¯sbçš„è·¯ç”±è¡¨\nset policy route WG0-to-SB interface \u0026#39;wg0\u0026#39; set policy route WG0-to-SB rule 10 destination group network-group \u0026#39;!LAN-v4\u0026#39; set policy route WG0-to-SB rule 10 set table \u0026#39;100\u0026#39; è·¯ç”±è¡¨\nset protocols static table 100 route 0.0.0.0/0 next-hop 192.168.10.90 Happy Routing!\n","permalink":"https://hanigege.github.io/posts/routers/vyos-jibenshangwang-1/","tags":null,"title":"Vyosä¸Šç½‘ç³»åˆ—ä¹‹-ä¸Šç½‘é…ç½®ï¼ˆ1ï¼‰"},{"categories":null,"contents":"ğŸ§‘â€ğŸ’» ç®€ä»‹ # æ­¡è¿ä¾†åˆ°æˆ‘çš„å€‹äººå°ç«™ ğŸŒ ä½ å¥½ï¼ğŸ‘‹ é€™è£¡æ˜¯æˆ‘å€‹äººä½¿ç”¨çš„ä¸€äº›æ¥­å‹™é…ç½®æ–¹æ¡ˆçš„åˆé›†ï¼Œå®Œå…¨æ˜¯ç‚ºäº†æ–¹ä¾¿è‡ªå·±éš¨æ™‚æŸ¥é–±å’Œå­¸ç¿’ï¼ŒåŒæ™‚ä¹Ÿé©ç”¨æ–¼æˆ‘çš„æ—¥å¸¸ç”Ÿæ´»å’Œå®¶åº­ç’°å¢ƒã€‚âœ¨ ğŸ–¥ï¸ ä¸»è¦æ¶‰åŠçš„æŠ€è¡“é ˜åŸŸ æˆ‘çš„å°ç«™ä¸»è¦æ¶µè“‹ä»¥ä¸‹å¹¾å€‹æŠ€è¡“é ˜åŸŸï¼š\nLinux ç³»çµ± FreeBSD ç³»çµ± è»Ÿè·¯ç”±æŠ€è¡“ï¼ˆå¦‚ï¼šRouterOSã€VyOSã€OPNsenseï¼‰ é€šè¨Šè»Ÿä»¶æ–¹æ¡ˆ é€™äº›é…ç½®æ–¹æ¡ˆåœ¨æˆ‘çš„å®¶åº­ç¶²çµ¡ä¸­å»£æ³›ä½¿ç”¨ï¼Œæä¾›äº†è±å¯Œçš„åŠŸèƒ½å’Œä¿éšœï¼Œæ—¢èƒ½æ»¿è¶³å€‹äººéœ€æ±‚ï¼Œåˆèƒ½æé«˜ç¶²çµ¡æ•ˆç‡å’Œå®‰å…¨æ€§ã€‚ğŸ› ï¸\nğŸ’¡ å°ç«™ç›®çš„ é€™å€‹ç«™é»ä¸åƒ…åƒ…æ˜¯æˆ‘å€‹äººçš„æŠ€è¡“å‚™å¿˜éŒ„ï¼Œä¹Ÿå¸Œæœ›èƒ½ç‚ºæœ‰é¡ä¼¼éœ€æ±‚çš„æœ‹å‹å€‘æä¾›ä¸€äº›å¯¦ç”¨çš„åƒè€ƒã€‚ğŸ™ å¦‚æœä½ å’Œæˆ‘æœ‰ç›¸åŒçš„èˆˆè¶£ï¼Œæˆ–è€…æ­£åœ¨å°‹æ‰¾ç›¸é—œçš„æŠ€è¡“æ–¹æ¡ˆï¼Œæ­¡è¿éš¨æ™‚è¨ªå•é€™è£¡ã€‚å¤§å®¶ä¸€èµ·å­¸ç¿’ï¼Œå…±åŒé€²æ­¥ï¼ğŸš€\næ„Ÿè¬ä½ çš„è¨ªå•ï¼ğŸ’– å¸Œæœ›ä½ èƒ½åœ¨é€™è£¡æ‰¾åˆ°æœ‰ç”¨çš„å…§å®¹ã€‚ğŸš€\n","permalink":"https://hanigege.github.io/about/","tags":null,"title":"About"},{"categories":["routers"],"contents":"ipv6æœ€ç»ˆé…ç½®å®šå‹ï¼š /ipv6 dhcp-client add comment=\u0026#34;defconf: local DHCPv6 Client\u0026#34; interface=pppoe-out1 pool-name=dhcpv6-gua-pool1 pool-prefix-length=62 request=prefix use-peer-dns=no /ipv6 address add address=::1 comment=\u0026#34;defconf: local LAN GUA IPv6 address\u0026#34; from-pool=dhcpv6-gua-pool1 interface=pppoe-out1 add address=fd88::1111 comment=\u0026#34;defconf: local LAN ULA IPv6 address\u0026#34; from-pool=DHCPv6 interface=bridge1 /ipv6 pool add name=DHCPv6 prefix=fd88::/64 prefix-length=64 /routing table add name=Proxy-V6 fib /ipv6 firewall mangle add chain=prerouting dst-address-list=proxy_ipv6 action=mark-routing new-routing-mark=Proxy-V6 /ipv6 route add dst-address=::/0 gateway=fd88::9999 routing-table=Proxy-V6 /routing rule/add action=lookup-only-in-table comment=\u0026#34;for ipv6 mangle effective in route\u0026#34; disabled=no routing-mark=Proxy-V6 table=Proxy-V6 /ipv6 firewall nat add action=masquerade chain=srcnat src-address=fd88::/64 /ipv6 firewall address-list add address=f2b0::/18 list=proxy_ipv6 add address=2001:b28:f23d::/48 list=proxy_ipv6 add address=2001:b28:f23f::/48 list=proxy_ipv6 add address=2001:67c:4e8::/48 list=proxy_ipv6 add address=2001:b28:f23c::/48 list=proxy_ipv6 add address=2a0a:f280::/32 list=proxy_ipv6 /ipv6 firewall filter add action=accept chain=input connection-state=established,related,untracked add action=drop chain=input connection-state=invalid add action=accept chain=forward connection-state=\\ established,related,untracked add action=accept chain=forward src-address=fd88::/64 add action=drop chain=forward comment=\u0026#34;defconf: drop invalid\u0026#34; \\ connection-state=invalid add action=accept chain=forward comment=\u0026#34;Accept ICMPv6\u0026#34; protocol=icmpv6 add action=accept chain=input comment=\u0026#34;Accept ICMPv6\u0026#34; protocol=icmpv6 add action=accept chain=input dst-port=546 protocol=udp src-address=fe80::/10 add action=accept chain=forward dst-port=546 protocol=udp src-address=fe80::/10 add action=drop chain=input comment=\u0026#34;Drop malformed packet\u0026#34; protocol=tcp \\ tcp-flags=fin,!syn,!rst,!ack add action=drop chain=input comment=\u0026#34;Drop TCP scan\u0026#34; protocol=tcp tcp-flags=\\ fin,syn add action=drop chain=input comment=\u0026#34;Drop TCP syn/rst scan\u0026#34; protocol=tcp \\ tcp-flags=syn,rst add action=drop chain=input comment=\u0026#34;Drop TCP fin/rst scan\u0026#34; protocol=tcp \\ tcp-flags=fin,rst add action=drop chain=input connection-state=new in-interface=!bridge1 add action=drop chain=input comment=\u0026#34;Drop all other input traffic\u0026#34; \\ in-interface=pppoe-out1 /ipv6 firewall mangle add action=change-mss chain=forward comment=\u0026#34;defconf: fix IPv6 mss for WAN\u0026#34; new-mss=clamp-to-pmtu passthrough=yes protocol=tcp tcp-flags=syn ### ipv4çš„ç«¯å£è½¬å‘ /ip firewall nat add action=dst-nat chain=dstnat comment=\u0026#34;synapse prot\u0026#34; dst-port=12335 \\ protocol=tcp to-addresses=10.20.20.8 to-ports=12335 add action=dst-nat chain=dstnat comment=\u0026#34;gohome prot\u0026#34; dst-port=10521 \\ protocol=udp to-addresses=10.20.20.8 to-ports=10521 /ip/firewall/nat add action=dst-nat chain=dstnat comment=\u0026#34;SoftEther VPN - L2TP\u0026#34; dst-port=1701 protocol=udp to-addresses=10.20.20.4 to-ports=1701 add action=dst-nat chain=dstnat comment=\u0026#34;SoftEther VPN - L2TP\u0026#34; dst-port=500 protocol=udp to-addresses=10.20.20.4 to-ports=500 add action=dst-nat chain=dstnat comment=\u0026#34;SoftEther VPN - L2TP\u0026#34; dst-port=4500 protocol=udp to-addresses=10.20.20.4 to-ports=4500 #ND åŸæœ‰çš„ç¦æ‰ï¼Œæ–°å»ºä¸€ä¸ªé»˜è®¤æ¥å£æ”¹ä¸ºæ¡¥å³å¯ï¼ä¸»è¦æ˜¯æ¥å£æ”¹ä¸ºæ¡¥ï¼ˆåŸNdç¦ç”¨ï¼Œæ–°å»ºä¸€ä¸ªï¼‰å…·ä½“å¦‚ä¸‹å›¾ï¼š /ipv6 nd prefix default set preferred-lifetime=4h valid-lifetime=24h /ipv6 settings set max-neighbor-entries=16384 å‚æ•°å«ä¹‰ â€¢\tmax-neighbor-entriesï¼šIPv6 é‚»å±…è¡¨ä¸­å…è®¸çš„æœ€å¤§æ¡ç›®æ•°é‡ã€‚ â€¢\tå¦‚æœé‚»å±…è¡¨æ»¡äº†ï¼Œæ–°çš„é‚»å±…æ¡ç›®å°†æ— æ³•æ·»åŠ ï¼Œå¯èƒ½å¯¼è‡´ç½‘ç»œä¸­çš„éƒ¨åˆ†è®¾å¤‡æ— æ³•é€šä¿¡ã€‚ â€¢\tæ¡ç›®åŒ…æ‹¬æœ¬åœ°é“¾è·¯ä¸Šçš„æ‰€æœ‰è®¾å¤‡ï¼Œå¦‚å®¢æˆ·ç«¯è®¾å¤‡ã€å…¶ä»–è·¯ç”±å™¨ç­‰ã€‚ å®¶ç”¨ç½‘ç»œçš„åˆç†è®¾ç½® 1. ç½‘ç»œè§„æ¨¡å‚è€ƒ â€¢\tå°å‹å®¶åº­ç½‘ç»œï¼ˆ1-10 å°è®¾å¤‡ï¼‰ï¼š æ¨èå€¼ï¼š128 æˆ–æ›´å°‘ï¼ˆé»˜è®¤æ˜¯ 512ï¼‰ã€‚ â€¢\tä¸­å‹å®¶åº­ç½‘ç»œï¼ˆ10-50 å°è®¾å¤‡ï¼‰ï¼š æ¨èå€¼ï¼š512 è‡³ 1024ã€‚ â€¢\tæœ‰æ™ºèƒ½è®¾å¤‡çš„å®¶åº­ç½‘ç»œï¼ˆ50+ å°è®¾å¤‡ï¼‰ï¼š æ¨èå€¼ï¼š2048ã€‚ â€¢\tå¤§å‹ç½‘ç»œï¼ˆ100 å°è®¾å¤‡æˆ–æ›´å¤šï¼‰ï¼š å¯æ ¹æ®éœ€è¦æé«˜åˆ° 4096 æˆ–æ›´é«˜ã€‚ #å¼€å¯nat1 /ip firewall nat add action=endpoint-independent-nat chain=srcnat protocol=udp out-interface=pppoe-out1 place-before=0 /ip firewall nat add action=endpoint-independent-nat chain=dstnat protocol=udp in-interface=pppoe-out1 place-before=0 é™„ï¼šç®€æ˜“æœ‰æ•ˆé˜²ç«å¢™ï¼ˆRå¤§æä¾›çš„æ–¹æ¡ˆï¼‰ ipv4 /ip firewall filter add action=accept chain=forward in-interface=bridge1 add action=accept chain=input in-interface=bridge1 add action=accept chain=input connection-state=established,related add action=drop chain=input connection-state=invalid in-interface=pppoe-out1 add action=drop chain=input in-interface=pppoe-out1 protocol=icmp ipv6 /ipv6 firewall filter add action=accept chain=input comment=\u0026#34;Accept established, related, untracked\u0026#34; connection-state=established,related,untracked add action=accept chain=forward comment=\u0026#34;Accept established, related, untracked\u0026#34; connection-state=established,related,untracked add action=accept chain=forward comment=\u0026#34;Accept ICMPv6\u0026#34; protocol=icmpv6 add action=accept chain=input comment=\u0026#34;Accept ICMPv6\u0026#34; protocol=icmpv6 add action=drop chain=input comment=\u0026#34;Drop invalid\u0026#34; connection-state=invalid add action=drop chain=forward comment=\u0026#34;Drop invalid\u0026#34; connection-state=invalid add action=drop chain=forward comment=\u0026#34;Drop all not from LAN\u0026#34; disabled=yes in-interface=!bridge ","permalink":"https://hanigege.github.io/posts/routers/ros-ipv6-set/","tags":null,"title":"RosIPV6é…ç½®æ–¹æ¡ˆ"},{"categories":["routers"],"contents":"ä¸€.åŸºæœ¬ä¸Šç½‘é…ç½® vyosçš„å‘½ä»¤è¡Œç•Œé¢æ˜¯åŸºäºshellçš„ï¼Œæ²¡æœ‰å›¾å½¢ç•Œé¢, ä½†æ˜¯å¯ä»¥ç”¨tabè‡ªåŠ¨è¡¥å…¨ æœ¬æ–‡çš„vyoså‘½ä»¤æ˜¯åŸºäºvyosçš„vyos-rolling-nightly-buildsçš„1.5.xç‰ˆæœ¬.\npveå®‰è£…vyos: ä¸‹è½½å®‰è£…åŒ… pveçš„è™šæ‹Ÿæœºè®¾ç½®å’Œå®‰è£…(ç•¥), å»ºè®®å†…å­˜2G, ç£ç›˜10Gæˆ–æ›´å¤§, å› ä¸ºvyoså¯ä»¥è¿è¡Œå®¹å™¨, vyosé™¤è‡ªå·±çš„å®¹å™¨ç®¡ç†å·¥å…·ä»¥å¤–ï¼Œä¹Ÿå¯ä»¥ç”¨podmanç®¡ç†å®¹å™¨. vmè¿è¡Œå, ç”¨vyos:vyosç™»å½•. ç”¨ä¸‹é¢å‘½ä»¤å®‰è£…:\ninstall image 2.å®‰è£…vyos. è¿›å…¥é…ç½®æ¨¡å¼ï¼š\nconfigure ç”Ÿæ•ˆï¼š\ncommit ä¿å­˜é…ç½®ï¼š\nsave å–æ¶ˆæœªcommitç”Ÿæ•ˆçš„,æœªä¿å­˜çš„é…ç½®ï¼š\ndiscard å»¶æ—¶ç¡®è®¤ï¼šå¦‚2åˆ†é’Ÿåä¸ç¡®è®¤ï¼Œé…ç½®å›æ»šåˆ°ä¸Šä¸€é…ç½®\ncommit-confirm 2 å›æ»šå dircard æ¸…é™¤ä¸Šæ¬¡æ²¡æœ‰commité…ç½®ã€‚(å› ä¸ºcommit-confirm 2åå·²ç»è¾“å…¥è¿‡äº†ï¼Œåªæ˜¯æ²¡æœ‰commitæäº¤) å¦‚æœæå‰ææ•ˆç¡®è®¤ï¼Œç›´æ¥è¾“å…¥ï¼š\nconfirm è®¾ç½®sshç™»å½•:\nset service ssh port \u0026#39;22\u0026#39; åˆ›å»ºç”¨æˆ·gary:\nset system login user gary full-name gary set system login user gary authentication plaintext-password \u0026#39;å¯†ç \u0026#39; å»ºè®®sshå¯†é’¥ç™»å½•:(å¯é€‰ï¼Œéå¿…é¡»ï¼Œç†Ÿç»ƒåå†ä½¿ç”¨ï¼‰\nset system login user gary authentication public-keys gary@laptop key \u0026#39;your-public-key\u0026#39; set system login user gary authentication public-keys gary@laptop type \u0026#39;ssh-rsa\u0026#39; ç¦ç”¨é»˜è®¤çš„vyosç”¨æˆ·:\nset system login user vyos disable è®¾ç½®ç³»ç»Ÿçš„hostname:\nset system host-name \u0026#39;vyos\u0026#39; æŸ¥çœ‹ç³»ç»Ÿçš„hostname\nshow system host-name è®¾ç½®æ—¶åŒº:\nset system time-zone \u0026#39;Asia/Shanghai\u0026#39; è®¾ç½®ntp:\nset service ntp server 129.250.35.251 set service ntp server 203.107.6.88 (æ³¨: å¯ä»¥è®¾ç½®å¤šä¸ªntpæœåŠ¡å™¨, å»ºè®®ç”¨è¿è¥å•†çš„ntpæœåŠ¡å™¨, æœ€å¥½æ˜¯çº¯ip, å¯åˆ é™¤é»˜è®¤çš„ntpæœåŠ¡å™¨)\nå…ˆçœ‹ä¸‹è‡ªå·±çš„æ¥å£æƒ…å†µï¼Œæœ‰çš„ä¸æ˜¯eht0å’Œeth1ã€‚ã€‚ã€‚æœ‰çš„ç›´æ¥å°±æ˜¯eth0å’Œeht2,æ‰€ä»¥è¯·æ ¹æ®è‡ªå·±å°ä¸»æœºçš„æƒ…å†µè°ƒæ•´åé¢çš„å‘½ä»¤æ¥å£ã€‚\nshow interface ä¸‹é¢çš„æ•™ç¨‹æŒ‰æ ‡å‡†çš„eht0,eth1,eth2,eth3å››ç½‘å£æ¥è¯´æ˜ï¼š WAN/LAN æ¥å£é…ç½® è¿›å…¥é…ç½®æ¨¡å¼ é¦–å…ˆï¼Œè¿›å…¥ VyOS é…ç½®æ¨¡å¼ï¼š\nconfigure åˆ›å»ºæ¡¥æ¥æ¥å£ï¼ˆbr0ï¼‰ æ¥ç€ï¼Œåˆ›å»ºä¸€ä¸ªæ¡¥æ¥æ¥å£ br0ï¼Œå¹¶å°† eth0ã€eth1 å’Œ eth2 åŠ å…¥è¯¥æ¡¥æ¥ç»„ï¼š\nset interfaces bridge br0 address \u0026#39;10.20.20.1/24\u0026#39; set interfaces bridge br0 address \u0026#39;fd88::1111/64\u0026#39; set interfaces bridge br0 member interface \u0026#39;eth0\u0026#39; set interfaces bridge br0 member interface \u0026#39;eth1\u0026#39; set interfaces bridge br0 member interface \u0026#39;eth2\u0026#39; 3. ã€ LAN é…ç½® DHCP 3.1 å¯ç”¨ LAN å£çš„ DHCP server LAN çš„ç½‘æ®µæ˜¯ 10.20.20.0/24ï¼ŒDHCP çš„åˆ†é… IP èŒƒå›´æ˜¯ 10.20.20.100-200ï¼ŒåŒæ—¶ä¸‹å‘äº† dns server å’Œ ntp serverã€‚\nset service dhcp-server hostfile-update set service dhcp-server shared-network-name LAN_br0 authoritative set service dhcp-server shared-network-name LAN_br0 option ntp-server \u0026#39;10.20.20.1\u0026#39; set service dhcp-server shared-network-name LAN_br0 option time-zone \u0026#39;Asia/Shanghai\u0026#39; set service dhcp-server shared-network-name LAN_br0 subnet 10.20.20.0/24 lease \u0026#39;86400\u0026#39; set service dhcp-server shared-network-name LAN_br0 subnet 10.20.20.0/24 option default-router \u0026#39;10.20.20.1\u0026#39; set service dhcp-server shared-network-name LAN_br0 subnet 10.20.20.0/24 option name-server \u0026#39;10.20.20.6\u0026#39; set service dhcp-server shared-network-name LAN_br0 subnet 10.20.20.0/24 range 100 start \u0026#39;10.20.20.100\u0026#39; set service dhcp-server shared-network-name LAN_br0 subnet 10.20.20.0/24 range 100 stop \u0026#39;10.20.20.200\u0026#39; set service dhcp-server shared-network-name LAN_br0 subnet 10.20.20.0/24 subnet-id \u0026#39;1\u0026#39; è®¾ç½®å›ºå®šIP set service dhcp-server shared-network-name LAN_br0 subnet 10.20.20.0/24 static-mapping freepbx16 ip-address \u0026#39;10.20.20.103\u0026#39; set service dhcp-server shared-network-name LAN_br0 subnet 10.20.20.0/24 static-mapping freepbx16 mac \u0026#39;bc:24:11:c4:6f:eb\u0026#39; è¡¥å……ï¼š(è¿™ä¸‹é¢çš„å‘½ä»¤åªæ˜¯æ–¹ä¾¿æ›´æ”¹å¤åˆ¶ä½¿ç”¨ï¼‰\n# æ·»åŠ ä¸€ä¸ªdns (è¿™ä¸ªdnsæ˜¯æˆ‘åç»­ä¸æŠ˜è…¾ä½¬çš„smboxçš„IPï¼‰ set service dhcp-server shared-network-name LAN_br0 subnet 10.20.20.0/24 option name-server \u0026#39;172.23.0.99\u0026#39; # æ·»åŠ ä¸€ä¸ªdns (è¿™ä¸ªdnsæ˜¯æˆ‘åç»­è‡ªå·±è™šæ‹Ÿæœºmosdnsçš„ip) set service dhcp-server shared-network-name LAN_br0 subnet 10.20.20.0/24 option name-server \u0026#39;10.20.20.6\u0026#39; # åˆ é™¤ä¸€ä¸ªdns delete service dhcp-server shared-network-name LAN_br0 subnet 10.20.20.0/24 option name-server \u0026#39;10.20.20.1\u0026#39; # æ›´æ”¹ç½‘å…³ ï¼ˆè¿™ä¸ªç½‘å…³æ˜¯æˆ‘åç»­sing-boxçš„IPï¼‰ set service dhcp-server shared-network-name LAN_br0 subnet 10.20.20.0/24 option default-router \u0026#39;10.20.20.9\u0026#39; 3.2 å±€åŸŸç½‘ DNS é…ç½® set system name-server \u0026#39;223.5.5.5\u0026#39; set service dns forwarding allow-from \u0026#39;10.20.20.0/24\u0026#39; set service dns forwarding listen-address \u0026#39;10.20.20.1\u0026#39; set service dns forwarding cache-size \u0026#39;0\u0026#39; ## å…³é—­äº†ç¼“å­˜ 3.4 å†…ç½‘è®¾å¤‡éšè—ä¸Šç½‘ masquerade(SNAT): masquerade\nset nat source rule 100 translation address \u0026#39;masquerade\u0026#39; æŒ‡å®šç½‘æ®µï¼šï¼ˆå¯é€‰ï¼‰ å¯ä»¥ä¸ç”¨ï¼ç”¨äº†ä¼šé™åˆ¶wg.æˆ–è€…å†æ·»åŠ wgç½‘æ®µç­‰ï¼Œä¸ä¼šå°±ä¸è¦ç”¨ï¼\nset nat source rule 100 source address \u0026#39;10.20.20.0/24\u0026#39; è®¾ç½®å›æµ: ç”±äºä¸Šé¢masquerade(SNAT)çš„è§„åˆ™, è¿™é‡Œä¸éœ€è¦è®¾ç½®å›æµ.\nåˆ°è¿™ä¸€æ­¥åŸºæœ¬çš„å±€åŸŸç½‘é…ç½®å°±å·²ç»å¯ä»¥äº†ï¼Œå…¶ä»–è®¾å¤‡åŠ å…¥å°±å¯ä»¥è‡ªåŠ¨dhcpè·å– ip å¹¶ä¸Šç½‘äº†ã€‚\nå››ã€QoS æµé‡ç®¡ç†ï¼ˆå¯é€‰ï¼‰\nVyos æä¾›äº†éå¸¸å®Œå–„çš„ Qos Policyï¼Œå¸¸è§çš„æµé‡ç­–ç•¥éƒ½æ”¯æŒã€‚å®¶ç”¨ä¸ç”¨é‚£ä¹ˆéº»çƒ¦ç›´æ¥ä½¿ç”¨ Cake ä»…éœ€è¦è®¾ç½®ä¸€ä¸‹å¸¦å®½ï¼Œè¦æ³¨æ„çš„æ˜¯å¯ç”¨ Qos ä¼šå ç”¨ CPUï¼ŒåŒæ—¶å¯èƒ½ä¼šå¯¼è‡´å¸¦å®½è·‘ä¸æ»¡ã€‚å¥½å¤„æ˜¯å¤šäººå ç”¨å¸¦å®½æ—¶ï¼Œå¯ä»¥ä¸ºæ¯ä¸€ä¸ªäººåˆç†åˆ†é…å®½å¸¦èµ„æºã€‚\nset qos policy cake Qos_Cake_Lan bandwidth \u0026#39;1gbit\u0026#39; set qos policy cake Qos_Cake_Lan description \u0026#39;Qos For Lan interface br0\u0026#39; set qos policy cake Qos_Cake_Lan flow-isolation dual-src-host set qos policy cake Qos_Cake_Lan rtt \u0026#39;100\u0026#39; set qos interface br0 egress \u0026#39;Qos_Cake_Lan\u0026#39; äº”ã€é˜²ç«å¢™ è¿™é‡Œé˜²ç«å¢™rule æ•°å­—å¯è‡ªå®š, åŒä¸€æ•°å­—ä¸ºä¸€ç»„, å»ºè®®è®¾ç½®æ•°å­—æ—¶, ç•™å‡ºç©ºéš™, ä»¥ä¾¿ä»¥åæ·»åŠ æ–°çš„è§„åˆ™. é’ˆå¯¹ä¸Šé¢è¿™æ¡nat source rule 100 è§„åˆ™, å»ºè®®ä¸è¦é™åˆ¶æ¥å£, å°±åªç”¨ä¸Šé¢ä¸€æ¡, è¿™å¯¹ä»¥åçš„ç«¯å£è½¬å‘å’Œå›æµè®¾ç½®, éƒ½å¾ˆæ–¹ä¾¿. è®¾ç½®é˜²ç«å¢™è§„åˆ™:\nå…¨å±€ï¼š\nset firewall global-options state-policy established action \u0026#39;accept\u0026#39; set firewall global-options state-policy invalid action \u0026#39;drop\u0026#39; set firewall global-options state-policy related action \u0026#39;accept\u0026#39; set firewall global-options apply-to-bridged-traffic invalid-connections ä¸Šé¢ç¬¬å››æ¡ä¹Ÿå°±æ˜¯æœ€åä¸€æ¡ï¼Œä½œç”¨æ˜¯å®¹å™¨ä¸å†…ç½‘äº’é€šï¼ˆæ¡¥æ¥ï¼‰\nè®¾ç½®ipv4å…¥ç«™(inputé“¾)è§„åˆ™:\nset firewall ipv4 name WAN_LOCAL default-action \u0026#39;drop\u0026#39; #é»˜è®¤æ‹’ç» set firewall ipv4 name WAN_LOCAL rule 10 action \u0026#39;accept\u0026#39; #å…è®¸å·²å»ºç«‹å’Œç›¸å…³è¿æ¥ set firewall ipv4 name WAN_LOCAL rule 10 state \u0026#39;established\u0026#39; set firewall ipv4 name WAN_LOCAL rule 10 state \u0026#39;related\u0026#39; set firewall ipv4 name WAN_LOCAL rule 30 action \u0026#39;accept\u0026#39; #å…è®¸icmp set firewall ipv4 name WAN_LOCAL rule 30 protocol \u0026#39;icmp\u0026#39; ä¸‹é¢æ˜¯wireguardæ”¾è¡Œç«¯å£ï¼ˆå¯é€‰ï¼‰\nset firewall ipv4 name WAN_LOCAL rule 20 description \u0026#34;Allow WireGuard\u0026#34; set firewall ipv4 name WAN_LOCAL rule 20 action \u0026#39;accept\u0026#39; #å…è®¸è¿æ¥wg0 set firewall ipv4 name WAN_LOCAL rule 20 destination port \u0026#39;11133\u0026#39; set firewall ipv4 name WAN_LOCAL rule 20 protocol \u0026#39;udp\u0026#39; #ä¸‹é¢æ˜¯æ”¾è¡Œè¿ç»­ç«¯å£æ ·ä¾‹ï¼šï¼ˆä¾‹ï¼‰\nset firewall ipv4 name WAN_LOCAL rule 40 action \u0026#39;accept\u0026#39; #è¿ç»­ç«¯å£æ ·ä¾‹ set firewall ipv4 name WAN_LOCAL rule 40 destination port \u0026#39;10000-10100\u0026#39; set firewall ipv4 name WAN_LOCAL rule 40 protocol \u0026#39;udp\u0026#39; è®¾ç½®ipv6å…¥ç«™(inputé“¾)è§„åˆ™:\nset firewall ipv6 name WAN_LOCAL default-action \u0026#39;drop\u0026#39; #é»˜è®¤æ‹’ç» set firewall ipv6 name WAN_LOCAL rule 10 action \u0026#39;accept\u0026#39; #å…è®¸å·²å»ºç«‹å’Œç›¸å…³è¿æ¥ set firewall ipv6 name WAN_LOCAL rule 10 state \u0026#39;established\u0026#39; set firewall ipv6 name WAN_LOCAL rule 10 state \u0026#39;related\u0026#39; set firewall ipv6 name WAN_LOCAL rule 20 action \u0026#39;accept\u0026#39; #å…è®¸icmpv6 set firewall ipv6 name WAN_LOCAL rule 20 protocol \u0026#39;icmpv6\u0026#39; set firewall ipv6 name WAN_LOCAL rule 30 action \u0026#39;accept\u0026#39; #å…è®¸ä»ISPå¤„è·å–çš„dhcp6çš„ä¿¡æ¯ set firewall ipv6 name WAN_LOCAL rule 30 destination port \u0026#39;546\u0026#39; set firewall ipv6 name WAN_LOCAL rule 30 protocol \u0026#39;udp\u0026#39; set firewall ipv6 name WAN_LOCAL rule 30 source port \u0026#39;547\u0026#39; ä¸‹é¢æ˜¯wireguardæ”¾è¡Œç«¯å£ï¼ˆå¯é€‰)\nset firewall ipv6 name WAN_LOCAL rule 40 description \u0026#34;Allow WireGuard set firewall ipv6 name WAN_LOCAL rule 40 action \u0026#39;accept\u0026#39; #å…è®¸è¿æ¥wg0 set firewall ipv6 name WAN_LOCAL rule 40 destination port \u0026#39;11133\u0026#39; set firewall ipv6 name WAN_LOCAL rule 40 protocol \u0026#39;udp\u0026#39; è®¾ç½®ipv4è½¬å‘(forwardé“¾)è§„åˆ™:\nset firewall ipv4 name WAN_IN default-action \u0026#39;drop\u0026#39; #é»˜è®¤æ‹’ç» set firewall ipv4 name WAN_IN rule 10 action \u0026#39;accept\u0026#39; #å…è®¸å·²å»ºç«‹å’Œç›¸å…³è¿æ¥ set firewall ipv4 name WAN_IN rule 10 state \u0026#39;established\u0026#39; set firewall ipv4 name WAN_IN rule 10 state \u0026#39;related\u0026#39; è®¾ç½®ipv6è½¬å‘(forwardé“¾)è§„åˆ™:\nset firewall ipv6 name WAN_IN default-action \u0026#39;drop\u0026#39; #é»˜è®¤æ‹’ç» set firewall ipv6 name WAN_IN rule 10 action \u0026#39;accept\u0026#39; #å…è®¸å·²å»ºç«‹å’Œç›¸å…³è¿æ¥ set firewall ipv6 name WAN_IN rule 10 state \u0026#39;established\u0026#39; set firewall ipv6 name WAN_IN rule 10 state \u0026#39;related\u0026#39; set firewall ipv6 name WAN_IN rule 20 action \u0026#39;accept\u0026#39; #å…è®¸icmpv6 set firewall ipv6 name WAN_IN rule 20 protocol \u0026#39;icmpv6\u0026#39; ä¸‹é¢ä¸‰æ¡è¾“å…¥ï¼Œnatç«¯å£åä¸ç”¨å†åœ¨é˜²ç«å¢™é‡Œæ‰“å¼€æ”¾è¡Œç«¯å£ï¼Œnatä¼˜å…ˆæ”¾è¡Œ\nIPV4ï¼š\nset firewall ipv4 name WAN_IN rule 20 action \u0026#39;accept\u0026#39; #å…è®¸å·²DNATçš„è¿æ¥ set firewall ipv4 name WAN_IN rule 20 connection-status nat \u0026#39;destination\u0026#39; set firewall ipv4 name WAN_IN rule 20 state \u0026#39;new\u0026#39; ä¸‹é¢ä¸‰æ¡è¾“å…¥ï¼Œnatç«¯å£åä¸ç”¨å†åœ¨é˜²ç«å¢™é‡Œæ‰“å¼€æ”¾è¡Œç«¯å£ï¼Œnatä¼˜å…ˆæ”¾è¡Œ IPV6ï¼š\nset firewall ipv6 name WAN_IN rule 40 action \u0026#39;accept\u0026#39; set firewall ipv6 name WAN_IN rule 40 connection-status nat \u0026#39;destination\u0026#39; set firewall ipv6 name WAN_IN rule 40 state \u0026#39;new\u0026#39; æ”¾è¡Œipsecç«¯å£ï¼ˆä¸¾ä¾‹ï¼šï¼‰\nset firewall ipv6 name WAN_IN rule 30 action \u0026#39;accept\u0026#39; #å…è®¸ipsec set firewall ipv6 name WAN_IN rule 30 destination port \u0026#39;500,4500\u0026#39; set firewall ipv6 name WAN_IN rule 30 protocol \u0026#39;udp\u0026#39; ç„¶ååˆ†åˆ«ä»inputå’Œforwardé“¾, è°ƒç”¨WAN_LOCALå’ŒWAN_IN: è®¾ç½®æ¥å£ç»„:\nset firewall group interface-group WAN interface \u0026#39;eth3\u0026#39; set firewall group interface-group WAN interface \u0026#39;pppoe1\u0026#39; ç„¶ååˆ†åˆ«ä»inputå’Œforwardé“¾, è°ƒç”¨WAN_LOCALå’ŒWAN_IN:\nset firewall ipv4 input filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv4 input filter rule 10 inbound-interface group \u0026#39;WAN\u0026#39; set firewall ipv4 input filter rule 10 jump-target \u0026#39;WAN_LOCAL\u0026#39; set firewall ipv4 forward filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv4 forward filter rule 10 inbound-interface group \u0026#39;WAN\u0026#39; set firewall ipv4 forward filter rule 10 jump-target \u0026#39;WAN_IN\u0026#39; set firewall ipv6 input filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv6 input filter rule 10 inbound-interface group \u0026#39;WAN\u0026#39; set firewall ipv6 input filter rule 10 jump-target \u0026#39;WAN_LOCAL\u0026#39; set firewall ipv6 forward filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv6 forward filter rule 10 inbound-interface group \u0026#39;WAN\u0026#39; set firewall ipv6 forward filter rule 10 jump-target \u0026#39;WAN_IN\u0026#39; è¯´æ˜: DNATï¼ˆè½¬å‘çš„ç«¯å£ï¼‰æ˜¯æµé‡è¿›å…¥å, æœ€å…ˆå¤„ç†çš„, ç„¶åè¿›å…¥forwardé“¾, è€ŒSNATæ˜¯æµé‡å‡ºç«™å‰, æœ€åå¤„ç†çš„. ä¸‹é¢åªæ˜¯æ ¹æ®è‡ªå·±çš„æƒ…å†µå¤åˆ¶é€‰ç”¨ï¼š\nç•™ä¸ªpppoeæ¥å£ï¼ˆä¾‹ï¼‰ set firewall ipv4 input filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv4 input filter rule 10 inbound-interface name pppoe1 set firewall ipv4 input filter rule 10 jump-target \u0026#39;WAN_LOCAL\u0026#39; set firewall ipv4 forward filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv4 forward filter rule 10 inbound-interface name pppoe1 set firewall ipv4 forward filter rule 10 jump-target \u0026#39;WAN_IN\u0026#39; set firewall ipv6 input filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv6 input filter rule 10 inbound-interface name pppoe1 set firewall ipv6 input filter rule 10 jump-target \u0026#39;WAN_LOCAL\u0026#39; set firewall ipv6 forward filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv6 forward filter rule 10 inbound-interface name pppoe1 set firewall ipv6 forward filter rule 10 jump-target \u0026#39;WAN_IN\u0026#39; ETH3 wanå£ï¼ˆä¾‹ï¼‰ set firewall ipv4 input filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv4 input filter rule 10 inbound-interface name eth3 set firewall ipv4 input filter rule 10 jump-target \u0026#39;WAN_LOCAL\u0026#39; set firewall ipv4 forward filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv4 forward filter rule 10 inbound-interface name eth3 set firewall ipv4 forward filter rule 10 jump-target \u0026#39;WAN_IN\u0026#39; set firewall ipv6 input filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv6 input filter rule 10 inbound-interface name eth3 set firewall ipv6 input filter rule 10 jump-target \u0026#39;WAN_LOCAL\u0026#39; v set firewall ipv6 forward filter rule 10 action \u0026#39;jump\u0026#39; set firewall ipv6 forward filter rule 10 inbound-interface name eth3 set firewall ipv6 forward filter rule 10 jump-target \u0026#39;WAN_IN\u0026#39; IPV4ç«¯å£è½¬å‘ï¼ˆæ ·ä¾‹é…ç½®ï¼‰ï¼šNATç«¯å£è½¬å‘ (é…ç½®æ ·ä¾‹ï¼‰ï¼ˆä¸ç”¨ä¸‹æ¥å£ï¼‰\nconfigure # Synapse (TCP 12335) set nat destination rule 10 description \u0026#39;synapse\u0026#39; set nat destination rule 10 destination port \u0026#39;12335\u0026#39; set nat destination rule 10 protocol \u0026#39;tcp\u0026#39; set nat destination rule 10 translation address \u0026#39;10.20.20.8\u0026#39; set nat destination rule 10 translation port \u0026#39;12335\u0026#39; # åŒä¸€ä¸ªç«¯å£ä¸å¡«ä¹Ÿå¯ä»¥ # SB_home (UDP 20521) set nat destination rule 20 description \u0026#39;SB_home\u0026#39; set nat destination rule 20 destination port \u0026#39;20521\u0026#39; set nat destination rule 20 protocol \u0026#39;udp\u0026#39; set nat destination rule 20 translation address \u0026#39;10.20.20.9\u0026#39; set nat destination rule 20 translation port \u0026#39;20521\u0026#39; # åŒä¸€ä¸ªç«¯å£ä¸å¡«ä¹Ÿå¯ä»¥ # L2TP VPN (UDP 1701) set nat destination rule 30 description \u0026#39;L2TP\u0026#39; set nat destination rule 30 destination port \u0026#39;1701\u0026#39; set nat destination rule 30 protocol \u0026#39;udp\u0026#39; set nat destination rule 30 translation address \u0026#39;10.20.20.4\u0026#39; set nat destination rule 30 translation port \u0026#39;1701\u0026#39; # åŒä¸€ä¸ªç«¯å£ä¸å¡«ä¹Ÿå¯ä»¥ # ISAKMP (UDP 500) - ç”¨äº IKEï¼ˆIPSec å¯†é’¥äº¤æ¢ï¼‰ set nat destination rule 40 description \u0026#39;ISAKMP\u0026#39; set nat destination rule 40 destination port \u0026#39;500\u0026#39; set nat destination rule 40 protocol \u0026#39;udp\u0026#39; set nat destination rule 40 translation address \u0026#39;10.20.20.4\u0026#39; set nat destination rule 40 translation port \u0026#39;500\u0026#39; # åŒä¸€ä¸ªç«¯å£ä¸å¡«ä¹Ÿå¯ä»¥ # IPSEC NAT-T (UDP 4500) - NAT ç©¿é€ set nat destination rule 50 description \u0026#39;IPSEC\u0026#39; set nat destination rule 50 destination port \u0026#39;4500\u0026#39; set nat destination rule 50 protocol \u0026#39;udp\u0026#39; set nat destination rule 50 translation address \u0026#39;10.20.20.4\u0026#39; set nat destination rule 50 translation port \u0026#39;4500\u0026#39; # åŒä¸€ä¸ªç«¯å£ä¸å¡«ä¹Ÿå¯ä»¥ # OpenVPN (TCP 1194) set nat destination rule 60 description \u0026#39;OPENVPN\u0026#39; set nat destination rule 60 destination port \u0026#39;1194\u0026#39; set nat destination rule 60 protocol \u0026#39;tcp\u0026#39; set nat destination rule 60 translation address \u0026#39;10.20.20.4\u0026#39; set nat destination rule 60 translation port \u0026#39;1194\u0026#39; # åŒä¸€ä¸ªç«¯å£ä¸å¡«ä¹Ÿå¯ä»¥ # SIP (UDP 5060) set nat destination rule 70 description \u0026#39;SIP\u0026#39; set nat destination rule 70 destination port \u0026#39;5060\u0026#39; set nat destination rule 70 protocol \u0026#39;udp\u0026#39; set nat destination rule 70 translation address \u0026#39;10.20.20.17\u0026#39; set nat destination rule 70 translation port \u0026#39;5060\u0026#39; # åŒä¸€ä¸ªç«¯å£ä¸å¡«ä¹Ÿå¯ä»¥ # SIP RTP (UDP 10000-10100) set nat destination rule 80 description \u0026#39;SIP_RTP\u0026#39; set nat destination rule 80 destination port \u0026#39;10000-10100\u0026#39; set nat destination rule 80 protocol \u0026#39;udp\u0026#39; set nat destination rule 80 translation address \u0026#39;10.20.20.17\u0026#39; set nat destination rule 80 translation port \u0026#39;10000-10100\u0026#39; # åŒä¸€ä¸ªç«¯å£ä¸å¡«ä¹Ÿå¯ä»¥ commit save IPV6ç«¯å£è½¬å‘ï¼ˆæ ·ä¾‹é…ç½®ï¼‰ï¼šNATç«¯å£è½¬å‘ (é…ç½®æ ·ä¾‹ï¼‰ï¼ˆä¸ç”¨ä¸‹æ¥å£ï¼‰\nset nat66 destination rule 10 description \u0026#39;gohome\u0026#39; set nat66 destination rule 10 destination port \u0026#39;10521\u0026#39; set nat66 destination rule 10 protocol \u0026#39;udp\u0026#39; set nat66 destination rule 10 translation address \u0026#39;fd99::9999\u0026#39; é˜²ç«å¢™èŒƒå›´é…ç½®ç»“æŸï¼\nå…­ã€WAN å£ PPPoE æ‹¨å·é…ç½® 6.1 æ‹¨å·é…ç½® å‰ææ˜¯å…‰çŒ«è¦æ”¹æ¡¥æ¥ï¼Œå¹¶ä¸”æœ‰å®½å¸¦çš„æ‹¨å·ä¿¡æ¯ï¼Œå…ˆä»å…‰çŒ«çš„ LAN å£æ¥ä¸€æ¡ç½‘çº¿åˆ° vyos çš„eth3æ¥å£(wanå£ï¼‰ï¼Œå¹¶å¯ç”¨ä¸€ä¸ªpppoe1çš„æ¥å£ï¼Œ è‡ªåŠ¨é…ç½® MTU ï¼š\nset interfaces pppoe pppoe1 description \u0026#39;China Telecom\\China Unicom\u0026#39; #ç”µä¿¡è¿˜æ˜¯è”é€šï¼ŒäºŒé€‰ä¸€ï¼Œä¸æ˜¯çš„åˆ é™¤ set interfaces pppoe pppoe1 source-interface \u0026#39;eth3\u0026#39; set interfaces pppoe pppoe1 authentication username \u0026#39;å¸å·\u0026#39; set interfaces pppoe pppoe1 authentication password \u0026#39;å¯†ç \u0026#39; set interfaces pppoe pppoe1 mtu \u0026#39;1492\u0026#39; set interfaces pppoe pppoe1 ip adjust-mss \u0026#39;clamp-mss-to-pmtu\u0026#39; ####PPPOEæµ‹è¯•æ—¶å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ pppoeæ–­å¼€ï¼š\nrun disconnect interface pppoe1 å†è¿ï¼š\nrun connect interface pppoe1 æŸ¥çœ‹ï¼š\nrun show int 6.2 IPv6 PD é…ç½® é¦–å…ˆè®¾ç½®éœ€è¦è®¾ç½® prefixï¼Œæˆ‘çš„è¿è¥å•†æ˜¯ç»™çš„æ˜¯/60\n#set interfaces pppoe pppoe1 dhcpv6-options pd 0 interface br0 sla-id \u0026#39;0\u0026#39; #ç¬¬ä¸€æ¡ç¬¬äºŒæ¡äºŒé€‰ä¸€ï¼Œéƒ½è¡Œï¼Œipv6åœ°å€çš„å½¢æ€ä¸ä¸€æ · set interfaces pppoe pppoe1 dhcpv6-options pd 0 interface br0 address \u0026#39;1\u0026#39; set interfaces pppoe pppoe1 dhcpv6-options pd 0 length \u0026#39;62\u0026#39; # è¿™æ˜¯perxi set interfaces pppoe pppoe1 ipv6 adjust-mss \u0026#39;clamp-mss-to-pmtu\u0026#39; set interfaces pppoe pppoe1 ipv6 address autoconf è®¾ç½®è·¯ç”±å™¨å…¬å‘ŠRAï¼š\nset service router-advert interface br0 prefix fd88::/64 valid-lifetime \u0026#39;172800\u0026#39; 6.3 å¤šæ‹¨(å¯é€‰ï¼‰ å¤šæ‹¨éœ€è¦è¿è¥å•†æ”¯æŒï¼Œvyos çš„å¤šæ‹¨éå¸¸ç®€å•ï¼Œæ–°å¯ç”¨ä¸€ä¸ª pppoe çš„æ¥å£æ‹¨å·å³å¯ï¼š\nset interfaces pppoe pppoe1 authentication password \u0026#39;å®½å¸¦å¯†ç \u0026#39; set interfaces pppoe pppoe1 authentication username \u0026#39;å®½å¸¦è´¦å·\u0026#39; set interfaces pppoe pppoe1 description \u0026#39;China Unicom WAN multi-pppoe-2\u0026#39; set interfaces pppoe pppoe1 source-interface \u0026#39;eth3\u0026#39; è‡³æ­¤ WAN-pppoe çš„é…ç½®å…¨éƒ¨ç»“æŸã€‚\nå¦‚æœå…¬ç½‘å£æ˜¯dhcpè·å–ï¼š(æ­¤å¤„æ˜¯å…‰çŒ«pppoeæ‹¨å·DHCPä¸‹å‘ä½¿ç”¨ï¼‰ set interfaces ethernet eth3 address dhcp ç°åœ¨åº”è¯¥å¯ä»¥ä¸Šç½‘äº†ï¼\nfakeipçš„æ”¯æŒ é€šè¿‡ MoS DNS æ¥åˆ†æµ Real IP å’Œ Fake IP çš„æµé‡ï¼Œå¯è¿™æ ·é…ç½®:\nå®šä¹‰ Telegram IPv4 ç»„\nset firewall group network-group Telegram-v4 network \u0026#39;91.108.56.0/22\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;91.108.4.0/22\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;91.108.8.0/22\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;91.108.16.0/22\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;91.108.12.0/22\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;149.154.160.0/20\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;91.105.192.0/23\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;91.108.20.0/22\u0026#39; set firewall group network-group Telegram-v4 network \u0026#39;185.76.151.0/24\u0026#39; å®šä¹‰ Telegram IPv6 ç»„\nset firewall group ipv6-network-group Telegram-v6 network \u0026#39;2001:b28:f23d::/48\u0026#39; set firewall group ipv6-network-group Telegram-v6 network \u0026#39;2001:b28:f23f::/48\u0026#39; set firewall group ipv6-network-group Telegram-v6 network \u0026#39;2001:67c:4e8::/48\u0026#39; set firewall group ipv6-network-group Telegram-v6 network \u0026#39;2001:b28:f23c::/48\u0026#39; set firewall group ipv6-network-group Telegram-v6 network \u0026#39;2a0a:f280::/32\u0026#39; å®šä¹‰ Fake IP ç»„\nset firewall group network-group FAKEIP-v4 network \u0026#39;198.18.0.0/15\u0026#39; # Fake IPv4 set firewall group ipv6-network-group FAKEIP-v6 network \u0026#39;f2b0::/18\u0026#39; # Fake IPv6 é…ç½®ç­–ç•¥è·¯ç”± (ç±»ä¼¼ RouterOS ä¸­çš„ Mangle è§„åˆ™)\nset policy route Route-to-SB interface br0 # br0 æ˜¯ LAN set policy route Route-to-SB rule 10 set table \u0026#39;100\u0026#39; # Table 100 æ˜¯ to-sb çš„è¡¨ set policy route Route-to-SB rule 10 destination group network-group \u0026#39;Telegram-v4\u0026#39; set policy route Route-to-SB rule 20 set table \u0026#39;100\u0026#39; set policy route Route-to-SB rule 20 destination group network-group \u0026#39;FAKEIP-v4\u0026#39; set policy route6 FAKE6-to-SB interface br0 set policy route6 FAKE6-to-SB rule 10 set table \u0026#39;106\u0026#39; # Table 106 æ˜¯ to-sb çš„è¡¨ (IPv6) set policy route6 FAKE6-to-SB rule 10 destination group network-group \u0026#39;FAKEIP-v6\u0026#39; set policy route6 FAKE6-to-SB rule 20 set table \u0026#39;106\u0026#39; set policy route6 FAKE6-to-SB rule 20 destination group network-group \u0026#39;Telegram-v6\u0026#39; é…ç½®è·¯ç”±è¡¨\nset protocols static table 100 route 0.0.0.0/0 next-hop 10.20.20.9 # sb çš„å†…ç½‘ IP set protocols static table 106 route6 ::/0 next-hop fd88::9999 # sb çš„ ULA IPV6 Nat ï¼ˆå¯¼å®Œæ”¯æŒipv6ä¼˜å…ˆï¼‰(æ³¨æ„ä¿®æ”¹è‡ªå·±çš„fakeip)\nset nat66 source rule 10 description \u0026#39;MASQ-FAKE6\u0026#39; set nat66 source rule 10 destination prefix \u0026#39;f2b0::/18\u0026#39; set nat66 source rule 10 translation address \u0026#39;masquerade\u0026#39; # set interfaces bridge br0 address \u0026#39;fd88::1111/64\u0026#39; #å¼€å§‹è®¾ç½®è¿‡å°±ä¸è¦å†è®¾ç½®äº† å®Œäº†ï¼okäº†ï¼\nå¯¹äº†ï¼Œåˆ«å¿˜äº†ï¼ŒæŠŠdnsçš„è®¾ç½®æ”¹ä¸ºï¼Œä½ æ‡‚çš„ï½ï¼Œä¸Šé¢DNSè®¾ç½®é‚£å—æœ‰å‘½ä»¤ï½å‡†å¤‡å¥½äº†ï½\né™„ï¼\nVyOS è‡ªå·±è¦ç§‘å­¦ä¸Šç½‘ ä¸€èˆ¬åœ¨ pull å®¹å™¨é•œåƒã€ä¸‹è½½æ›´æ–°æ—¶å¯ä»¥è¿™æ ·é…ç½®:\nset system name-server \u0026#39;172.23.0.99\u0026#39; # 172.23.0.99 æ˜¯ sb çš„ IP æˆ– MoS DNS çš„ IP or\nset system name-server \u0026#39;10.20.20.9\u0026#39; # 10.20.20.9 æ˜¯ sb çš„ IP æˆ– MoS DNS çš„ IP æ³¨æ„: name-server åªéœ€è¦ä¸€ä¸ªï¼Œç¡®ä¿èƒ½åŒºåˆ† Fake IPã€‚\nset policy local-route rule 10 destination address \u0026#39;198.18.0.0/15\u0026#39; set policy local-route rule 10 set table \u0026#39;100\u0026#39; #åªæƒ³è®© TCP æµé‡ ä½¿ç”¨ table 100ï¼Œè€Œ å…¶ä»–åè®®ï¼ˆå¦‚ UDPã€ICMPï¼‰ä»èµ°é»˜è®¤è·¯ç”±è¡¨(å¯é€‰ï¼‰ #set policy local-route rule 10 protocol \u0026#39;tcp\u0026#39; è¿™ä¸‰æ¡é…ç½®ä½œç”¨å¦‚ä¸‹ï¼š\nset policy local-route rule 10 destination address \u0026lsquo;198.18.0.0/15\u0026rsquo; â€¢ è¯¥è§„åˆ™åŒ¹é… ç›®çš„åœ°å€ åœ¨ 198.18.0.0/15 ç½‘æ®µå†…çš„æµé‡ã€‚\nset policy local-route rule 10 set table \u0026lsquo;100\u0026rsquo; â€¢ è®©åŒ¹é…è¯¥è§„åˆ™çš„æµé‡ä½¿ç”¨ è·¯ç”±è¡¨ 100 è¿›è¡Œè·¯ç”±æŸ¥æ‰¾ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„ mainï¼ˆ254ï¼‰è·¯ç”±è¡¨ã€‚\nset policy local-route rule 10 protocol \u0026rsquo;tcp' â€¢ é™åˆ¶è¯¥è§„åˆ™ä»…é€‚ç”¨äº TCP æµé‡ï¼Œå³ åªæœ‰ TCP åè®®çš„æ•°æ®åŒ…ä¼šåŒ¹é…æ­¤è§„åˆ™ã€‚\nç¬¬ä¸‰æ¡ï¼ˆprotocol \u0026rsquo;tcp\u0026rsquo;ï¼‰æ˜¯å¦å¿…è¦ï¼Ÿ\nâ€¢ å¦‚æœä½ çš„ç›®æ ‡æ˜¯ è®©æ‰€æœ‰å»å¾€ 198.18.0.0/15 çš„æµé‡ éƒ½ä½¿ç”¨ table 100ï¼Œé‚£ä¹ˆ ç¬¬ä¸‰æ¡æ˜¯ä¸å¿…è¦çš„ã€‚ â€¢ ä½†å¦‚æœä½  åªæƒ³è®© TCP æµé‡ ä½¿ç”¨ table 100ï¼Œè€Œ å…¶ä»–åè®®ï¼ˆå¦‚ UDPã€ICMPï¼‰ä»èµ°é»˜è®¤è·¯ç”±è¡¨ï¼Œé‚£ä¹ˆ ç¬¬ä¸‰æ¡æ˜¯æœ‰ç”¨çš„ã€‚\nå› æ­¤ï¼š å®Œæ•´æœ¬åœ°ç§‘å­¦çš„å‘½ä»¤:\nset system name-server \u0026#39;172.23.0.99\u0026#39; delete system name-server \u0026#39;223.5.5.5\u0026#39; delete system name-server \u0026#39;119.29.29.29\u0026#39; set policy local-route rule 10 destination address \u0026#39;198.18.0.0/15\u0026#39; set policy local-route rule 10 set table \u0026#39;100\u0026#39; or(æˆ–è€…ï¼‰ï¼ˆåªæ˜¯ipçš„åŒºåˆ«ï¼Œæ–¹ä¾¿å¤åˆ¶çš„ï¼Œä½ æ¢æˆä½ è‡ªå·±çš„ip)\nset system name-server \u0026#39;10.20.20.6\u0026#39; delete system name-server \u0026#39;223.5.5.5\u0026#39; delete system name-server \u0026#39;119.29.29.29\u0026#39; set policy local-route rule 10 destination address \u0026#39;198.18.0.0/15\u0026#39; set policy local-route rule 10 set table \u0026#39;100\u0026#39; é…ç½®wireguard: set interfaces wireguard wg0 address \u0026#39;10.20.20.1/24\u0026#39; set interfaces wireguard wg0 peer iphone allowed-ips \u0026#39;10.20.20.2/32\u0026#39; set interfaces wireguard wg0 peer iphone preshared-key \u0026#39;preshared-key\u0026#39; set interfaces wireguard wg0 peer iphone public-key \u0026#39;public-key\u0026#39; set interfaces wireguard wg0 port \u0026#39;11133\u0026#39; set interfaces wireguard wg0 private-key \u0026#39;private-key\u0026#39; å¦‚æœè®©wgç§‘å­¦ï¼Œä¸‹é¢æ¥ç€æ“ä½œï¼š\næ·»åŠ ç»„ï¼šï¼ˆè¾“å…¥å†…ç½‘IPæ®µï¼Œä¸Šé¢å¦‚æœè®¾ç½®è¿‡äº†å°±ä¸éœ€è¦é‡å¤è®¾ç½®ï¼Œè¿™é‡Œåªæ˜¯æ³¨æ˜è¿™å—éœ€è¦ï¼‰\nset firewall group network-group LAN-v4 network \u0026#39;10.20.20.0/24\u0026#39; è®¾ç½®ç­–ç•¥è·¯ç”±: ä¸¾ä¾‹: è®©wg0çš„æµé‡èµ°100å·è·¯ç”±è¡¨, 100å·è·¯ç”±è¡¨æ˜¯sbçš„è·¯ç”±è¡¨\nset policy route WG0-to-SB interface \u0026#39;wg0\u0026#39; set policy route WG0-to-SB rule 10 destination group network-group \u0026#39;!LAN-v4\u0026#39; set policy route WG0-to-SB rule 10 set table \u0026#39;100\u0026#39; #è·¯ç”±è¡¨ï¼ˆä¹‹å‰æ·»åŠ è¿‡å°±ä¸è¦é‡å¤æ·»åŠ ï¼‰(10.20.20.9æ˜¯æˆ‘sing-boxçš„ip)\nset protocols static table 100 route 0.0.0.0/0 next-hop 10.20.20.9 ##é…ç½®ddns: cloudflare ddns:\nset service dns dynamic name DDNS-CF-v4 address interface \u0026#39;pppoe1\u0026#39; set service dns dynamic name DDNS-CF-v4 host-name \u0026#39;ddns.example.com\u0026#39; set service dns dynamic name DDNS-CF-v4 ip-version \u0026#39;ipv4\u0026#39; set service dns dynamic name DDNS-CF-v4 password \u0026#39;token\u0026#39; set service dns dynamic name DDNS-CF-v4 protocol \u0026#39;cloudflare\u0026#39; set service dns dynamic name DDNS-CF-v4 zone \u0026#39;example.com\u0026#39; set service dns dynamic name DDNS-CF-v6 address interface \u0026#39;eth0\u0026#39; set service dns dynamic name DDNS-CF-v6 host-name \u0026#39;ddns6.example.com\u0026#39; set service dns dynamic name DDNS-CF-v6 ip-version \u0026#39;ipv6\u0026#39; set service dns dynamic name DDNS-CF-v6 password \u0026#39;token\u0026#39; set service dns dynamic name DDNS-CF-v6 protocol \u0026#39;cloudflare\u0026#39; set service dns dynamic name DDNS-CF-v6 zone \u0026#39;example.com\u0026#39; dnspod ddns:\nset service dns dynamic name DNSPOD-v4 address interface \u0026#39;pppoe1\u0026#39; set service dns dynamic name DNSPOD-v4 host-name \u0026#39;ddns.example.com\u0026#39; set service dns dynamic name DNSPOD-v4 password \u0026#39;token\u0026#39; set service dns dynamic name DNSPOD-v4 protocol \u0026#39;dyndns2\u0026#39; set service dns dynamic name DNSPOD-v4 server \u0026#39;dnsapi.cn\u0026#39; set service dns dynamic name DNSPOD-v4 username \u0026#39;id\u0026#39; ä¸ªäººä½¿ç”¨ä¸‹æ¥, ä¸Šè¿°é…ç½®å¹¶ä¸éœ€è¦è®¾ç½®interval, ipå˜åŒ–ä¹Ÿä¼šè‡ªåŠ¨æ›´æ–°.\næœ€åç»™ä¸ªå°å‘½ä»¤çŸ¥è¯†ç‚¹ï¼š ç¡®ä¿ NAT è§„åˆ™å®Œæ•´,æŸ¥çœ‹å‘½ä»¤ï¼Œå¦‚: æ£€æŸ¥è§„åˆ™\nshow configuration commands | match \u0026#39;nat destination\u0026#39; ç”¨showå‘½ä»¤çš„æ—¶å€™è¦æ³¨æ„ï¼Œåœ¨é…ç½®æ¨¡å¼#ä¸‹ï¼Œå¦‚çœ‹æŸ¥çœ‹æ¨¡å¼$ä¸‹çš„show,éœ€è¦åœ¨showå‰é¢åŠ ä¸ªrunå‘½ä»¤ã€‚ ç¥å›ä½¿ç”¨æ„‰å¿«ï½\n","permalink":"https://hanigege.github.io/posts/routers/vyos-qiaojie-4kou/","tags":null,"title":"vyoså¤šç½‘å£å°ä¸»æœºæ¡¥æ¥é…ç½®(å®Œæ•´)"},{"categories":null,"contents":"","permalink":"https://hanigege.github.io/search/","tags":null,"title":"æœç´¢"}]