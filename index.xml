<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>代码仓库 on bash</title><link>https://hanigege.github.io/</link><description>Recent content in 代码仓库 on bash</description><generator>Hugo</generator><language>zh-CN</language><copyright>© **mana**.</copyright><lastBuildDate>Fri, 27 Feb 2026 17:20:17 +0800</lastBuildDate><atom:link href="https://hanigege.github.io/index.xml" rel="self" type="application/rss+xml"/><item><title>05.RouterOS如何nat回流及包含配套防火墙规则</title><link>https://hanigege.github.io/posts/routers/05.routeros%E5%A6%82%E4%BD%95nat%E5%9B%9E%E6%B5%81/</link><pubDate>Fri, 27 Feb 2026 17:20:17 +0800</pubDate><guid>https://hanigege.github.io/posts/routers/05.routeros%E5%A6%82%E4%BD%95nat%E5%9B%9E%E6%B5%81/</guid><description>&lt;h2 id="内网的dst-nat要加外网接口如pppoe-out1"&gt;内网的dst-nat要加外网接口如pppoe-out1&lt;/h2&gt;
&lt;h2 id="1-为什么需要回流"&gt;1. 为什么需要回流？&lt;/h2&gt;
&lt;p&gt;当你从内网请求公网 IP 时，ROS 收到包后转发给内网服务器，但服务器发现请求方和自己在同一个网段，会直接把回包传给手机。手机发现自己发给公网 IP 的请求却收到了来自内网私有 IP 的响应，会因为安全机制直接丢弃该包。回流规则通过让 ROS 中转这个“回头包”来解决这个问题。&lt;/p&gt;
&lt;h2 id="2-完整的-ros-nat-脚本包含-web-回流"&gt;2. 完整的 ROS NAT 脚本（包含 Web 回流）&lt;/h2&gt;
&lt;h4 id="请根据你的实际端口修改-12335-web-和-21-ftp-等"&gt;请根据你的实际端口修改 12335 (Web) 和 21 (FTP) 等。&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall nat
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;# --- 基础规则 ---
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;# 1. 核心上网伪装（必须限制在 WAN 口，防止干扰其他转发）
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;add chain=srcnat action=masquerade out-interface=pppoe-out1 comment=&amp;#34;Standard Internet Access&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;# --- 端口转发 (DST-NAT) ---
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;# 2. DERP 转发
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;add chain=dstnat protocol=tcp dst-port=12340 action=dst-nat to-addresses=10.20.20.4 to-ports=12340 comment=&amp;#34;DERP TCP&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;add chain=dstnat protocol=udp dst-port=3478 action=dst-nat to-addresses=10.20.20.4 to-ports=3478 comment=&amp;#34;DERP STUN&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;# 3. Web 服务转发 (示例)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;add chain=dstnat protocol=tcp dst-port=12335 action=dst-nat to-addresses=10.20.20.x to-ports=12335 comment=&amp;#34;web&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;# 4. FTP 服务转发 (示例)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;add chain=dstnat protocol=tcp dst-port=21 action=dst-nat to-addresses=10.20.20.x to-ports=21 comment=&amp;#34;vsftpd&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;# --- 回流规则 (Hairpin NAT) ---
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;# 只有当内网访问内网服务器时才触发。建议将所有内网服务器放在一个规则里，或者逐个添加。
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;# 给 DERP 添加回流
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;add chain=srcnat src-address=10.20.20.0/24 dst-address=10.20.20.4 protocol=tcp dst-port=12340 action=masquerade comment=&amp;#34;Hairpin DERP TCP&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;add chain=srcnat src-address=10.20.20.0/24 dst-address=10.20.20.4 protocol=udp dst-port=3478 action=masquerade comment=&amp;#34;Hairpin DERP STUN&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;# 给 Web 服务添加回流 (假设内网 IP 为 10.20.20.5)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;add chain=srcnat src-address=10.20.20.0/24 dst-address=10.20.20.5 protocol=tcp dst-port=12335 action=masquerade comment=&amp;#34;Hairpin Web&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="3-操作建议使用地址列表简化回流"&gt;3. 操作建议：使用“地址列表”简化回流&lt;/h2&gt;
&lt;p&gt;如果你有很多内网服务器需要回流，一条条加 srcnat 很麻烦。你可以这样做：&lt;/p&gt;</description></item><item><title>04.RouterOS使用queue_tree配置流量整形</title><link>https://hanigege.github.io/posts/routers/04.routeros%E4%BD%BF%E7%94%A8queue_tree%E9%85%8D%E7%BD%AE%E6%B5%81%E9%87%8F%E6%95%B4%E5%BD%A2/</link><pubDate>Fri, 27 Feb 2026 16:59:27 +0800</pubDate><guid>https://hanigege.github.io/posts/routers/04.routeros%E4%BD%BF%E7%94%A8queue_tree%E9%85%8D%E7%BD%AE%E6%B5%81%E9%87%8F%E6%95%B4%E5%BD%A2/</guid><description>&lt;h1 id="本教程介绍使用-queue-tree-开启-ros-的流控功能"&gt;本教程介绍使用 queue tree 开启 ROS 的流控功能&lt;/h1&gt;
&lt;p&gt;本教程介绍如何使用 RouterOS 的 &lt;code&gt;queue tree&lt;/code&gt; 实现流量整形。
文章分成两种方案：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;为 DNS、Web 等小包流量设置更高优先级&lt;/strong&gt;，提高网页响应速度，适合一般用户；&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;为宽带及特定服务设定上传/下载限速，并按服务设定优先级&lt;/strong&gt;，适合 BT/PT 等大流量应用用户。&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2 id="1为-dnsweb-等小包流量设置更高优先级提高网页响应速度适合一般用户使用"&gt;1、为 DNS、Web 等小包流量设置更高优先级，提高网页响应速度，适合一般用户使用。&lt;/h2&gt;
&lt;h3 id="添加queue-type"&gt;添加queue type&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/queue type add fq-codel-flows&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;128&lt;/span&gt; fq-codel-interval&lt;span style="color:#f92672"&gt;=&lt;/span&gt;30ms fq-codel-limit&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;128&lt;/span&gt; fq-codel-memlimit&lt;span style="color:#f92672"&gt;=&lt;/span&gt;4096.0KiB fq-codel-quantum&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;512&lt;/span&gt; fq-codel-target&lt;span style="color:#f92672"&gt;=&lt;/span&gt;3ms kind&lt;span style="color:#f92672"&gt;=&lt;/span&gt;fq-codel name&lt;span style="color:#f92672"&gt;=&lt;/span&gt;Fq_Codel_Dns_Up
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/queue type add fq-codel-flows&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;256&lt;/span&gt; fq-codel-interval&lt;span style="color:#f92672"&gt;=&lt;/span&gt;30ms fq-codel-limit&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;128&lt;/span&gt; fq-codel-memlimit&lt;span style="color:#f92672"&gt;=&lt;/span&gt;8.0MiB fq-codel-quantum&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;512&lt;/span&gt; fq-codel-target&lt;span style="color:#f92672"&gt;=&lt;/span&gt;3ms kind&lt;span style="color:#f92672"&gt;=&lt;/span&gt;fq-codel name&lt;span style="color:#f92672"&gt;=&lt;/span&gt;Fq_Codel_Dns_Down
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/queue type add fq-codel-flows&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;512&lt;/span&gt; fq-codel-interval&lt;span style="color:#f92672"&gt;=&lt;/span&gt;50ms fq-codel-limit&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;512&lt;/span&gt; fq-codel-memlimit&lt;span style="color:#f92672"&gt;=&lt;/span&gt;8.0MiB fq-codel-quantum&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;512&lt;/span&gt; fq-codel-target&lt;span style="color:#f92672"&gt;=&lt;/span&gt;5ms kind&lt;span style="color:#f92672"&gt;=&lt;/span&gt;fq-codel name&lt;span style="color:#f92672"&gt;=&lt;/span&gt;Fq_Codel_Small_Up
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/queue type add fq-codel-flows&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;512&lt;/span&gt; fq-codel-interval&lt;span style="color:#f92672"&gt;=&lt;/span&gt;50ms fq-codel-limit&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;512&lt;/span&gt; fq-codel-memlimit&lt;span style="color:#f92672"&gt;=&lt;/span&gt;16.0MiB fq-codel-quantum&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;512&lt;/span&gt; fq-codel-target&lt;span style="color:#f92672"&gt;=&lt;/span&gt;5ms kind&lt;span style="color:#f92672"&gt;=&lt;/span&gt;fq-codel name&lt;span style="color:#f92672"&gt;=&lt;/span&gt;Fq_Codel_Small_Down
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/queue type add fq-codel-flows&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;512&lt;/span&gt; fq-codel-interval&lt;span style="color:#f92672"&gt;=&lt;/span&gt;50ms fq-codel-limit&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;2048&lt;/span&gt; fq-codel-memlimit&lt;span style="color:#f92672"&gt;=&lt;/span&gt;64.0MiB fq-codel-quantum&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1400&lt;/span&gt; fq-codel-target&lt;span style="color:#f92672"&gt;=&lt;/span&gt;5ms kind&lt;span style="color:#f92672"&gt;=&lt;/span&gt;fq-codel name&lt;span style="color:#f92672"&gt;=&lt;/span&gt;Fq_Codel_Web_Up
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/queue type add fq-codel-flows&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1024&lt;/span&gt; fq-codel-interval&lt;span style="color:#f92672"&gt;=&lt;/span&gt;50ms fq-codel-limit&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;4096&lt;/span&gt; fq-codel-memlimit&lt;span style="color:#f92672"&gt;=&lt;/span&gt;128.0MiB fq-codel-quantum&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1500&lt;/span&gt; fq-codel-target&lt;span style="color:#f92672"&gt;=&lt;/span&gt;5ms kind&lt;span style="color:#f92672"&gt;=&lt;/span&gt;fq-codel name&lt;span style="color:#f92672"&gt;=&lt;/span&gt;Fq_Codel_Web_Down
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/queue type add fq-codel-flows&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1024&lt;/span&gt; fq-codel-interval&lt;span style="color:#f92672"&gt;=&lt;/span&gt;100ms fq-codel-limit&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;8192&lt;/span&gt; fq-codel-memlimit&lt;span style="color:#f92672"&gt;=&lt;/span&gt;128.0MiB fq-codel-quantum&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1400&lt;/span&gt; fq-codel-target&lt;span style="color:#f92672"&gt;=&lt;/span&gt;8ms kind&lt;span style="color:#f92672"&gt;=&lt;/span&gt;fq-codel name&lt;span style="color:#f92672"&gt;=&lt;/span&gt;Fq_Codel_Stream_Up
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/queue type add fq-codel-flows&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;2048&lt;/span&gt; fq-codel-interval&lt;span style="color:#f92672"&gt;=&lt;/span&gt;100ms fq-codel-limit&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;10240&lt;/span&gt; fq-codel-memlimit&lt;span style="color:#f92672"&gt;=&lt;/span&gt;256.0MiB fq-codel-quantum&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1500&lt;/span&gt; fq-codel-target&lt;span style="color:#f92672"&gt;=&lt;/span&gt;8ms kind&lt;span style="color:#f92672"&gt;=&lt;/span&gt;fq-codel name&lt;span style="color:#f92672"&gt;=&lt;/span&gt;Fq_Codel_Stream_Down
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/queue type add fq-codel-flows&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;2048&lt;/span&gt; fq-codel-interval&lt;span style="color:#f92672"&gt;=&lt;/span&gt;100ms fq-codel-limit&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;10240&lt;/span&gt; fq-codel-memlimit&lt;span style="color:#f92672"&gt;=&lt;/span&gt;128.0MiB fq-codel-quantum&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1400&lt;/span&gt; fq-codel-target&lt;span style="color:#f92672"&gt;=&lt;/span&gt;20ms kind&lt;span style="color:#f92672"&gt;=&lt;/span&gt;fq-codel name&lt;span style="color:#f92672"&gt;=&lt;/span&gt;Fq_Codel_Nomark_Up
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/queue type add fq-codel-flows&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;4096&lt;/span&gt; fq-codel-interval&lt;span style="color:#f92672"&gt;=&lt;/span&gt;100ms fq-codel-limit&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;10240&lt;/span&gt; fq-codel-memlimit&lt;span style="color:#f92672"&gt;=&lt;/span&gt;256.0MiB fq-codel-quantum&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1500&lt;/span&gt; fq-codel-target&lt;span style="color:#f92672"&gt;=&lt;/span&gt;15ms kind&lt;span style="color:#f92672"&gt;=&lt;/span&gt;fq-codel name&lt;span style="color:#f92672"&gt;=&lt;/span&gt;Fq_Codel_Nomark_Down
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="配置-queue-tree"&gt;配置 queue tree&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;自行修改桥的名称（bridge1）及pppoe拨号口（pppoe-out1）的名称&lt;/p&gt;</description></item><item><title>03.RouterOS配置FakeIP</title><link>https://hanigege.github.io/posts/routers/03.routeros%E9%85%8D%E7%BD%AEfakeip/</link><pubDate>Fri, 27 Feb 2026 16:41:22 +0800</pubDate><guid>https://hanigege.github.io/posts/routers/03.routeros%E9%85%8D%E7%BD%AEfakeip/</guid><description>&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-markdown" data-lang="markdown"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;本文介绍使用 FakeIP 分流法实现局域网内设备透明代理时，主路由 RouterOS 部分的设置。
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;注意：sing-box 及 mosdns 的具体配置不在本文讨论范围内。
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;作者：Tom
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="环境设定"&gt;环境设定&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;sing-box IP&lt;/strong&gt;: IPv4 &lt;code&gt;10.0.0.2&lt;/code&gt;, IPv6 &lt;code&gt;dc00::2222&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;FakeIP 网段&lt;/strong&gt;: IPv4 &lt;code&gt;28.0.0.0/8&lt;/code&gt;, IPv6 &lt;code&gt;f2b0::/18&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;注意&lt;/strong&gt;: 开启 FastTrack 后 Mangle 会失效，建议使用 Route 或 Routing Rules 方式。&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="方案-1使用-mangle-打标签方式"&gt;方案 1：使用 Mangle 打标签方式&lt;/h2&gt;
&lt;h3 id="ipv4-部分"&gt;IPv4 部分&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;添加sing-box-v4路由表&lt;/strong&gt;：&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; /routing table add name=sing-box-v4 fib
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start="2"&gt;
&lt;li&gt;&lt;strong&gt;配置地址列表&lt;/strong&gt;（地址列表中新增proxy_ipv4列表，填入fakeip网段、tg v4网段、奈菲v4网段）：&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=28.0.0.0/8
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=1.1.1.1/32
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=1.0.0.1/32
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=8.8.8.8/32
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=8.8.4.4/32
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=8.41.4.0/24
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=23.23.189.144/28
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=23.246.0.0/18
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=34.195.253.0/25
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=37.77.184.0/21
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=38.72.126.0/24
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=45.57.0.0/17
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=52.24.178.0/24
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=52.35.140.0/24
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=54.204.25.0/28
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=54.213.167.0/24
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=64.120.128.0/17
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=66.197.128.0/17
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=69.53.224.0/19
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=103.87.204.0/22
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=108.175.32.0/20
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=185.2.220.0/22
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=185.9.188.0/22
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=192.173.64.0/18
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=198.38.96.0/19
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=198.45.48.0/20
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=203.75.84.0/24
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=203.198.13.0/24
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=203.198.80.0/24
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=207.45.72.0/22
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=208.75.76.0/22
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=210.0.153.0/24
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=91.108.56.0/22
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=91.108.4.0/22
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=91.108.8.0/22
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=91.108.16.0/22
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=91.108.12.0/22
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=149.154.160.0/20
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=91.105.192.0/23
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=91.108.20.0/22
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=185.76.151.0/24
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall address-list add list=proxy_ipv4 address=95.161.64.0/20
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start="3"&gt;
&lt;li&gt;&lt;strong&gt;为目的ip为proxy_ipv4地址列表的连接打上“sing-box-v4”标记&lt;/strong&gt;：&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip firewall mangle add action=mark-routing chain=prerouting dst-address-list=proxy_ipv4 new-routing-mark=sing-box-v4 passthrough=yes
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start="4"&gt;
&lt;li&gt;&lt;strong&gt;设置路由表sing-box-v4的下一跳网关为sing-box&lt;/strong&gt;：&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip route add dst-address=0.0.0.0/0 gateway=10.0.0.2 routing-table=sing-box-v4
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="ipv6-部分"&gt;IPv6 部分&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;添加sing-box-v6路由表&lt;/strong&gt;：&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/routing table add name=sing-box-v6 fib
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start="2"&gt;
&lt;li&gt;&lt;strong&gt;地址列表添加添加fakev6及tg v6网段&lt;/strong&gt;：&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ipv6 firewall address-list add address=f2b0::/18 list=proxy_ipv6
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ipv6 firewall address-list add address=2001:b28:f23d::/48 list=proxy_ipv6
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ipv6 firewall address-list add address=2001:b28:f23f::/48 list=proxy_ipv6
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ipv6 firewall address-list add address=2001:67c:4e8::/48 list=proxy_ipv6
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ipv6 firewall address-list add address=2001:b28:f23c::/48 list=proxy_ipv6
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ipv6 firewall address-list add address=2a0a:f280::/32 list=proxy_ipv6
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start="3"&gt;
&lt;li&gt;&lt;strong&gt;为目的ip为proxy_ipv6的连接打标记&lt;/strong&gt;：&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ipv6 firewall mangle add action=mark-routing chain=prerouting dst-address-list=proxy_ipv6 new-routing-mark=sing-box-v6
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;设置路由表sing-box-v6的下一跳网关为sing-box。注意gateway为sing-box的IPv6&lt;/strong&gt;：&lt;/p&gt;</description></item><item><title>02.RouterOS开启IPv6并配置防火墙</title><link>https://hanigege.github.io/posts/routers/02.routeros%E5%BC%80%E5%90%AFipv6%E5%B9%B6%E9%85%8D%E7%BD%AE%E9%98%B2%E7%81%AB%E5%A2%99/</link><pubDate>Fri, 27 Feb 2026 16:32:31 +0800</pubDate><guid>https://hanigege.github.io/posts/routers/02.routeros%E5%BC%80%E5%90%AFipv6%E5%B9%B6%E9%85%8D%E7%BD%AE%E9%98%B2%E7%81%AB%E5%A2%99/</guid><description>&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-markdown" data-lang="markdown"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;本文介绍 RouterOS 如何开启 IPv6。以 &lt;span style="font-weight:bold"&gt;**NAT6**&lt;/span&gt; 模式为例，IPv6 内网网段默认为
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;`dc00::/64`&lt;/span&gt;，RouterOS &lt;span style="color:#e6db74"&gt;`bridge1`&lt;/span&gt; 的 IPv6 内网地址为 &lt;span style="color:#e6db74"&gt;`dc00::1111/64`&lt;/span&gt;。
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; 桥接接口 &lt;span style="color:#e6db74"&gt;`bridge1`&lt;/span&gt;、拨号接口 &lt;span style="color:#e6db74"&gt;`pppoe-out1`&lt;/span&gt; 名称若不同则自行替换。
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; 作者：Tom
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="1-开启-ipv6-模块"&gt;1. 开启 IPv6 模块&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ipv6 settings set disable-ipv6=no
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="2-获取-ipv6-前缀-prefix"&gt;2. 获取 IPv6 前缀 (Prefix)&lt;/h2&gt;
&lt;p&gt;从运营商处获取 IPv6 PD：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ipv6 dhcp-client add interface=pppoe-out1 pool-name=dhcpv6-gua-pool1 pool-prefix-length=60 request=prefix
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="3-添加局域网-ula-地址池"&gt;3. 添加局域网 ULA 地址池&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ipv6 pool add name=dhcpv6-ula-pool1 prefix=dc00::/64 prefix-length=64
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="4-配置接口地址"&gt;4. 配置接口地址&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;计算 EUI-64 地址&lt;/strong&gt;：可使用 &lt;a href="https://eui64-calc.princelle.org/"&gt;EUI-64 计算器&lt;/a&gt;，或直接使用 &lt;code&gt;::1&lt;/code&gt;,或使用上面计算得到的后缀（例如::BF24:12FF:FEE1:E81B）配置pppoe-out1的GUA地址&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;配置 PPPoE 接口 GUA 地址&lt;/strong&gt;：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ipv6 address add address=::BF24:12FF:FEE1:E81B/64 from-pool=dhcpv6-gua-pool1 interface=pppoe-out1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;配置 Bridge 接口 ULA 地址，默认dc00::1111（可自行修改）&lt;/strong&gt;：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ipv6 address add address=dc00::1111/64 from-pool=dhcpv6-ula-pool1 interface=bridge1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="5-开启-nat6-源地址伪装"&gt;5. 开启 NAT6 (源地址伪装)&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ipv6 firewall nat add action=masquerade chain=srcnat src-address=dc00::/64
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="6-配置邻居发现-nd"&gt;6. 配置邻居发现 (ND)&lt;/h2&gt;
&lt;p&gt;禁用默认 ND 配置，并新建配置。建议不广播 IPv6 DNS。&lt;/p&gt;</description></item><item><title>01.RouterOS联网基本配置及IPv4防火墙</title><link>https://hanigege.github.io/posts/routers/01.routeros%E8%81%94%E7%BD%91%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%E5%8F%8Aipv4%E9%98%B2%E7%81%AB%E5%A2%99/</link><pubDate>Fri, 27 Feb 2026 16:19:29 +0800</pubDate><guid>https://hanigege.github.io/posts/routers/01.routeros%E8%81%94%E7%BD%91%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%E5%8F%8Aipv4%E9%98%B2%E7%81%AB%E5%A2%99/</guid><description>&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-markdown" data-lang="markdown"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;本文介绍 RouterOS 拨号、配置 DHCP 服务器、配置 DNS、开启 IPv4 防火墙等通网的基础配置。
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;桥接接口 &lt;span style="color:#e6db74"&gt;`bridge1`&lt;/span&gt;、拨号接口 &lt;span style="color:#e6db74"&gt;`pppoe-out1`&lt;/span&gt; 名称若不同则自行替换。
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;作者：Tom
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="1-pppoe-拨号配置"&gt;1. PPPoE 拨号配置&lt;/h2&gt;
&lt;p&gt;手动配置 &lt;code&gt;pppoe-out1&lt;/code&gt; 接口拨号：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;User&lt;/strong&gt;: 填入宽带账号&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Password&lt;/strong&gt;: 填入宽带密码&lt;/li&gt;
&lt;li&gt;如果不使用运营商提供的 DNS，可不勾选 &lt;strong&gt;Use Peer DNS&lt;/strong&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src="assets/0.png" alt="0"&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;注&lt;/strong&gt;：接口前出现 “R” 代表拨号成功。拨号成功后建议先禁用，待防火墙配置完毕后再开启！
&lt;img src="assets/2.png" alt="2"&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="2-配置-dhcp-服务器"&gt;2. 配置 DHCP 服务器&lt;/h2&gt;
&lt;p&gt;DHCP IP 范围为 &lt;code&gt;10.0.0.100-10.0.0.250&lt;/code&gt;，网关和 DNS 默认为 ROS。如果希望全局配置透明代理，&lt;code&gt;dns-server&lt;/code&gt; 可配置为 mosdns。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip pool add name=dhcpv4-pool1 ranges=10.0.0.100-10.0.0.250
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip dhcp-server add name=dhcpv4-server1 interface=bridge1 address-pool=dhcpv4-pool1 lease-time=1d
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip dhcp-server network add address=10.0.0.0/24 gateway=10.0.0.1 dns-server=10.0.0.1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src="assets/3.png" alt="3"&gt;
&lt;img src="assets/4.png" alt="4"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="assets/5.png" alt="5"&gt;&lt;/p&gt;
&lt;h2 id="3-配置-dns"&gt;3. 配置 DNS&lt;/h2&gt;
&lt;p&gt;设置 ROS 的上游 DNS，此处先设置 &lt;code&gt;223.5.5.5&lt;/code&gt;，也可自定义填入运营商分配的 DNS。&lt;/p&gt;</description></item><item><title>00.RouterOS初始化及基础配置</title><link>https://hanigege.github.io/posts/routers/00.routeros%E5%88%9D%E5%A7%8B%E5%8C%96%E5%8F%8A%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/</link><pubDate>Fri, 27 Feb 2026 15:52:26 +0800</pubDate><guid>https://hanigege.github.io/posts/routers/00.routeros%E5%88%9D%E5%A7%8B%E5%8C%96%E5%8F%8A%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/</guid><description>&lt;hr&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-markdown" data-lang="markdown"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;# 00.RouterOS 初始化及基础配置
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;作者：Tom
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="第一次进入-routeros"&gt;第一次进入 RouterOS&lt;/h2&gt;
&lt;p&gt;先恢复原厂设置，使用 &lt;strong&gt;Winbox&lt;/strong&gt; 登录（通过 MAC 地址访问后台配置）。&lt;br&gt;
建议先配置防火墙，再开启 PPPoE 接口设置帐号密码联网：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/system reset-configuration
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="确认接口并修改名称"&gt;确认接口并修改名称&lt;/h2&gt;
&lt;p&gt;确认网口功能（区分 lan、wan），并重命名为方便后续操作：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/interface set ether1 name&lt;span style="color:#f92672"&gt;=&lt;/span&gt;lan
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/interface set ether2 name&lt;span style="color:#f92672"&gt;=&lt;/span&gt;wan
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src="assets/0.png" alt="图例"&gt;&lt;/p&gt;
&lt;h2 id="建立网桥bridge"&gt;建立网桥（Bridge）&lt;/h2&gt;
&lt;p&gt;将所有 LAN 接口添加进桥（bridge）：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/interface bridge add name&lt;span style="color:#f92672"&gt;=&lt;/span&gt;bridge1
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/interface bridge port add bridge&lt;span style="color:#f92672"&gt;=&lt;/span&gt;bridge1 interface&lt;span style="color:#f92672"&gt;=&lt;/span&gt;lan
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src="assets/1.png" alt="1"&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;注：如果双网口，可不建bridge，直接使用lan口，并接入物理交换机。但为方便管理
并为后期vlan等虚拟接口并入bridge做准备，建议建立bridge。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="为-bridge1-和-wan-设置-ip"&gt;为 bridge1 和 wan 设置 IP&lt;/h2&gt;
&lt;p&gt;为bridge1设置IP。本教程以bridge1为例，即ros本机ip为10.0.0.1/24
：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip address add interface&lt;span style="color:#f92672"&gt;=&lt;/span&gt;bridge1 address&lt;span style="color:#f92672"&gt;=&lt;/span&gt;10.0.0.1/24 network&lt;span style="color:#f92672"&gt;=&lt;/span&gt;10.0.0.0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src="assets/2.png" alt="2"&gt;&lt;/p&gt;
&lt;h2 id="设置时区与-ntp-服务器"&gt;设置时区与 NTP 服务器&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/system clock set time-zone-name&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;Asia/Shanghai&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/system clock manual set time-zone&lt;span style="color:#f92672"&gt;=&lt;/span&gt;+08:00
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/system ntp client set enabled&lt;span style="color:#f92672"&gt;=&lt;/span&gt;yes servers&lt;span style="color:#f92672"&gt;=&lt;/span&gt;cn.pool.ntp.org,ntp1.aliyun.com,time1.cloud.tencent.com
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="关闭所有不需要的服务及端口更改winbox登陆端口为5391可自定义并开启仅允许内网访问注意下方address1000024修改为自己的内网网段"&gt;关闭所有不需要的服务及端口，更改Winbox登陆端口为5391（可自定义），并开启仅允许内网访问，注意下方address=10.0.0.0/24修改为自己的内网网段&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip smb set enabled&lt;span style="color:#f92672"&gt;=&lt;/span&gt;no
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip smb shares disable numbers&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip ssh set forwarding-enabled&lt;span style="color:#f92672"&gt;=&lt;/span&gt;no
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip socks set enabled&lt;span style="color:#f92672"&gt;=&lt;/span&gt;no
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip upnp set enabled&lt;span style="color:#f92672"&gt;=&lt;/span&gt;no
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip proxy set enabled&lt;span style="color:#f92672"&gt;=&lt;/span&gt;no
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip service disable api
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip service disable api-ssl
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip service disable ftp
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip service disable ssh
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip service disable telnet
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip service disable www
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip service disable www-ssl
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ip service set winbox port&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;5391&lt;/span&gt; address&lt;span style="color:#f92672"&gt;=&lt;/span&gt;10.0.0.0/24
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/tool bandwidth-server set enabled&lt;span style="color:#f92672"&gt;=&lt;/span&gt;no
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="创建管理员帐号并禁用默认账号"&gt;创建管理员帐号并禁用默认账号&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/user add name&lt;span style="color:#f92672"&gt;=&lt;/span&gt;用户名 password&lt;span style="color:#f92672"&gt;=&lt;/span&gt;密码 group&lt;span style="color:#f92672"&gt;=&lt;/span&gt;full address&lt;span style="color:#f92672"&gt;=&lt;/span&gt;10.0.0.0/24
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="禁用默认账户"&gt;禁用默认账户&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/user disable admin
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;注意：请先确认新创建的用户名和密码可以正常登录，再禁用默认管理员帐号。&lt;/p&gt;</description></item><item><title>2026版Ubuntu&amp;Debian下iptables+mss防火墙管理一键脚本</title><link>https://hanigege.github.io/posts/linux/ubuntu2026iptables+mss%E9%98%B2%E7%81%AB%E5%A2%99%E7%AE%A1%E7%90%86%E4%B8%80%E9%94%AE%E8%84%9A%E6%9C%AC/</link><pubDate>Fri, 27 Feb 2026 14:27:51 +0800</pubDate><guid>https://hanigege.github.io/posts/linux/ubuntu2026iptables+mss%E9%98%B2%E7%81%AB%E5%A2%99%E7%AE%A1%E7%90%86%E4%B8%80%E9%94%AE%E8%84%9A%E6%9C%AC/</guid><description>&lt;h3 id="说明支持ipv4ipv6自动检测有无ipv6添加mss自动检测ssh端口等很方便"&gt;说明：支持ipv4&amp;amp;ipv6,自动检测有无ipv6，添加mss.自动检测ssh端口等，很方便&lt;/h3&gt;
&lt;h2 id="成功的步骤与方法"&gt;成功的步骤与方法&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;nano iptables_manager.sh
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="直接复制并执行以下完整代码覆盖原脚本"&gt;直接复制并执行以下完整代码覆盖原脚本：&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cat &lt;span style="color:#e6db74"&gt;&amp;lt;&amp;lt; &amp;#39;EOF&amp;#39; &amp;gt; iptables_manager.sh
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;#!/bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;# ==========================================================
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;# 脚本名称：高级防火墙管理工具 (Debian/Ubuntu 专属自适应版 V4.1)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;# 核心升级：基于软件和内核模块的深度智能检测，消除冗余规则
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;# ==========================================================
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;gl_lv=&amp;#39;\033[32m&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;gl_huang=&amp;#39;\033[33m&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;gl_hong=&amp;#39;\033[31m&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;gl_bai=&amp;#39;\033[0m&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;root_use() {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; [ &amp;#34;$EUID&amp;#34; -ne 0 ] &amp;amp;&amp;amp; echo -e &amp;#34;${gl_huang}提示: ${gl_bai}需 root 权限运行！&amp;#34; &amp;amp;&amp;amp; exit 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;check_deps() {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; if ! dpkg -l | grep -qw iptables-persistent; then
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo -e &amp;#34;${gl_huang}检测到未安装持久化组件，正在自动安装...${gl_bai}&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; apt-get update
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; DEBIAN_FRONTEND=noninteractive apt-get install -y iptables iptables-persistent netfilter-persistent
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo -e &amp;#34;${gl_lv}依赖安装完成！${gl_bai}&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; sleep 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; fi
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;root_use
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;check_deps
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;if command -v ip6tables &amp;gt;/dev/null 2&amp;gt;&amp;amp;1 &amp;amp;&amp;amp; ip addr 2&amp;gt;/dev/null | grep -q &amp;#34;inet6 .* global&amp;#34;; then
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; CMDS=&amp;#34;iptables ip6tables&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; HAS_IPV6=true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;else
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; CMDS=&amp;#34;iptables&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; HAS_IPV6=false
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;fi
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;save_rules() {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo -e &amp;#34;${gl_huang}正在持久化规则...${gl_bai}&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; mkdir -p /etc/iptables
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; netfilter-persistent save &amp;gt;/dev/null 2&amp;gt;&amp;amp;1 || {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; iptables-save &amp;gt; /etc/iptables/rules.v4
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; [ &amp;#34;$HAS_IPV6&amp;#34; == true ] &amp;amp;&amp;amp; ip6tables-save &amp;gt; /etc/iptables/rules.v6
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo -e &amp;#34;${gl_lv}规则保存成功。${gl_bai}&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;get_ssh_port() {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; local port=$(grep -i &amp;#34;^Port&amp;#34; /etc/ssh/sshd_config 2&amp;gt;/dev/null | awk &amp;#39;{print $2}&amp;#39; | head -n 1)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; [ -z &amp;#34;$port&amp;#34; ] &amp;amp;&amp;amp; port=22
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo &amp;#34;$port&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;view_rules() {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; for cmd in $CMDS; do
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo -e &amp;#34;\n${gl_lv}=== $cmd filter 表状态 ===${gl_bai}&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -L INPUT -n -v --line-numbers
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo -e &amp;#34;${gl_huang}--- FORWARD 转发状态 ---${gl_bai}&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -L FORWARD -n -v --line-numbers
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo -e &amp;#34;${gl_huang}--- MSS 钳制状态 (mangle 表) ---${gl_bai}&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -t mangle -L FORWARD -n -v --line-numbers
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; done
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; read -p &amp;#34;按回车继续...&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;allow_port_flexible() {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; read -e -p &amp;#34;请输入要放行的端口号: &amp;#34; port
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; [ -z &amp;#34;$port&amp;#34; ] &amp;amp;&amp;amp; return
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo -e &amp;#34;1. TCP 2. UDP 3. 同时放行&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; read -p &amp;#34;选择 (1-3): &amp;#34; p_choice
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; for cmd in $CMDS; do
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; case $p_choice in
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; 1) $cmd -I INPUT 4 -p tcp --dport &amp;#34;$port&amp;#34; -j ACCEPT ;;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; 2) $cmd -I INPUT 4 -p udp --dport &amp;#34;$port&amp;#34; -j ACCEPT ;;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; 3) 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -I INPUT 4 -p tcp --dport &amp;#34;$port&amp;#34; -j ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -I INPUT 4 -p udp --dport &amp;#34;$port&amp;#34; -j ACCEPT 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; ;;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; esac
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; done
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; save_rules
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;block_ip() {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; read -e -p &amp;#34;输入要屏蔽的 IP: &amp;#34; tip
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; [ -z &amp;#34;$tip&amp;#34; ] &amp;amp;&amp;amp; return
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; if [[ &amp;#34;$tip&amp;#34; == *&amp;#34;:&amp;#34;* ]]; then
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; if [ &amp;#34;$HAS_IPV6&amp;#34; == true ]; then
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; ip6tables -I INPUT 1 -s &amp;#34;$tip&amp;#34; -j DROP
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; else
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo -e &amp;#34;${gl_hong}系统未开启 IPv6，无法添加该规则。${gl_bai}&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; sleep 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; return
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; fi
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; else
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; iptables -I INPUT 1 -s &amp;#34;$tip&amp;#34; -j DROP
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; fi
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; save_rules
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;delete_rule() {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo -e &amp;#34;1. IPv4 (iptables)&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; [ &amp;#34;$HAS_IPV6&amp;#34; == true ] &amp;amp;&amp;amp; echo &amp;#34;2. IPv6 (ip6tables)&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; read -p &amp;#34;选择协议: &amp;#34; p_choice
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; local cmd=&amp;#34;iptables&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; if [ &amp;#34;$p_choice&amp;#34; == &amp;#34;2&amp;#34; ] &amp;amp;&amp;amp; [ &amp;#34;$HAS_IPV6&amp;#34; == true ]; then
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; cmd=&amp;#34;ip6tables&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; elif [ &amp;#34;$p_choice&amp;#34; == &amp;#34;2&amp;#34; ]; then
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo -e &amp;#34;${gl_hong}系统不支持 IPv6。${gl_bai}&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; sleep 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; return
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; fi
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -L INPUT -n --line-numbers
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; read -p &amp;#34;输入要删除的 filter/INPUT 规则编号: &amp;#34; num
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; [ -n &amp;#34;$num&amp;#34; ] &amp;amp;&amp;amp; $cmd -D INPUT &amp;#34;$num&amp;#34; &amp;amp;&amp;amp; save_rules
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;close_all_but_ssh() {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; local ssh_p=$(get_ssh_port)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo -e &amp;#34;${gl_huang}开始执行自适应深度加固...${gl_bai}&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; sysctl -w net.ipv4.ip_forward=1 &amp;gt;/dev/null 2&amp;gt;&amp;amp;1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; [ &amp;#34;$HAS_IPV6&amp;#34; == true ] &amp;amp;&amp;amp; sysctl -w net.ipv6.conf.all.forwarding=1 &amp;gt;/dev/null 2&amp;gt;&amp;amp;1 || true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; for cmd in $CMDS; do
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -P INPUT ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -P FORWARD ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -L INPUT --line-numbers | grep -vE &amp;#34;ts-|DOCKER&amp;#34; | awk &amp;#39;/^[0-9]/ {print $1}&amp;#39; | sort -nr | xargs -r -I{} $cmd -D INPUT {} 2&amp;gt;/dev/null
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -F FORWARD
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -A INPUT -i lo -j ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; if $cmd -L ts-input &amp;gt;/dev/null 2&amp;gt;&amp;amp;1; then
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -D INPUT -j ts-input 2&amp;gt;/dev/null || true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -I INPUT 3 -j ts-input
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; fi
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -A INPUT -p tcp --dport &amp;#34;$ssh_p&amp;#34; -j ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; # 规范 ICMP
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; if [ &amp;#34;$cmd&amp;#34; == &amp;#34;iptables&amp;#34; ]; then
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -A INPUT -p icmp --icmp-type echo-request -m limit --limit 1/s --limit-burst 5 -j ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -A INPUT -p icmp --icmp-type 3 -j ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -A INPUT -p icmp --icmp-type 11 -j ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -A INPUT -p icmp -j DROP
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; else
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; for type in 2 133 134 135 136 137; do
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -A INPUT -p ipv6-icmp --icmpv6-type $type -j ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; done
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -A INPUT -p ipv6-icmp --icmpv6-type echo-request -m limit --limit 1/s --limit-burst 5 -j ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -A INPUT -p ipv6-icmp -j DROP
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; fi
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; if $cmd -L ts-forward &amp;gt;/dev/null 2&amp;gt;&amp;amp;1; then
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -D FORWARD -j ts-forward 2&amp;gt;/dev/null || true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -I FORWARD 1 -j ts-forward
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; fi
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; # 核心优化：智能环境检测 (检测软件安装状态而非网卡状态)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; if command -v docker &amp;gt;/dev/null 2&amp;gt;&amp;amp;1 || command -v dockerd &amp;gt;/dev/null 2&amp;gt;&amp;amp;1; then
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -A FORWARD -i docker+ -j ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -A FORWARD -o docker+ -j ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; fi
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; if command -v tailscaled &amp;gt;/dev/null 2&amp;gt;&amp;amp;1; then
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -A FORWARD -i tailscale+ -j ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -A FORWARD -o tailscale+ -j ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; fi
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; if command -v wg &amp;gt;/dev/null 2&amp;gt;&amp;amp;1 || lsmod | grep -q wireguard; then
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -A FORWARD -i wg+ -j ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -A FORWARD -o wg+ -j ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; fi
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; if command -v openvpn &amp;gt;/dev/null 2&amp;gt;&amp;amp;1 || [ -c /dev/net/tun ]; then
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -A FORWARD -i tun+ -j ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -A FORWARD -o tun+ -j ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; fi
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; if command -v pppd &amp;gt;/dev/null 2&amp;gt;&amp;amp;1; then
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -A FORWARD -i ppp+ -j ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -A FORWARD -o ppp+ -j ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; fi
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -P INPUT DROP
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -P FORWARD DROP
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; # 双栈 MSS 钳制
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -t mangle -F FORWARD
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -t mangle -A FORWARD -p tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu 2&amp;gt;/dev/null || true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; done
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; save_rules
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo -e &amp;#34;${gl_lv}深度加固及 MSS 网络优化完成！冗余规则已清理。${gl_bai}&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; sleep 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;open_all_ports() {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; for cmd in iptables ip6tables; do
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; command -v $cmd &amp;gt;/dev/null 2&amp;gt;&amp;amp;1 || continue
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -P INPUT ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -P FORWARD ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -P OUTPUT ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -F
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -X 2&amp;gt;/dev/null || true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; $cmd -t mangle -F FORWARD 2&amp;gt;/dev/null || true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; done
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; save_rules
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo -e &amp;#34;${gl_lv}防火墙已重置全开模式，MSS 钳制已清除。${gl_bai}&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; sleep 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;iptables_panel() {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; while true; do
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; clear
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo -e &amp;#34;${gl_lv}===========================================${gl_bai}&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo -e &amp;#34; 高级防火墙管理 (Debian/Ubuntu 自适应版 V4.1) &amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo -e &amp;#34; 当前 IPv6 状态: \c&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; if [ &amp;#34;$HAS_IPV6&amp;#34; == true ]; then echo -e &amp;#34;${gl_lv}已启用${gl_bai}&amp;#34;; else echo -e &amp;#34;${gl_huang}未启用${gl_bai}&amp;#34;; fi
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo -e &amp;#34;${gl_lv}===========================================${gl_bai}&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo &amp;#34; 1. 查看规则 (含 MSS 钳制状态)&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo &amp;#34; 2. 放行端口&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo &amp;#34; 3. 屏蔽地址&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo &amp;#34; 4. 删除规则&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo -e &amp;#34; 5. ${gl_hong}执行深度加固 (智能检测环境，拒绝冗余规则)${gl_bai}&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo -e &amp;#34; 6. ${gl_huang}紧急恢复全开 (重置所有策略)${gl_bai}&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo &amp;#34; 7. 手动持久化保存&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo &amp;#34; 0. 退出脚本&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; echo &amp;#34;-------------------------------------------&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; read -e -p &amp;#34;请选择: &amp;#34; choice
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; case $choice in
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; 1) view_rules ;;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; 2) allow_port_flexible ;;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; 3) block_ip ;;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; 4) delete_rule ;;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; 5) close_all_but_ssh ;;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; 6) open_all_ports ;;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; 7) save_rules; sleep 2 ;;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; 0) exit 0 ;;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; *) echo &amp;#34;无效选择&amp;#34;; sleep 1 ;;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; esac
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; done
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;iptables_panel
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;chmod +x iptables_manager.sh
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./iptables_manager.sh
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="使用注意"&gt;使用注意&lt;/h2&gt;
&lt;h4 id="执行后选择-5系统将只根据你真实安装的组件写入必需的转发规则"&gt;执行后选择 5，系统将只根据你真实安装的组件写入必需的转发规则。&lt;/h4&gt;</description></item><item><title>Debian下nvim格式化全家桶安装</title><link>https://hanigege.github.io/posts/linux/debianmac%E4%B8%8Bnvim%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%85%A8%E5%AE%B6%E6%A1%B6%E5%AE%89%E8%A3%85/</link><pubDate>Fri, 27 Feb 2026 13:04:22 +0800</pubDate><guid>https://hanigege.github.io/posts/linux/debianmac%E4%B8%8Bnvim%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%85%A8%E5%AE%B6%E6%A1%B6%E5%AE%89%E8%A3%85/</guid><description>&lt;br&gt;
安装 Neovim (&gt;= 0.10.0)
&lt;h2 id="1-安装neovim-debian13ubuntu2510自动获取最新版必须是默认--010x"&gt;1. 安装neovim (Debian13&amp;amp;Ubuntu25.10+)(自动获取最新版，必须是默认 &amp;gt;= 0.10.x)&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;apt update &amp;amp;&amp;amp; apt install neovim
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="验证版本信息"&gt;验证版本信息&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;nvim --version | grep ^NVIM
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="如果是低版本系统也可自行编译安装最新版"&gt;如果是低版本系统，也可自行编译安装（最新版）&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;# 1. 安装编译所必须的基础工具和系统依赖
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;sudo apt update
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;sudo apt install ninja-build gettext cmake unzip curl build-essential git -y
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;# 2. 拉取 Neovim 源码并切换到稳定版分支 (规避开发版的潜在 bug)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;git clone https://github.com/neovim/neovim.git ~/neovim-src
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cd ~/neovim-src
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;git checkout stable
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;# 3. 编译并全局安装 (利用多核加速)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;make CMAKE_BUILD_TYPE=Release -j$(nproc)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;sudo make install
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;# 4. 清理路径缓存并验证版本
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;hash -r
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;nvim -v
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="安装格式化与剪贴板依赖环境"&gt;安装格式化与剪贴板依赖环境&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;要让 conform.nvim 成功调用 prettier，以及保证系统与 Neovim 之间的剪贴板交互顺畅，必须在操作系统层面安装以下工具：&lt;/strong&gt;&lt;/p&gt;</description></item><item><title>FreeBSD 15 PF 终极交互式管理脚本</title><link>https://hanigege.github.io/posts/freebsd/freebsd15-pf-js/</link><pubDate>Fri, 27 Feb 2026 08:44:18 +0800</pubDate><guid>https://hanigege.github.io/posts/freebsd/freebsd15-pf-js/</guid><description>&lt;br&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202026-02-27%20at%2009.05.03@2x.png" alt="列表"&gt;&lt;/p&gt;
&lt;h2 id="新建脚本文件"&gt;新建脚本文件&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;nvim pf_manager.sh
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="复制下面的配置"&gt;复制下面的配置&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;#!/bin/sh
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# FreeBSD 15 PF 交互式防火墙管理脚本 - 终极版&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;STATE_FILE&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;/etc/pf_ports.list&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;PF_CONF&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;/etc/pf.conf&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; &lt;span style="color:#f92672"&gt;[&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;$(&lt;/span&gt;id -u&lt;span style="color:#66d9ef"&gt;)&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; !&lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;0&amp;#34;&lt;/span&gt; &lt;span style="color:#f92672"&gt;]&lt;/span&gt;; &lt;span style="color:#66d9ef"&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;错误：必须使用 root 权限运行。&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; exit &lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;get_active_ssh_ports&lt;span style="color:#f92672"&gt;()&lt;/span&gt; &lt;span style="color:#f92672"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; ports&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;$(&lt;/span&gt;sockstat -46 -l -P tcp | grep -E &lt;span style="color:#e6db74"&gt;&amp;#39;\bsshd\b&amp;#39;&lt;/span&gt; | awk &lt;span style="color:#e6db74"&gt;&amp;#39;{print $6}&amp;#39;&lt;/span&gt; | awk -F&lt;span style="color:#e6db74"&gt;&amp;#39;:&amp;#39;&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;{print $NF}&amp;#39;&lt;/span&gt; | sort -u&lt;span style="color:#66d9ef"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; &lt;span style="color:#f92672"&gt;[&lt;/span&gt; -z &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$ports&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &lt;span style="color:#f92672"&gt;]&lt;/span&gt;; &lt;span style="color:#66d9ef"&gt;then&lt;/span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;22&amp;#34;&lt;/span&gt;; &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$ports&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;; &lt;span style="color:#66d9ef"&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;init_env&lt;span style="color:#f92672"&gt;()&lt;/span&gt; &lt;span style="color:#f92672"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; ! grep -q &lt;span style="color:#e6db74"&gt;&amp;#34;^pf_enable=\&amp;#34;YES\&amp;#34;&amp;#34;&lt;/span&gt; /etc/rc.conf; &lt;span style="color:#66d9ef"&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; sysrc pf_enable&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;YES&amp;#34;&lt;/span&gt; &amp;gt;/dev/null
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; service pf start &amp;gt;/dev/null 2&amp;gt;&amp;amp;&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;[&lt;/span&gt; ! -f &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$STATE_FILE&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &lt;span style="color:#f92672"&gt;]&lt;/span&gt; &lt;span style="color:#f92672"&gt;&amp;amp;&amp;amp;&lt;/span&gt; init_zero
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;init_zero&lt;span style="color:#f92672"&gt;()&lt;/span&gt; &lt;span style="color:#f92672"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$STATE_FILE&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; active_ports&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;$(&lt;/span&gt;get_active_ssh_ports&lt;span style="color:#66d9ef"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; port in $active_ports; &lt;span style="color:#66d9ef"&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;tcp &lt;/span&gt;$port&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$STATE_FILE&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; apply_rules &amp;gt;/dev/null 2&amp;gt;&amp;amp;&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;✅ 已清空所有自定义规则。&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;🔒 自动检测并放行当前活动 SSH 端口: [ &lt;/span&gt;$active_ports&lt;span style="color:#e6db74"&gt; ]&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;apply_rules&lt;span style="color:#f92672"&gt;()&lt;/span&gt; &lt;span style="color:#f92672"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; cat &lt;span style="color:#e6db74"&gt;&amp;lt;&amp;lt;EOF &amp;gt; &amp;#34;$PF_CONF&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;# 宏定义与全局选项
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;set skip on lo0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;set block-policy drop
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;# 流量清理
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;scrub in all fragment reassemble
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;# 基础过滤规则 (状态机制处理新老连接)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;block in all
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;pass out all keep state
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;pass in quick inet proto icmp all icmp-type echoreq keep state
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; grep -q &lt;span style="color:#e6db74"&gt;&amp;#34;^ALL PORTS OPEN&lt;/span&gt;$&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$STATE_FILE&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;; &lt;span style="color:#66d9ef"&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;pass in quick all keep state&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$PF_CONF&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;while&lt;/span&gt; read -r proto port; &lt;span style="color:#66d9ef"&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;[&lt;/span&gt; -z &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$proto&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &lt;span style="color:#f92672"&gt;]&lt;/span&gt; &lt;span style="color:#f92672"&gt;||&lt;/span&gt; &lt;span style="color:#f92672"&gt;[&lt;/span&gt; -z &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$port&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &lt;span style="color:#f92672"&gt;]&lt;/span&gt; &lt;span style="color:#f92672"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;continue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;pass in quick inet proto &lt;/span&gt;$proto&lt;span style="color:#e6db74"&gt; from any to any port &lt;/span&gt;$port&lt;span style="color:#e6db74"&gt; keep state&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$PF_CONF&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;done&lt;/span&gt; &amp;lt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$STATE_FILE&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; pfctl -nf &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$PF_CONF&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &amp;gt;/dev/null 2&amp;gt;&amp;amp;&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; &lt;span style="color:#f92672"&gt;[&lt;/span&gt; $? -eq &lt;span style="color:#ae81ff"&gt;0&lt;/span&gt; &lt;span style="color:#f92672"&gt;]&lt;/span&gt;; &lt;span style="color:#66d9ef"&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; pfctl -f &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$PF_CONF&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &amp;gt;/dev/null 2&amp;gt;&amp;amp;&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;✅ 规则已成功更新并生效！&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;❌ 规则语法错误，未应用更改！&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;view_rules&lt;span style="color:#f92672"&gt;()&lt;/span&gt; &lt;span style="color:#f92672"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;--- 当前系统生效的 PF 规则 (pfctl -sr) ---&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; pfctl -sr
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;------------------------------------------&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;open_port&lt;span style="color:#f92672"&gt;()&lt;/span&gt; &lt;span style="color:#f92672"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; read -p &lt;span style="color:#e6db74"&gt;&amp;#34;请输入要开放的端口号 (1-65535): &amp;#34;&lt;/span&gt; port
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; ! &lt;span style="color:#f92672"&gt;[&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$port&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; -eq &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$port&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &lt;span style="color:#f92672"&gt;]&lt;/span&gt; 2&amp;gt;/dev/null &lt;span style="color:#f92672"&gt;||&lt;/span&gt; &lt;span style="color:#f92672"&gt;[&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$port&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; -lt &lt;span style="color:#ae81ff"&gt;1&lt;/span&gt; &lt;span style="color:#f92672"&gt;]&lt;/span&gt; &lt;span style="color:#f92672"&gt;||&lt;/span&gt; &lt;span style="color:#f92672"&gt;[&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$port&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; -gt &lt;span style="color:#ae81ff"&gt;65535&lt;/span&gt; &lt;span style="color:#f92672"&gt;]&lt;/span&gt;; &lt;span style="color:#66d9ef"&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;错误：端口号无效。&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;请选择协议: 1) TCP 2) UDP 3) TCP 和 UDP&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; read -p &lt;span style="color:#e6db74"&gt;&amp;#34;输入选项 (1/2/3): &amp;#34;&lt;/span&gt; proto_opt
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; sed -i &lt;span style="color:#e6db74"&gt;&amp;#39;&amp;#39;&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;/^ALL PORTS OPEN$/d&amp;#39;&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$STATE_FILE&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;case&lt;/span&gt; $proto_opt in
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; 1&lt;span style="color:#f92672"&gt;)&lt;/span&gt; grep -q &lt;span style="color:#e6db74"&gt;&amp;#34;^tcp &lt;/span&gt;$port$&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$STATE_FILE&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &lt;span style="color:#f92672"&gt;||&lt;/span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;tcp &lt;/span&gt;$port&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$STATE_FILE&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; ;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; 2&lt;span style="color:#f92672"&gt;)&lt;/span&gt; grep -q &lt;span style="color:#e6db74"&gt;&amp;#34;^udp &lt;/span&gt;$port$&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$STATE_FILE&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &lt;span style="color:#f92672"&gt;||&lt;/span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;udp &lt;/span&gt;$port&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$STATE_FILE&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; ;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; 3&lt;span style="color:#f92672"&gt;)&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; grep -q &lt;span style="color:#e6db74"&gt;&amp;#34;^tcp &lt;/span&gt;$port$&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$STATE_FILE&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &lt;span style="color:#f92672"&gt;||&lt;/span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;tcp &lt;/span&gt;$port&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$STATE_FILE&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; grep -q &lt;span style="color:#e6db74"&gt;&amp;#34;^udp &lt;/span&gt;$port$&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$STATE_FILE&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &lt;span style="color:#f92672"&gt;||&lt;/span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;udp &lt;/span&gt;$port&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$STATE_FILE&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; ;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; *&lt;span style="color:#f92672"&gt;)&lt;/span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;错误：无效选项。&amp;#34;&lt;/span&gt; ; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; ;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;esac&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; apply_rules
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;delete_port&lt;span style="color:#f92672"&gt;()&lt;/span&gt; &lt;span style="color:#f92672"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; read -p &lt;span style="color:#e6db74"&gt;&amp;#34;请输入要关闭的端口号: &amp;#34;&lt;/span&gt; port
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; grep -q &lt;span style="color:#e6db74"&gt;&amp;#34; &lt;/span&gt;$port$&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$STATE_FILE&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;; &lt;span style="color:#66d9ef"&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; sed -i &lt;span style="color:#e6db74"&gt;&amp;#39;&amp;#39;&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;/ &lt;/span&gt;$port$&lt;span style="color:#e6db74"&gt;/d&amp;#34;&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$STATE_FILE&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; apply_rules
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;该端口未在管理列表中。&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;open_all_ports&lt;span style="color:#f92672"&gt;()&lt;/span&gt; &lt;span style="color:#f92672"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;⚠️ 警告：这将放行所有入站流量！&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; read -p &lt;span style="color:#e6db74"&gt;&amp;#34;确认执行？(y/n): &amp;#34;&lt;/span&gt; confirm
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;[&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$confirm&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;y&amp;#34;&lt;/span&gt; &lt;span style="color:#f92672"&gt;]&lt;/span&gt; &lt;span style="color:#f92672"&gt;||&lt;/span&gt; &lt;span style="color:#f92672"&gt;[&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$confirm&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;Y&amp;#34;&lt;/span&gt; &lt;span style="color:#f92672"&gt;]&lt;/span&gt; &lt;span style="color:#f92672"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style="color:#f92672"&gt;{&lt;/span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;ALL PORTS OPEN&amp;#34;&lt;/span&gt; &amp;gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$STATE_FILE&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;; apply_rules; &lt;span style="color:#f92672"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;init_env
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;while&lt;/span&gt; true; &lt;span style="color:#66d9ef"&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;=== PF 防火墙管理菜单 ===&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;1. 查看当前底层生效规则&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;2. 查看已开放端口列表&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;3. 开放新端口 (支持 TCP/UDP)&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;4. 删除/关闭端口&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;5. 关闭所有端口并从零开始 (保留当前活动 SSH 端口)&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;6. 开放所有端口 (高危)&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;0. 退出&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; read -p &lt;span style="color:#e6db74"&gt;&amp;#34;请选择操作 [0-6]: &amp;#34;&lt;/span&gt; choice
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;case&lt;/span&gt; $choice in
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; 1&lt;span style="color:#f92672"&gt;)&lt;/span&gt; view_rules ;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; 2&lt;span style="color:#f92672"&gt;)&lt;/span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;--- 当前管理的端口 ---&amp;#34;&lt;/span&gt;; cat &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$STATE_FILE&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; ;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; 3&lt;span style="color:#f92672"&gt;)&lt;/span&gt; open_port ;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; 4&lt;span style="color:#f92672"&gt;)&lt;/span&gt; delete_port ;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; 5&lt;span style="color:#f92672"&gt;)&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;⚠️ 警告：这将清除所有记录，并重新抓取当前 SSH 端口作为唯一放行规则！&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; read -p &lt;span style="color:#e6db74"&gt;&amp;#34;确认执行？(y/n): &amp;#34;&lt;/span&gt; confirm
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;[&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$confirm&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;y&amp;#34;&lt;/span&gt; &lt;span style="color:#f92672"&gt;]&lt;/span&gt; &lt;span style="color:#f92672"&gt;||&lt;/span&gt; &lt;span style="color:#f92672"&gt;[&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$confirm&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;Y&amp;#34;&lt;/span&gt; &lt;span style="color:#f92672"&gt;]&lt;/span&gt; &lt;span style="color:#f92672"&gt;&amp;amp;&amp;amp;&lt;/span&gt; init_zero ;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; 6&lt;span style="color:#f92672"&gt;)&lt;/span&gt; open_all_ports ;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; 0&lt;span style="color:#f92672"&gt;)&lt;/span&gt; exit &lt;span style="color:#ae81ff"&gt;0&lt;/span&gt; ;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; *&lt;span style="color:#f92672"&gt;)&lt;/span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;无效选项。&amp;#34;&lt;/span&gt; ;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;esac&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="添加权限并执行"&gt;添加权限并执行&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;chmod +x iptables_manager.sh
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./iptables_manager.sh
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description></item><item><title>Vyos Wireguard Ipv4</title><link>https://hanigege.github.io/posts/routers/vyos-wireguard-ipv4/</link><pubDate>Sun, 01 Jun 2025 20:42:39 +0800</pubDate><guid>https://hanigege.github.io/posts/routers/vyos-wireguard-ipv4/</guid><description>&lt;h1 id="vyos上配置wireguard-ipv4"&gt;vyos上配置wireguard （IPV4）&lt;/h1&gt;
&lt;h2 id="1-生成-wireguard-密钥"&gt;1. 生成 WireGuard 密钥&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;wg genkey | tee privatekey | wg pubkey &amp;gt; publickey
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;• privatekey 文件中存储 私钥&lt;/p&gt;
&lt;p&gt;• publickey 文件中存储 公钥&lt;/p&gt;
&lt;p&gt;然后使用：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cat privatekey
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;把私钥填入 第一步 的 &amp;lt;服务器私钥&amp;gt; 位置。&lt;/p&gt;
&lt;p&gt;配置wireguard:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set interfaces wireguard wg0 address &amp;#39;10.20.30.1/24&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set interfaces wireguard wg0 port &amp;#39;11133&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set interfaces wireguard wg0 private-key &amp;#39;private-key&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set interfaces wireguard wg0 peer iphone allowed-ips &amp;#39;10.20.30.2/32&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set interfaces wireguard wg0 peer iphone public-key &amp;#39;public-key&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set interfaces wireguard wg0 peer iphone preshared-key &amp;#39;preshared-key&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;上面这是添加过peer的。&lt;/p&gt;</description></item><item><title>CK佬的wg-Easy一键脚本程序</title><link>https://hanigege.github.io/posts/linux/ck%E4%BD%AC%E7%9A%84wg-easy%E4%B8%80%E9%94%AE%E8%84%9A%E6%9C%AC%E7%A8%8B%E5%BA%8F/</link><pubDate>Mon, 12 May 2025 16:09:56 +0800</pubDate><guid>https://hanigege.github.io/posts/linux/ck%E4%BD%AC%E7%9A%84wg-easy%E4%B8%80%E9%94%AE%E8%84%9A%E6%9C%AC%E7%A8%8B%E5%BA%8F/</guid><description>&lt;p&gt;&lt;img src="assets/1.png" alt="图示"&gt;&lt;/p&gt;
&lt;p&gt;pve下安装ubuntu或者debian.然后看下面ck佬的教程操作：&lt;/p&gt;
&lt;p&gt;&lt;a href="https://drive.google.com/file/d/1ETrZhXvuLgmXs_-6rdMwsPHz0QJ2JmqY/view?usp=sharing"&gt;wg-easy.zip&lt;/a&gt;&lt;/p&gt;
&lt;h2 id="安装教程"&gt;安装教程&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# vm ubuntu22.04测试通过，新版本注意下面改了个组件，即：npm@11.6.2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;1、迁移代码
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;复制app文件夹到 /app
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cd /app
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;2、安装依赖
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;apt update
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;apt install -y wireguard iptables
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;curl -fsSL https://deb.nodesource.com/setup_22.x | sudo bash -
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;sudo apt-get install -y nodejs
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;sudo npm install -g npm@11.6.2 bcryptjs debug express-session h3 qrcode
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;3、配置环境
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;export NODE_PATH&lt;span style="color:#f92672"&gt;=&lt;/span&gt;/usr/lib/node_modules
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;echo &lt;span style="color:#e6db74"&gt;&amp;#34;export NODE_PATH=/usr/lib/node_modules&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt; ~/.bashrc
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;source ~/.bashrc
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;npm audit fix
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;4、启用 IPv4 和 IPv6 转发
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;sudo sysctl -w net.ipv4.ip_forward&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;sudo sysctl -w net.ipv6.conf.all.forwarding&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;sudo bash -c &lt;span style="color:#e6db74"&gt;&amp;#39;echo &amp;#34;net.ipv4.ip_forward = 1&amp;#34; &amp;gt;&amp;gt; /etc/sysctl.conf&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;sudo bash -c &lt;span style="color:#e6db74"&gt;&amp;#39;echo &amp;#34;net.ipv6.conf.all.forwarding = 1&amp;#34; &amp;gt;&amp;gt; /etc/sysctl.conf&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;sudo sysctl -p
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;5、配置 systemd 服务
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;复制wg-easy.service到 /etc/systemd/system/
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;chmod +x /etc/systemd/system/wg-easy.service
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;systemctl enable wg-easy.service
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;systemctl start wg-easy.service
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;systemctl status wg-easy.service
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;登录WebUI： http://ip:51821/
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;详细参数请修改 /app/config.js
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# 如果报500错误的话&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cd /app
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;npm audit fix
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src="assets/CleanShot%202026-02-27%20at%2021.34.48@2x.png" alt="CleanShot 2026-02-27 at 21.34.48@2x"&gt;&lt;/p&gt;</description></item><item><title>Freebsd安装Hysteria2服务端</title><link>https://hanigege.github.io/posts/freebsd/freebsd%E5%AE%89%E8%A3%85hysteria2%E6%9C%8D%E5%8A%A1%E7%AB%AF/</link><pubDate>Mon, 12 May 2025 14:31:26 +0800</pubDate><guid>https://hanigege.github.io/posts/freebsd/freebsd%E5%AE%89%E8%A3%85hysteria2%E6%9C%8D%E5%8A%A1%E7%AB%AF/</guid><description>&lt;h2 id="freebsd15下配置服务器端hysteria2"&gt;FreeBSD15下配置服务器端Hysteria2&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;建议用root用户运行：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;特权端口限制：非 root 用户无法监听 1024 以下的端口（如 443）。
Hysteria2设置简单，性能强劲，强力推荐，只自己用，很方便。&lt;/p&gt;
&lt;p&gt;先到官网下载最新的for freebsd版 &lt;a href="https://github.com/apernet/hysteria/releases"&gt;官网下载&lt;/a&gt;&lt;/p&gt;
&lt;h2 id="1-安装hysteria"&gt;1. 安装hysteria&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-gdscript3" data-lang="gdscript3"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;fetch https:&lt;span style="color:#f92672"&gt;//&lt;/span&gt;github&lt;span style="color:#f92672"&gt;.&lt;/span&gt;com&lt;span style="color:#f92672"&gt;/&lt;/span&gt;apernet&lt;span style="color:#f92672"&gt;/&lt;/span&gt;hysteria&lt;span style="color:#f92672"&gt;/&lt;/span&gt;releases&lt;span style="color:#f92672"&gt;/&lt;/span&gt;download&lt;span style="color:#f92672"&gt;/&lt;/span&gt;app&lt;span style="color:#f92672"&gt;%&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;2&lt;/span&gt;Fv2&lt;span style="color:#f92672"&gt;.&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;7.0&lt;/span&gt;&lt;span style="color:#f92672"&gt;/&lt;/span&gt;hysteria&lt;span style="color:#f92672"&gt;-&lt;/span&gt;freebsd&lt;span style="color:#f92672"&gt;-&lt;/span&gt;amd64 &lt;span style="color:#75715e"&gt;#下载目前最新的2.7.0版&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;mv hysteria&lt;span style="color:#f92672"&gt;-&lt;/span&gt;freebsd&lt;span style="color:#f92672"&gt;-&lt;/span&gt;amd64 hysteria &lt;span style="color:#75715e"&gt;#把文件改名成hysteria&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;chmod &lt;span style="color:#f92672"&gt;+&lt;/span&gt;x hysteria &lt;span style="color:#75715e"&gt;#让文件可执行&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;mv hysteria &lt;span style="color:#f92672"&gt;/&lt;/span&gt;usr&lt;span style="color:#f92672"&gt;/&lt;/span&gt;local&lt;span style="color:#f92672"&gt;/&lt;/span&gt;bin &lt;span style="color:#75715e"&gt;#将文件移到相应目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;sysrc hysteria_enable&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;YES&amp;#34;&lt;/span&gt; &lt;span style="color:#75715e"&gt;#设置开机启动&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="2-自签证书"&gt;2. 自签证书：&lt;/h2&gt;
&lt;p&gt;以下是适配 FreeBSD 的高效执行步骤：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;mkdir -p /usr/local/etc/hysteria
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;# 生成私钥与证书 bing.com也可以改为其它的
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;openssl req -x509 -nodes -newkey ec -pkeyopt ec_paramgen_curve:prime256v1 \
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;-keyout /usr/local/etc/hysteria/server.key \
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;-out /usr/local/etc/hysteria/server.crt \
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;-subj &amp;#34;/CN=bing.com&amp;#34; -days 36500
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;# 修正权限 (FreeBSD 中 hysteria 用户组名通常也是 hysteria) root用户登录下面命令没有必要
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;# chown hysteria:hysteria /usr/local/etc/hysteria/server.key /usr/local/etc/hysteria/server.crt
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;# 所有用户必须执行包括root,给证书权限
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;chmod 644 /usr/local/etc/hysteria/server.crt
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;chmod 600 /usr/local/etc/hysteria/server.key
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="hysteria-服务配置提示"&gt;Hysteria 服务配置提示&lt;/h3&gt;
&lt;p&gt;在 FreeBSD 上运行 Hysteria 时，请确保 /usr/local/etc/hysteria/config.yaml（或你的配置文件）引用了正确的路径：&lt;/p&gt;</description></item><item><title>Freebsd更改默认编辑器vi</title><link>https://hanigege.github.io/posts/freebsd/freebsd%E6%9B%B4%E6%94%B9%E9%BB%98%E8%AE%A4%E7%BC%96%E8%BE%91%E5%99%A8vi/</link><pubDate>Mon, 12 May 2025 12:52:04 +0800</pubDate><guid>https://hanigege.github.io/posts/freebsd/freebsd%E6%9B%B4%E6%94%B9%E9%BB%98%E8%AE%A4%E7%BC%96%E8%BE%91%E5%99%A8vi/</guid><description>&lt;h2 id="前提是新编辑器已经安装"&gt;前提是新编辑器已经安装&lt;/h2&gt;
&lt;p&gt;FreeBSD 下你可以通过设置环境变量 EDITOR 来更改 crontab -e 使用的默认编辑器。下面是几种常见方法：&lt;/p&gt;
&lt;h2 id="-临时更改当前-shell-有效"&gt;✅ 临时更改（当前 shell 有效）&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;EDITOR&lt;span style="color:#f92672"&gt;=&lt;/span&gt;nano crontab -e
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;或者用其他你喜欢的编辑器，如：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;EDITOR&lt;span style="color:#f92672"&gt;=&lt;/span&gt;micro crontab -e
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;EDITOR&lt;span style="color:#f92672"&gt;=&lt;/span&gt;ee crontab -e
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;EDITOR&lt;span style="color:#f92672"&gt;=&lt;/span&gt;vim crontab -e
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="-永久更改加到-shell-启动文件"&gt;✅ 永久更改（加到 shell 启动文件）&lt;/h2&gt;
&lt;p&gt;如果你使用的是 sh 或 bash，可以将以下内容加到 &lt;code&gt;~/.profile&lt;/code&gt; 或 &lt;code&gt;~/.bashrc&lt;/code&gt;或 &lt;code&gt;~/bash_profile&lt;/code&gt;：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;export EDITOR&lt;span style="color:#f92672"&gt;=&lt;/span&gt;nano
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;如果你使用的是 tcsh（FreeBSD 默认），请加到 ~/.cshrc 文件中：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;setenv EDITOR nano
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;然后执行：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;source ~/.cshrc
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="-补充提示安装简易编辑器"&gt;📦 补充提示：安装简易编辑器&lt;/h2&gt;
&lt;p&gt;如果你想用 nano 但系统没有，可以用 pkg 安装：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;sudo pkg install nano
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description></item><item><title>Freebsd-Ipfirewall(IPFW)防火墙介绍</title><link>https://hanigege.github.io/posts/freebsd/freebsd-ipfirewallipfw/</link><pubDate>Mon, 12 May 2025 10:32:24 +0800</pubDate><guid>https://hanigege.github.io/posts/freebsd/freebsd-ipfirewallipfw/</guid><description>&lt;h4 id="ipfirewall-ipfwip-防火墙-是一款由-freebsd-发起的防火墙应用软件它由-freebsd-项目编写和维护"&gt;IPFIREWALL (IPFW，IP 防火墙) 是一款由 FreeBSD 发起的防火墙应用软件，它由 FreeBSD 项目编写和维护。&lt;/h4&gt;
&lt;p&gt;ipfw 在基本系统的内核（GENERIC）作为可加载模块而存在。&lt;/p&gt;
&lt;h1 id="警告"&gt;&lt;code&gt;警告&lt;/code&gt;&lt;/h1&gt;
&lt;p&gt;IPFW 默认会有一条规则，规则号为 &lt;code&gt;65535&lt;/code&gt;，是不可以删除的：这条规则会把所有流量都切断。故在未配置好防火墙前，请勿启动 IPFW，否则就会面临被阻挡在防火墙之外的麻烦。&lt;/p&gt;
&lt;h2 id="服务项"&gt;服务项&lt;/h2&gt;
&lt;p&gt;开机自动启动防火墙相应的内核模块：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# sysrc firewall_enable=&amp;#34;YES&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;参见 &lt;a href="https://github.com/freebsd/freebsd-src/blob/main/libexec/rc/rc.d/routing#L387"&gt;官方网址&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;或者&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# service ipfw enable # 须重启后生效&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;保存所需编辑后，启动防火墙。要立即启用日志记录限制，还请设置sysctl上面指定的值：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# service ipfw start&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;启动 ipfw：（启动前需要先添加放开22端口的规则，先执行下面的）&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# service ipfw start&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Firewall rules loaded.
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Firewall logging enabled.
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;ifconfig: interface ipfw0 already exists
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Firewall logging pseudo-interface &lt;span style="color:#f92672"&gt;(&lt;/span&gt;ipfw0&lt;span style="color:#f92672"&gt;)&lt;/span&gt; created.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;查看 ipfw 状态：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# service ipfw status&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;ipfw is enabled
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;其他 RC 配置&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# sysrc firewall_type=&amp;#34;open&amp;#34; # 允许任何访问。如果不这么做，会调用默认规则 65535——deny ip from any to any，拒绝所有 IP。你就只能去物理机上再操作了。基本等同于 net.inet.ip.fw.default_to_accept=&amp;#34;1&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# sysrc firewall_script=&amp;#34;/usr/local/etc/ipfw.rules&amp;#34; # 指定 ipfw 规则的路径，在此处编辑规则&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# sysrc firewall_logging=&amp;#34;YES&amp;#34; # 这样 ipfw 就可以打印日志&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# sysrc firewall_logif=&amp;#34;YES&amp;#34; # 把日志打印到 `ipfw0` 这个设备里&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;sysrc firewall_type=&amp;quot;open&amp;quot;&lt;/code&gt; 设置后不会直接写入 allow ip from any to any 到配置文件。&lt;/p&gt;</description></item><item><title>Freebsd-Packet-Filter（PF）防火墙介绍</title><link>https://hanigege.github.io/posts/freebsd/freebsd-packet-filterpf%E9%98%B2%E7%81%AB%E5%A2%99%E4%BB%8B%E7%BB%8D/</link><pubDate>Mon, 12 May 2025 10:25:50 +0800</pubDate><guid>https://hanigege.github.io/posts/freebsd/freebsd-packet-filterpf%E9%98%B2%E7%81%AB%E5%A2%99%E4%BB%8B%E7%BB%8D/</guid><description>&lt;h4 id="在-pfconf-中pf-规则的顺序是非常严格的正确的顺序应该是"&gt;在 pf.conf 中，PF 规则的顺序是非常严格的。正确的顺序应该是：&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;options — 设置 PF 的全局选项。&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ethernet — 设置网络接口。&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;normalization — 设置数据包的规范化。&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;queueing — 设置队列（可选）。&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;translation — NAT 或 RDR 设置。&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;filtering — 包过滤规则。&lt;/code&gt;&lt;/p&gt;
&lt;h4 id="pfpacket-filter包过滤器是一款由-openbsd-移植而来的防火墙提供了大量功能包括-altq-alternate-queuing交错队列-等"&gt;PF（Packet Filter，包过滤器）是一款由 OpenBSD 移植而来的防火墙，提供了大量功能，包括 ALTQ (Alternate Queuing，交错队列) 等。&lt;/h4&gt;
&lt;p&gt;启用 PF&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# kldload pf # ① 加载内核模块&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# 示例文件作为默认配置规则集文件，否则 pf 无法启动 ②&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# cp /usr/share/examples/pf/pf.conf /etc/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# service pf enable # 设置 pf 开机启动&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# service pf start # 启动 pf&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;① 如不做，则提示 pfctl: /dev/pf: No such file or directory。或者你重启再 service pf start。&lt;/p&gt;</description></item><item><title>Freebsd14.2拉取源码安装sing-Box(包含pf防火墙配置)</title><link>https://hanigege.github.io/posts/freebsd/freebsd14.2%E6%8B%89%E5%8F%96%E6%BA%90%E7%A0%81%E5%AE%89%E8%A3%85sing-box/</link><pubDate>Mon, 12 May 2025 09:18:31 +0800</pubDate><guid>https://hanigege.github.io/posts/freebsd/freebsd14.2%E6%8B%89%E5%8F%96%E6%BA%90%E7%A0%81%E5%AE%89%E8%A3%85sing-box/</guid><description>&lt;h4 id="在-freebsd-上编译并安装-sing-box可以按照以下步骤进行操作我们将使用-git-拉取源代码并编译以下是详细步骤"&gt;在 FreeBSD 上编译并安装 sing-box，可以按照以下步骤进行操作。我们将使用 git 拉取源代码并编译，以下是详细步骤：&lt;/h4&gt;
&lt;h2 id="1-安装依赖工具"&gt;1. 安装依赖工具&lt;/h2&gt;
&lt;p&gt;首先，你需要安装一些基础工具，例如 git 和 go（Go 语言环境），以便能编译和构建 sing-box。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;pkg update
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;pkg install git
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;点击安装最新版本go1.23.1&lt;/p&gt;
&lt;h2 id="2-获取-sing-box-源代码"&gt;2. 获取 Sing-Box 源代码&lt;/h2&gt;
&lt;p&gt;然后，使用 git 克隆 sing-box 的源码库：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# 下面是root用户安装&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;mkdir /usr/local/opt
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;git clone https://github.com/SagerNet/sing-box.git /usr/local/opt/sing-box
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cd /usr/local/opt/sing-box
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# 下面是普通用户安装，只能安装本级目录下~/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;mkdir .usr/local/opt
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;git clone https://github.com/SagerNet/sing-box.git .usr/local/opt/sing-box
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cd .usr/local/opt/sing-box
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="3-编译-sing-box"&gt;3. 编译 Sing-Box&lt;/h2&gt;
&lt;p&gt;确保你的系统上安装了 Go 语言环境后，运行以下命令来编译 sing-box：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# 执行构建，没有任何输出就是构建完&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;go build -tags &lt;span style="color:#e6db74"&gt;&amp;#34;with_quic with_dhcp with_wireguard with_utls with_acme with_clash_api with_gvisor with_grpc with_v2ray_api&amp;#34;&lt;/span&gt; ./cmd/sing-box
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# 这会编译 sing-box 并启用 QUIC协议支持。&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# 你现在应该可以在当前目录看到可执行文件了&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;ls -lh sing-box
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# 如果你还想把它安装到系统路径中，可以执行（需要 root 权限）：&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;sudo install -m &lt;span style="color:#ae81ff"&gt;755&lt;/span&gt; sing-box /usr/local/bin/sing-box 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# 普通用户执行&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;go build -tags &lt;span style="color:#e6db74"&gt;&amp;#34;with_quic with_dhcp with_wireguard with_utls with_acme with_clash_api with_gvisor with_grpc with_v2ray_api&amp;#34;&lt;/span&gt; ./cmd/sing-box
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# 这会编译 sing-box 并启用 QUIC协议支持。&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# 你现在应该可以在当前目录看到可执行文件了&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;ls -lh sing-box
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# 我装在了之前go的bin文件夹里，可以执行：&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;install -m &lt;span style="color:#ae81ff"&gt;755&lt;/span&gt; sing-box ~/.usr/local/opt/go/bin/sing-box 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="或者明白原理装哪里就随心所欲了"&gt;或者：（明白原理，装哪里就随心所欲了）&lt;/h2&gt;
&lt;p&gt;如果你是 普通用户（非 root）并想不使用 sudo 安装 sing-box，可以将其安装到你自己的 $HOME 目录下的 bin/ 子目录中，这是 Unix 系统常用的做法之一。&lt;/p&gt;</description></item><item><title>Freebsd Install Go最新版</title><link>https://hanigege.github.io/posts/freebsd/freebsd-install-go1231/</link><pubDate>Mon, 12 May 2025 09:12:59 +0800</pubDate><guid>https://hanigege.github.io/posts/freebsd/freebsd-install-go1231/</guid><description>&lt;h2 id="手动安装最新版本-go"&gt;手动安装最新版本 Go&lt;/h2&gt;
&lt;p&gt;从 Go &lt;a href="https://go.dev/dl/"&gt;官方网站&lt;/a&gt;下载最新版本的 Go 语言：&lt;/p&gt;
&lt;p&gt;访问 Go 语言官网 下载最新版本的 Go。选择适合 FreeBSD 的版本，例如 go1.23.1.freebsd-amd64.tar.gz，后面如需版本更新，请自行修改新版本下载链接，一般情况下只修改版本号就可以了。&lt;/p&gt;
&lt;h2 id="root用户安装方法"&gt;root用户安装方法：&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;fetch https://golang.org/dl/go1.26.0.freebsd-amd64.tar.gz 
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;tar -C /usr/local -xzf go1.26.0.freebsd-amd64.tar.gz
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;如需修改安装路径：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;mkdir -p /usr/local/opt/
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;fetch -o /usr/local/opt/go1.26.0.freebsd-amd64.tar.gz https://golang.org/dl/go1.26.0.freebsd-amd64.tar.gz
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cd /usr/local/opt/
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;tar -C /usr/local/opt/ -xzf go1.26.0.freebsd-amd64.tar.gz
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="普通用户的安装方法只能在自己目录中操作好处安全隔离推荐"&gt;普通用户的安装方法：(只能在自己目录中操作，好处:安全，隔离）{推荐}&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;mkdir -p .usr/local/opt/
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;fetch -o .usr/local/opt/go1.26.0.freebsd-amd64.tar.gz https://golang.org/dl/go1.26.0.freebsd-amd64.tar.gz
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cd .usr/local/opt/
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;tar -C ~/.usr/local/opt/ -xzf go1.26.0.freebsd-amd64.tar.gz
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;设置 Go 环境变量：&lt;/p&gt;
&lt;p&gt;打开&lt;code&gt;~/.profile&lt;/code&gt; 文件，添加 Go 的环境变量：&lt;/p&gt;
&lt;p&gt;原方式：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;export PATH&lt;span style="color:#f92672"&gt;=&lt;/span&gt;$PATH:/usr/local/go/bin
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;改路径后：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;export PATH&lt;span style="color:#f92672"&gt;=&lt;/span&gt;$PATH:/usr/local/opt/go/bin
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="普通用户下在bash_profile-文件中添加变量普通用户已改为bash指令如用提sh指令那就在profile文件中改"&gt;普通用户下：在.bash_profile 文件中添加变量（普通用户已改为bash指令）如用提sh指令，那就在.profile文件中改：&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;export PATH&lt;span style="color:#f92672"&gt;=&lt;/span&gt;$PATH:~/.usr/local/opt/go/bin
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;刷新配置或重启终端：在 FreeBSD 中，默认使用的 shell 是 sh，而 sh 不支持 source 命令。相反，sh 使用 . 来代替 source。因此，如果你使用的是 sh，需要改为使用以下命令来加载配置文件：&lt;/p&gt;</description></item><item><title>手动申请域名ssl证书</title><link>https://hanigege.github.io/posts/linux/%E6%89%8B%E5%8A%A8%E7%94%B3%E8%AF%B7%E5%9F%9F%E5%90%8Dssl%E8%AF%81%E4%B9%A6/</link><pubDate>Mon, 12 May 2025 08:22:29 +0800</pubDate><guid>https://hanigege.github.io/posts/linux/%E6%89%8B%E5%8A%A8%E7%94%B3%E8%AF%B7%E5%9F%9F%E5%90%8Dssl%E8%AF%81%E4%B9%A6/</guid><description>&lt;h1 id="acmesh脚本申请cloudflare的证书-支持泛域名"&gt;acme.sh脚本申请cloudflare的证书 支持泛域名&lt;/h1&gt;
&lt;p&gt;前言：&lt;code&gt;acme.sh&lt;/code&gt;是一个非常好用的用于申请证书的脚本，它开源在Github，它极大地降低了申请证书的难度，支持使用cloudflare api等多种api来申请证书。&lt;/p&gt;
&lt;p&gt;本文主要介绍使用此脚本来申请 ssl 证书，给你的http请求加把锁，具体可以用来cloudflare api介绍。&lt;/p&gt;
&lt;h2 id="准备条件"&gt;准备条件：&lt;/h2&gt;
&lt;p&gt;一台被分配了公网IP的主机&lt;/p&gt;
&lt;p&gt;一个域名(建议购买收费域名)&lt;/p&gt;
&lt;p&gt;电脑ssh客户端&lt;/p&gt;
&lt;p&gt;能解决个体的问题&lt;/p&gt;
&lt;h2 id="一全球api申请证书"&gt;一、全球API申请证书&lt;/h2&gt;
&lt;p&gt;1.1、安装脚本文件
以root用户ssh连接到主机，使用下面的命令安装脚本：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;apt update &lt;span style="color:#f92672"&gt;&amp;amp;&amp;amp;&lt;/span&gt; apt -y install socat //更新源并安装socat
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;wget -qO- get.acme.sh | bash //安装此脚本
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;source ~/.bashrc //让别名生效，此后无论在哪里直接使用acme.sh，不用输绝对路径
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# 由于最新acme.sh脚本默认ca变成了zerossl，现## 执行下面命令修改脚本默认ca为letsencrypt&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;acme.sh --set-default-ca --server letsencrypt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;1.2、证书配置
1.2.1 获取Cloudflare api key
注册好cloudflare账号，把域名解析的解析权限锁定cloudflare处理，这样以后只需要在cloudflare这里配置解析记录。按照图标获取cloudflare api key。
&lt;img src="assets/CleanShot%202025-05-12%20at%2008.24.26@2x.png" alt="CleanShot 2025-05-12 at 08.24.26@2x"&gt;
1.2.2 申请证书（二选一）
这里假设您的域名是yourdomain.com，执行下面命令申请证书：&lt;/p&gt;
&lt;p&gt;1.2.2.1 dns方式验证&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;export CF_Key&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;slfjksjffjfhfhkjhfksjf&amp;#34;&lt;/span&gt; //此处替换成你自己的Key
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;export CF_Email&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;yourcloudflare@gmail.com&amp;#34;&lt;/span&gt; //此处填写你给Cloudflare绑定的邮箱账号
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;acme.sh --issue --dns dns_cf -d yourdomain.com -d www.yourdomain.com -k ec-256
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;说明：Cloudflare 目前不支持.tk .cf .ml等免费申请来的域名后缀使用此 DNS 验证方式，付费域名才受支持，免费域名使用低于 2.2.2 方式。脚本申请到的证书和密钥都放在目录下~/.acme.sh/yourdomain.com_ecc。&lt;/p&gt;</description></item><item><title>出国自建voip(一.2)FreePBX对接SMG4004网关实现SIP网络电话</title><link>https://hanigege.github.io/posts/other/voip-0/</link><pubDate>Sun, 11 May 2025 20:19:19 +0800</pubDate><guid>https://hanigege.github.io/posts/other/voip-0/</guid><description>&lt;h2 id="前言"&gt;前言&lt;/h2&gt;
&lt;p&gt;我个人搭建SIP的主要目的是因为我个人有很多手机卡，而手机只有2个卡槽，并且每年出国玩的时候手机带出去就是全球漫游，那基本不敢打电话。所以决定搭建一套自己的SIP Server来进行拨打接听电话，手机里只放一张流量卡，而且在不同地点可以在手机原理身边的时候在其他终端接听电话。还能研究学习一项新技术（笑）&lt;/p&gt;
&lt;p&gt;经过多放考虑最后我选择了Synway出品的SMG4004-4LC这款GOIP机器，支持全网通，4个卡槽（长期应该是够用了），SMS Over Email（虽然他也支持SMS Over SIP，但由于FreePBX官方不支持，而且本次我分机主要创建的是PJSIP，而这款机器的SMS是通过Chan SIP发送的，处理起来很麻烦，最后选择了使用Email接收的方式【稳定一些】，当然官方提供了大量API接口，应该是可以写一些机器人发送到如Telegram之类的【已解决，本站有提供】），而且国内还有代理商，可以很方便的买到。&lt;/p&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-11%20at%2020.21.31@2x.png" alt="CleanShot 2025-05-11 at 20.21.31@2x"&gt;
卡槽界面
&lt;img src="assets/CleanShot%202025-05-11%20at%2020.21.57@2x.png" alt="CleanShot 2025-05-11 at 20.21.57@2x"&gt;&lt;/p&gt;
&lt;h2 id="搭建freepbx"&gt;搭建FreePBX&lt;/h2&gt;
&lt;p&gt;我直接使用了官方ISO镜像（基于CentOS）进行默认搭建，搭完还升了个级，关于FreePBX设置的教程网上很多，上几个图大家也可以参照我图里的进行设置。
&lt;img src="assets/CleanShot%202025-05-11%20at%2020.23.06@2x.png" alt="CleanShot 2025-05-11 at 20.23.06@2x"&gt;&lt;/p&gt;
&lt;h2 id="还要设置-pjsip的udptcp协议开启"&gt;还要设置 PJSIP的UDP,TCP协议开启&lt;/h2&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-11%20at%2020.23.46@2x.png" alt="CleanShot 2025-05-11 at 20.23.46@2x"&gt;&lt;/p&gt;
&lt;h2 id="软路由开启端口"&gt;软路由开启端口&lt;/h2&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-11%20at%2020.24.22@2x.png" alt="CleanShot 2025-05-11 at 20.24.22@2x"&gt;&lt;/p&gt;
&lt;h2 id="对接网关"&gt;对接网关&lt;/h2&gt;
&lt;p&gt;首先要将网关整机注册到FreePBX实现SIP互通&lt;/p&gt;
&lt;h2 id="创建中继账号"&gt;创建中继账号&lt;/h2&gt;
&lt;p&gt;选择创建一个 &lt;code&gt;chan_sip&lt;/code&gt; 中继
&lt;img src="assets/CleanShot%202025-05-11%20at%2020.25.14@2x.png" alt="CleanShot 2025-05-11 at 20.25.14@2x"&gt;
首先仅填写中继名
&lt;img src="assets/CleanShot%202025-05-11%20at%2020.25.36@2x.png" alt="CleanShot 2025-05-11 at 20.25.36@2x"&gt;
路由规则写 X.
&lt;img src="assets/CleanShot%202025-05-11%20at%2020.25.54@2x.png" alt="CleanShot 2025-05-11 at 20.25.54@2x"&gt;
SIP设置页面填写中继名、和中继配置（可参考下方我的配置）
&lt;img src="assets/CleanShot%202025-05-11%20at%2020.26.17@2x.png" alt="CleanShot 2025-05-11 at 20.26.17@2x"&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;host&lt;span style="color:#f92672"&gt;=&lt;/span&gt;dynamic
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;port&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;5160&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;type&lt;span style="color:#f92672"&gt;=&lt;/span&gt;peer
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;secret&lt;span style="color:#f92672"&gt;=&lt;/span&gt;da*********************随便设置个密码
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;context&lt;span style="color:#f92672"&gt;=&lt;/span&gt;from-pstn
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;dtmfmode&lt;span style="color:#f92672"&gt;=&lt;/span&gt;rfc2833
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;insecure&lt;span style="color:#f92672"&gt;=&lt;/span&gt;no
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;qualify&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;3000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="设置出局线路"&gt;设置出局线路&lt;/h2&gt;
&lt;p&gt;设置完中继之后我们还需要设置一下出局线路让FreePBX的分机可以成功走网关进行拨打
&lt;img src="assets/CleanShot%202025-05-11%20at%2020.27.15@2x.png" alt="CleanShot 2025-05-11 at 20.27.15@2x"&gt;
设置一下匹配中继
&lt;img src="assets/CleanShot%202025-05-11%20at%2020.27.32@2x.png" alt="CleanShot 2025-05-11 at 20.27.32@2x"&gt;
设置匹配正则表达式为 X.
&lt;img src="assets/CleanShot%202025-05-11%20at%2020.27.49@2x.png" alt="CleanShot 2025-05-11 at 20.27.49@2x"&gt;&lt;/p&gt;</description></item><item><title>自用ROS的MANGLE小包规则</title><link>https://hanigege.github.io/posts/routers/ros%E7%9A%84mangle%E5%B0%8F%E5%8C%85%E8%A7%84%E5%88%99/</link><pubDate>Sun, 11 May 2025 19:23:13 +0800</pubDate><guid>https://hanigege.github.io/posts/routers/ros%E7%9A%84mangle%E5%B0%8F%E5%8C%85%E8%A7%84%E5%88%99/</guid><description>&lt;h2 id="为了让网络低延迟小包优先真正生效科学的做法是禁用-fasttrack"&gt;为了让网络低延迟、小包优先真正生效，科学的做法是：&lt;code&gt;禁用 Fasttrack。&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;执行以下指令，找到并禁用 Fasttrack 规则：&lt;/p&gt;
&lt;p&gt;代码段&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ae81ff"&gt;/ip firewall filter&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# 查找带有 fasttrack-connection 动作的规则并禁用它&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ae81ff"&gt;disable [find action=fasttrack-connection]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;注意：禁用后，所有流量将交由 CPU 进行 Mangle 标记和 Queue 树排队。你的小包优先和限速机制将立刻 100% 生效。&lt;/p&gt;
&lt;h2 id="例外网下行是300m上行是30m的带宽"&gt;例：外网下行是300m，上行是30m的带宽&lt;/h2&gt;
&lt;p&gt;下行队列的挂载接口精准替换为 bridge1，上行接口保持 pppoe-out1&lt;/p&gt;
&lt;p&gt;成功的步骤与科学计算
预留缓冲避免光猫排队： 必须扣除运营商标称带宽的 5% 到 10%，将排队机制强行拉回到 RouterOS 本地处理，以彻底消除缓冲膨胀（Bufferbloat）带来的高延迟。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;上行严格阈值： 30M × 0.95 = 28M&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;下行严格阈值： 300M × 0.95 = 285M&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;重构挂载点： 将上行队列挂载在拨号接口，下行队列挂载在内网接口。Mangle 标记只需在 prerouting 和 postrouting 抓取一次，即可被上下行队列同时调用。&lt;/p&gt;
&lt;h2 id="1代码导入的方法"&gt;1、代码导入的方法&lt;/h2&gt;
&lt;p&gt;导入代码：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ae81ff"&gt;/ip firewall mangle&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# 1. 优先 DNS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ae81ff"&gt;add action=mark-packet chain=prerouting protocol=udp dst-port=53 new-packet-mark=dns passthrough=no&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ae81ff"&gt;add action=mark-packet chain=prerouting protocol=tcp dst-port=53 new-packet-mark=dns passthrough=no&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# 2. 优先 ICMP&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ae81ff"&gt;add action=mark-packet chain=prerouting protocol=icmp new-packet-mark=small-packet passthrough=no&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# 3. 根据包大小标记中小包 (覆盖 TCP ACK 和游戏数据)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ae81ff"&gt;add action=mark-packet chain=prerouting packet-size=0-128 new-packet-mark=small-packet passthrough=no&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ae81ff"&gt;add action=mark-packet chain=prerouting packet-size=129-512 new-packet-mark=medium-packet passthrough=no&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# 4. 剩余大包兜底 (下载、视频等)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ae81ff"&gt;add action=mark-packet chain=prerouting new-packet-mark=large-packet passthrough=no&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# 5. MSS 钳制&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ae81ff"&gt;add action=change-mss chain=forward protocol=tcp tcp-flags=syn new-mss=clamp-to-pmtu passthrough=yes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ae81ff"&gt;/queue tree&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# 清理旧队列&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ae81ff"&gt;remove [find]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# ================= 上行队列 (Upload) =================&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# 挂载到外网拨号接口 pppoe-out1，总带宽 28M&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ae81ff"&gt;add name=Upload-Total parent=pppoe-out1 max-limit=28M&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ae81ff"&gt;add name=U1-Dns parent=Upload-Total packet-mark=dns priority=1 queue=default-small limit-at=2M max-limit=28M&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ae81ff"&gt;add name=U2-Small parent=Upload-Total packet-mark=small-packet priority=2 queue=default-small limit-at=5M max-limit=28M&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ae81ff"&gt;add name=U3-Medium parent=Upload-Total packet-mark=medium-packet priority=3 queue=default-small limit-at=10M max-limit=28M&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ae81ff"&gt;add name=U4-Large parent=Upload-Total packet-mark=large-packet priority=8 queue=default-small limit-at=11M max-limit=28M&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# ================= 下行队列 (Download) =================&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# 挂载到内网桥接接口 bridge1，总带宽 285M&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ae81ff"&gt;add name=Download-Total parent=bridge1 max-limit=285M&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ae81ff"&gt;add name=D1-Dns parent=Download-Total packet-mark=dns priority=1 queue=default-small limit-at=5M max-limit=285M&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ae81ff"&gt;add name=D2-Small parent=Download-Total packet-mark=small-packet priority=2 queue=default-small limit-at=20M max-limit=285M&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ae81ff"&gt;add name=D3-Medium parent=Download-Total packet-mark=medium-packet priority=3 queue=default-small limit-at=50M max-limit=285M&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ae81ff"&gt;add name=D4-Large parent=Download-Total packet-mark=large-packet priority=8 queue=default-small limit-at=210M max-limit=285M&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;要让以上 QoS 规则真正生效，必须处理（禁用）防火墙中的 Fasttrack（硬件加速）规则，否则所有数据包都会直接绕过 Mangle 和 Queue 树。&lt;/p&gt;</description></item><item><title>Freebsd普通用户如何使用sudo</title><link>https://hanigege.github.io/posts/freebsd/freebsd%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8sudo/</link><pubDate>Sun, 11 May 2025 17:44:04 +0800</pubDate><guid>https://hanigege.github.io/posts/freebsd/freebsd%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8sudo/</guid><description>&lt;h3 id="我个人不建议安装开启sudo因为普通用户用自己的密码就可以提升管理权限个人理解还是完全隔离的好"&gt;我个人不建议安装开启sudo,因为普通用户用自己的密码就可以提升管理权限。个人理解还是完全隔离的好&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;**下面只提供知识点参考**～&lt;/code&gt;&lt;/p&gt;
&lt;h3 id="安装freebsd时已经添加好普通用户的可以直接从下面可以用-visudo-打开-sudo-配置文件-这里直接修改配置文件就可以了"&gt;安装freebsd时已经添加好普通用户的，可以直接从下面&lt;code&gt;可以用 visudo 打开 sudo 配置文件&lt;/code&gt; 这里直接修改配置文件就可以了。&lt;/h3&gt;
&lt;p&gt;你看到的提示：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;gary is not in the sudoers file.
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;This incident has been reported to the administrator.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;意思是：当前用户 gary 没有权限使用 sudo，因此不能安装软件或执行需要管理员权限的操作。&lt;/p&gt;
&lt;p&gt;解决办法（需要 root 用户操作）
你需要切换到 root 用户，然后把 gary 添加到 sudo 权限组。步骤如下：&lt;/p&gt;
&lt;p&gt;✅ 1. 用 root 用户登录，或者用 su 切换到 root：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;su -
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;系统会提示你输入 root 的密码，不是 gary 的密码。&lt;/p&gt;
&lt;p&gt;✅ 2. 安装 sudo（如果还没装）：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;pkg install sudo
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;✅ 3. 把 gary 用户添加到 wheel 组：(如果安装系统时已加入wheel组就不需要下面的再次操作）&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;pw usermod gary -G wheel
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;默认 FreeBSD 的 sudoers 文件允许 wheel 组的用户使用 sudo。&lt;/p&gt;</description></item><item><title>家庭聊天服务器系列（3）coturn服务搭建</title><link>https://hanigege.github.io/posts/other/%E5%AE%B6%E5%BA%AD%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B3%BB%E5%88%973coturn%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/</link><pubDate>Sun, 11 May 2025 16:42:06 +0800</pubDate><guid>https://hanigege.github.io/posts/other/%E5%AE%B6%E5%BA%AD%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B3%BB%E5%88%973coturn%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/</guid><description>&lt;h2 id="docker搭建coturn-turn服务器"&gt;docker搭建Coturn TURN服务器&lt;/h2&gt;
&lt;h2 id="共两种方案"&gt;共两种方案：&lt;/h2&gt;
&lt;h2 id="第一种方案要了解"&gt;第一种方案（要了解）&lt;/h2&gt;
&lt;h4 id="先建立一个文件夹"&gt;先建立一个文件夹&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;mkdir -p ~/data/docker_data/coturn/etc/coturn
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;mkdir -p ~/data/docker_data/coturn/var/run
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;mkdir -p ~/data/docker_data/coturn/var/log &lt;span style="color:#75715e"&gt;#如果用下面第一种方案这个才需要建立，第二种不需要&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cd ~/data/docker_data/coturn/etc/coturn
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;touch turnserver.conf
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cd ~/data/docker_data/coturn/var/run
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;touch turnserver.pid
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cd ../../
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;chmod &lt;span style="color:#ae81ff"&gt;777&lt;/span&gt; -R var
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;拉取镜像&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; docker pull coturn/coturn
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;直接host方式运行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; docker run -d --network&lt;span style="color:#f92672"&gt;=&lt;/span&gt;host &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; -v /root/data/docker_data/coturn/etc/coturn/turnserver.conf:/etc/coturn/turnserver.conf &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; -v /root/data/docker_data/coturn/etc/:/etc/ &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; -v /root/data/docker_data/coturn/var:/var &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; coturn/coturn
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;运行时不加 -d 先看输入有错误吗！
同时查看var下的log看相关的问题
调试启动命令：停止容器后会自动图删除容器，命令如下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;docker run --network&lt;span style="color:#f92672"&gt;=&lt;/span&gt;host &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; -v /root/data/docker_data/coturn/etc/coturn/turnserver.conf:/etc/coturn/turnserver.conf &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; -v /root/data/docker_data/coturn/etc/:/etc/ &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; -v /root/data/docker_data/coturn/var:/var &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; --rm &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; coturn/coturn
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;哪果去掉了配置文件里的指定log，停用cli功能，下面有说明，可以用下面的启动命令：&lt;/p&gt;</description></item><item><title>家庭聊天服务器系列（2）ntfy服务搭建</title><link>https://hanigege.github.io/posts/other/%E5%AE%B6%E5%BA%AD%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B3%BB%E5%88%972ntfy%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/</link><pubDate>Sun, 11 May 2025 16:34:01 +0800</pubDate><guid>https://hanigege.github.io/posts/other/%E5%AE%B6%E5%BA%AD%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B3%BB%E5%88%972ntfy%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/</guid><description>&lt;br&gt;
&lt;h3 id="ntfy-无需注册的通知服务"&gt;ntfy 无需注册的通知服务&lt;/h3&gt;
&lt;h4 id="最下面是恢复备份的方案"&gt;最下面是恢复备份的方案：&lt;/h4&gt;
&lt;p&gt;##​​ 什么是 ntfy ？
​ntfy​​​（发音：notify​​​）是一个简单的基于 HTTP​​​ 的 pub-sub​​​ 通知服务。它允许您通过任何计算机上的脚本向您的手机或桌面发送通知，完全无需注册或费用。&lt;/p&gt;
&lt;h4 id="官方提供了免费的版本httpsntfyshapp"&gt;官方提供了免费的版本：https://ntfy.sh/app&lt;/h4&gt;
&lt;h2 id="安装"&gt;安装&lt;/h2&gt;
&lt;p&gt;新建文件：docker-compose.yml
脚本如下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;services:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; ntfy:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; image: binwiederhier/ntfy:latest
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; container_name: ntfy
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; command:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - serve
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; environment:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - TZ&lt;span style="color:#f92672"&gt;=&lt;/span&gt;Asia/Shanghai
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; volumes:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - /root/data/docker_data/ntfy/data/cache:/var/cache/ntfy
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - /root/data/docker_data/ntfy/data/config:/etc/ntfy
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; ports:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - 12332:80
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; restart: unless-stopped
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; networks:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - matrix
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;networks:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; matrix:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; name: matrix
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;代码中的反向代理npm转发外出端口12332 。&lt;/p&gt;
&lt;p&gt;上面的代码中会自建 网络matrix.&lt;/p&gt;
&lt;h2 id="如果先行自己建立网络如"&gt;如果先行自己建立网络，如：&lt;/h2&gt;
&lt;p&gt;建立一个 docker network：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;docker network create matrix
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;那么您可以按照之前提到的建议在 Docker Compose 文件中将网络定义标记为外部网络，并且指定正确的网络名称。在您的 Docker Compose 文件中，您可以将网络定义修改为类似以下内容：&lt;/p&gt;</description></item><item><title>家庭聊天服务器系列（1）synapse搭建</title><link>https://hanigege.github.io/posts/other/%E5%AE%B6%E5%BA%AD%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B3%BB%E5%88%971synapse%E6%90%AD%E5%BB%BA/</link><pubDate>Sun, 11 May 2025 16:24:14 +0800</pubDate><guid>https://hanigege.github.io/posts/other/%E5%AE%B6%E5%BA%AD%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B3%BB%E5%88%971synapse%E6%90%AD%E5%BB%BA/</guid><description>&lt;br&gt;
&lt;h2 id="设计思路"&gt;设计思路&lt;/h2&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-11%20at%2016.27.38@2x.png" alt="CleanShot 2025-05-11 at 16.27.38@2x"&gt;&lt;/p&gt;
&lt;h3 id="服务器需要2台外网一台vps即可搭建coturn服务本地一台搭建synapse及ntfy服务所有服务均以docker的方式来搭建"&gt;服务器需要2台，外网一台vps即可，搭建coturn服务。本地一台，搭建synapse及ntfy服务，所有服务均以docker的方式来搭建&lt;/h3&gt;
&lt;h4 id="1-ntfy服务因为很多的限制导致消息无法传达类似于你消息来了确收不到通知提醒"&gt;1. ntfy服务：因为很多的限制导致消息无法传达，类似于你消息来了，确收不到通知提醒.&lt;/h4&gt;
&lt;h4 id="2-coturn-是一个-stunturn-服务器-实现主要用于-webrtcvoip视频会议等实时通信应用中解决nat-穿透问题coturn-同时实现了-stun--turn通常用作-webrtc-的中继服务器确保视频语音连接在各种复杂网络环境下都能建立"&gt;2. coturn 是一个 STUN/TURN 服务器 实现，主要用于 WebRTC、VoIP、视频会议等实时通信应用中，解决NAT 穿透问题。coturn 同时实现了 STUN + TURN，通常用作 WebRTC 的中继服务器，确保视频/语音连接在各种复杂网络环境下都能建立。&lt;/h4&gt;
&lt;h4 id="3-synapse聊天服务器主体支持文字语音在线语音电话在线视频文件传送是一套完整可持续的聊天服务"&gt;3. synapse聊天服务器主体，支持文字，语音，在线语音电话，在线视频，文件传送，是一套完整可持续的聊天服务。&lt;/h4&gt;
&lt;h4 id="4-客户端有很多种官网上都有介绍这里只推荐使用element客户端"&gt;4. 客户端有很多种，官网上都有介绍，这里只推荐使用Element客户端。&lt;/h4&gt;
&lt;p&gt;最最下面是备份恢复的方法，如何备份，把相关docker文件夹打包下载就可以了，需要恢复的时候，上传到相关的服务器，放在root文件夹下。&lt;/p&gt;
&lt;h4 id="切记synapae服务器不可以使用fakeip的dns代理上网只能用本地的网络不然会收不到消息ntfy会出问题"&gt;切记，SYNAPAE服务器不可以使用fakeip的DNS代理上网，只能用本地的网络，不然，会收不到消息NTFY会出问题！&lt;/h4&gt;
&lt;p&gt;前言
首先必须介绍下Matrix。Matrix是一个开源、可交互、去中心化的实时通信服务框架。使用Matrix可以搭建安全的通信服务器，配合支持 Matrix 的客户端可以实现个人、团队间的实时聊天交互。&lt;/p&gt;
&lt;p&gt;与常见的QQ、微信、钉钉相比，Matrix的特点就是开源，可私有化部署，保证通信的安全和隐私。与Rocket.chat、MatterMost相比，matrix的特点还要再加上去中心化。每个运行Matrix的服务器都是一个节点，用户可以选择在任意节点注册、连接，同一个节点内的用户可以任意通信。同时，节点与节点之间也可以通过联锁（Federation）机制进行通信，实现不同节点的用户之间进行通信。&lt;/p&gt;
&lt;p&gt;因为Matrix只是个框架，可以有很多实现，本文使用的synapse就是其中一个服务端实现。&lt;/p&gt;
&lt;p&gt;除了安装服务端，本文还有安装element web端的步骤。&lt;/p&gt;
&lt;p&gt;搭一个demo并不耗资源，加上postgresql数据库才用了200MB内存不到，如果用默认的sqlite数据库会更省内存。&lt;/p&gt;
&lt;h1 id="安装服务端"&gt;安装服务端&lt;/h1&gt;
&lt;h2 id="更新环境"&gt;更新环境&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;apt update -y &lt;span style="color:#f92672"&gt;&amp;amp;&amp;amp;&lt;/span&gt; apt upgrade -y &lt;span style="color:#f92672"&gt;&amp;amp;&amp;amp;&lt;/span&gt; apt install -y curl wget sudo socat
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="安装-docker"&gt;安装 Docker&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;curl -fsSL https://get.docker.com -o get-docker.sh &lt;span style="color:#f92672"&gt;&amp;amp;&amp;amp;&lt;/span&gt; sh get-docker.sh
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;curl -L &lt;span style="color:#e6db74"&gt;&amp;#34;https://github.com/docker/compose/releases/download/v2.16.0/docker-compose-&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;$(&lt;/span&gt;uname -s&lt;span style="color:#66d9ef"&gt;)&lt;/span&gt;&lt;span style="color:#e6db74"&gt;-&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;$(&lt;/span&gt;uname -m&lt;span style="color:#66d9ef"&gt;)&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; -o /usr/local/bin/docker-compose 
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;chmod +x /usr/local/bin/docker-compose
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="搭建synapse"&gt;搭建Synapse&lt;/h2&gt;
&lt;p&gt;按照教程建立/data/synapse/下的三个文件夹：&lt;/p&gt;</description></item><item><title>Vyos下安装ddns-Go</title><link>https://hanigege.github.io/posts/routers/vyos%E4%B8%8B%E5%AE%89%E8%A3%85ddns-go/</link><pubDate>Sun, 11 May 2025 14:51:24 +0800</pubDate><guid>https://hanigege.github.io/posts/routers/vyos%E4%B8%8B%E5%AE%89%E8%A3%85ddns-go/</guid><description>&lt;br&gt;
&lt;h2 id="这里使用vyos自管理容器的方法可以获取到网卡公网ip"&gt;这里使用vyos自管理容器的方法,可以获取到网卡公网ip&lt;/h2&gt;
&lt;h3 id="操作前vyos本机先科学不然没法接docker镜像"&gt;操作前，vyos本机先科学，不然没法接docker镜像&lt;/h3&gt;
&lt;p&gt;    这种模式不可以设置单独的IP,因为使用的是vyos主机的ip&lt;/p&gt;
&lt;p&gt;    桥接的网络如果没有，可以建一个的：原因是方便 ddns-go使用内网的网址登录 ：172.23.0.1 (可选，非必须，也可以用内外网口ip登录)&lt;/p&gt;
&lt;h2 id="创建桥接网络"&gt;创建桥接网络&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set container network ct-network prefix &lt;span style="color:#e6db74"&gt;&amp;#39;172.23.0.0/24&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="提前建立好ddns的映射本地持久目录"&gt;提前建立好ddns的映射本地持久目录：&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;mkdir -p /config/containers/ddns
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="拉取容器镜像"&gt;拉取容器镜像&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ add container image &lt;span style="color:#e6db74"&gt;&amp;#39;jeessy/ddns-go&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="搭建ddns-go"&gt;搭建ddns-go&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set container name ddns-go allow-host-networks &lt;span style="color:#75715e"&gt;#允许容器使用主机网络（host network），也就是说，容器不会有独立的网络接口，而是直接使用 VyOS 主机的网络&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set container name ddns-go image &lt;span style="color:#e6db74"&gt;&amp;#39;docker.io/jeessy/ddns-go&amp;#39;&lt;/span&gt; &lt;span style="color:#75715e"&gt;#指定该容器使用的 Docker 镜像&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set container name ddns-go restart &lt;span style="color:#e6db74"&gt;&amp;#39;always&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set container name ddns-go volume config destination &lt;span style="color:#e6db74"&gt;&amp;#39;/root/&amp;#39;&lt;/span&gt; &lt;span style="color:#75715e"&gt;#映射容器内的路径&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set container name ddns-go volume config source &lt;span style="color:#e6db74"&gt;&amp;#39;/config/containers/ddns&amp;#39;&lt;/span&gt; &lt;span style="color:#75715e"&gt;#映射本地的路役&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="查看运行是否成功有up即成功"&gt;查看运行是否成功有UP即成功&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;sudo podman ps -s
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;sudo podman ps -a
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="登录管理平台"&gt;登录管理平台&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;http://IP:9876
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;登录用户名：admin&lt;/p&gt;</description></item><item><title>让freebsd在终端下换源</title><link>https://hanigege.github.io/posts/freebsd/%E8%AE%A9freebsd%E5%9C%A8%E7%BB%88%E7%AB%AF%E4%B8%8B%E6%8D%A2%E6%BA%90/</link><pubDate>Sun, 11 May 2025 13:52:12 +0800</pubDate><guid>https://hanigege.github.io/posts/freebsd/%E8%AE%A9freebsd%E5%9C%A8%E7%BB%88%E7%AB%AF%E4%B8%8B%E6%8D%A2%E6%BA%90/</guid><description>&lt;br&gt;
&lt;h2 id="pkg-换源"&gt;pkg 换源&lt;/h2&gt;
&lt;p&gt;若要获取滚动更新的包，请将 quarterly 修改为 latest。二者区别见 FreeBSD 手册。请注意，CURRENT 版本只有 latest。&lt;/p&gt;
&lt;p&gt;使用命令修改系统级 pkg 源使用 latest：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;sed -i &amp;#39;&amp;#39; &amp;#39;s/quarterly/latest/g&amp;#39; /etc/pkg/FreeBSD.conf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;创建用户级源目录和文件：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;# mkdir -p /usr/local/etc/pkg/repos
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;# nano /usr/local/etc/pkg/repos/mirrors.conf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;中国科学技术大学开源软件镜像站（USTC）&lt;/p&gt;
&lt;p&gt;写入以下内容：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;ustc: {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;url: &amp;#34;http://mirrors.ustc.edu.cn/freebsd-pkg/${ABI}/latest&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;FreeBSD: { enabled: no }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;南京大学开源镜像站&lt;/p&gt;
&lt;p&gt;写入以下内容：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;nju: {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;url: &amp;#34;http://mirrors.nju.edu.cn/freebsd-pkg/${ABI}/latest&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;FreeBSD: { enabled: no }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;网易开源镜像站&lt;/p&gt;
&lt;p&gt;写入以下内容：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;163: {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;url: &amp;#34;http://mirrors.163.com/freebsd-pkg/${ABI}/latest&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;FreeBSD: { enabled: no }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="ports-源以源代码方式编译安装软件的包管理器"&gt;ports 源：以源代码方式编译安装软件的包管理器&lt;/h2&gt;
&lt;p&gt;下载 ports
这个源是下载 ports 本身的源。等同于以前的 portsnap。&lt;/p&gt;</description></item><item><title>让freebsd在终端下支持中文</title><link>https://hanigege.github.io/posts/freebsd/%E8%AE%A9freebsd%E5%9C%A8%E7%BB%88%E7%AB%AF%E4%B8%8B%E6%94%AF%E6%8C%81%E4%B8%AD%E6%96%87/</link><pubDate>Sun, 11 May 2025 13:48:46 +0800</pubDate><guid>https://hanigege.github.io/posts/freebsd/%E8%AE%A9freebsd%E5%9C%A8%E7%BB%88%E7%AB%AF%E4%B8%8B%E6%94%AF%E6%8C%81%E4%B8%AD%E6%96%87/</guid><description>&lt;br&gt;
&lt;h2 id="编辑etcloginconf结尾处我一般在russian段落后面添加"&gt;编辑/etc/login.conf，结尾处（我一般在russian段落后面）添加&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;chinese|Chinese Users Accounts:&lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; :charset&lt;span style="color:#f92672"&gt;=&lt;/span&gt;UTF-8:&lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; :lang&lt;span style="color:#f92672"&gt;=&lt;/span&gt;zh_CN.UTF-8:&lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; :setenv&lt;span style="color:#f92672"&gt;=&lt;/span&gt;LC_ALL&lt;span style="color:#f92672"&gt;=&lt;/span&gt;zh_CN.UTF-8:&lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; :tc&lt;span style="color:#f92672"&gt;=&lt;/span&gt;default:
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="之后运行"&gt;之后运行&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cap_mkdb /etc/login.conf
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;pw usermod root -L chinese
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description></item><item><title>Freebsd编译安装和使用bash</title><link>https://hanigege.github.io/posts/freebsd/freebsd%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8bash/</link><pubDate>Sun, 11 May 2025 13:33:20 +0800</pubDate><guid>https://hanigege.github.io/posts/freebsd/freebsd%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8bash/</guid><description>&lt;br&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;freebsd系统我建议是用普通用户登录使用，bash指令集只修改普通用户使用，root用户不要改。
&lt;br&gt;&lt;br&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;🧱 原因一：bash 通常安装在 /usr/local/bin，而不是 /bin
&lt;br&gt;&lt;br&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;FreeBSD 遵循传统 Unix 的目录结构，系统核心工具位于 /bin、/sbin、/usr/bin 等，而 /usr/local/bin 是用于第三方软件的。&lt;br&gt;&lt;br&gt;
&lt;p&gt;    如果你将 root 的 shell 改为 /usr/local/bin/bash，但 /usr/local 没挂载或出故障了，就无法登录或修复系统。&lt;/p&gt;
&lt;p&gt;    这在 单用户模式（single user mode）或系统修复环境中 是个大问题：系统通常只挂载了根分区 /，并不会挂载 /usr。&lt;/p&gt;
&lt;p&gt;⸻&lt;/p&gt;
&lt;p&gt;🧯 原因二：系统启动时的最小可用环境中没有 bash&lt;/p&gt;
&lt;p&gt;    系统启动早期可能 bash 还没被加载，root 就必须依赖 /bin/sh 之类的最基本 shell。
    如果你用的是 bash，而 bash 又不可用，那你甚至连 shell 都打不开。&lt;/p&gt;
&lt;h2 id="1安装bash"&gt;1.安装bash&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cd /usr/ports/shells/bash
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;make install clean
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在/bin目录下面做一个符号连接。（这一步可以不做，可选）&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;ln -s /usr/local/bin/bash /bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="加入bash如果上一步做了"&gt;加入bash,如果上一步做了&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;echo &lt;span style="color:#e6db74"&gt;&amp;#39;/bin/bash&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; /etc/shells
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;保持默认路径的用下面的&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;echo &lt;span style="color:#e6db74"&gt;&amp;#39;/usr/local/bin/bash&amp;#39;&lt;/span&gt; | sudo tee -a /etc/shells
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;4.更改用户shell(root用户不建议修改）&lt;/p&gt;</description></item><item><title>安装freebsd13.1流程(14.2版本的一样)</title><link>https://hanigege.github.io/posts/freebsd/freebsd-install/</link><pubDate>Sun, 11 May 2025 13:12:51 +0800</pubDate><guid>https://hanigege.github.io/posts/freebsd/freebsd-install/</guid><description>&lt;br&gt;
&lt;h2 id="开始安装回车"&gt;开始安装，回车&lt;/h2&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-05%20at%2007.07.59@2x.png" alt="CleanShot 2025-05-05 at 07.07.59@2x"&gt;&lt;/p&gt;
&lt;h2 id="直接回车"&gt;直接回车&lt;/h2&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-05%20at%2007.08.27@2x.png" alt="CleanShot 2025-05-05 at 07.08.27@2x"&gt;&lt;/p&gt;
&lt;h2 id="填写主机名-可直接回车"&gt;填写主机名 （可直接回车）&lt;/h2&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-05%20at%2007.09.40@2x.png" alt="CleanShot 2025-05-05 at 07.09.40@2x"&gt;&lt;/p&gt;
&lt;h2 id="默认的基础上多加一个安装ports"&gt;默认的基础上多加一个安装ports&lt;/h2&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-05%20at%2007.12.20@2x.png" alt="CleanShot 2025-05-05 at 07.12.20@2x"&gt;&lt;/p&gt;
&lt;h2 id="这里我选择ufs虚拟机我建议选ufs"&gt;这里我选择UFS（虚拟机我建议选UFS）&lt;/h2&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-05%20at%2007.12.44@2x.png" alt="CleanShot 2025-05-05 at 07.12.44@2x"&gt;&lt;/p&gt;
&lt;h2 id="直接回车-1"&gt;直接回车&lt;/h2&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-05%20at%2007.13.30@2x.png" alt="CleanShot 2025-05-05 at 07.13.30@2x"&gt;&lt;/p&gt;
&lt;h2 id="选择gpt"&gt;选择GPT&lt;/h2&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-05%20at%2007.14.48@2x.png" alt="CleanShot 2025-05-05 at 07.14.48@2x"&gt;&lt;/p&gt;
&lt;h2 id="finish"&gt;finish&lt;/h2&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-05%20at%2007.15.11@2x.png" alt="CleanShot 2025-05-05 at 07.15.11@2x"&gt;&lt;/p&gt;
&lt;h2 id="commit"&gt;commit&lt;/h2&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-05%20at%2007.15.38@2x.png" alt="CleanShot 2025-05-05 at 07.15.38@2x"&gt;&lt;/p&gt;
&lt;h2 id="开始安装"&gt;开始安装&lt;/h2&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-05%20at%2007.16.02@2x.png" alt="CleanShot 2025-05-05 at 07.16.02@2x"&gt;&lt;/p&gt;
&lt;h2 id="安装好后会提示设定root密码"&gt;安装好后会提示设定root密码&lt;/h2&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-05%20at%2007.16.32@2x.png" alt="CleanShot 2025-05-05 at 07.16.32@2x"&gt;&lt;/p&gt;
&lt;h2 id="ok-设置网络"&gt;ok 设置网络&lt;/h2&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-05%20at%2007.17.10@2x.png" alt="CleanShot 2025-05-05 at 07.17.10@2x"&gt;&lt;/p&gt;
&lt;h2 id="选no-自设置ip地址"&gt;选no ,自设置ip地址&lt;/h2&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-05%20at%2007.17.43@2x.png" alt="CleanShot 2025-05-05 at 07.17.43@2x"&gt;&lt;/p&gt;
&lt;h2 id="设置完点ok"&gt;设置完点ok&lt;/h2&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-05%20at%2007.18.33@2x.png" alt="CleanShot 2025-05-05 at 07.18.33@2x"&gt;&lt;/p&gt;</description></item><item><title>Alpine Linux搭建sing-box服务端</title><link>https://hanigege.github.io/posts/linux/alpine-linux-sing-box/</link><pubDate>Sun, 11 May 2025 12:14:50 +0800</pubDate><guid>https://hanigege.github.io/posts/linux/alpine-linux-sing-box/</guid><description>&lt;br&gt;
现在有很多便宜NAT鸡因为配置较低，所以只选用的是Alpine Linux,所以我就随便写了个教程方便使用。
&lt;h2 id="安装依赖"&gt;安装依赖&lt;/h2&gt;
&lt;p&gt;首先先安装singbox,还有vim（方便编辑）&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;echo &lt;span style="color:#e6db74"&gt;&amp;#34;@testing https://dl-cdn.alpinelinux.org/alpine/edge/testing&amp;#34;&lt;/span&gt; &lt;span style="color:#f92672"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style="color:#f92672"&gt;/&lt;/span&gt;etc&lt;span style="color:#f92672"&gt;/&lt;/span&gt;apk&lt;span style="color:#f92672"&gt;/&lt;/span&gt;repositories
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;apk add sing&lt;span style="color:#f92672"&gt;-&lt;/span&gt;box&lt;span style="color:#a6e22e"&gt;@testing&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;apk add vim
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;rc&lt;span style="color:#f92672"&gt;-&lt;/span&gt;update add sing&lt;span style="color:#f92672"&gt;-&lt;/span&gt;box default
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="设置自启"&gt;设置自启.&lt;/h2&gt;
&lt;h4 id="1这里要说明一下上面安装好后默认会自动生成启动文件etcinitdsing-box-"&gt;1.这里要说明一下，上面安装好后默认会自动生成启动文件&lt;code&gt;/etc/init.d/sing-box &lt;/code&gt;,&lt;/h4&gt;
&lt;p&gt;配置文件在
&lt;code&gt;/etc/sing-box/config.json&lt;/code&gt;&lt;/p&gt;
&lt;h4 id="2如果用下面自建的默认的就不用启动就行了更不要设置自启动以免冲突"&gt;2.如果用下面自建的，默认的就不用启动就行了，更不要设置自启动，以免冲突。&lt;/h4&gt;
&lt;p&gt;编辑这个文件：&lt;code&gt;vim /etc/init.d/singbox&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;#!/sbin/openrc-run
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;command&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;/usr/bin/sing-box&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;command_args&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;run -c /root/config.json&amp;#34;&lt;/span&gt; &lt;span style="color:#75715e"&gt;#是您的配置文件位置&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;description&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;singbox service&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;depend&lt;span style="color:#f92672"&gt;()&lt;/span&gt; &lt;span style="color:#f92672"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; need net
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; use logger
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;start&lt;span style="color:#f92672"&gt;()&lt;/span&gt; &lt;span style="color:#f92672"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; ebegin &lt;span style="color:#e6db74"&gt;&amp;#34;Starting singbox&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; start-stop-daemon --start --background --exec $command -- $command_args
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; eend $?
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;stop&lt;span style="color:#f92672"&gt;()&lt;/span&gt; &lt;span style="color:#f92672"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; ebegin &lt;span style="color:#e6db74"&gt;&amp;#34;Stopping singbox&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; start-stop-daemon --stop --exec $command
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; eend $?
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;然后加入OpenRC自启动&lt;/p&gt;</description></item><item><title>Sing-Box中的ss服务的写法配置</title><link>https://hanigege.github.io/posts/routers/sing-box-ss-server/</link><pubDate>Sun, 11 May 2025 12:07:27 +0800</pubDate><guid>https://hanigege.github.io/posts/routers/sing-box-ss-server/</guid><description>&lt;h2 id="服务端"&gt;服务端：&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span style="color:#e6db74"&gt;&amp;#34;shadowsocks&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;listen&amp;#34;&lt;/span&gt;: &lt;span style="color:#e6db74"&gt;&amp;#34;::&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;listen_port&amp;#34;&lt;/span&gt;: 58442,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;method&amp;#34;&lt;/span&gt;: &lt;span style="color:#e6db74"&gt;&amp;#34;chacha20-ietf-poly1305&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;password&amp;#34;&lt;/span&gt;: &lt;span style="color:#e6db74"&gt;&amp;#34;Um5zktQDo6GKqM1L/lLzwg==&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;multiplex&amp;#34;&lt;/span&gt;: &lt;span style="color:#f92672"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;enabled&amp;#34;&lt;/span&gt;: true
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="客户端"&gt;客户端：&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span style="color:#e6db74"&gt;&amp;#34;shadowsocks&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;tag&amp;#34;&lt;/span&gt;: &lt;span style="color:#e6db74"&gt;&amp;#34;ss-in-jygg-ros&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;server&amp;#34;&lt;/span&gt;: &lt;span style="color:#e6db74"&gt;&amp;#34;你的域名.xyz&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;server_port&amp;#34;&lt;/span&gt;: 58442,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;network_strategy&amp;#34;&lt;/span&gt;: &lt;span style="color:#e6db74"&gt;&amp;#34;hybrid&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;method&amp;#34;&lt;/span&gt;: &lt;span style="color:#e6db74"&gt;&amp;#34;chacha20-ietf-poly1305&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;password&amp;#34;&lt;/span&gt;: &lt;span style="color:#e6db74"&gt;&amp;#34;Um5zktQDo6GKqM1L/lLzwg==&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;udp_over_tcp&amp;#34;&lt;/span&gt;: false
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description></item><item><title>Downloads</title><link>https://hanigege.github.io/downloads/</link><pubDate>Sun, 11 May 2025 11:50:45 +0800</pubDate><guid>https://hanigege.github.io/downloads/</guid><description>&lt;h2 id="三汇smg4004-4lc的升级文件"&gt;三汇SMG4004-4LC的升级文件&lt;/h2&gt;
&lt;br&gt;
&lt;p&gt;1、先升级web固件包
&lt;a href="https://drive.google.com/file/d/1NApkdy91PhARGWWxVDafBiDEFvK0_8G2/view?usp=sharing"&gt;install4_2.2.8_2020092516.tar.gz&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;2、再升级底层固件包
&lt;a href="https://drive.google.com/file/d/1vYljqzx4Zi0f0cRjymoxKoxWMq-LJbNN/view?usp=sharing"&gt;install4_FPGA_1.11_2.11_3.032018122015.tar.gz&lt;/a&gt;&lt;/p&gt;
&lt;h2 id="虚拟机承接三汇和telegram收发短信的机器人启动文件"&gt;虚拟机承接三汇和telegram收发短信的机器人启动文件&lt;/h2&gt;
&lt;br&gt;
&lt;p&gt;记的修改启动文件中的参数，里面有标注。&lt;a href="https://drive.google.com/file/d/1yJ5ZFjRru2csSIyduJ700zOy8zPUis7G/view?usp=sharing"&gt;sms.py&lt;/a&gt;&lt;/p&gt;</description></item><item><title>出国自建voip(二.2)三汇SMG4004-4LC的配置方法测试电话呼叫</title><link>https://hanigege.github.io/posts/other/sanhui-smg4004-4lc-set/</link><pubDate>Sun, 11 May 2025 11:29:46 +0800</pubDate><guid>https://hanigege.github.io/posts/other/sanhui-smg4004-4lc-set/</guid><description>&lt;h2 id="我使用的是三汇smg4004-4lc算是捡垃圾了这是以前的老款4口语音网关目前这款只能支持2g网络和短信我测试我这个地区只支持移动和联通不过也够用了"&gt;我使用的是三汇SMG4004-4LC（算是捡垃圾了，这是以前的老款），4口语音网关，目前这款只能支持2g网络和短信，我测试我这个地区只支持移动和联通。不过也够用了。&lt;/h2&gt;
&lt;h4 id="使用前需要先升能这款设备的固件相关升级文件本站有提供下载"&gt;使用前需要先升能这款设备的固件，相关升级文件，本站有提供下载。&lt;/h4&gt;
&lt;p&gt;照着下面设置，就可以测试电话呼叫了：
&lt;img src="assets/CleanShot%202025-05-11%20at%2011.31.37@2x.png" alt="CleanShot 2025-05-11 at 11.31.37@2x"&gt;
&lt;img src="assets/CleanShot%202025-05-11%20at%2011.31.50@2x.png" alt="CleanShot 2025-05-11 at 11.31.50@2x"&gt;
&lt;img src="assets/CleanShot%202025-05-11%20at%2011.32.01@2x.png" alt="CleanShot 2025-05-11 at 11.32.01@2x"&gt;&lt;/p&gt;</description></item><item><title>出国自建voip(二）创建 Telegram 机器人</title><link>https://hanigege.github.io/posts/other/sanhui-telegram-bot-4/</link><pubDate>Sun, 11 May 2025 11:19:47 +0800</pubDate><guid>https://hanigege.github.io/posts/other/sanhui-telegram-bot-4/</guid><description>&lt;p&gt;要通过 Telegram 机器人 对接 三汇语音网关（SMG4000-C1LC） 的短信功能，您需要完成以下几个步骤：&lt;/p&gt;
&lt;h2 id="步骤-1"&gt;步骤 1：&lt;/h2&gt;
&lt;p&gt;打开 Telegram，搜索并与 BotFather 聊天。&lt;/p&gt;
&lt;p&gt;发送命令 /newbot 来创建一个新的机器人。&lt;/p&gt;
&lt;p&gt;给机器人起个名字并设置用户名。&lt;/p&gt;
&lt;p&gt;BotFather 会给你一个 API Token，用来与 Telegram 机器人进行交互。保存好这个 &lt;code&gt;Token&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;步骤 2：配置三汇网关发送短信
三汇语音网关一般支持通过 HTTP API 或 SMTP 发送短信。首先，确保三汇网关的短信服务已经启用，并且能够通过接口发送短信。&lt;/p&gt;
&lt;p&gt;步骤 3：编写 Telegram 机器人和三汇网关的对接脚本 （本站有提供下载）
你需要编写一个脚本，使用 Telegram 机器人获取信息，并通过 HTTP 请求将短信发送到三汇网关。&lt;/p&gt;
&lt;p&gt;步骤 3.1：安装 Telegram Bot 库（例如 Python 的 python-telegram-bot）（详情，请看voip出国系列三）&lt;/p&gt;</description></item><item><title>出国自建voip(一)Freepbx16配置</title><link>https://hanigege.github.io/posts/other/freepbx16-set-all-1/</link><pubDate>Sun, 11 May 2025 06:43:58 +0800</pubDate><guid>https://hanigege.github.io/posts/other/freepbx16-set-all-1/</guid><description>&lt;br&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;为什么要建回家voip系统，出国后，电话就是国际长途，打电话收发短信都不方便，有没有办法可以做到通过网络传递语音和收发短信（利用telegram机器人），当然可以，手机卡可以放在国内的小设备上，自己手机上装一个sip软电话客户端，即可完全实现，接听拨打电话，收发短信，并且不会再受地域限制，仅限学习交流，友情提醒，不要做违反当地法律法规的事。
&lt;h1 id="开始操作"&gt;开始操作&lt;/h1&gt;
&lt;h4 id="架构"&gt;架构&lt;/h4&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-11%20at%2011.14.14@2x.png" alt="CleanShot 2025-05-11 at 11.14.14@2x"&gt;&lt;/p&gt;
&lt;h2 id="freepbx16首先修改ip为固定ip"&gt;freepbx16首先修改ip为固定ip&lt;/h2&gt;
&lt;p&gt;安装好后，系统其实是dhcp动态获得ip的，进入看了看，是Centos，我们不需要dhcp，把IP给固定死&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;vi &lt;span style="color:#f92672"&gt;/&lt;/span&gt;etc&lt;span style="color:#f92672"&gt;/&lt;/span&gt;sysconfig&lt;span style="color:#f92672"&gt;/&lt;/span&gt;network&lt;span style="color:#f92672"&gt;-&lt;/span&gt;scripts&lt;span style="color:#f92672"&gt;/&lt;/span&gt;ifcfg&lt;span style="color:#f92672"&gt;-&lt;/span&gt;eth0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;下面的内容跟实际配置文件里的内容相对替换，一一对应替换，原文件里的内容可能更多一些，只修改下面有的，没涉及的保持原来的，dns不可以用科学的，只允许用本地，不然会影响后面系统里nat-ip获取的准确性&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;TYPE=&amp;#34;Ethernet&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;BOOTPROTO=&amp;#34;static&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;IPADDR=10.8.2.60
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;NETMASK=255.255.255.0
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;GATEWAY=10.8.2.1
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;DNS1=114.114.114.114
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;DEFROUTE=&amp;#34;yes&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;NAME=&amp;#34;eth0&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;DEVICE=&amp;#34;eth0&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;ONBOOT=&amp;#34;yes&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;重启～&lt;/p&gt;
&lt;h1 id="freepbx16配置图例"&gt;freepbx16配置图例&lt;/h1&gt;
&lt;p&gt;freepbx16默认安装在pve系统上就好，登录系统后
：&lt;/p&gt;
&lt;h2 id="先进行asterisk-sip-设置"&gt;先进行asterisk sip 设置&lt;/h2&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-11%20at%2006.47.04@2x.png" alt="先进行asterisk sip 设置"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-11%20at%2006.56.27@2x.png" alt="CleanShot 2025-05-11 at 06.56.27@2x"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-11%20at%2006.59.32@2x.png" alt="CleanShot 2025-05-11 at 06.59.32@2x"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-11%20at%2007.03.35@2x.png" alt="CleanShot 2025-05-11 at 07.03.35@2x"&gt;&lt;/p&gt;
&lt;h2 id="现在开始设置系统中文地区时间"&gt;现在开始设置系统中文地区时间&lt;/h2&gt;
&lt;p&gt;选择高级设置：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-mysql" data-lang="mysql"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#960050;background-color:#1e0010"&gt;高级设置里一开始还有一个选项是启&lt;/span&gt;&lt;span style="color:#f92672"&gt;`&lt;/span&gt;chan_sip&lt;span style="color:#f92672"&gt;`&lt;/span&gt;,&lt;span style="color:#960050;background-color:#1e0010"&gt;这个记的要打开，不然后面设置中继或者是&lt;/span&gt;sip有些选项不显示
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-11%20at%2007.07.49@2x.png" alt="CleanShot 2025-05-11 at 07.07.49@2x"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-11%20at%2007.09.16@2x.png" alt="CleanShot 2025-05-11 at 07.09.16@2x"&gt;&lt;/p&gt;
&lt;h2 id="开启中继配置-这块设置是连接三汇语音网关的"&gt;开启中继配置 （这块设置是连接三汇语音网关的）&lt;/h2&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-11%20at%2007.12.25@2x.png" alt="CleanShot 2025-05-11 at 07.12.25@2x"&gt;
&lt;img src="assets/CleanShot%202025-05-11%20at%2007.13.45@2x.png" alt="CleanShot 2025-05-11 at 07.13.45@2x"&gt;
&lt;img src="assets/CleanShot%202025-05-11%20at%2007.13.57@2x.png" alt="CleanShot 2025-05-11 at 07.13.57@2x"&gt;
&lt;img src="assets/CleanShot%202025-05-11%20at%2007.14.08@2x.png" alt="CleanShot 2025-05-11 at 07.14.08@2x"&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;host&lt;span style="color:#f92672"&gt;=&lt;/span&gt;dynamic
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;port&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;5160&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;type&lt;span style="color:#f92672"&gt;=&lt;/span&gt;peer
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;secret&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;666&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;context&lt;span style="color:#f92672"&gt;=&lt;/span&gt;from&lt;span style="color:#f92672"&gt;-&lt;/span&gt;pstn
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;dtmfmode&lt;span style="color:#f92672"&gt;=&lt;/span&gt;rfc2833
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;insecure&lt;span style="color:#f92672"&gt;=&lt;/span&gt;no
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;qualify&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;3000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;照图填写就好，这里是内网传输使用的，端口不影响啥&lt;/p&gt;</description></item><item><title>出国自建voip(三.2）Telegram机器人连接程序自启动(补充篇)</title><link>https://hanigege.github.io/posts/other/telegram-sms-bot2/</link><pubDate>Sun, 11 May 2025 00:58:10 +0800</pubDate><guid>https://hanigege.github.io/posts/other/telegram-sms-bot2/</guid><description>&lt;h2 id="rootsms-source-myenvbinactivate"&gt;root@sms:~# source myenv/bin/activate&lt;/h2&gt;
&lt;h2 id="激活虚拟环境"&gt;激活虚拟环境&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;source myenv/bin/activate 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;(myenv) root@sms:~# nohup python sms.py &amp;gt; sms.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;后台启动sms.py&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;nohup python sms.py &amp;gt; sms.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;or
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;nohup python sms.py &amp;gt; sms.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;(myenv) root@sms:~#
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;上面的两条命令能不能做成脚本，设置为开机自启动&lt;/p&gt;
&lt;p&gt;可以的，你可以创建一个 systemd 服务 或者 编写一个 shell 脚本 来实现 Python 虚拟环境的激活 并 运行 sms.py 脚本，同时设置为 开机自启动。&lt;/p&gt;
&lt;p&gt;方法 1：使用 systemd (推荐)
适用于 Debian/Ubuntu 及大多数 Linux 发行版。&lt;/p&gt;
&lt;p&gt;步骤 1：创建 systemd 服务文件
运行以下命令，创建 sms.service：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;nano /etc/systemd/system/sms.service
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;填入以下内容：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;[Unit]
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Description=SMS Python Service
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;After=network.target
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;[Service]
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;User=root
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;WorkingDirectory=/root
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;ExecStart=/root/myenv/bin/python /root/sms.py
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Restart=always
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;StandardOutput=append:/root/sms.log
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;StandardError=append:/root/sms.log
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;[Install]
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;WantedBy=multi-user.target
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;⚠ 注意：&lt;/p&gt;</description></item><item><title>出国自建voip(三）连接Telegram机器人本地安装</title><link>https://hanigege.github.io/posts/other/telegram-sms-bot/</link><pubDate>Sun, 11 May 2025 00:39:56 +0800</pubDate><guid>https://hanigege.github.io/posts/other/telegram-sms-bot/</guid><description>&lt;h3 id="前提是telegram自己的机器人提前生成好并获取相应的密钥"&gt;前提是telegram自己的机器人提前生成好，并获取相应的密钥&lt;/h3&gt;
&lt;h1 id="打开一台虚拟机建议debian12"&gt;打开一台虚拟机（建议debian12)&lt;/h1&gt;
&lt;h2 id="方法-1使用虚拟环境"&gt;方法 1：使用虚拟环境&lt;/h2&gt;
&lt;p&gt;创建一个 Python 虚拟环境，并在其中安装所需的库。这样可以避免系统级 Python 环境的冲突。&lt;/p&gt;
&lt;p&gt;安装 python3-venv（如果未安装）&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;apt update
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;apt install python3&lt;span style="color:#f92672"&gt;-&lt;/span&gt;venv
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;创建一个新的虚拟环境&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; python3 &lt;span style="color:#f92672"&gt;-&lt;/span&gt;m venv myenv
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;激活虚拟环境&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;source myenv&lt;span style="color:#f92672"&gt;/&lt;/span&gt;bin&lt;span style="color:#f92672"&gt;/&lt;/span&gt;activate
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在虚拟环境中安装 python-telegram-bot&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;pip install python&lt;span style="color:#f92672"&gt;-&lt;/span&gt;telegram&lt;span style="color:#f92672"&gt;-&lt;/span&gt;bot smpplib
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;运行脚本：你可以在虚拟环境中运行你的 Telegram 机器人脚本,脚本&lt;code&gt;sms.py&lt;/code&gt;下载
命令：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;python sms&lt;span style="color:#f92672"&gt;.&lt;/span&gt;py
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;退出虚拟环境：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;deactivate
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="运行脚本有三种方案一种是运行在tmux虚拟窗口下二种是直接本地后台运行三种systemd进行管理-建议第三种"&gt;运行脚本有三种方案，一种是运行在tmux虚拟窗口下，二种是直接本地后台运行，三种systemd进行管理 （建议第三种）&lt;/h2&gt;
&lt;p&gt;以上要运行在虚拟窗口下，建议使用tmux&lt;/p&gt;
&lt;h4 id="1使用-tmux"&gt;1.使用 tmux&lt;/h4&gt;
&lt;p&gt;安装（如果未安装）：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;apt-get install tmux # Debian/Ubuntu 
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;yum install tmux # CentOS/RHEL
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;启动 Tmux 会话：
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;tmux&lt;/strong&gt;
按 Ctrl+B，然后按 D，会返回终端。&lt;/p&gt;
&lt;p&gt;关闭 SSH，程序继续运行。&lt;/p&gt;
&lt;p&gt;重新连接：&lt;/p&gt;
&lt;p&gt;列出会话：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;tmux ls
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;输出示例：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;0: 1 windows (created ...)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;恢复会话：&lt;/p&gt;</description></item><item><title>Vyos上网系统之-vyos命令技巧集(3)</title><link>https://hanigege.github.io/posts/routers/vyos-jiqiao-3/</link><pubDate>Sat, 10 May 2025 21:35:04 +0800</pubDate><guid>https://hanigege.github.io/posts/routers/vyos-jiqiao-3/</guid><description>&lt;h2 id="你可以使用-delete-和-set-命令来修改-network-group-的子网"&gt;你可以使用 delete 和 set 命令来修改 network-group 的子网。&lt;/h2&gt;
&lt;p&gt;修改 LAN-v4 的网络&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;删除原来的 192.168.10.0/24&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;delete firewall group network-group LAN-v4 network 192.168.10.0/24
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start="2"&gt;
&lt;li&gt;添加新的 192.168.100.0/24&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set firewall group network-group LAN-v4 network 192.168.100.0/24
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start="3"&gt;
&lt;li&gt;提交并保存&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;commit
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;save
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;验证修改是否生效&lt;/p&gt;
&lt;p&gt;执行以下命令：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;show firewall group network-group LAN-v4
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;如果输出如下，就说明修改成功：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; network-group LAN-v4 {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; network 192.168.100.0/24
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在 VyOS 中，你可以使用以下命令查看 所有配置：
显示完整的层级配置（推荐）&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;show configuration
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这个命令会以 层级结构 显示整个配置，类似于 show running-config。&lt;/p&gt;
&lt;p&gt;显示所有配置命令（适合复制）($ 模式下）&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;show configuration commands
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这个命令会以 show 命令的格式 展示所有配置，适用于备份或复制配置：&lt;/p&gt;</description></item><item><title>Vyos上网系列之-Fakeip配置(2)</title><link>https://hanigege.github.io/posts/routers/vyos-fakeip-2/</link><pubDate>Sat, 10 May 2025 21:25:08 +0800</pubDate><guid>https://hanigege.github.io/posts/routers/vyos-fakeip-2/</guid><description>&lt;h2 id="对于终端网关是vyos的通过mosdns来分流realip和fakeip的流量-可这样配置"&gt;对于终端网关是vyos的，通过mosdns来分流realip和fakeip的流量, 可这样配置:&lt;/h2&gt;
&lt;p&gt;(vyos的group分为address-group,network-group等)&lt;/p&gt;
&lt;h4 id="定义组-ip例"&gt;定义组 IP例:&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set firewall group address-group Telegram-v4 address &amp;#39;157.148.47.204&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set firewall group address-group Telegram-v4 address &amp;#39;182.43.124.6&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="定义组网段v4例"&gt;定义组网段V4例：&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set firewall group network-group Telegram-v4 network &amp;#39;91.108.56.0/22&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set firewall group network-group Telegram-v4 network &amp;#39;91.108.4.0/22&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;定义组telegram V4:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set firewall group network-group Telegram-v4 network &amp;#39;91.108.56.0/22&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set firewall group network-group Telegram-v4 network &amp;#39;91.108.4.0/22&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set firewall group network-group Telegram-v4 network &amp;#39;91.108.8.0/22&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set firewall group network-group Telegram-v4 network &amp;#39;91.108.16.0/22&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set firewall group network-group Telegram-v4 network &amp;#39;91.108.12.0/22&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set firewall group network-group Telegram-v4 network &amp;#39;149.154.160.0/20&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set firewall group network-group Telegram-v4 network &amp;#39;91.105.192.0/23&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set firewall group network-group Telegram-v4 network &amp;#39;91.108.20.0/22&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set firewall group network-group Telegram-v4 network &amp;#39;185.76.151.0/24&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="定义组ip-v6例"&gt;定义组ip-V6例：&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set firewall group ipv6-address-group Telegram-v6 address &amp;#39;2a00:1098:80:2::1004&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set firewall group ipv6-address-group Telegram-v6 address &amp;#39;2a00:1098:80:2::1001&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;定义组网段V6例：&lt;/p&gt;</description></item><item><title>Vyos上网系列之-上网配置（1）</title><link>https://hanigege.github.io/posts/routers/vyos-jibenshangwang-1/</link><pubDate>Sat, 10 May 2025 21:04:17 +0800</pubDate><guid>https://hanigege.github.io/posts/routers/vyos-jibenshangwang-1/</guid><description>&lt;h4 id="vyos的命令行界面是基于shell的没有图形界面-但是可以用tab自动补全"&gt;vyos的命令行界面是基于shell的，没有图形界面, 但是可以用tab自动补全.&lt;/h4&gt;
&lt;p&gt;本文的vyos命令是基于vyos的vyos-rolling-nightly-builds的1.5.x版本.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;**特别感谢大卫佬给予的指导与帮助**&lt;/code&gt;&lt;/p&gt;
&lt;h2 id="pve安装vyos"&gt;pve安装vyos:&lt;/h2&gt;
&lt;p&gt;下载nightly-build: &lt;a href="https://github.com/vyos/vyos-nightly-build/releases"&gt;https://github.com/vyos/vyos-nightly-build/releases&lt;/a&gt;
pve的虚拟机设置和安装(略), 建议内存2G, 磁盘10G或更大, 因为vyos可以运行容器, vyos用podman管理容器.&lt;/p&gt;
&lt;p&gt;vm运行后, 用vyos:vyos登录. 用命令&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;install image
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;安装vyos.&lt;/p&gt;
&lt;p&gt;进入配置模式：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;configure
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;生效：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;commit
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;保存配置：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;save
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;取消生效的,未保存的配置：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;discard
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="下面开始配置随时都可以输入生效命令如果不保存重启后配置会失效"&gt;下面开始配置，随时都可以输入生效命令，如果不保存，重启后配置会失效&lt;/h2&gt;
&lt;p&gt;设置ssh登录:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set service ssh port &amp;#39;22&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;创建用户gary:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set system login user gary full-name gary
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set system login user gary authentication plaintext-password &amp;#39;密码&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;建议ssh密钥登录:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set system login user gary authentication public-keys gary@laptop key &amp;#39;your-public-key&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set system login user gary authentication public-keys gary@laptop type &amp;#39;ssh-rsa&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;禁用默认的vyos用户:&lt;/p&gt;</description></item><item><title>About</title><link>https://hanigege.github.io/about/</link><pubDate>Sat, 10 May 2025 16:14:10 +0800</pubDate><guid>https://hanigege.github.io/about/</guid><description>&lt;h1 id="-简介"&gt;🧑‍💻 简介&lt;/h1&gt;
&lt;br&gt;
# 歡迎來到我的個人小站 🌐
你好！👋 這裡是我個人使用的一些業務配置方案的合集，完全是為了方便自己隨時查閱和學習，同時也適用於我的日常生活和家庭環境。✨
&lt;hr&gt;
&lt;h2 id="-主要涉及的技術領域"&gt;🖥️ 主要涉及的技術領域&lt;/h2&gt;
&lt;p&gt;我的小站主要涵蓋以下幾個技術領域：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Linux 系統&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;FreeBSD 系統&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;軟路由技術&lt;/strong&gt;（如：RouterOS、VyOS、OPNsense）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;通訊軟件方案&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;這些配置方案在我的家庭網絡中廣泛使用，提供了豐富的功能和保障，既能滿足個人需求，又能提高網絡效率和安全性。🛠️&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="-小站目的"&gt;💡 小站目的&lt;/h2&gt;
&lt;p&gt;這個站點不僅僅是我個人的技術備忘錄，也希望能為有類似需求的朋友們提供一些實用的參考。🙏 如果你和我有相同的興趣，或者正在尋找相關的技術方案，歡迎隨時訪問這裡。大家一起學習，共同進步！🚀&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;感謝你的訪問！💖 希望你能在這裡找到有用的內容。🚀&lt;/p&gt;</description></item><item><title>vyos多网口小主机桥接配置(完整)</title><link>https://hanigege.github.io/posts/routers/vyos-qiaojie-4kou/</link><pubDate>Wed, 07 May 2025 23:30:18 +0800</pubDate><guid>https://hanigege.github.io/posts/routers/vyos-qiaojie-4kou/</guid><description>&lt;h3 id="一基本上网配置"&gt;一.基本上网配置&lt;/h3&gt;
&lt;h3 id="vyos的命令行界面是基于shell的没有图形界面-但是可以用tab自动补全"&gt;vyos的命令行界面是基于shell的，没有图形界面, 但是可以用tab自动补全&lt;/h3&gt;
&lt;p&gt;本文的vyos命令是基于vyos的vyos-rolling-nightly-builds的1.5.x版本.&lt;/p&gt;</description></item><item><title>搜索</title><link>https://hanigege.github.io/search/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hanigege.github.io/search/</guid><description/></item></channel></rss>