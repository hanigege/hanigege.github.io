<!DOCTYPE html>
<html lang="zh">

    <head><title>å®¶åº­èŠå¤©æœåŠ¡å™¨ç³»åˆ—ï¼ˆ3ï¼‰coturnæœåŠ¡æ­å»º &ndash; ä»£ç¢¼å€‰åº«</title>
<meta name="description" content="å€‹äººè‡ªç•™åœ°ï¼Œå¦‚æœèƒ½å¹«åˆ°ä½ ï¼Œæˆ‘ä¹Ÿæœƒå¾ˆé«˜èˆˆï¼Œå·¥ä½œç¹å¿™ï¼Œä¸æ¥å—è«®è©¢,æ•¬è«‹è«’è§£ã€‚">

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="UTF-8"/>



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.4/css/academicons.min.css" integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />


<link rel="stylesheet" href="https://hanigege.github.io/css/palettes/base16-dark.css">
<link rel="stylesheet" href="https://hanigege.github.io/css/risotto.css">
<link rel="stylesheet" href="https://hanigege.github.io/css/custom.css">










</head>

    <body>
        <div class="page">

            <header class="page__header"><nav class="page__nav main-nav">
    <ul>
      <li class="nomarker"><h1 class="page__logo"><a href="https://hanigege.github.io/" class="page__logo-inner">ä»£ç¢¼å€‰åº«</a></h1></li>
    
    
    <li class="main-nav__item"><a class="nav-main-item" href="https://hanigege.github.io/about/" title="">About</a></li>
    
    <li class="main-nav__item"><a class="nav-main-item" href="https://hanigege.github.io/posts/" title="">Posts</a></li>
    
    <li class="main-nav__item"><a class="nav-main-item" href="https://hanigege.github.io/downloads/" title="">Downlaods</a></li>
    
    </ul>
</nav>

</header>

            <section class="page__body">
    <header class="content__header">
        <h1>å®¶åº­èŠå¤©æœåŠ¡å™¨ç³»åˆ—ï¼ˆ3ï¼‰coturnæœåŠ¡æ­å»º</h1>
    </header>
    <div class="content__body">
        <h2 id="dockeræ­å»ºcoturn-turnæœåŠ¡å™¨">dockeræ­å»ºCoturn TURNæœåŠ¡å™¨</h2>
<h2 id="å…±ä¸¤ç§æ–¹æ¡ˆ">å…±ä¸¤ç§æ–¹æ¡ˆï¼š</h2>
<h2 id="ç¬¬ä¸€ç§æ–¹æ¡ˆè¦äº†è§£">ç¬¬ä¸€ç§æ–¹æ¡ˆï¼ˆè¦äº†è§£ï¼‰</h2>
<h4 id="å…ˆå»ºç«‹ä¸€ä¸ªæ–‡ä»¶å¤¹">å…ˆå»ºç«‹ä¸€ä¸ªæ–‡ä»¶å¤¹</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir -p ~/data/docker_data/coturn/etc/coturn
</span></span><span style="display:flex;"><span>mkdir -p ~/data/docker_data/coturn/var/run
</span></span><span style="display:flex;"><span>mkdir -p ~/data/docker_data/coturn/var/log  <span style="color:#75715e">#å¦‚æœç”¨ä¸‹é¢ç¬¬ä¸€ç§æ–¹æ¡ˆè¿™ä¸ªæ‰éœ€è¦å»ºç«‹ï¼Œç¬¬äºŒç§ä¸éœ€è¦</span>
</span></span><span style="display:flex;"><span>cd ~/data/docker_data/coturn/etc/coturn
</span></span><span style="display:flex;"><span>touch turnserver.conf
</span></span><span style="display:flex;"><span>cd ~/data/docker_data/coturn/var/run
</span></span><span style="display:flex;"><span>touch turnserver.pid
</span></span><span style="display:flex;"><span>cd ../../
</span></span><span style="display:flex;"><span>chmod <span style="color:#ae81ff">777</span> -R var
</span></span></code></pre></div><p>æ‹‰å–é•œåƒ</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> docker pull coturn/coturn
</span></span></code></pre></div><p>ç›´æ¥hostæ–¹å¼è¿è¡Œ</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>     docker run -d --network<span style="color:#f92672">=</span>host <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>           -v /root/data/docker_data/coturn/etc/coturn/turnserver.conf:/etc/coturn/turnserver.conf <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>           -v /root/data/docker_data/coturn/etc/:/etc/ <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>           -v /root/data/docker_data/coturn/var:/var <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>       coturn/coturn
</span></span></code></pre></div><p>è¿è¡Œæ—¶ä¸åŠ  -d å…ˆçœ‹è¾“å…¥æœ‰é”™è¯¯å—ï¼
åŒæ—¶æŸ¥çœ‹varä¸‹çš„logçœ‹ç›¸å…³çš„é—®é¢˜
è°ƒè¯•å¯åŠ¨å‘½ä»¤ï¼šåœæ­¢å®¹å™¨åä¼šè‡ªåŠ¨å›¾åˆ é™¤å®¹å™¨ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run --network<span style="color:#f92672">=</span>host <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>           -v /root/data/docker_data/coturn/etc/coturn/turnserver.conf:/etc/coturn/turnserver.conf <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>           -v /root/data/docker_data/coturn/etc/:/etc/ <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>           -v /root/data/docker_data/coturn/var:/var <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>           --rm <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>       coturn/coturn
</span></span></code></pre></div><p>å“ªæœå»æ‰äº†é…ç½®æ–‡ä»¶é‡Œçš„æŒ‡å®šlogï¼Œåœç”¨cliåŠŸèƒ½ï¼Œä¸‹é¢æœ‰è¯´æ˜ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å¯åŠ¨å‘½ä»¤ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> docker run -d --network<span style="color:#f92672">=</span>host <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>           -e DETECT_EXTERNAL_IP<span style="color:#f92672">=</span>yes <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>           -e DETECT_RELAY_IP<span style="color:#f92672">=</span>yes <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>           -v /root/data/docker_data/coturn/etc/coturn/turnserver.conf:/etc/coturn/turnserver.conf <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>           -v /root/data/docker_data/coturn/etc/:/etc/ <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>           -v /root/data/docker_data/coturn/var:/var <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>       coturn/coturn <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>           -n --log-file<span style="color:#f92672">=</span>stdout  
</span></span></code></pre></div><p>ä½ ä¹‹åä¸è¦1~65535å…¨éƒ½å¼€æ”¾ å®è¡Œç™½åå•æ”¾è¡Œæ¨¡å¼</p>
<p>æ¯”å¦‚coturnåªå¼€æ”¾ä»¥ä¸‹</p>
<p>3478</p>
<p>5349</p>
<p>ä¸Šé¢ä¸¤ä¸ªtcp udpå…¨æ‰“å¼€</p>
<p>49152~65535</p>
<p>ç”Ÿæˆè¯ä¹¦ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo openssl req -x509 -newkey rsa:2048 -keyout /etc/turn_server_pkey.pem -out /etc/turn_server_cert.pem -days <span style="color:#ae81ff">99999</span> -nodes 
</span></span></code></pre></div><p>ç”Ÿæˆçš„ä¸¤ä¸ªè¯ä¹¦ä¼ è¾“åˆ° <code>/root/data/docker_data/coturn/etc/ </code>æ–‡ä»¶å¤¹ä¸‹ã€‚å¯ä»¥å…ˆä¸‹è½½ä¸‹æ¥ï¼Œå†ä¼ åˆ°ç›¸åº”çš„æ–‡ä»¶å¤¹é‡Œã€‚
<strong>æˆ–è€…ä¸€æ­¥åˆ°ä½ç›´æ¥ç”Ÿæˆåˆ°ç›®æ ‡æ–‡ä»¶å¤¹</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo openssl req -x509 -newkey rsa:2048 -keyout /root/data/docker_data/coturn/etc/turn_server_pkey.pem -out  /root/data/docker_data/coturn/etc/turn_server_cert.pem -days <span style="color:#ae81ff">99999</span> -nodes
</span></span></code></pre></div><p><code>netstat -anpl | grep turnserver </code> #æ£€æµ‹ Dibianæ²¡æœ‰è¿™ä¸ªå‘½ä»¤ï¼Œå¯ä»¥å®‰è£…ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>apt-get install net-tools
</span></span></code></pre></div><p>æå®šï¼
ç”ŸæˆéªŒè¯å¯†é’¥åˆ°test.confæ–‡ä»¶ï¼Œç”Ÿæˆåæ‰“å¼€æ–‡ä»¶å¤åˆ¶å¯†é’¥æ›¿æ¢ä¸‹é¢é…ç½®æ–‡ä»¶é‡Œçš„å¯†é’¥ï¼šï¼ˆç‰¹åˆ«è¯´æ˜ï¼Œå¯†é’¥çš„é•¿åº¦å¯ä»¥ä¿®æ”¹ä¸‹é¢å‘½ä»¤è¡Œé‡Œçš„256å‚æ•°ï¼Œå»ºè®®è®¾ä¸º68å³å¯ï¼Œä¹Ÿå°±æ˜¯68ä¸ªå­—ç¬¦</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;static-auth-secret=</span><span style="color:#66d9ef">$(</span>cat /dev/urandom | tr -cd <span style="color:#e6db74">&#39;[:alnum:]&#39;</span> | fold -w <span style="color:#ae81ff">256</span> | head -n 1<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> | sudo tee /root/test.conf
</span></span></code></pre></div><p>å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;static-auth-secret=</span><span style="color:#66d9ef">$(</span>cat /dev/urandom | tr -cd <span style="color:#e6db74">&#39;[:alnum:]&#39;</span> | fold -w <span style="color:#ae81ff">68</span> | head -n 1<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> | sudo tee /root/test.conf
</span></span></code></pre></div><p>å…·ä½“é…ç½®æ–‡ä»¶æ˜¯ï¼š<code>turnserver.conf</code> è·¯å¾„ä¸ºï¼š<code>/root/data/docker_data/coturn/etc/coturn</code></p>
<p>COTURN Server é…ç½®æ ·ä¾‹ï¼šturnserver.conf</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>use-auth-secret
</span></span><span style="display:flex;"><span>static-auth-secret<span style="color:#f92672">=</span>ynojlSEBrJ6VjFHNyjJiyZRnnMUQ0WKAsSzGdMhL8he
</span></span><span style="display:flex;"><span>realm<span style="color:#f92672">=</span>coturn.1.xyz
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æŒ‡å®š Coturn çš„æ—¥å¿—æ–‡ä»¶è·¯å¾„</span>
</span></span><span style="display:flex;"><span>log-file<span style="color:#f92672">=</span>/var/log/turnserver.log
</span></span><span style="display:flex;"><span><span style="color:#75715e"># VoIP traffic is all UDP. There is no reason to let users connect to arbitrary TCP endpoints via the relay.</span>
</span></span><span style="display:flex;"><span>no-tcp-relay
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è°ƒè¯•æ—¥å¿—çº§åˆ«</span>
</span></span><span style="display:flex;"><span>verbose<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cli-password<span style="color:#f92672">=</span>8al8la.com <span style="color:#75715e"># Set a non-empty CLI password</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># don&#39;t let the relay ever try to connect to private IP address ranges within your network (if any)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># given the turn server is likely behind your firewall, remember to include any privileged public IPs too.</span>
</span></span><span style="display:flex;"><span>denied-peer-ip<span style="color:#f92672">=</span>10.0.0.0-10.255.255.255
</span></span><span style="display:flex;"><span>denied-peer-ip<span style="color:#f92672">=</span>192.168.0.0-192.168.255.255
</span></span><span style="display:flex;"><span>denied-peer-ip<span style="color:#f92672">=</span>172.16.0.0-172.31.255.255
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># special case the turn server itself so that client-&gt;TURN-&gt;TURN-&gt;client flows work</span>
</span></span><span style="display:flex;"><span>allowed-peer-ip<span style="color:#f92672">=</span>10.0.0.1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>listener-ip<span style="color:#f92672">=</span>coturn.1.xyz
</span></span><span style="display:flex;"><span>relay-ip<span style="color:#f92672">=</span>coturn.1.xyz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># consider whether you want to limit the quota of relayed streams per user (or total) to avoid risk of DoS.</span>
</span></span><span style="display:flex;"><span>user-quota<span style="color:#f92672">=</span><span style="color:#ae81ff">12</span> <span style="color:#75715e"># 4 streams per video call, so 12 streams = 3 simultaneous relayed calls per user.</span>
</span></span><span style="display:flex;"><span>total-quota<span style="color:#f92672">=</span><span style="color:#ae81ff">1200</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># TLS certificates, including intermediate certs.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŒ‡å®šäº† TLS è¯ä¹¦æ–‡ä»¶çš„è·¯å¾„</span>
</span></span><span style="display:flex;"><span>cert<span style="color:#f92672">=</span>/etc/turn_server_cert.pem
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŒ‡å®šäº† TLS ç§é’¥æ–‡ä»¶çš„è·¯å¾„</span>
</span></span><span style="display:flex;"><span>pkey<span style="color:#f92672">=</span>/etc/turn_server_pkey.pem
</span></span><span style="display:flex;"><span>pidfile<span style="color:#f92672">=</span>/var/run/turnserver.pid
</span></span></code></pre></div><p>ä¿®æ”¹ä¸Šé¢çš„åŸŸåï¼Œå’Œé‚£ä¸€ä¸²å¯†ç ï¼Œä¿å­˜åé‡å¯coturnçš„å®¹å™¨ï¼</p>
<h2 id="è°ƒè¯•æ—¥å¿—è¯´æ˜">è°ƒè¯•æ—¥å¿—è¯´æ˜</h2>
<p>åœ¨æ‚¨æä¾›çš„é…ç½®ä¸­ï¼Œæ—¥å¿—è°ƒè¯•çº§åˆ«ç”±verboseå‚æ•°æŒ‡å®šã€‚åœ¨æ‚¨çš„é…ç½®ä¸­ï¼Œverboseè®¾ç½®ä¸º1ï¼Œè¡¨ç¤ºå¯ç”¨äº†æœ€ä½çº§åˆ«çš„è°ƒè¯•æ—¥å¿—ã€‚</p>
<p>è°ƒè¯•çº§åˆ«é€šå¸¸æœ‰ä¸åŒçš„å€¼ï¼Œç”¨äºæ§åˆ¶æ—¥å¿—çš„è¯¦ç»†ç¨‹åº¦ã€‚å¸¸è§çš„çº§åˆ«åŒ…æ‹¬ï¼š</p>
<p>0ï¼šå…³é—­è°ƒè¯•æ—¥å¿—ï¼Œåªè®°å½•é”™è¯¯å’Œå…³é”®ä¿¡æ¯ã€‚</p>
<p>1ï¼šæœ€ä½çº§åˆ«çš„è°ƒè¯•ï¼Œé€šå¸¸ç”¨äºè®°å½•åŸºæœ¬çš„æ“ä½œä¿¡æ¯å’Œè­¦å‘Šã€‚</p>
<p>2ï¼šä¸­ç­‰çº§åˆ«çš„è°ƒè¯•ï¼Œè®°å½•æ›´å¤šçš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸€äº›å†…éƒ¨æ“ä½œçš„ç»†èŠ‚ã€‚</p>
<p>3ï¼šæœ€é«˜çº§åˆ«çš„è°ƒè¯•ï¼Œè®°å½•éå¸¸è¯¦ç»†çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¯ä¸ªæ­¥éª¤çš„æ“ä½œå’ŒçŠ¶æ€ã€‚</p>
<p>åœ¨æ‚¨çš„é…ç½®ä¸­ï¼Œè®¾ç½®ä¸º1çš„è°ƒè¯•çº§åˆ«å°†è®°å½•åŸºæœ¬çš„æ“ä½œä¿¡æ¯å’Œè­¦å‘Šï¼Œä½†ä¸ä¼šè®°å½•è¿‡å¤šçš„ç»†èŠ‚ã€‚è¿™å¯¹äºä¸€èˆ¬æƒ…å†µä¸‹çš„æ—¥å¿—è®°å½•å·²ç»è¶³å¤Ÿã€‚å¦‚æœéœ€è¦æ›´è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥å°†è°ƒè¯•çº§åˆ«è®¾ç½®ä¸ºæ›´é«˜çš„å€¼ï¼Œä¾‹å¦‚2æˆ–3ï¼Œä½†è¿™å¯èƒ½ä¼šç”Ÿæˆæ›´å¤šçš„æ—¥å¿—æ•°æ®ã€‚</p>
<p>æ³¨æ„ä¸Šé¢/etc/turn_*è·¯å½¹æ˜¯æŒ‡å®¹å™¨é‡Œçš„è·¯å¾„ã€‚</p>
<p>å¦‚æœæƒ³å…³é—­CLIç›‘å¬å™¨åŠŸèƒ½ã€‚è¦ç¦ç”¨CLIåŠŸèƒ½ï¼Œæ‚¨å¯ä»¥åˆ é™¤æˆ–æ³¨é‡Šæ‰ç›¸å…³é…ç½®è¡Œã€‚åœ¨æ‚¨çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œåªéœ€è¦åˆ é™¤æˆ–æ³¨é‡Šæ‰ä»¥ä¸‹ä¸¤è¡Œå³å¯ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cli-password<span style="color:#f92672">=</span>8al8la.com <span style="color:#75715e"># Set a non-empty CLI password</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŒ‡å®š Coturn çš„æ—¥å¿—æ–‡ä»¶è·¯å¾„</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># log-file=/var/log/turnserver.log</span>
</span></span></code></pre></div><p>è¯·æ³¨æ„ï¼Œè¿™äº›é…ç½®æ›´æ”¹å°†ç¦ç”¨CLIå¯†ç å’ŒCLIæ—¥å¿—è®°å½•åŠŸèƒ½ã€‚ä¿å­˜æ›´æ”¹åï¼Œé‡æ–°å¯åŠ¨coturnæœåŠ¡å™¨ä»¥ä½¿æ›´æ”¹ç”Ÿæ•ˆã€‚</p>
<p>æ‰€è°“cliåŠŸèƒ½ï¼š</p>
<p>CLIç›‘å¬å™¨ï¼ˆCommand Line Interface listenerï¼‰å…è®¸æ‚¨é€šè¿‡å‘½ä»¤è¡Œç•Œé¢ä¸coturnæœåŠ¡å™¨è¿›è¡Œäº¤äº’å’Œç®¡ç†ã€‚é€šè¿‡CLIï¼Œæ‚¨å¯ä»¥æ‰§è¡Œå„ç§ç®¡ç†ä»»åŠ¡ï¼Œä¾‹å¦‚æŸ¥çœ‹å½“å‰æœåŠ¡å™¨çŠ¶æ€ã€æ·»åŠ æˆ–åˆ é™¤ç”¨æˆ·ã€é…ç½®è½¬å‘è§„åˆ™ç­‰ã€‚</p>
<p>CLIç›‘å¬å™¨å…è®¸ç®¡ç†å‘˜é€šè¿‡å‘½ä»¤è¡Œè¾“å…¥ç‰¹å®šçš„å‘½ä»¤æ¥ä¸coturnæœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œè€Œæ— éœ€é€šè¿‡å›¾å½¢ç•Œé¢æˆ–å…¶ä»–æ–¹å¼è¿›è¡Œæ“ä½œã€‚è¿™ä½¿å¾—ç®¡ç†è€…å¯ä»¥æ›´åŠ çµæ´»å’Œé«˜æ•ˆåœ°ç®¡ç†æœåŠ¡å™¨ï¼Œç‰¹åˆ«æ˜¯åœ¨è‡ªåŠ¨åŒ–å’Œè„šæœ¬åŒ–ç®¡ç†æ–¹é¢ã€‚</p>
<p>æŸ¥çœ‹æ—¥å¿—ï¼šè¿è¡Œæ—¶ä¸åŠ  -d çœ‹è¾“å…¥ï¼</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>journalctl -u coturnsystemd 
</span></span></code></pre></div><p>è¿™æ˜¯åŠ <code>/root/data/docker_data/synapse/data/homeserver.yaml</code>é…ç½®æ–‡ä»¶é‡Œçš„</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#turnserver#</span>
</span></span><span style="display:flex;"><span>turn_uris: <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;turn:coturn.666.eu.org?transport=udp&#34;</span>, <span style="color:#e6db74">&#34;turn:coturn.666.eu.org?transport=tcp&#34;</span> <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>turn_shared_secret: <span style="color:#e6db74">&#34;SdQmVOBTRxViwUhsRsRgpBctFNMYatKUBHIO69wFKxEVuqog1HPPoMKya7YA&#34;</span>
</span></span><span style="display:flex;"><span>turn_user_lifetime: <span style="color:#ae81ff">86400000</span>
</span></span><span style="display:flex;"><span>turn_allow_guests: True
</span></span><span style="display:flex;"><span><span style="color:#e6db74">```</span>bash
</span></span><span style="display:flex;"><span>è®°çš„ä¿®æ”¹åŸŸåå’Œå¯†ç å’Œä¸»æ–‡ä»¶åŒæ­¥ã€‚
</span></span><span style="display:flex;"><span><span style="color:#e6db74">```</span>bash
</span></span><span style="display:flex;"><span>ç¡®ä¿æ‚¨çš„é˜²ç«å¢™å…è®¸æµé‡è¿›å…¥æ‚¨é…ç½®ä¸ºä¾¦å¬çš„ç«¯å£ä¸Šçš„ TURN æœåŠ¡å™¨ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼šTURN æµé‡ä½¿ç”¨ <span style="color:#ae81ff">3478</span> å’Œ 5349ï¼ˆè¯·è®°ä½åŒæ—¶å…è®¸ TCP å’Œ UDP æµé‡ï¼‰ï¼ŒUDP ä¸­ç»§ä½¿ç”¨ç«¯å£ 49152-65535 .<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>ç‰¹åˆ«è¯´æ˜ï¼šcoturnæœåŠ¡å™¨ä¹Ÿå¯ä»¥ä¸åšåå‘ä»£ç†</p>
<p>CoturnæœåŠ¡é€šå¸¸éœ€è¦æ‰“å¼€ä»¥ä¸‹ç«¯å£ä»¥æ”¯æŒTURNåè®®å’Œå®ç°NATéå†ï¼š</p>
<p><code>TURN Listening Port (Default: 3478): </code>CoturnæœåŠ¡é€šè¿‡æ­¤ç«¯å£ä¾¦å¬TURNè¯·æ±‚ã€‚æ­¤ç«¯å£æ˜¯TURNåè®®çš„æ ‡å‡†ç«¯å£ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Default TURN Port: <span style="color:#ae81ff">3478</span>
</span></span><span style="display:flex;"><span>TURN TLS Listening Port <span style="color:#f92672">(</span>Default: 5349<span style="color:#f92672">)</span>: å¦‚æœå¯ç”¨äº†TURN over TLSï¼ˆåŠ å¯†çš„TURNæµé‡ï¼‰ï¼Œåˆ™éœ€è¦æ‰“å¼€æ­¤ç«¯å£ã€‚
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Default TURN TLS Port: <span style="color:#ae81ff">5349</span>
</span></span></code></pre></div><p>Listening Ports Range for Relayed UDP Traffic (Default: 49152-65535): å½“TURNæœåŠ¡å™¨ç”¨äºä¸­ç»§UDPæµé‡æ—¶ï¼Œå®ƒéœ€è¦ä½¿ç”¨ä¸€ç³»åˆ—UDPç«¯å£ã€‚</p>
<p>ä¸Šé¢çš„é…ç½®é‡Œæˆ‘æŒ‡å®šäº†20000-30000</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Default UDP Port Range: 49152-65535
</span></span></code></pre></div><p>è¿™äº›ç«¯å£éœ€è¦åœ¨CoturnæœåŠ¡å™¨é…ç½®ä¸­æŒ‡å®šï¼Œå¹¶ä¸”ç›¸åº”çš„é˜²ç«å¢™è§„åˆ™ä¹Ÿéœ€è¦é…ç½®ï¼Œä»¥å…è®¸æµé‡é€šè¿‡è¿™äº›ç«¯å£ã€‚ç¡®ä¿åœ¨é…ç½®CoturnæœåŠ¡å™¨æ—¶å‚è€ƒæ–‡æ¡£ï¼Œå› ä¸ºå®é™…ç«¯å£é…ç½®å¯èƒ½å› ç‰¹å®šç”¨ä¾‹å’Œå®‰å…¨éœ€æ±‚è€Œæœ‰æ‰€ä¸åŒã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Matrix Synapse Default Communication Port <span style="color:#f92672">(</span>TCP<span style="color:#f92672">)</span>: <span style="color:#ae81ff">8448</span>
</span></span></code></pre></div><p>ç¡®ä¿åœ¨é…ç½®é˜²ç«å¢™è§„åˆ™æ—¶ï¼Œè¿™äº›ç«¯å£æ˜¯å¼€æ”¾çš„ï¼Œä»¥ç¡®ä¿Synapseå’ŒCoturnèƒ½å¤Ÿç›¸äº’é€šä¿¡ã€‚</p>
<h2 id="ç¬¬äºŒç§æ–¹æ¡ˆä¼˜é€‰æ¨èä½¿ç”¨è¿™ä¸€ç§æ–¹æ¡ˆ">ç¬¬äºŒç§æ–¹æ¡ˆï¼šï¼ˆä¼˜é€‰ï¼Œæ¨èä½¿ç”¨è¿™ä¸€ç§æ–¹æ¡ˆï¼‰</h2>
<p>å…³äºæ—¥å¿—è¾“å…¥ç­‰çº§ï¼Œå¸¸è§çš„é€‰é¡¹åŒ…æ‹¬ï¼š</p>
<p>verboseï¼šå†—ä½™çš„è¾“å‡ºï¼Œé€šå¸¸åŒ…å«äº†éå¸¸è¯¦ç»†çš„ä¿¡æ¯ï¼Œç”¨äºè°ƒè¯•å’Œæ’æŸ¥é—®é¢˜ã€‚</p>
<p>debugï¼šè°ƒè¯•çº§åˆ«çš„è¾“å‡ºï¼Œæä¾›æ¯”è¾ƒè¯¦ç»†ä½†ä¸å¦‚ verbose é‚£ä¹ˆå†—ä½™çš„ä¿¡æ¯ã€‚</p>
<p>infoï¼šä¿¡æ¯çº§åˆ«çš„è¾“å‡ºï¼Œæä¾›åŸºæœ¬çš„è¿è¡Œä¿¡æ¯ï¼Œé€‚åˆä¸€èˆ¬æƒ…å†µä¸‹çš„ä½¿ç”¨ã€‚</p>
<p>warningï¼šè­¦å‘Šçº§åˆ«çš„è¾“å‡ºï¼Œç”¨äºæŒ‡ç¤ºæ½œåœ¨çš„é—®é¢˜æˆ–é”™è¯¯ã€‚</p>
<p>errorï¼šé”™è¯¯çº§åˆ«çš„è¾“å‡ºï¼ŒæŒ‡ç¤ºå‡ºç°çš„é”™è¯¯æƒ…å†µã€‚</p>
<p>æ‚¨å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´æ—¥å¿—è¾“å…¥ç­‰çº§ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé€šå¸¸ä¼šå°†æ—¥å¿—è¾“å…¥ç­‰çº§è®¾ç½®ä¸º info æˆ–æ›´é«˜çº§åˆ«ï¼Œä»¥é¿å…å†—ä½™ä¿¡æ¯è¿‡å¤šï¼Œè€Œåœ¨å¼€å‘æˆ–è°ƒè¯•é˜¶æ®µï¼Œåˆ™å¯èƒ½ä¼šé€‰æ‹© debug æˆ– verbose ç­‰çº§ä»¥ä¾¿æ›´è¯¦ç»†åœ°äº†è§£ç³»ç»Ÿè¿è¡Œæƒ…å†µã€‚</p>
<h2 id="è‡ªè¡Œå®‰è£…å¥½dockeråŠdocker-compose">è‡ªè¡Œå®‰è£…å¥½dockeråŠdocker-compose</h2>
<h2 id="å¼€å§‹æ“ä½œ">å¼€å§‹æ“ä½œ</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir -p ~/data/docker_data/coturn/etc/coturn
</span></span><span style="display:flex;"><span>mkdir -p ~/data/docker_data/coturn/var/run
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mkdir -p ~/data/docker_data/coturn/var/log  <span style="color:#75715e">#å¦‚æœç”¨ä¸‹é¢ç¬¬ä¸€ç§æ–¹æ¡ˆè¿™ä¸ªæ‰éœ€è¦å»ºç«‹ï¼Œç¬¬äºŒç§ä¸éœ€è¦</span>
</span></span><span style="display:flex;"><span>cd ~/data/docker_data/coturn/etc/coturn
</span></span><span style="display:flex;"><span>touch turnserver.conf
</span></span><span style="display:flex;"><span>cd ~/data/docker_data/coturn/var/run
</span></span><span style="display:flex;"><span>touch turnserver.pid
</span></span><span style="display:flex;"><span>cd ../../
</span></span><span style="display:flex;"><span>chmod <span style="color:#ae81ff">777</span> -R var
</span></span></code></pre></div><p><code>turnserver.conf:</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#è¿™æ˜¯ç³»ç»Ÿæ—¥å¿— </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#syslog</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#å†—ä½™çš„æ—¥å¿—è¾“å‡º</span>
</span></span><span style="display:flex;"><span>verbose
</span></span><span style="display:flex;"><span>use-auth-secret
</span></span><span style="display:flex;"><span>static-auth-secret<span style="color:#f92672">=</span>ThisIsASharedSecret-ChangeMe
</span></span><span style="display:flex;"><span>realm<span style="color:#f92672">=</span>example.org
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cert<span style="color:#f92672">=</span>/etc/letsencrypt/live/turn.example.org/fullchain.pem
</span></span><span style="display:flex;"><span>pkey<span style="color:#f92672">=</span>/etc/letsencrypt/live/turn.example.org/privkey.pem
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>no-udp
</span></span><span style="display:flex;"><span>external-ip<span style="color:#f92672">=</span>1.2.3.4
</span></span><span style="display:flex;"><span>min-port<span style="color:#f92672">=</span><span style="color:#ae81ff">64000</span>
</span></span><span style="display:flex;"><span>max-port<span style="color:#f92672">=</span><span style="color:#ae81ff">65535</span>
</span></span></code></pre></div><p>è¯¦è§£ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># èµ°ç³»ç»Ÿæ—¥å¿—</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#syslog</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å†—ä½™çš„æ—¥å¿—è¾“å‡º</span>
</span></span><span style="display:flex;"><span>verbose
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŒ‡å®šäº†é•¿æœŸå‡­è¯æœºåˆ¶ï¼Œç”¨äºå®¢æˆ·ç«¯çš„èº«ä»½éªŒè¯å’Œä¸‹é¢çš„äºŒé€‰ä¸€</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#lt-cred-mech</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯ç”¨äº†ä½¿ç”¨é™æ€èº«ä»½éªŒè¯å¯†é’¥è¿›è¡Œèº«ä»½éªŒè¯çš„åŠŸèƒ½</span>
</span></span><span style="display:flex;"><span>use-auth-secret
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è®¾ç½®äº†èº«ä»½éªŒè¯å¯†é’¥å’ŒåŸŸå</span>
</span></span><span style="display:flex;"><span>static-auth-secret<span style="color:#f92672">=</span>ynojlSEBrJnMUQ0WKAsSzGdMhL8he
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è®¾ç½®äº†åŸŸå</span>
</span></span><span style="display:flex;"><span>realm<span style="color:#f92672">=</span>coturn.1.xyz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŒ‡å®šäº† TLS è¯ä¹¦æ–‡ä»¶çš„è·¯å¾„</span>
</span></span><span style="display:flex;"><span>cert<span style="color:#f92672">=</span>/etc/web.crt
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŒ‡å®šäº† TLS ç§é’¥æ–‡ä»¶çš„è·¯å¾„</span>
</span></span><span style="display:flex;"><span>pkey<span style="color:#f92672">=</span>/etc/web.key
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Set a non-empty CLI password</span>
</span></span><span style="display:flex;"><span>cli-password<span style="color:#f92672">=</span>8al8la.com 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¦ç”¨äº† UDP é€šä¿¡ï¼Œæ„å‘³ç€åªä½¿ç”¨ TCP</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#no-udp</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>min-port<span style="color:#f92672">=</span><span style="color:#ae81ff">64000</span>
</span></span><span style="display:flex;"><span>max-port<span style="color:#f92672">=</span><span style="color:#ae81ff">65535</span>
</span></span></code></pre></div><p>æœ€ç»ˆå®ä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># æ—¥å¿—è¾“å‡ºå‚æ•°</span>
</span></span><span style="display:flex;"><span>info
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯ç”¨è®¤è¯</span>
</span></span><span style="display:flex;"><span>use-auth-secret
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å€¼ä¸ºè®¤è¯æ—¶ä½¿ç”¨çš„å¯†é’¥</span>
</span></span><span style="display:flex;"><span>static-auth-secret<span style="color:#f92672">=</span>ynojlSEBnMUQ0WKAsSzGdMhL8he
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å€¼ä¸ºä½ ç»™ coturn å®ä¾‹åˆ†é…çš„åŸŸå (å®ƒå¯ä»¥ä¸å’Œä½ çš„åŸŸåå®Œå…¨ä¸€è‡´, ä½†è‡³å°‘å¿…é¡»æœ‰)</span>
</span></span><span style="display:flex;"><span>realm<span style="color:#f92672">=</span>coturn.10.xyz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŒ‡å®šäº† TLS è¯ä¹¦æ–‡ä»¶çš„è·¯å¾„</span>
</span></span><span style="display:flex;"><span>cert<span style="color:#f92672">=</span>/etc/web.crt
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŒ‡å®šäº† TLS ç§é’¥æ–‡ä»¶çš„è·¯å¾„</span>
</span></span><span style="display:flex;"><span>pkey<span style="color:#f92672">=</span>/etc/web.key
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Set a non-empty CLI password</span>
</span></span><span style="display:flex;"><span>cli-password<span style="color:#f92672">=</span>8a.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#é™å®šæœ€å°æœ€å¤§ç«¯å£</span>
</span></span><span style="display:flex;"><span>min-port<span style="color:#f92672">=</span><span style="color:#ae81ff">64000</span>
</span></span><span style="display:flex;"><span>max-port<span style="color:#f92672">=</span><span style="color:#ae81ff">65535</span>
</span></span></code></pre></div><h2 id="ä¸Šé¢é…ç½®é‡Œçš„è¯ä¹¦-å’ŒåŸŸåç”Ÿæˆæ ‡å‡†è¯ä¹¦ä¸€æ ·æœ¬ç«™æœ‰æä¾›æ•™ç¨‹æ­¤è¯ä¹¦ä¸ºcoturnæœåŠ¡å™¨åŸŸåçš„è¯ä¹¦">ä¸Šé¢é…ç½®é‡Œçš„è¯ä¹¦ï¼š å’ŒåŸŸåç”Ÿæˆæ ‡å‡†è¯ä¹¦ä¸€æ ·ï¼Œæœ¬ç«™æœ‰æä¾›æ•™ç¨‹ã€‚æ­¤è¯ä¹¦ä¸ºcoturnæœåŠ¡å™¨åŸŸåçš„è¯ä¹¦</h2>
<h2 id="æµ‹è¯•å¯åŠ¨å‘½ä»¤æ²¡æœ‰åŠ -d-åå°è¿è¡Œ-æµ‹è¯•æ²¡é—®é¢˜äº†å†åŠ è¿˜æœ‰æœ€åçš„rmå»é™¤æ‰é€€å‡ºè‡ªåŠ¨åˆ é™¤å®¹å™¨çš„æ„æ€">æµ‹è¯•å¯åŠ¨å‘½ä»¤ï¼š(æ²¡æœ‰åŠ -d ï¼ˆåå°è¿è¡Œï¼‰ æµ‹è¯•æ²¡é—®é¢˜äº†ï¼Œå†åŠ ,è¿˜æœ‰æœ€åçš„&ndash;rmå»é™¤æ‰ï¼Œé€€å‡ºè‡ªåŠ¨åˆ é™¤å®¹å™¨çš„æ„æ€ï¼‰</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run --network<span style="color:#f92672">=</span>host <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>           -v /root/data/docker_data/coturn/etc/coturn/turnserver.conf:/etc/coturn/turnserver.conf <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>           -v /root/data/docker_data/coturn/etc/:/etc/ <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>		   -v /root/data/docker_data/coturn/var/run/turnserver.pid:/var/run/turnserver.pid <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>           --rm <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>       coturn/coturn
</span></span></code></pre></div><p>(å°æé†’:åŸŸåè¯ä¹¦ç”ŸæˆåæŒ‰ç…§é…ç½®æ–‡ä»¶è·¯å½¹æ”¾å…¥è¿è¡Œåï¼Œå¯èƒ½ä¼šæç¤ºkeyæ–‡ä»¶æƒé™ä¸å¤Ÿï¼Œç»™ä»–ä¸ªotherè¯»æƒé™ï¼Œé‡å¯å³å¯ï¼‰
æ­£å¼å¯åŠ¨å‘½ä»¤ï¼š</p>
<pre tabindex="0"><code>docker run -d --network=host \
           -v /root/data/docker_data/coturn/etc/coturn/turnserver.conf:/etc/coturn/turnserver.conf \
           -v /root/data/docker_data/coturn/etc/:/etc/ \
		   -v /root/data/docker_data/coturn/var/run/turnserver.pid:/var/run/turnserver.pid \
       coturn/coturn
</code></pre><p>docker-compose.yaml</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>services:
</span></span><span style="display:flex;"><span>    coturn:
</span></span><span style="display:flex;"><span>        image: coturn/coturn
</span></span><span style="display:flex;"><span>        container_name: coturn
</span></span><span style="display:flex;"><span>        network_mode: host
</span></span><span style="display:flex;"><span>        restart: unless-stopped     <span style="color:#75715e"># å§‹ç»ˆå¯åŠ¨ï¼Œé™¤éæ‰‹åŠ¨åœæ­¢</span>
</span></span><span style="display:flex;"><span>        volumes:
</span></span><span style="display:flex;"><span>            - /root/data/docker_data/coturn/etc/coturn/turnserver.conf:/etc/coturn/turnserver.conf
</span></span><span style="display:flex;"><span>            - /root/data/docker_data/coturn/etc/:/etc/
</span></span><span style="display:flex;"><span>            - /root/data/docker_data/coturn/var/run/turnserver.pid:/var/run/turnserver.pid
</span></span></code></pre></div><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥åå°è¿è¡Œå®¹å™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker-compose up -d
</span></span></code></pre></div><h2 id="åœ¨synapseé…ç½®æ–‡ä»¶datahomeserveryamlé‡ŒåŠ å…¥">åœ¨synapseé…ç½®æ–‡ä»¶<code>data/homeserver.yaml</code>é‡ŒåŠ å…¥</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#turnserver#</span>
</span></span><span style="display:flex;"><span>turn_uris: <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;turn:cotu10.xyz?transport=udp&#34;</span>, <span style="color:#e6db74">&#34;turn:coturnc10.xyz?transport=tcp&#34;</span> <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>turn_shared_secret: <span style="color:#e6db74">&#34;ynojlAOWksiyk1SEBrJ6VjFHNyjJiyZRnnMUQ0WKAsSzGdMhL8he&#34;</span>
</span></span><span style="display:flex;"><span>turn_user_lifetime: <span style="color:#ae81ff">86400000</span>
</span></span><span style="display:flex;"><span>turn_allow_guests: True
</span></span></code></pre></div>
<div id="utterances-comments">
  <script src="https://utteranc.es/client.js"
      repo="hanigege/blog-comments"
      issue-term="pathname"
      theme="github-light"
      crossorigin="anonymous"
      async>
  </script>
</div>




    </div>
    <footer class="content__footer"></footer>

            </section>

            <section class="page__aside">
                <div class="aside__about">
<div class="aside__about">
    <span class="about__logo" role="img">ğŸš</span>&nbsp;
    
<h1 class="about__title">å–‚é¥­</h1>
<p class="about__description">å€‹äººè‡ªç•™åœ°ï¼Œå¦‚æœèƒ½å¹«åˆ°ä½ ï¼Œæˆ‘ä¹Ÿæœƒå¾ˆé«˜èˆˆï¼Œå·¥ä½œç¹å¿™ï¼Œä¸æ¥å—è«®è©¢,æ•¬è«‹è«’è§£ã€‚</p>
</div>


<ul class="aside__social-links">
    
    <li>
        <a href="mailto:purodn@gmail.com" rel="me" aria-label="Email" title="Email"><i class="fa-solid fa-envelope" aria-hidden="true"></i></a>&nbsp;
    </li>
    
</ul>
</div>
                <hr>
                <div class="aside__content">
    
    
        <p>
            
            2025-05-11
        </p>
    

    
	    <hr>
	    On this page:
	    <nav id="TableOfContents">
  <ol>
    <li><a href="#dockeræ­å»ºcoturn-turnæœåŠ¡å™¨">dockeræ­å»ºCoturn TURNæœåŠ¡å™¨</a></li>
    <li><a href="#å…±ä¸¤ç§æ–¹æ¡ˆ">å…±ä¸¤ç§æ–¹æ¡ˆï¼š</a></li>
    <li><a href="#ç¬¬ä¸€ç§æ–¹æ¡ˆè¦äº†è§£">ç¬¬ä¸€ç§æ–¹æ¡ˆï¼ˆè¦äº†è§£ï¼‰</a>
      <ol>
        <li></li>
      </ol>
    </li>
    <li><a href="#è°ƒè¯•æ—¥å¿—è¯´æ˜">è°ƒè¯•æ—¥å¿—è¯´æ˜</a></li>
    <li><a href="#ç¬¬äºŒç§æ–¹æ¡ˆä¼˜é€‰æ¨èä½¿ç”¨è¿™ä¸€ç§æ–¹æ¡ˆ">ç¬¬äºŒç§æ–¹æ¡ˆï¼šï¼ˆä¼˜é€‰ï¼Œæ¨èä½¿ç”¨è¿™ä¸€ç§æ–¹æ¡ˆï¼‰</a></li>
    <li><a href="#è‡ªè¡Œå®‰è£…å¥½dockeråŠdocker-compose">è‡ªè¡Œå®‰è£…å¥½dockeråŠdocker-compose</a></li>
    <li><a href="#å¼€å§‹æ“ä½œ">å¼€å§‹æ“ä½œ</a></li>
    <li><a href="#ä¸Šé¢é…ç½®é‡Œçš„è¯ä¹¦-å’ŒåŸŸåç”Ÿæˆæ ‡å‡†è¯ä¹¦ä¸€æ ·æœ¬ç«™æœ‰æä¾›æ•™ç¨‹æ­¤è¯ä¹¦ä¸ºcoturnæœåŠ¡å™¨åŸŸåçš„è¯ä¹¦">ä¸Šé¢é…ç½®é‡Œçš„è¯ä¹¦ï¼š å’ŒåŸŸåç”Ÿæˆæ ‡å‡†è¯ä¹¦ä¸€æ ·ï¼Œæœ¬ç«™æœ‰æä¾›æ•™ç¨‹ã€‚æ­¤è¯ä¹¦ä¸ºcoturnæœåŠ¡å™¨åŸŸåçš„è¯ä¹¦</a></li>
    <li><a href="#æµ‹è¯•å¯åŠ¨å‘½ä»¤æ²¡æœ‰åŠ -d-åå°è¿è¡Œ-æµ‹è¯•æ²¡é—®é¢˜äº†å†åŠ è¿˜æœ‰æœ€åçš„rmå»é™¤æ‰é€€å‡ºè‡ªåŠ¨åˆ é™¤å®¹å™¨çš„æ„æ€">æµ‹è¯•å¯åŠ¨å‘½ä»¤ï¼š(æ²¡æœ‰åŠ -d ï¼ˆåå°è¿è¡Œï¼‰ æµ‹è¯•æ²¡é—®é¢˜äº†ï¼Œå†åŠ ,è¿˜æœ‰æœ€åçš„&ndash;rmå»é™¤æ‰ï¼Œé€€å‡ºè‡ªåŠ¨åˆ é™¤å®¹å™¨çš„æ„æ€ï¼‰</a></li>
    <li><a href="#åœ¨synapseé…ç½®æ–‡ä»¶datahomeserveryamlé‡ŒåŠ å…¥">åœ¨synapseé…ç½®æ–‡ä»¶<code>data/homeserver.yaml</code>é‡ŒåŠ å…¥</a></li>
  </ol>
</nav>
    

                </div>
            </section>

            <footer class="page__footer">
 <p class="copyright">Â© <strong>çŸ³æ¦´</strong>.</p>
 <p class="advertisement">Powered by <a>å¤§ä½¬å€‘</a>.</p>
</footer>

        </div>
    </body>

</html>
