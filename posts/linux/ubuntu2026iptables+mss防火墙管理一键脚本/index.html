<!doctype html><html lang=zh><head><title>2026ç‰ˆUbuntu&amp;Debianä¸‹iptables+mssé˜²ç«å¢™ç®¡ç†ä¸€é”®è„šæœ¬ &ndash; ä»£ç¢¼å€‰åº«</title><meta name=description content="å€‹äººè‡ªç•™åœ°ï¼Œå¦‚æœèƒ½å¹«åˆ°ä½ ï¼Œæˆ‘ä¹Ÿæœƒå¾ˆé«˜èˆˆã€‚"><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=UTF-8><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.4/css/academicons.min.css integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://hanigege.github.io/css/palettes/base16-dark.css><link rel=stylesheet href=https://hanigege.github.io/css/risotto.css><link rel=stylesheet href=https://hanigege.github.io/css/custom.css><script src=https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js></script><style>pre{position:relative;padding-top:40px!important;background-color:#1e1e1e!important;border:1px solid #333!important;border-radius:10px!important;box-shadow:0 4px 15px rgba(0,0,0,.4);overflow:hidden;margin:1.5em 0}code{font-family:jetbrains mono,fira code,Menlo,monospace!important;font-size:.92em!important;line-height:1.6!important;color:#d4d4d4!important}.copy-code-button{position:absolute;top:10px;right:12px;padding:5px 12px;background:rgba(255,255,255,8%);color:#aaa;border:1px solid rgba(255,255,255,.15);border-radius:6px;backdrop-filter:blur(5px);-webkit-backdrop-filter:blur(5px);cursor:pointer;font-size:11px;font-weight:500;z-index:100;transition:all .25s ease}.copy-code-button:hover{background:rgba(102,217,239,.2);color:#66d9ef;border-color:#66d9ef;transform:translateY(-1px)}.copy-code-button:active{transform:translateY(0)}p img{cursor:zoom-in;transition:opacity .3s;border-radius:4px;max-width:100%}p img:hover{opacity:.9}.medium-zoom-overlay{z-index:999998!important}.medium-zoom-image--opened{z-index:999999!important}</style><script>document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll("pre").forEach(e=>{if(e.querySelector(".copy-code-button"))return;const t=document.createElement("button");t.className="copy-code-button",t.type="button",t.innerText="Copy",t.addEventListener("click",()=>{const n=e.querySelector("code"),s=n?n.innerText:e.innerText;navigator.clipboard.writeText(s).then(()=>{t.innerText="Copied!",t.style.background="rgba(166, 226, 46, 0.2)",t.style.color="#a6e22e",setTimeout(()=>{t.innerText="Copy",t.style.background="",t.style.color=""},2e3)})}),e.appendChild(t)});const e=document.querySelectorAll("p img");console.log(`[æ”¾å¤§é•œè¯Šæ–­] é¡µé¢å…±æ‰¾åˆ°å¯ä»¥æ”¾å¤§çš„å›¾ç‰‡æ•°é‡: ${e.length}`),e.length>0&&mediumZoom(e,{margin:24,background:"#1e1e1ecf",scrollOffset:40})})</script></head><body><div class=page><header class=page__header><nav class="page__nav main-nav"><link rel=stylesheet href=/css/custom.css><ul><li class=nomarker><h1 class=page__logo><a href=https://hanigege.github.io/ class=page__logo-inner>ä»£ç¢¼å€‰åº«</a></h1></li><li class=main-nav__item><a class=nav-main-item href=https://hanigege.github.io/categories/freebsd/ title>FreeBSD</a></li><li class=main-nav__item><a class=nav-main-item href=https://hanigege.github.io/categories/linux/ title>Linux</a></li><li class=main-nav__item><a class=nav-main-item href=https://hanigege.github.io/categories/routers/ title>Routers</a></li><li class=main-nav__item><a class=nav-main-item href=https://hanigege.github.io/categories/other/ title>Other</a></li><li class=main-nav__item><a class=nav-main-item href=https://hanigege.github.io/about/ title>About</a></li></ul></nav></header><section class=page__body><header class=content__header><h1>2026ç‰ˆUbuntu&amp;Debianä¸‹iptables+mssé˜²ç«å¢™ç®¡ç†ä¸€é”®è„šæœ¬</h1></header><div class=content__body><h3 id=è¯´æ˜æ”¯æŒipv4ipv6è‡ªåŠ¨æ£€æµ‹æœ‰æ— ipv6æ·»åŠ mssè‡ªåŠ¨æ£€æµ‹sshç«¯å£ç­‰å¾ˆæ–¹ä¾¿>è¯´æ˜ï¼šæ”¯æŒipv4&amp;ipv6,è‡ªåŠ¨æ£€æµ‹æœ‰æ— ipv6ï¼Œæ·»åŠ mss.è‡ªåŠ¨æ£€æµ‹sshç«¯å£ç­‰ï¼Œå¾ˆæ–¹ä¾¿</h3><h2 id=æˆåŠŸçš„æ­¥éª¤ä¸æ–¹æ³•>æˆåŠŸçš„æ­¥éª¤ä¸æ–¹æ³•</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>nano iptables_manager.sh
</span></span></code></pre></div><h2 id=ç›´æ¥å¤åˆ¶å¹¶æ‰§è¡Œä»¥ä¸‹å®Œæ•´ä»£ç è¦†ç›–åŸè„šæœ¬>ç›´æ¥å¤åˆ¶å¹¶æ‰§è¡Œä»¥ä¸‹å®Œæ•´ä»£ç è¦†ç›–åŸè„šæœ¬ï¼š</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt; &#39;EOF&#39; &gt; iptables_manager.sh
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#e6db74># ==========================================================
</span></span></span><span style=display:flex><span><span style=color:#e6db74># è„šæœ¬åç§°ï¼šé«˜çº§é˜²ç«å¢™ç®¡ç†å·¥å…· (Debian/Ubuntu ä¸“å±è‡ªé€‚åº”ç‰ˆ V4.1)
</span></span></span><span style=display:flex><span><span style=color:#e6db74># æ ¸å¿ƒå‡çº§ï¼šåŸºäºè½¯ä»¶å’Œå†…æ ¸æ¨¡å—çš„æ·±åº¦æ™ºèƒ½æ£€æµ‹ï¼Œæ¶ˆé™¤å†—ä½™è§„åˆ™
</span></span></span><span style=display:flex><span><span style=color:#e6db74># ==========================================================
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gl_lv=&#39;\033[32m&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gl_huang=&#39;\033[33m&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gl_hong=&#39;\033[31m&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gl_bai=&#39;\033[0m&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>root_use() {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    [ &#34;$EUID&#34; -ne 0 ] &amp;&amp; echo -e &#34;${gl_huang}æç¤º: ${gl_bai}éœ€ root æƒé™è¿è¡Œï¼&#34; &amp;&amp; exit 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>check_deps() {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    if ! dpkg -l | grep -qw iptables-persistent; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        echo -e &#34;${gl_huang}æ£€æµ‹åˆ°æœªå®‰è£…æŒä¹…åŒ–ç»„ä»¶ï¼Œæ­£åœ¨è‡ªåŠ¨å®‰è£…...${gl_bai}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        apt-get update
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        DEBIAN_FRONTEND=noninteractive apt-get install -y iptables iptables-persistent netfilter-persistent
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        echo -e &#34;${gl_lv}ä¾èµ–å®‰è£…å®Œæˆï¼${gl_bai}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        sleep 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>root_use
</span></span></span><span style=display:flex><span><span style=color:#e6db74>check_deps
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>if command -v ip6tables &gt;/dev/null 2&gt;&amp;1 &amp;&amp; ip addr 2&gt;/dev/null | grep -q &#34;inet6 .* global&#34;; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    CMDS=&#34;iptables ip6tables&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    HAS_IPV6=true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>else
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    CMDS=&#34;iptables&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    HAS_IPV6=false
</span></span></span><span style=display:flex><span><span style=color:#e6db74>fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>save_rules() {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    echo -e &#34;${gl_huang}æ­£åœ¨æŒä¹…åŒ–è§„åˆ™...${gl_bai}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    mkdir -p /etc/iptables
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    netfilter-persistent save &gt;/dev/null 2&gt;&amp;1 || {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        iptables-save &gt; /etc/iptables/rules.v4
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        [ &#34;$HAS_IPV6&#34; == true ] &amp;&amp; ip6tables-save &gt; /etc/iptables/rules.v6
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    echo -e &#34;${gl_lv}è§„åˆ™ä¿å­˜æˆåŠŸã€‚${gl_bai}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>get_ssh_port() {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    local port=$(grep -i &#34;^Port&#34; /etc/ssh/sshd_config 2&gt;/dev/null | awk &#39;{print $2}&#39; | head -n 1)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    [ -z &#34;$port&#34; ] &amp;&amp; port=22
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    echo &#34;$port&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>view_rules() {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    for cmd in $CMDS; do
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        echo -e &#34;\n${gl_lv}=== $cmd filter è¡¨çŠ¶æ€ ===${gl_bai}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        $cmd -L INPUT -n -v --line-numbers
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        echo -e &#34;${gl_huang}--- FORWARD è½¬å‘çŠ¶æ€ ---${gl_bai}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        $cmd -L FORWARD -n -v --line-numbers
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        echo -e &#34;${gl_huang}--- MSS é’³åˆ¶çŠ¶æ€ (mangle è¡¨) ---${gl_bai}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        $cmd -t mangle -L FORWARD -n -v --line-numbers
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    done
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    read -p &#34;æŒ‰å›è½¦ç»§ç»­...&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>allow_port_flexible() {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    read -e -p &#34;è¯·è¾“å…¥è¦æ”¾è¡Œçš„ç«¯å£å·: &#34; port
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    [ -z &#34;$port&#34; ] &amp;&amp; return
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    echo -e &#34;1. TCP  2. UDP  3. åŒæ—¶æ”¾è¡Œ&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    read -p &#34;é€‰æ‹© (1-3): &#34; p_choice
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    for cmd in $CMDS; do
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        case $p_choice in
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            1) $cmd -I INPUT 4 -p tcp --dport &#34;$port&#34; -j ACCEPT ;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            2) $cmd -I INPUT 4 -p udp --dport &#34;$port&#34; -j ACCEPT ;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            3) 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>               $cmd -I INPUT 4 -p tcp --dport &#34;$port&#34; -j ACCEPT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>               $cmd -I INPUT 4 -p udp --dport &#34;$port&#34; -j ACCEPT 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>               ;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        esac
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    done
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    save_rules
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>block_ip() {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    read -e -p &#34;è¾“å…¥è¦å±è”½çš„ IP: &#34; tip
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    [ -z &#34;$tip&#34; ] &amp;&amp; return
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    if [[ &#34;$tip&#34; == *&#34;:&#34;* ]]; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        if [ &#34;$HAS_IPV6&#34; == true ]; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            ip6tables -I INPUT 1 -s &#34;$tip&#34; -j DROP
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        else
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            echo -e &#34;${gl_hong}ç³»ç»Ÿæœªå¼€å¯ IPv6ï¼Œæ— æ³•æ·»åŠ è¯¥è§„åˆ™ã€‚${gl_bai}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            sleep 2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            return
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    else
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        iptables -I INPUT 1 -s &#34;$tip&#34; -j DROP
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    save_rules
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>delete_rule() {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    echo -e &#34;1. IPv4 (iptables)&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    [ &#34;$HAS_IPV6&#34; == true ] &amp;&amp; echo &#34;2. IPv6 (ip6tables)&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    read -p &#34;é€‰æ‹©åè®®: &#34; p_choice
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    local cmd=&#34;iptables&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    if [ &#34;$p_choice&#34; == &#34;2&#34; ] &amp;&amp; [ &#34;$HAS_IPV6&#34; == true ]; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        cmd=&#34;ip6tables&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    elif [ &#34;$p_choice&#34; == &#34;2&#34; ]; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        echo -e &#34;${gl_hong}ç³»ç»Ÿä¸æ”¯æŒ IPv6ã€‚${gl_bai}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        sleep 2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        return
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    $cmd -L INPUT -n --line-numbers
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    read -p &#34;è¾“å…¥è¦åˆ é™¤çš„ filter/INPUT è§„åˆ™ç¼–å·: &#34; num
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    [ -n &#34;$num&#34; ] &amp;&amp; $cmd -D INPUT &#34;$num&#34; &amp;&amp; save_rules
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>close_all_but_ssh() {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    local ssh_p=$(get_ssh_port)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    echo -e &#34;${gl_huang}å¼€å§‹æ‰§è¡Œè‡ªé€‚åº”æ·±åº¦åŠ å›º...${gl_bai}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    sysctl -w net.ipv4.ip_forward=1 &gt;/dev/null 2&gt;&amp;1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    [ &#34;$HAS_IPV6&#34; == true ] &amp;&amp; sysctl -w net.ipv6.conf.all.forwarding=1 &gt;/dev/null 2&gt;&amp;1 || true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    for cmd in $CMDS; do
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        $cmd -P INPUT ACCEPT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        $cmd -P FORWARD ACCEPT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        $cmd -L INPUT --line-numbers | grep -vE &#34;ts-|DOCKER&#34; | awk &#39;/^[0-9]/ {print $1}&#39; | sort -nr | xargs -r -I{} $cmd -D INPUT {} 2&gt;/dev/null
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        $cmd -F FORWARD
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        $cmd -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        $cmd -A INPUT -i lo -j ACCEPT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        if $cmd -L ts-input &gt;/dev/null 2&gt;&amp;1; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            $cmd -D INPUT -j ts-input 2&gt;/dev/null || true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            $cmd -I INPUT 3 -j ts-input
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        $cmd -A INPUT -p tcp --dport &#34;$ssh_p&#34; -j ACCEPT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        # è§„èŒƒ ICMP
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        if [ &#34;$cmd&#34; == &#34;iptables&#34; ]; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            $cmd -A INPUT -p icmp --icmp-type echo-request -m limit --limit 1/s --limit-burst 5 -j ACCEPT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            $cmd -A INPUT -p icmp --icmp-type 3 -j ACCEPT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            $cmd -A INPUT -p icmp --icmp-type 11 -j ACCEPT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            $cmd -A INPUT -p icmp -j DROP
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        else
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            for type in 2 133 134 135 136 137; do
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                $cmd -A INPUT -p ipv6-icmp --icmpv6-type $type -j ACCEPT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            done
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            $cmd -A INPUT -p ipv6-icmp --icmpv6-type echo-request -m limit --limit 1/s --limit-burst 5 -j ACCEPT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            $cmd -A INPUT -p ipv6-icmp -j DROP
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        if $cmd -L ts-forward &gt;/dev/null 2&gt;&amp;1; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            $cmd -D FORWARD -j ts-forward 2&gt;/dev/null || true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            $cmd -I FORWARD 1 -j ts-forward
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        # æ ¸å¿ƒä¼˜åŒ–ï¼šæ™ºèƒ½ç¯å¢ƒæ£€æµ‹ (æ£€æµ‹è½¯ä»¶å®‰è£…çŠ¶æ€è€Œéç½‘å¡çŠ¶æ€)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        if command -v docker &gt;/dev/null 2&gt;&amp;1 || command -v dockerd &gt;/dev/null 2&gt;&amp;1; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            $cmd -A FORWARD -i docker+ -j ACCEPT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            $cmd -A FORWARD -o docker+ -j ACCEPT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        if command -v tailscaled &gt;/dev/null 2&gt;&amp;1; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            $cmd -A FORWARD -i tailscale+ -j ACCEPT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            $cmd -A FORWARD -o tailscale+ -j ACCEPT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        if command -v wg &gt;/dev/null 2&gt;&amp;1 || lsmod | grep -q wireguard; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            $cmd -A FORWARD -i wg+ -j ACCEPT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            $cmd -A FORWARD -o wg+ -j ACCEPT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        if command -v openvpn &gt;/dev/null 2&gt;&amp;1 || [ -c /dev/net/tun ]; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            $cmd -A FORWARD -i tun+ -j ACCEPT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            $cmd -A FORWARD -o tun+ -j ACCEPT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        if command -v pppd &gt;/dev/null 2&gt;&amp;1; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            $cmd -A FORWARD -i ppp+ -j ACCEPT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            $cmd -A FORWARD -o ppp+ -j ACCEPT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        $cmd -A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        $cmd -P INPUT DROP
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        $cmd -P FORWARD DROP
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        # åŒæ ˆ MSS é’³åˆ¶
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        $cmd -t mangle -F FORWARD
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        $cmd -t mangle -A FORWARD -p tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu 2&gt;/dev/null || true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    done
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    save_rules
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    echo -e &#34;${gl_lv}æ·±åº¦åŠ å›ºåŠ MSS ç½‘ç»œä¼˜åŒ–å®Œæˆï¼å†—ä½™è§„åˆ™å·²æ¸…ç†ã€‚${gl_bai}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    sleep 2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>open_all_ports() {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    for cmd in iptables ip6tables; do
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        command -v $cmd &gt;/dev/null 2&gt;&amp;1 || continue
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        $cmd -P INPUT ACCEPT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        $cmd -P FORWARD ACCEPT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        $cmd -P OUTPUT ACCEPT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        $cmd -F
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        $cmd -X 2&gt;/dev/null || true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        $cmd -t mangle -F FORWARD 2&gt;/dev/null || true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    done
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    save_rules
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    echo -e &#34;${gl_lv}é˜²ç«å¢™å·²é‡ç½®å…¨å¼€æ¨¡å¼ï¼ŒMSS é’³åˆ¶å·²æ¸…é™¤ã€‚${gl_bai}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    sleep 2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>iptables_panel() {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    while true; do
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        clear
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        echo -e &#34;${gl_lv}===========================================${gl_bai}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        echo -e &#34;    é«˜çº§é˜²ç«å¢™ç®¡ç† (Debian/Ubuntu è‡ªé€‚åº”ç‰ˆ V4.1)    &#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        echo -e &#34;    å½“å‰ IPv6 çŠ¶æ€: \c&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        if [ &#34;$HAS_IPV6&#34; == true ]; then echo -e &#34;${gl_lv}å·²å¯ç”¨${gl_bai}&#34;; else echo -e &#34;${gl_huang}æœªå¯ç”¨${gl_bai}&#34;; fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        echo -e &#34;${gl_lv}===========================================${gl_bai}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        echo &#34; 1. æŸ¥çœ‹è§„åˆ™ (å« MSS é’³åˆ¶çŠ¶æ€)&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        echo &#34; 2. æ”¾è¡Œç«¯å£&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        echo &#34; 3. å±è”½åœ°å€&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        echo &#34; 4. åˆ é™¤è§„åˆ™&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        echo -e &#34; 5. ${gl_hong}æ‰§è¡Œæ·±åº¦åŠ å›º (æ™ºèƒ½æ£€æµ‹ç¯å¢ƒï¼Œæ‹’ç»å†—ä½™è§„åˆ™)${gl_bai}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        echo -e &#34; 6. ${gl_huang}ç´§æ€¥æ¢å¤å…¨å¼€ (é‡ç½®æ‰€æœ‰ç­–ç•¥)${gl_bai}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        echo &#34; 7. æ‰‹åŠ¨æŒä¹…åŒ–ä¿å­˜&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        echo &#34; 0. é€€å‡ºè„šæœ¬&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        echo &#34;-------------------------------------------&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        read -e -p &#34;è¯·é€‰æ‹©: &#34; choice
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        case $choice in
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            1) view_rules ;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            2) allow_port_flexible ;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            3) block_ip ;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            4) delete_rule ;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            5) close_all_but_ssh ;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            6) open_all_ports ;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            7) save_rules; sleep 2 ;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            0) exit 0 ;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            *) echo &#34;æ— æ•ˆé€‰æ‹©&#34;; sleep 1 ;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        esac
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    done
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>iptables_panel
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>chmod +x iptables_manager.sh
</span></span><span style=display:flex><span>./iptables_manager.sh
</span></span></code></pre></div><h2 id=ä½¿ç”¨æ³¨æ„>ä½¿ç”¨æ³¨æ„</h2><h4 id=æ‰§è¡Œåé€‰æ‹©-5ç³»ç»Ÿå°†åªæ ¹æ®ä½ çœŸå®å®‰è£…çš„ç»„ä»¶å†™å…¥å¿…éœ€çš„è½¬å‘è§„åˆ™>æ‰§è¡Œåé€‰æ‹© 5ï¼Œç³»ç»Ÿå°†åªæ ¹æ®ä½ çœŸå®å®‰è£…çš„ç»„ä»¶å†™å…¥å¿…éœ€çš„è½¬å‘è§„åˆ™ã€‚</h4><div id=utterances-comments><script src=https://utteranc.es/client.js repo=hanigege/blog-comments issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><footer class=content__footer></footer></section><section class=page__aside><div class=aside__about><div class=aside__about><span class=about__logo role=img>ğŸš</span>&nbsp;<h1 class=about__title>bash&amp;sh</h1><p class=about__description>å€‹äººè‡ªç•™åœ°ï¼Œå¦‚æœèƒ½å¹«åˆ°ä½ ï¼Œæˆ‘ä¹Ÿæœƒå¾ˆé«˜èˆˆã€‚</p></div><ul class=aside__social-links><li><a href=mailto:purodn@gmail.com rel=me aria-label=Email title=Email><i class="fa-solid fa-envelope" aria-hidden=true></i></a>&nbsp;</li></ul></div><hr><div class=aside__content><p>2026-02-27</p><hr>On this page:<nav id=TableOfContents><ol><li><ol><li><a href=#è¯´æ˜æ”¯æŒipv4ipv6è‡ªåŠ¨æ£€æµ‹æœ‰æ— ipv6æ·»åŠ mssè‡ªåŠ¨æ£€æµ‹sshç«¯å£ç­‰å¾ˆæ–¹ä¾¿>è¯´æ˜ï¼šæ”¯æŒipv4&amp;ipv6,è‡ªåŠ¨æ£€æµ‹æœ‰æ— ipv6ï¼Œæ·»åŠ mss.è‡ªåŠ¨æ£€æµ‹sshç«¯å£ç­‰ï¼Œå¾ˆæ–¹ä¾¿</a></li></ol></li><li><a href=#æˆåŠŸçš„æ­¥éª¤ä¸æ–¹æ³•>æˆåŠŸçš„æ­¥éª¤ä¸æ–¹æ³•</a></li><li><a href=#ç›´æ¥å¤åˆ¶å¹¶æ‰§è¡Œä»¥ä¸‹å®Œæ•´ä»£ç è¦†ç›–åŸè„šæœ¬>ç›´æ¥å¤åˆ¶å¹¶æ‰§è¡Œä»¥ä¸‹å®Œæ•´ä»£ç è¦†ç›–åŸè„šæœ¬ï¼š</a></li><li><a href=#ä½¿ç”¨æ³¨æ„>ä½¿ç”¨æ³¨æ„</a><ol><li></li></ol></li></ol></nav></div></section><footer class=page__footer><p class=copyright>Â© <strong>felix</strong>.</p><p class=advertisement>Powered by <a>bash&sh</a>.</p></footer></div></body></html>