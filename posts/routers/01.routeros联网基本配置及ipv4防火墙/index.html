<!doctype html><html lang=zh><head><title>01.RouterOSè”ç½‘åŸºæœ¬é…ç½®åŠIPv4é˜²ç«å¢™ &ndash; bash</title><meta name=description content="å€‹äººè‡ªç•™åœ°ï¼Œå¦‚æœèƒ½å¹«åˆ°ä½ ï¼Œæˆ‘ä¹Ÿæœƒå¾ˆé«˜èˆˆã€‚"><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=UTF-8><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.4/css/academicons.min.css integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://hanigege.github.io/css/palettes/base16-dark.css><link rel=stylesheet href=https://hanigege.github.io/css/risotto.css><link rel=stylesheet href=https://hanigege.github.io/css/custom.css><script src=https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js></script><style>.page__aside hr,.aside__content hr{display:none!important}.aside__content p{margin-bottom:.5rem!important}pre{position:relative;padding-top:40px!important;background-color:#1e1e1e!important;border:1px solid #333!important;border-radius:10px!important;box-shadow:0 4px 15px rgba(0,0,0,.4);overflow-x:auto!important;overflow-y:hidden!important;margin:1.5em 0}pre::-webkit-scrollbar{height:8px}pre::-webkit-scrollbar-thumb{background:#4a4a4a;border-radius:4px}pre::-webkit-scrollbar-track{background:0 0}code{font-family:jetbrains mono,fira code,Menlo,monospace!important;font-size:.92em!important;line-height:1.6!important;color:#d4d4d4!important;background:0 0!important;white-space:pre!important}.copy-code-button{position:absolute;top:10px;right:12px;padding:5px 12px;background:rgba(255,255,255,8%);color:#aaa;border:1px solid rgba(255,255,255,.15);border-radius:6px;backdrop-filter:blur(5px);-webkit-backdrop-filter:blur(5px);cursor:pointer;font-size:11px;font-weight:500;z-index:100;transition:all .25s ease}.copy-code-button:hover{background:rgba(102,217,239,.2);color:#66d9ef;border-color:#66d9ef;transform:translateY(-1px)}.copy-code-button:active{transform:translateY(0)}p img{cursor:zoom-in;transition:opacity .3s;border-radius:4px;max-width:100%}p img:hover{opacity:.9}.medium-zoom-overlay{z-index:999998!important}.medium-zoom-image--opened{z-index:999999!important}</style><script>document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll("pre").forEach(e=>{if(e.querySelector(".copy-code-button"))return;const t=document.createElement("button");t.className="copy-code-button",t.type="button",t.innerText="Copy",t.addEventListener("click",()=>{const n=e.querySelector("code"),s=n?n.innerText:e.innerText;navigator.clipboard.writeText(s).then(()=>{t.innerText="Copied!",t.style.background="rgba(166, 226, 46, 0.2)",t.style.color="#a6e22e",setTimeout(()=>{t.innerText="Copy",t.style.background="",t.style.color=""},2e3)})}),e.appendChild(t)});const e=document.querySelectorAll("p img");e.length>0&&mediumZoom(e,{margin:24,background:"#1e1e1ecf",scrollOffset:40})})</script></head><body><div class=page><header class=page__header><nav class="page__nav main-nav"><link rel=stylesheet href=/css/custom.css><ul><li class=nomarker><h1 class=page__logo><a href=https://hanigege.github.io/ class=page__logo-inner>bash</a></h1></li><li class=main-nav__item><a class=nav-main-item href=https://hanigege.github.io/categories/freebsd/ title>FreeBSD</a></li><li class=main-nav__item><a class=nav-main-item href=https://hanigege.github.io/categories/linux/ title>Linux</a></li><li class=main-nav__item><a class=nav-main-item href=https://hanigege.github.io/categories/routers/ title>Routers</a></li><li class=main-nav__item><a class=nav-main-item href=https://hanigege.github.io/categories/other/ title>Other</a></li><li class=main-nav__item><a class=nav-main-item href=https://hanigege.github.io/about/ title>About</a></li></ul></nav></header><section class=page__body><header class=content__header><h1>01.RouterOSè”ç½‘åŸºæœ¬é…ç½®åŠIPv4é˜²ç«å¢™</h1></header><div class=content__body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>æœ¬æ–‡ä»‹ç» RouterOS æ‹¨å·ã€é…ç½® DHCP æœåŠ¡å™¨ã€é…ç½® DNSã€å¼€å¯ IPv4 é˜²ç«å¢™ç­‰é€šç½‘çš„åŸºç¡€é…ç½®ã€‚
</span></span><span style=display:flex><span>æ¡¥æ¥æ¥å£ <span style=color:#e6db74>`bridge1`</span>ã€æ‹¨å·æ¥å£ <span style=color:#e6db74>`pppoe-out1`</span> åç§°è‹¥ä¸åŒåˆ™è‡ªè¡Œæ›¿æ¢ã€‚
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ä½œè€…ï¼šTom
</span></span></code></pre></div><h2 id=1-pppoe-æ‹¨å·é…ç½®>1. PPPoE æ‹¨å·é…ç½®</h2><p>æ‰‹åŠ¨é…ç½® <code>pppoe-out1</code> æ¥å£æ‹¨å·ï¼š</p><ul><li><strong>User</strong>: å¡«å…¥å®½å¸¦è´¦å·</li><li><strong>Password</strong>: å¡«å…¥å®½å¸¦å¯†ç </li><li>å¦‚æœä¸ä½¿ç”¨è¿è¥å•†æä¾›çš„ DNSï¼Œå¯ä¸å‹¾é€‰ <strong>Use Peer DNS</strong>ã€‚</li></ul><p><img src=assets/0.png alt=0></p><blockquote><p><strong>æ³¨</strong>ï¼šæ¥å£å‰å‡ºç° â€œRâ€ ä»£è¡¨æ‹¨å·æˆåŠŸã€‚æ‹¨å·æˆåŠŸåå»ºè®®å…ˆç¦ç”¨ï¼Œå¾…é˜²ç«å¢™é…ç½®å®Œæ¯•åå†å¼€å¯ï¼
<img src=assets/2.png alt=2></p></blockquote><h2 id=2-é…ç½®-dhcp-æœåŠ¡å™¨>2. é…ç½® DHCP æœåŠ¡å™¨</h2><p>DHCP IP èŒƒå›´ä¸º <code>10.0.0.100-10.0.0.250</code>ï¼Œç½‘å…³å’Œ DNS é»˜è®¤ä¸º ROSã€‚å¦‚æœå¸Œæœ›å…¨å±€é…ç½®é€æ˜ä»£ç†ï¼Œ<code>dns-server</code> å¯é…ç½®ä¸º mosdnsã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>/ip pool add name=dhcpv4-pool1 ranges=10.0.0.100-10.0.0.250
</span></span><span style=display:flex><span>/ip dhcp-server add name=dhcpv4-server1 interface=bridge1 address-pool=dhcpv4-pool1 lease-time=1d
</span></span><span style=display:flex><span>/ip dhcp-server network add address=10.0.0.0/24 gateway=10.0.0.1 dns-server=10.0.0.1
</span></span></code></pre></div><p><img src=assets/3.png alt=3>
<img src=assets/4.png alt=4></p><p><img src=assets/5.png alt=5></p><h2 id=3-é…ç½®-dns>3. é…ç½® DNS</h2><p>è®¾ç½® ROS çš„ä¸Šæ¸¸ DNSï¼Œæ­¤å¤„å…ˆè®¾ç½® <code>223.5.5.5</code>ï¼Œä¹Ÿå¯è‡ªå®šä¹‰å¡«å…¥è¿è¥å•†åˆ†é…çš„ DNSã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>/ip dns set servers=223.5.5.5 allow-remote-requests=yes max-concurrent-queries=4096 max-concurrent-tcp-sessions=512 cache-size=8192 cache-max-ttl=04:00:00
</span></span></code></pre></div><p><img src=assets/6.png alt=6></p><h2 id=4-é…ç½®åŠ¨æ€æºåœ°å€ä¼ªè£…-nat>4. é…ç½®åŠ¨æ€æºåœ°å€ä¼ªè£… (NAT)</h2><p>é™åˆ¶æº IP ä¸ºå†…ç½‘ç½‘æ®µï¼ˆæ³¨æ„å­ç½‘æ©ç ï¼Œå»ºè®®å°† WireGuard ä½¿ç”¨ç½‘æ®µåŒ…å«å…¶ä¸­ï¼‰ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>/ip firewall nat add action=masquerade chain=srcnat comment=&#34;defconf: masquerade IPv4&#34; src-address=10.0.0.0/8
</span></span></code></pre></div><p><img src=assets/7.png alt=7></p><p><strong>è‡³æ­¤æ‰“å¼€ pppoe æ¥å£å³å¯é€šç½‘ï¼Œä½†å»ºè®®ç»§ç»­é…ç½®å®Œé˜²ç«å¢™å†é€šç½‘ï¼</strong></p><h2 id=5-è®¿é—®å…‰çŒ«å¯é€‰>5. è®¿é—®å…‰çŒ«ï¼ˆå¯é€‰ï¼‰</h2><p>å¦‚æœéœ€è¦è®¿é—®å…‰çŒ«ï¼Œåˆ™ä¸º WAN å£åˆ†é…ä¸€ä¸ªå…‰çŒ«åŒç½‘æ®µçš„ IP åœ°å€ï¼ˆä¸€èˆ¬ä¸º <code>192.168.1.0/24</code>ï¼‰ã€‚æ³¨æ„ <code>interface</code> ä¸ºç‰©ç†æ¥å£ WANï¼Œä¸æ˜¯æ‹¨å·å£ã€‚
<img src=assets/8.png alt=8></p><hr><h2 id=6-ipv4-é˜²ç«å¢™é…ç½®>6. IPv4 é˜²ç«å¢™é…ç½®</h2><p><em>è§„åˆ™æºäº @Ronä½¬ï¼Œå»ºè®®æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´ã€‚</em></p><h3 id=æ·»åŠ é˜²ç«å¢™è§„åˆ™>æ·»åŠ é˜²ç«å¢™è§„åˆ™</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>/ip firewall filter add action=accept chain=forward in-interface=bridge1
</span></span><span style=display:flex><span>/ip firewall filter add action=accept chain=input in-interface=bridge1
</span></span><span style=display:flex><span>/ip firewall filter add action=accept chain=forward connection-state=established,related,untracked
</span></span><span style=display:flex><span>/ip firewall filter add action=accept chain=input connection-state=established,related
</span></span><span style=display:flex><span>/ip firewall filter add action=drop chain=input src-address-list=BlockIP in-interface=pppoe-out1
</span></span><span style=display:flex><span>/ip firewall filter add action=drop chain=input connection-state=invalid in-interface=pppoe-out1
</span></span><span style=display:flex><span>/ip firewall filter add action=drop chain=input protocol=icmp in-interface=pppoe-out1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>## 5391æ˜¯Winboxç™»é™†ç«¯å£ï¼Œå¯ä»¥åŠ ä¸Šæƒ³éšè—çš„ç«¯å£ã€‚å¦‚æœåœ¨NATæœ‰æ˜ å°„ï¼Œç«¯å£æ— æ³•éšè—
</span></span><span style=display:flex><span>/ip firewall filter add action=drop chain=input protocol=tcp dst-port=53,5391 in-interface=pppoe-out1
</span></span><span style=display:flex><span>/ip firewall filter add action=drop chain=input protocol=udp dst-port=53,5391 in-interface=pppoe-out1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>/ip firewall filter add action=add-src-to-address-list chain=input address-list=BlockIP address-list-timeout=1w protocol=tcp dst-port=!53,853,5391 tcp-flags=rst in-interface=pppoe-out1 psd=21,5s,3,1
</span></span><span style=display:flex><span>/ip firewall filter add action=add-src-to-address-list chain=input address-list=BlockIP address-list-timeout=1w protocol=tcp dst-port=!53,853,5391 tcp-flags=syn in-interface=pppoe-out1 psd=21,5s,3,1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>## UDPåè®® dst-port=!53,853,5391 å¯ä»¥åŠ ä¸Šwireguardç«¯å£ï¼Œé˜²æ­¢è§¦å‘PSDï¼Œé€ æˆIPè¢«Block
</span></span><span style=display:flex><span>/ip firewall filter add action=add-src-to-address-list chain=input address-list=BlockIP address-list-timeout=1w protocol=udp dst-port=!53,853,5391 in-interface=pppoe-out1 psd=21,5s,3,1
</span></span><span style=display:flex><span>/ip firewall filter add action=drop chain=input src-address-list=BlockIP
</span></span></code></pre></div><h3 id=è°ƒæ•´-tcp-mss>è°ƒæ•´ TCP MSS</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>/ip firewall mangle add action=change-mss chain=forward protocol=tcp tcp-flags=syn new-mss=clamp-to-pmtu passthrough=yes
</span></span><span style=display:flex><span>/ip firewall mangle add action=change-mss chain=output protocol=tcp tcp-flags=syn new-mss=clamp-to-pmtu passthrough=yes
</span></span></code></pre></div><h3 id=å…³é—­éå¿…è¦æœåŠ¡ç«¯å£>å…³é—­éå¿…è¦æœåŠ¡ç«¯å£</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>/ip firewall service-port disable ftp
</span></span><span style=display:flex><span>/ip firewall service-port disable irc
</span></span><span style=display:flex><span>/ip firewall service-port disable pptp
</span></span><span style=display:flex><span>/ip firewall service-port disable rtsp
</span></span><span style=display:flex><span>/ip firewall service-port disable sip
</span></span><span style=display:flex><span>/ip firewall service-port disable tftp
</span></span></code></pre></div><blockquote><p><strong>æ³¨</strong>ï¼šé˜²ç«å¢™é…ç½®å®Œæ¯•åï¼Œå³å¯æ‰“å¼€ <code>pppoe</code> æ¥å£å¼€å§‹ä¸Šç½‘ã€‚</p></blockquote><div id=utterances-comments><script src=https://utteranc.es/client.js repo=hanigege/blog-comments issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><footer class=content__footer></footer></section><section class=page__aside><div class=aside__about><div class=aside__about><span class=about__logo role=img>ğŸš</span>&nbsp;<h1 class=about__title>root</h1><p class=about__description>å€‹äººè‡ªç•™åœ°ï¼Œå¦‚æœèƒ½å¹«åˆ°ä½ ï¼Œæˆ‘ä¹Ÿæœƒå¾ˆé«˜èˆˆã€‚</p></div><ul class=aside__social-links><li><a href=mailto:purodn@gmail.com rel=me aria-label=Email title=Email><i class="fa-solid fa-envelope" aria-hidden=true></i></a>&nbsp;</li></ul></div><hr><div class=aside__content><p>2026-02-27</p><hr>On this page:<nav id=TableOfContents><ol><li><a href=#1-pppoe-æ‹¨å·é…ç½®>1. PPPoE æ‹¨å·é…ç½®</a></li><li><a href=#2-é…ç½®-dhcp-æœåŠ¡å™¨>2. é…ç½® DHCP æœåŠ¡å™¨</a></li><li><a href=#3-é…ç½®-dns>3. é…ç½® DNS</a></li><li><a href=#4-é…ç½®åŠ¨æ€æºåœ°å€ä¼ªè£…-nat>4. é…ç½®åŠ¨æ€æºåœ°å€ä¼ªè£… (NAT)</a></li><li><a href=#5-è®¿é—®å…‰çŒ«å¯é€‰>5. è®¿é—®å…‰çŒ«ï¼ˆå¯é€‰ï¼‰</a></li><li><a href=#6-ipv4-é˜²ç«å¢™é…ç½®>6. IPv4 é˜²ç«å¢™é…ç½®</a><ol><li><a href=#æ·»åŠ é˜²ç«å¢™è§„åˆ™>æ·»åŠ é˜²ç«å¢™è§„åˆ™</a></li><li><a href=#è°ƒæ•´-tcp-mss>è°ƒæ•´ TCP MSS</a></li><li><a href=#å…³é—­éå¿…è¦æœåŠ¡ç«¯å£>å…³é—­éå¿…è¦æœåŠ¡ç«¯å£</a></li></ol></li></ol></nav></div></section><footer class=page__footer><p class=copyright>Â© <strong>mana</strong>.</p><p class=advertisement>Powered by <a>bash&sh</a>.</p></footer></div></body></html>