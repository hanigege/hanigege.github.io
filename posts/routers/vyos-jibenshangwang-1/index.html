<!doctype html><html lang=zh><head><title>Vyosä¸Šç½‘ç³»åˆ—ä¹‹-ä¸Šç½‘é…ç½®ï¼ˆ1ï¼‰ &ndash; bash</title><meta name=description content="å€‹äººè‡ªç•™åœ°ï¼Œå¦‚æœèƒ½å¹«åˆ°ä½ ï¼Œæˆ‘ä¹Ÿæœƒå¾ˆé«˜èˆˆã€‚"><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=UTF-8><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.4/css/academicons.min.css integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://hanigege.github.io/css/palettes/base16-dark.css><link rel=stylesheet href=https://hanigege.github.io/css/risotto.css><link rel=stylesheet href=https://hanigege.github.io/css/custom.css><script src=https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js></script><style>.page__aside hr,.aside__content hr{display:none!important}.aside__content p{margin-bottom:.5rem!important}pre{position:relative;padding-top:40px!important;background-color:#1e1e1e!important;border:1px solid #333!important;border-radius:10px!important;box-shadow:0 4px 15px rgba(0,0,0,.4);overflow-x:auto!important;overflow-y:hidden!important;margin:1.5em 0}pre::-webkit-scrollbar{height:8px}pre::-webkit-scrollbar-thumb{background:#4a4a4a;border-radius:4px}pre::-webkit-scrollbar-track{background:0 0}code{font-family:jetbrains mono,fira code,Menlo,monospace!important;font-size:.92em!important;line-height:1.6!important;color:#d4d4d4!important;background:0 0!important;white-space:pre!important}.copy-code-button{position:absolute;top:10px;right:12px;padding:5px 12px;background:rgba(255,255,255,8%);color:#aaa;border:1px solid rgba(255,255,255,.15);border-radius:6px;backdrop-filter:blur(5px);-webkit-backdrop-filter:blur(5px);cursor:pointer;font-size:11px;font-weight:500;z-index:100;transition:all .25s ease}.copy-code-button:hover{background:rgba(102,217,239,.2);color:#66d9ef;border-color:#66d9ef;transform:translateY(-1px)}.copy-code-button:active{transform:translateY(0)}p img{cursor:zoom-in;transition:opacity .3s;border-radius:4px;max-width:100%}p img:hover{opacity:.9}.medium-zoom-overlay{z-index:999998!important}.medium-zoom-image--opened{z-index:999999!important}</style><script>document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll("pre").forEach(e=>{if(e.querySelector(".copy-code-button"))return;const t=document.createElement("button");t.className="copy-code-button",t.type="button",t.innerText="Copy",t.addEventListener("click",()=>{const n=e.querySelector("code"),s=n?n.innerText:e.innerText;navigator.clipboard.writeText(s).then(()=>{t.innerText="Copied!",t.style.background="rgba(166, 226, 46, 0.2)",t.style.color="#a6e22e",setTimeout(()=>{t.innerText="Copy",t.style.background="",t.style.color=""},2e3)})}),e.appendChild(t)});const e=document.querySelectorAll("p img");e.length>0&&mediumZoom(e,{margin:24,background:"#1e1e1ecf",scrollOffset:40})})</script></head><body><div class=page><header class=page__header><nav class="page__nav main-nav"><link rel=stylesheet href=/css/custom.css><ul><li class=nomarker><h1 class=page__logo><a href=https://hanigege.github.io/ class=page__logo-inner>bash</a></h1></li><li class=main-nav__item><a class=nav-main-item href=https://hanigege.github.io/categories/freebsd/ title>FreeBSD</a></li><li class=main-nav__item><a class=nav-main-item href=https://hanigege.github.io/categories/linux/ title>Linux</a></li><li class=main-nav__item><a class=nav-main-item href=https://hanigege.github.io/categories/routers/ title>Routers</a></li><li class=main-nav__item><a class=nav-main-item href=https://hanigege.github.io/categories/other/ title>Other</a></li><li class=main-nav__item><a class=nav-main-item href=https://hanigege.github.io/about/ title>About</a></li></ul></nav></header><section class=page__body><header class=content__header><h1>Vyosä¸Šç½‘ç³»åˆ—ä¹‹-ä¸Šç½‘é…ç½®ï¼ˆ1ï¼‰</h1></header><div class=content__body><h4 id=vyosçš„å‘½ä»¤è¡Œç•Œé¢æ˜¯åŸºäºshellçš„æ²¡æœ‰å›¾å½¢ç•Œé¢-ä½†æ˜¯å¯ä»¥ç”¨tabè‡ªåŠ¨è¡¥å…¨>vyosçš„å‘½ä»¤è¡Œç•Œé¢æ˜¯åŸºäºshellçš„ï¼Œæ²¡æœ‰å›¾å½¢ç•Œé¢, ä½†æ˜¯å¯ä»¥ç”¨tabè‡ªåŠ¨è¡¥å…¨.</h4><p>æœ¬æ–‡çš„vyoså‘½ä»¤æ˜¯åŸºäºvyosçš„vyos-rolling-nightly-buildsçš„1.5.xç‰ˆæœ¬.</p><p><code>**ç‰¹åˆ«æ„Ÿè°¢å¤§å«ä½¬ç»™äºˆçš„æŒ‡å¯¼ä¸å¸®åŠ©**</code></p><h2 id=pveå®‰è£…vyos>pveå®‰è£…vyos:</h2><p>ä¸‹è½½nightly-build: <a href=https://github.com/vyos/vyos-nightly-build/releases>https://github.com/vyos/vyos-nightly-build/releases</a>
pveçš„è™šæ‹Ÿæœºè®¾ç½®å’Œå®‰è£…(ç•¥), å»ºè®®å†…å­˜2G, ç£ç›˜10Gæˆ–æ›´å¤§, å› ä¸ºvyoså¯ä»¥è¿è¡Œå®¹å™¨, vyosç”¨podmanç®¡ç†å®¹å™¨.</p><p>vmè¿è¡Œå, ç”¨vyos:vyosç™»å½•. ç”¨å‘½ä»¤</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>install image
</span></span></code></pre></div><p>å®‰è£…vyos.</p><p>è¿›å…¥é…ç½®æ¨¡å¼ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>configure
</span></span></code></pre></div><p>ç”Ÿæ•ˆï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>commit
</span></span></code></pre></div><p>ä¿å­˜é…ç½®ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>save
</span></span></code></pre></div><p>å–æ¶ˆç”Ÿæ•ˆçš„,æœªä¿å­˜çš„é…ç½®ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>discard
</span></span></code></pre></div><h2 id=ä¸‹é¢å¼€å§‹é…ç½®éšæ—¶éƒ½å¯ä»¥è¾“å…¥ç”Ÿæ•ˆå‘½ä»¤å¦‚æœä¸ä¿å­˜é‡å¯åé…ç½®ä¼šå¤±æ•ˆ>ä¸‹é¢å¼€å§‹é…ç½®ï¼Œéšæ—¶éƒ½å¯ä»¥è¾“å…¥ç”Ÿæ•ˆå‘½ä»¤ï¼Œå¦‚æœä¸ä¿å­˜ï¼Œé‡å¯åé…ç½®ä¼šå¤±æ•ˆ</h2><p>è®¾ç½®sshç™»å½•:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set service ssh port &#39;22&#39;
</span></span></code></pre></div><p>åˆ›å»ºç”¨æˆ·gary:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set system login user gary full-name gary
</span></span><span style=display:flex><span>set system login user gary authentication plaintext-password &#39;å¯†ç &#39;
</span></span></code></pre></div><p>å»ºè®®sshå¯†é’¥ç™»å½•:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set system login user gary authentication public-keys gary@laptop key &#39;your-public-key&#39;
</span></span><span style=display:flex><span>set system login user gary authentication public-keys gary@laptop type &#39;ssh-rsa&#39;
</span></span></code></pre></div><p>ç¦ç”¨é»˜è®¤çš„vyosç”¨æˆ·:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set system login user vyos disable
</span></span></code></pre></div><p>è®¾ç½®ç³»ç»Ÿçš„hostname:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set system host-name &#39;vyos&#39;
</span></span></code></pre></div><p>æŸ¥çœ‹ç³»ç»Ÿçš„hostname</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>show system host-name
</span></span></code></pre></div><p>è®¾ç½®æ—¶åŒº:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set system time-zone &#39;Asia/Shanghai&#39;
</span></span></code></pre></div><p>è®¾ç½®ntp:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set service ntp server 129.250.35.251
</span></span><span style=display:flex><span>set service ntp server 203.107.6.88
</span></span></code></pre></div><p>(æ³¨: å¯ä»¥è®¾ç½®å¤šä¸ªntpæœåŠ¡å™¨, å»ºè®®ç”¨è¿è¥å•†çš„ntpæœåŠ¡å™¨, æœ€å¥½æ˜¯çº¯ip, å¯åˆ é™¤é»˜è®¤çš„ntpæœåŠ¡å™¨)</p><p>è®¾ç½®æ¥å£ç»„(å¯é€‰ä½†å»ºè®®):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set firewall group interface-group LAN interface &#39;eth0&#39;
</span></span><span style=display:flex><span>set firewall group interface-group WAN interface &#39;eth1&#39;
</span></span></code></pre></div><p>è®¾ç½®ç½‘ç»œç»„(å¯é€‰):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set firewall group network-group LAN-v4 network &#39;192.168.100.0/24&#39;
</span></span></code></pre></div><p>è®¾ç½®ip:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set interfaces ethernet eth0 address 192.168.100.1/24
</span></span></code></pre></div><p>é…ç½®dhcp server:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 subnet-id 1   
</span></span><span style=display:flex><span>set service dhcp-server hostfile-update
</span></span><span style=display:flex><span>set service dhcp-server shared-network-name VYOS authoritative #å¼€å¯ç‰¹å®šå…±äº«ç½‘ç»œçš„æˆæƒï¼Œé˜²æ­¢å‡ºç°å†²çªå’Œæ··ä¹±(ç¬¬ä¸‰æ–¹åŠ çš„ï¼‰
</span></span><span style=display:flex><span>set service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 lease &#39;86400&#39;
</span></span><span style=display:flex><span>set service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 option default-router &#39;192.168.100.1&#39; #dhcp option é»˜è®¤ç½‘å…³
</span></span><span style=display:flex><span>set service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 option name-server &#39;192.168.100.1&#39; #dhcp option dns
</span></span><span style=display:flex><span>set service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 option ntp-server &#39;192.168.100.1&#39; #dhcp option ntp
</span></span><span style=display:flex><span>set service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 range 0 start &#39;192.168.100.101&#39;
</span></span><span style=display:flex><span>set service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 range 0 stop &#39;192.168.100.200&#39;
</span></span></code></pre></div><h3 id=è¡¥å……å¯é€‰>è¡¥å……ï¼ˆå¯é€‰ï¼‰ï¼š</h3><p>æ·»åŠ ä¸€ä¸ªdhcpä¸‹çš„dns</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 option name-server &#39;192.168.100.2&#39;
</span></span><span style=display:flex><span>åˆ é™¤ä¸€ä¸ªdpcpä¸‹çš„dns
</span></span><span style=display:flex><span>delete service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 option name-server &#39;192.168.100.1&#39;
</span></span><span style=display:flex><span>æ›´æ”¹dhcpä¸‹çš„ç½‘å…³åœ°å€
</span></span><span style=display:flex><span>set service dhcp-server shared-network-name VYOS subnet 192.168.100.0/24 option default-router &#39;192.168.100.2&#39; 
</span></span></code></pre></div><p>è®¾ç½®å¤–ç½‘ç½‘å£ä¸ºdhcpå®¢æˆ·ç«¯ï¼Œä»ä¸Šçº§è·¯ç”±è·å– ï¼ˆå¯é€‰ï¼‰ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set interfaces ethernet eth1 address dhcp
</span></span></code></pre></div><h2 id=è®¾ç½®pppoe1å‚è€ƒé…ç½®ä¸€>è®¾ç½®pppoe1å‚è€ƒé…ç½®ï¼ˆä¸€ï¼‰</h2><p>å½“eth1æ˜¯pppoeæ—¶ï¼Œé…ç½® PPPoE æ‹¨å·:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set interfaces pppoe pppoe0 source-interface &#39;eth1&#39;
</span></span><span style=display:flex><span>set interfaces pppoe pppoe0 authentication username &#39;054546å¸å·6266&#39;
</span></span><span style=display:flex><span>set interfaces pppoe pppoe0 authentication password &#39;24å¯†ç 502&#39;
</span></span><span style=display:flex><span>set interfaces pppoe pppoe0 mtu &#39;1492&#39;
</span></span><span style=display:flex><span>set interfaces pppoe pppoe0 ip adjust-mss &#39;clamp-mss-to-pmtu&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>set interfaces pppoe pppoe1 no-default-route
</span></span><span style=display:flex><span>(æ³¨: å½“è®¾ç½®no-default-routeæ—¶, éœ€è¦åœ¨åé¢æŒ‡å®šé™æ€è·¯ç”±, æˆ–è€…ä¹Ÿå¯ä¸è®¾ç½®no-default-routeè¿™æ¡, vyosä¼šè‡ªåŠ¨æ·»åŠ é»˜è®¤è·¯ç”±)
</span></span></code></pre></div><p>å°æŠ€å·§ï¼šåœ¨ VyOS ä¸­ï¼Œè¦åˆ é™¤ä¸€æ¡å·²æœ‰çš„é…ç½®ï¼Œéœ€è¦ä½¿ç”¨ delete å‘½ä»¤ã€‚
å¯¹äº <code>set interfaces pppoe pppoe0 source-interface 'eth1'</code>ï¼Œå¯ä»¥è¿™æ ·åˆ é™¤ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>configure
</span></span><span style=display:flex><span>delete interfaces pppoe pppoe1 source-interface
</span></span><span style=display:flex><span>commit
</span></span><span style=display:flex><span>save
</span></span><span style=display:flex><span>exit
</span></span></code></pre></div><p>è®¾ç½®å‡ºWanå£çš„é»˜è®¤é™æ€è·¯ç”±:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set protocols static route 0.0.0.0/0 interface pppoe0
</span></span><span style=display:flex><span>set protocols static route6 ::/0 interface pppoe0
</span></span><span style=display:flex><span>(æ³¨: å‰é¢è®¾ç½®äº†no-default-route, æ‰€ä»¥è¿™é‡Œéœ€è¦è®¾ç½®é»˜è®¤è·¯ç”±)
</span></span></code></pre></div><h2 id=è®¾ç½®dns>è®¾ç½®dns:</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set system name-server &#39;223.5.5.5&#39;
</span></span><span style=display:flex><span>set service dns forwarding cache-size &#39;0&#39; ## å…³é—­äº†ç¼“å­˜ï¼Œé»˜è®¤æ˜¯150
</span></span><span style=display:flex><span>set service dns forwarding listen-address &#39;192.168.100.1&#39; ## ç›‘å¬ LAN å£
</span></span><span style=display:flex><span># 3. é™åˆ¶ DNS è§£æèŒƒå›´ï¼Œä»…å…è®¸å†…ç½‘ä½¿ç”¨
</span></span><span style=display:flex><span>set service dns forwarding allow-from &#39;192.168.100.0/24&#39;
</span></span></code></pre></div><p>è®¾ç½®ç«¯å£è½¬å‘(DNAT):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set nat destination rule 10 description &#39;DSTNAT-wg&#39;
</span></span><span style=display:flex><span>set nat destination rule 10 destination port &#39;53822&#39;
</span></span><span style=display:flex><span>set nat destination rule 10 inbound-interface group &#39;WAN&#39; #å¯ç”¨interface eth1ä»£æ›¿
</span></span><span style=display:flex><span>set nat destination rule 10 protocol &#39;udp&#39;
</span></span><span style=display:flex><span>set nat destination rule 10 translation address &#39;192.168.10.145&#39;
</span></span><span style=display:flex><span>set nat destination rule 10 translation port &#39;53822&#39; #å¯çœç•¥, å¦‚æœç«¯å£ç›¸åŒ
</span></span></code></pre></div><p>è®¾ç½®é˜²ç«å¢™:
è®¾ç½®masquerade(SNAT):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set nat source rule 100 translation address &#39;masquerade&#39;
</span></span></code></pre></div><p>æŒ‡å®šç½‘æ®µï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set nat source rule 100 source address &#39;192.168.100.0/24&#39;
</span></span></code></pre></div><p>è®¾ç½®å›æµ:
ç”±äºä¸Šé¢masquerade(SNAT)çš„è§„åˆ™, è¿™é‡Œä¸éœ€è¦è®¾ç½®å›æµ.
<code>---------------------------------------------</code>
è¿™é‡Œé˜²ç«å¢™rule <number>æ•°å­—å¯è‡ªå®š, åŒä¸€æ•°å­—ä¸ºä¸€ç»„, å»ºè®®è®¾ç½®æ•°å­—æ—¶, ç•™å‡ºç©ºéš™, ä»¥ä¾¿ä»¥åæ·»åŠ æ–°çš„è§„åˆ™.
é’ˆå¯¹ä¸Šé¢è¿™æ¡nat source rule 100 è§„åˆ™, å»ºè®®ä¸è¦é™åˆ¶æ¥å£, å°±åªç”¨ä¸Šé¢ä¸€æ¡, è¿™å¯¹ä»¥åçš„ç«¯å£è½¬å‘å’Œå›æµè®¾ç½®, éƒ½å¾ˆæ–¹ä¾¿.</p><h2 id=è®¾ç½®é˜²ç«å¢™è§„åˆ™>è®¾ç½®é˜²ç«å¢™è§„åˆ™:</h2><p>å…¨å±€ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set firewall global-options state-policy established action &#39;accept&#39;
</span></span><span style=display:flex><span>set firewall global-options state-policy invalid action &#39;drop&#39;
</span></span><span style=display:flex><span>set firewall global-options state-policy related action &#39;accept&#39;
</span></span><span style=display:flex><span>#ä¸‹é¢ä¸€æ¡æ˜¯å®¹å™¨ä¸å†…ç½‘äº’é€š
</span></span><span style=display:flex><span>set firewall global-options apply-to-bridged-traffic invalid-connections
</span></span></code></pre></div><p>è®¾ç½®ipv4å…¥ç«™(inputé“¾)è§„åˆ™:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set firewall ipv4 name WAN_LOCAL default-action &#39;drop&#39; #é»˜è®¤æ‹’ç»
</span></span><span style=display:flex><span>set firewall ipv4 name WAN_LOCAL rule 10 action &#39;accept&#39; #å…è®¸å·²å»ºç«‹å’Œç›¸å…³è¿æ¥
</span></span><span style=display:flex><span>set firewall ipv4 name WAN_LOCAL rule 10 state &#39;established&#39;
</span></span><span style=display:flex><span>set firewall ipv4 name WAN_LOCAL rule 10 state &#39;related&#39;
</span></span><span style=display:flex><span>set firewall ipv4 name WAN_LOCAL rule 30 action &#39;accept&#39; #å…è®¸icmp
</span></span><span style=display:flex><span>set firewall ipv4 name WAN_LOCAL rule 30 protocol &#39;icmp&#39;
</span></span></code></pre></div><p>ä¸‹é¢æ˜¯wireguardæ”¾è¡Œç«¯å£ï¼ˆå¯é€‰ï¼‰</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set firewall ipv4 name WAN_LOCAL rule 20 action &#39;accept&#39; #å…è®¸è¿æ¥wg0
</span></span><span style=display:flex><span>set firewall ipv4 name WAN_LOCAL rule 20 destination port &#39;11133&#39; 
</span></span><span style=display:flex><span>set firewall ipv4 name WAN_LOCAL rule 20 protocol &#39;udp&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>set firewall ipv4 name WAN_LOCAL rule 40 action &#39;accept&#39; #è¿ç»­ç«¯å£æ ·ä¾‹
</span></span><span style=display:flex><span>set firewall ipv4 name WAN_LOCAL rule 40 destination port &#39;10000-10100&#39;
</span></span><span style=display:flex><span>set firewall ipv4 name WAN_LOCAL rule 40 protocol &#39;udp&#39;
</span></span></code></pre></div><p>è®¾ç½®ipv6å…¥ç«™(inputé“¾)è§„åˆ™:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set firewall ipv6 name WAN_LOCAL default-action &#39;drop&#39; #é»˜è®¤æ‹’ç»
</span></span><span style=display:flex><span>set firewall ipv6 name WAN_LOCAL rule 10 action &#39;accept&#39; #å…è®¸å·²å»ºç«‹å’Œç›¸å…³è¿æ¥
</span></span><span style=display:flex><span>set firewall ipv6 name WAN_LOCAL rule 10 state &#39;established&#39;
</span></span><span style=display:flex><span>set firewall ipv6 name WAN_LOCAL rule 10 state &#39;related&#39;
</span></span><span style=display:flex><span>set firewall ipv6 name WAN_LOCAL rule 20 action &#39;accept&#39; #å…è®¸icmpv6
</span></span><span style=display:flex><span>set firewall ipv6 name WAN_LOCAL rule 20 protocol &#39;icmpv6&#39;
</span></span><span style=display:flex><span>set firewall ipv6 name WAN_LOCAL rule 30 action &#39;accept&#39; #å…è®¸ä»ISPå¤„è·å–çš„dhcp6çš„ä¿¡æ¯
</span></span><span style=display:flex><span>set firewall ipv6 name WAN_LOCAL rule 30 destination port &#39;546&#39;
</span></span><span style=display:flex><span>set firewall ipv6 name WAN_LOCAL rule 30 protocol &#39;udp&#39;
</span></span><span style=display:flex><span>set firewall ipv6 name WAN_LOCAL rule 30 source port &#39;547&#39;
</span></span></code></pre></div><p>ä¸‹é¢æ˜¯wireguardæ”¾è¡Œç«¯å£ï¼ˆå¯é€‰ï¼‰</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set firewall ipv6 name WAN_LOCAL rule 40 action &#39;accept&#39; #å…è®¸è¿æ¥wg0
</span></span><span style=display:flex><span>set firewall ipv6 name WAN_LOCAL rule 40 destination port &#39;11133&#39;
</span></span><span style=display:flex><span>set firewall ipv6 name WAN_LOCAL rule 40 protocol &#39;udp&#39;
</span></span></code></pre></div><p>è®¾ç½®ipv4è½¬å‘(forwardé“¾)è§„åˆ™:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set firewall ipv4 name WAN_IN default-action &#39;drop&#39; #é»˜è®¤æ‹’ç»
</span></span><span style=display:flex><span>set firewall ipv4 name WAN_IN rule 10 action &#39;accept&#39; #å…è®¸å·²å»ºç«‹å’Œç›¸å…³è¿æ¥
</span></span><span style=display:flex><span>set firewall ipv4 name WAN_IN rule 10 state &#39;established&#39;
</span></span><span style=display:flex><span>set firewall ipv4 name WAN_IN rule 10 state &#39;related&#39;
</span></span></code></pre></div><p>å¦‚æœ‰ipv4è¿›æ¥åçš„ç«¯å£è½¬å‘åŠ ä¸‹é¢ä¸‰æ¡</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set firewall ipv4 name WAN_IN rule 20 action &#39;accept&#39; #å…è®¸å·²DNATçš„è¿æ¥
</span></span><span style=display:flex><span>set firewall ipv4 name WAN_IN rule 20 connection-status nat &#39;destination&#39;
</span></span><span style=display:flex><span>set firewall ipv4 name WAN_IN rule 20 state &#39;new&#39;
</span></span></code></pre></div><p>å¦‚æœ‰ipv6è¿›æ¥åçš„ç«¯å£è½¬å‘ ä¹Ÿéœ€è¦å’Œv4ä¸€æ · åŠ è¿™æ¡</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set firewall ipv6 name WAN_IN rule 40 action &#39;accept&#39;
</span></span><span style=display:flex><span>set firewall ipv6 name WAN_IN rule 40 connection-status nat &#39;destination&#39;
</span></span><span style=display:flex><span>set firewall ipv6 name WAN_IN rule 40 state &#39;new&#39;
</span></span></code></pre></div><p>è®¾ç½®ipv6è½¬å‘(forwardé“¾)è§„åˆ™:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set firewall ipv6 name WAN_IN default-action &#39;drop&#39; #é»˜è®¤æ‹’ç»
</span></span><span style=display:flex><span>set firewall ipv6 name WAN_IN rule 10 action &#39;accept&#39; #å…è®¸å·²å»ºç«‹å’Œç›¸å…³è¿æ¥
</span></span><span style=display:flex><span>set firewall ipv6 name WAN_IN rule 10 state &#39;established&#39;
</span></span><span style=display:flex><span>set firewall ipv6 name WAN_IN rule 10 state &#39;related&#39;
</span></span><span style=display:flex><span>set firewall ipv6 name WAN_IN rule 20 action &#39;accept&#39; #å…è®¸icmpv6
</span></span><span style=display:flex><span>set firewall ipv6 name WAN_IN rule 20 protocol &#39;icmpv6&#39;
</span></span><span style=display:flex><span>set firewall ipv6 name WAN_IN rule 30 action &#39;accept&#39; #å…è®¸ipsec
</span></span><span style=display:flex><span>set firewall ipv6 name WAN_IN rule 30 destination port &#39;500,4500&#39;
</span></span><span style=display:flex><span>set firewall ipv6 name WAN_IN rule 30 protocol &#39;udp&#39;
</span></span></code></pre></div><p>ç„¶ååˆ†åˆ«ä»inputå’Œforwardé“¾, è°ƒç”¨WAN_LOCALå’ŒWAN_IN:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set firewall ipv4 input filter rule 10 action &#39;jump&#39;
</span></span><span style=display:flex><span>set firewall ipv4 input filter rule 10 inbound-interface group &#39;WAN&#39;
</span></span><span style=display:flex><span>set firewall ipv4 input filter rule 10 jump-target &#39;WAN_LOCAL&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>set firewall ipv4 forward filter rule 10 action &#39;jump&#39;
</span></span><span style=display:flex><span>set firewall ipv4 forward filter rule 10 inbound-interface group &#39;WAN&#39;
</span></span><span style=display:flex><span>set firewall ipv4 forward filter rule 10 jump-target &#39;WAN_IN&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>set firewall ipv6 input filter rule 10 action &#39;jump&#39;
</span></span><span style=display:flex><span>set firewall ipv6 input filter rule 10 inbound-interface group &#39;WAN&#39;
</span></span><span style=display:flex><span>set firewall ipv6 input filter rule 10 jump-target &#39;WAN_LOCAL&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>set firewall ipv6 forward filter rule 10 action &#39;jump&#39;
</span></span><span style=display:flex><span>set firewall ipv6 forward filter rule 10 inbound-interface group &#39;WAN&#39;
</span></span><span style=display:flex><span>set firewall ipv6 forward filter rule 10 jump-target &#39;WAN_IN&#39;
</span></span></code></pre></div><p>æ³¨: DNATæ˜¯æµé‡è¿›å…¥å, æœ€å…ˆå¤„ç†çš„, ç„¶åè¿›å…¥forwardé“¾, è€ŒSNATæ˜¯æµé‡å‡ºç«™å‰, æœ€åå¤„ç†çš„.</p><h2 id=é…ç½®wireguard>é…ç½®wireguard:</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set interfaces wireguard wg0 address &#39;10.20.20.1/24&#39;
</span></span><span style=display:flex><span>set interfaces wireguard wg0 peer iphone allowed-ips &#39;10.20.20.2/32&#39;
</span></span><span style=display:flex><span>set interfaces wireguard wg0 peer iphone preshared-key &#39;preshared-key&#39;
</span></span><span style=display:flex><span>set interfaces wireguard wg0 peer iphone public-key &#39;public-key&#39;
</span></span><span style=display:flex><span>set interfaces wireguard wg0 port &#39;11133&#39;
</span></span><span style=display:flex><span>set interfaces wireguard wg0 private-key &#39;private-key&#39;
</span></span></code></pre></div><h2 id=é…ç½®ddns>é…ç½®ddns:</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>cloudflare ddns:
</span></span><span style=display:flex><span>set service dns dynamic name DDNS-CF-v4 address interface &#39;pppoe1&#39;
</span></span><span style=display:flex><span>set service dns dynamic name DDNS-CF-v4 host-name &#39;ddns.example.com&#39;
</span></span><span style=display:flex><span>set service dns dynamic name DDNS-CF-v4 ip-version &#39;ipv4&#39;
</span></span><span style=display:flex><span>set service dns dynamic name DDNS-CF-v4 password &#39;token&#39;
</span></span><span style=display:flex><span>set service dns dynamic name DDNS-CF-v4 protocol &#39;cloudflare&#39;
</span></span><span style=display:flex><span>set service dns dynamic name DDNS-CF-v4 zone &#39;example.com&#39;
</span></span><span style=display:flex><span>set service dns dynamic name DDNS-CF-v6 address interface &#39;eth0&#39;
</span></span><span style=display:flex><span>set service dns dynamic name DDNS-CF-v6 host-name &#39;ddns6.example.com&#39;
</span></span><span style=display:flex><span>set service dns dynamic name DDNS-CF-v6 ip-version &#39;ipv6&#39;
</span></span><span style=display:flex><span>set service dns dynamic name DDNS-CF-v6 password &#39;token&#39;
</span></span><span style=display:flex><span>set service dns dynamic name DDNS-CF-v6 protocol &#39;cloudflare&#39;
</span></span><span style=display:flex><span>set service dns dynamic name DDNS-CF-v6 zone &#39;example.com&#39;
</span></span></code></pre></div><p>dnspod ddns:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set service dns dynamic name DNSPOD-v4 address interface &#39;pppoe1&#39;
</span></span><span style=display:flex><span>set service dns dynamic name DNSPOD-v4 host-name &#39;ddns.example.com&#39;
</span></span><span style=display:flex><span>set service dns dynamic name DNSPOD-v4 password &#39;token&#39;
</span></span><span style=display:flex><span>set service dns dynamic name DNSPOD-v4 protocol &#39;dyndns2&#39;
</span></span><span style=display:flex><span>set service dns dynamic name DNSPOD-v4 server &#39;dnsapi.cn&#39;
</span></span><span style=display:flex><span>set service dns dynamic name DNSPOD-v4 username &#39;id&#39;
</span></span></code></pre></div><h4 id=ä¸ªäººä½¿ç”¨ä¸‹æ¥-ä¸Šè¿°é…ç½®å¹¶ä¸éœ€è¦è®¾ç½®interval-ipå˜åŒ–ä¹Ÿä¼šè‡ªåŠ¨æ›´æ–°>ä¸ªäººä½¿ç”¨ä¸‹æ¥, ä¸Šè¿°é…ç½®å¹¶ä¸éœ€è¦è®¾ç½®interval, ipå˜åŒ–ä¹Ÿä¼šè‡ªåŠ¨æ›´æ–°.</h4><h2 id=è®¾ç½®ç­–ç•¥è·¯ç”±>è®¾ç½®ç­–ç•¥è·¯ç”±:</h2><p>ä¸¾ä¾‹: è®©wg0çš„æµé‡èµ°100å·è·¯ç”±è¡¨, 100å·è·¯ç”±è¡¨æ˜¯sbçš„è·¯ç”±è¡¨</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set policy route WG0-to-SB interface &#39;wg0&#39;
</span></span><span style=display:flex><span>set policy route WG0-to-SB rule 10 destination group network-group &#39;!LAN-v4&#39;
</span></span><span style=display:flex><span>set policy route WG0-to-SB rule 10 set table &#39;100&#39;
</span></span></code></pre></div><p>è·¯ç”±è¡¨</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>set protocols static table 100 route 0.0.0.0/0 next-hop 192.168.10.90
</span></span></code></pre></div><hr><p>Happy Routing!</p><div id=utterances-comments><script src=https://utteranc.es/client.js repo=hanigege/blog-comments issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><footer class=content__footer></footer></section><section class=page__aside><div class=aside__about><div class=aside__about><span class=about__logo role=img>ğŸš</span>&nbsp;<h1 class=about__title>root</h1><p class=about__description>å€‹äººè‡ªç•™åœ°ï¼Œå¦‚æœèƒ½å¹«åˆ°ä½ ï¼Œæˆ‘ä¹Ÿæœƒå¾ˆé«˜èˆˆã€‚</p></div><ul class=aside__social-links><li><a href=mailto:purodn@gmail.com rel=me aria-label=Email title=Email><i class="fa-solid fa-envelope" aria-hidden=true></i></a>&nbsp;</li></ul></div><hr><div class=aside__content><p>2025-05-10</p><hr>On this page:<nav id=TableOfContents><ol><li><ol><li></li></ol></li><li><a href=#pveå®‰è£…vyos>pveå®‰è£…vyos:</a></li><li><a href=#ä¸‹é¢å¼€å§‹é…ç½®éšæ—¶éƒ½å¯ä»¥è¾“å…¥ç”Ÿæ•ˆå‘½ä»¤å¦‚æœä¸ä¿å­˜é‡å¯åé…ç½®ä¼šå¤±æ•ˆ>ä¸‹é¢å¼€å§‹é…ç½®ï¼Œéšæ—¶éƒ½å¯ä»¥è¾“å…¥ç”Ÿæ•ˆå‘½ä»¤ï¼Œå¦‚æœä¸ä¿å­˜ï¼Œé‡å¯åé…ç½®ä¼šå¤±æ•ˆ</a><ol><li><a href=#è¡¥å……å¯é€‰>è¡¥å……ï¼ˆå¯é€‰ï¼‰ï¼š</a></li></ol></li><li><a href=#è®¾ç½®pppoe1å‚è€ƒé…ç½®ä¸€>è®¾ç½®pppoe1å‚è€ƒé…ç½®ï¼ˆä¸€ï¼‰</a></li><li><a href=#è®¾ç½®dns>è®¾ç½®dns:</a></li><li><a href=#è®¾ç½®é˜²ç«å¢™è§„åˆ™>è®¾ç½®é˜²ç«å¢™è§„åˆ™:</a></li><li><a href=#é…ç½®wireguard>é…ç½®wireguard:</a></li><li><a href=#é…ç½®ddns>é…ç½®ddns:</a><ol><li></li></ol></li><li><a href=#è®¾ç½®ç­–ç•¥è·¯ç”±>è®¾ç½®ç­–ç•¥è·¯ç”±:</a></li></ol></nav></div></section><footer class=page__footer><p class=copyright>Â© <strong>Gary</strong>.</p><p class=advertisement>Powered by <a>bash&sh</a>.</p></footer></div></body></html>