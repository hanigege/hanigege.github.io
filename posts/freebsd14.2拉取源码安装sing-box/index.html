<!doctype html><html lang=zh><head><title>Freebsd14.2æ‹‰å–æºç å®‰è£…sing-Box(åŒ…å«pfé˜²ç«å¢™é…ç½®) &ndash; ä»£ç¢¼å€‰åº«</title><meta name=description content="å€‹äººè‡ªç•™åœ°ï¼Œå¦‚æœèƒ½å¹«åˆ°ä½ ï¼Œæˆ‘ä¹Ÿæœƒå¾ˆé«˜èˆˆã€‚"><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=UTF-8><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.4/css/academicons.min.css integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://hanigege.github.io/css/palettes/base16-dark.css><link rel=stylesheet href=https://hanigege.github.io/css/risotto.css><link rel=stylesheet href=https://hanigege.github.io/css/custom.css></head><body><div class=page><header class=page__header><nav class="page__nav main-nav"><link rel=stylesheet href=/css/custom.css><ul><li class=nomarker><h1 class=page__logo><a href=https://hanigege.github.io/ class=page__logo-inner>ä»£ç¢¼å€‰åº«</a></h1></li><li class=main-nav__item><a class=nav-main-item href=https://hanigege.github.io/posts/ title>Posts</a></li><li class=main-nav__item><a class=nav-main-item href=https://hanigege.github.io/search/ title>Search</a></li></ul></nav></header><section class=page__body><header class=content__header><h1>Freebsd14.2æ‹‰å–æºç å®‰è£…sing-Box(åŒ…å«pfé˜²ç«å¢™é…ç½®)</h1></header><div class=content__body><h4 id=åœ¨-freebsd-ä¸Šç¼–è¯‘å¹¶å®‰è£…-sing-boxå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œæˆ‘ä»¬å°†ä½¿ç”¨-git-æ‹‰å–æºä»£ç å¹¶ç¼–è¯‘ä»¥ä¸‹æ˜¯è¯¦ç»†æ­¥éª¤>åœ¨ FreeBSD ä¸Šç¼–è¯‘å¹¶å®‰è£… sing-boxï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œã€‚æˆ‘ä»¬å°†ä½¿ç”¨ git æ‹‰å–æºä»£ç å¹¶ç¼–è¯‘ï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†æ­¥éª¤ï¼š</h4><h2 id=1-å®‰è£…ä¾èµ–å·¥å…·>1. å®‰è£…ä¾èµ–å·¥å…·</h2><p>é¦–å…ˆï¼Œä½ éœ€è¦å®‰è£…ä¸€äº›åŸºç¡€å·¥å…·ï¼Œä¾‹å¦‚ git å’Œ goï¼ˆGo è¯­è¨€ç¯å¢ƒï¼‰ï¼Œä»¥ä¾¿èƒ½ç¼–è¯‘å’Œæ„å»º sing-boxã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pkg update
</span></span><span style=display:flex><span>pkg install git
</span></span></code></pre></div><p>ç‚¹å‡»å®‰è£…æœ€æ–°ç‰ˆæœ¬go1.23.1</p><h2 id=2-è·å–-sing-box-æºä»£ç >2. è·å– Sing-Box æºä»£ç </h2><p>ç„¶åï¼Œä½¿ç”¨ git å…‹éš† sing-box çš„æºç åº“ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># ä¸‹é¢æ˜¯rootç”¨æˆ·å®‰è£…</span>
</span></span><span style=display:flex><span>mkdir /usr/local/opt
</span></span><span style=display:flex><span>git clone https://github.com/SagerNet/sing-box.git /usr/local/opt/sing-box
</span></span><span style=display:flex><span>cd /usr/local/opt/sing-box
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># ä¸‹é¢æ˜¯æ™®é€šç”¨æˆ·å®‰è£…ï¼Œåªèƒ½å®‰è£…æœ¬çº§ç›®å½•ä¸‹~/</span>
</span></span><span style=display:flex><span>mkdir .usr/local/opt
</span></span><span style=display:flex><span>git clone https://github.com/SagerNet/sing-box.git .usr/local/opt/sing-box
</span></span><span style=display:flex><span>cd .usr/local/opt/sing-box
</span></span></code></pre></div><h2 id=3-ç¼–è¯‘-sing-box>3. ç¼–è¯‘ Sing-Box</h2><p>ç¡®ä¿ä½ çš„ç³»ç»Ÿä¸Šå®‰è£…äº† Go è¯­è¨€ç¯å¢ƒåï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥ç¼–è¯‘ sing-boxï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># æ‰§è¡Œæ„å»ºï¼Œæ²¡æœ‰ä»»ä½•è¾“å‡ºå°±æ˜¯æ„å»ºå®Œ</span>
</span></span><span style=display:flex><span>go build -tags <span style=color:#e6db74>&#34;with_quic with_dhcp with_wireguard with_utls with_acme with_clash_api with_gvisor with_grpc with_v2ray_api&#34;</span> ./cmd/sing-box
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è¿™ä¼šç¼–è¯‘ sing-box å¹¶å¯ç”¨ QUICåè®®æ”¯æŒã€‚</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä½ ç°åœ¨åº”è¯¥å¯ä»¥åœ¨å½“å‰ç›®å½•çœ‹åˆ°å¯æ‰§è¡Œæ–‡ä»¶äº†</span>
</span></span><span style=display:flex><span>ls -lh sing-box
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å¦‚æœä½ è¿˜æƒ³æŠŠå®ƒå®‰è£…åˆ°ç³»ç»Ÿè·¯å¾„ä¸­ï¼Œå¯ä»¥æ‰§è¡Œï¼ˆéœ€è¦ root æƒé™ï¼‰ï¼š</span>
</span></span><span style=display:flex><span>sudo install -m <span style=color:#ae81ff>755</span> sing-box /usr/local/bin/sing-box 
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># æ™®é€šç”¨æˆ·æ‰§è¡Œ</span>
</span></span><span style=display:flex><span>go build -tags <span style=color:#e6db74>&#34;with_quic with_dhcp with_wireguard with_utls with_acme with_clash_api with_gvisor with_grpc with_v2ray_api&#34;</span> ./cmd/sing-box
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è¿™ä¼šç¼–è¯‘ sing-box å¹¶å¯ç”¨ QUICåè®®æ”¯æŒã€‚</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä½ ç°åœ¨åº”è¯¥å¯ä»¥åœ¨å½“å‰ç›®å½•çœ‹åˆ°å¯æ‰§è¡Œæ–‡ä»¶äº†</span>
</span></span><span style=display:flex><span>ls -lh sing-box
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æˆ‘è£…åœ¨äº†ä¹‹å‰goçš„binæ–‡ä»¶å¤¹é‡Œï¼Œå¯ä»¥æ‰§è¡Œï¼š</span>
</span></span><span style=display:flex><span>install -m <span style=color:#ae81ff>755</span> sing-box ~/.usr/local/opt/go/bin/sing-box 
</span></span></code></pre></div><h2 id=æˆ–è€…æ˜ç™½åŸç†è£…å“ªé‡Œå°±éšå¿ƒæ‰€æ¬²äº†>æˆ–è€…ï¼šï¼ˆæ˜ç™½åŸç†ï¼Œè£…å“ªé‡Œå°±éšå¿ƒæ‰€æ¬²äº†ï¼‰</h2><p>å¦‚æœä½ æ˜¯ æ™®é€šç”¨æˆ·ï¼ˆé rootï¼‰å¹¶æƒ³ä¸ä½¿ç”¨ sudo å®‰è£… sing-boxï¼Œå¯ä»¥å°†å…¶å®‰è£…åˆ°ä½ è‡ªå·±çš„ $HOME ç›®å½•ä¸‹çš„ bin/ å­ç›®å½•ä¸­ï¼Œè¿™æ˜¯ Unix ç³»ç»Ÿå¸¸ç”¨çš„åšæ³•ä¹‹ä¸€ã€‚</p><p>âœ… æ¨èåšæ³•ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p ~/bin
</span></span><span style=display:flex><span>install -m <span style=color:#ae81ff>755</span> sing-box ~/bin/sing-box
</span></span></code></pre></div><p>è¿™ä¼šå°† sing-box å®‰è£…åˆ°ä½ çš„ ~/bin/ ç›®å½•ä¸‹ã€‚</p><p>âœ… æ·»åŠ åˆ° PATHï¼ˆå¦‚æœè¿˜æ²¡æ·»åŠ ï¼‰</p><p>å¦‚æœä½ å°šæœªæŠŠ ~/bin åŠ å…¥ç¯å¢ƒå˜é‡ PATHï¼Œè¯·åœ¨ä½ çš„ shell é…ç½®æ–‡ä»¶é‡ŒåŠ ä¸€å¥ï¼š</p><p>å¯¹äº bashï¼š(è£…å¥½bashå°±ç”¨è¿™ä¸ªï¼‰</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#e6db74>&#39;export PATH=&#34;$HOME/bin:$PATH&#34;&#39;</span> &gt;&gt; ~/.bash_profile
</span></span><span style=display:flex><span>source ~/.bash_profile
</span></span></code></pre></div><p>å¯¹äº tcshï¼ˆFreeBSD é»˜è®¤ï¼‰ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#e6db74>&#39;setenv PATH &#34;$HOME/bin:$PATH&#34;&#39;</span> &gt;&gt; ~/.cshrc
</span></span><span style=display:flex><span>source ~/.cshrc
</span></span></code></pre></div><p>å¯¹äº zshï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#e6db74>&#39;export PATH=&#34;$HOME/bin:$PATH&#34;&#39;</span> &gt;&gt; ~/.zshrc
</span></span><span style=display:flex><span>source ~/.zshrc
</span></span></code></pre></div><p>ğŸ” éªŒè¯å®‰è£…</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>which sing-box
</span></span><span style=display:flex><span>sing-box version
</span></span></code></pre></div><p>ç¡®è®¤è¾“å‡ºæ­£ç¡®ç‰ˆæœ¬ä¿¡æ¯å³å¯ã€‚</p><h2 id=4-é…ç½®-sing-box>4. é…ç½® Sing-Box</h2><p>ä½ éœ€è¦é…ç½® sing-boxï¼Œé€šå¸¸å¯ä»¥å°†é…ç½®æ–‡ä»¶æ”¾ç½®åœ¨ <code>~/.config/sing-box</code>/ æˆ– <code>/usr/local/etc/sing-box/ </code>ç›®å½•ä¸‹ã€‚ä½ å¯ä»¥åœ¨ sing-box é…ç½®æ–‡ä»¶æ–‡æ¡£ ä¸­æ‰¾åˆ°è¯¦ç»†çš„é…ç½®è¯´æ˜ã€‚</p><p>åˆ›å»ºé…ç½®ç›®å½•ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># rootç”¨æˆ·</span>
</span></span><span style=display:flex><span>mkdir -p  /usr/local/etc/sing-box <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#34;{}&#34;</span> &gt;  /usr/local/etc/sing-box/config.json
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># æ™®é€šç”¨æˆ·</span>
</span></span><span style=display:flex><span>mkdir -p  ~/.usr/local/etc/sing-box <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#34;{}&#34;</span> &gt;  ~/.usr/local/etc/sing-box/config.json
</span></span></code></pre></div><p>å°†é…ç½®æ–‡ä»¶æ”¾åˆ°è¯¥ç›®å½•ä¸‹ï¼Œæˆ–è€…æ ¹æ®å®é™…æƒ…å†µè‡ªå®šä¹‰é…ç½®ã€‚</p><h2 id=socksé…ç½®å®ä¾‹>socksé…ç½®å®ä¾‹ï¼š</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;log&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;disabled&#34;</span>: false,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;level&#34;</span>: <span style=color:#e6db74>&#34;info&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;timestamp&#34;</span>: true
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;dns&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;servers&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;tag&#34;</span>: <span style=color:#e6db74>&#34;alidns&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;address&#34;</span>: <span style=color:#e6db74>&#34;https://223.5.5.5/dns-query&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;strategy&#34;</span>: <span style=color:#e6db74>&#34;ipv4_only&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;detour&#34;</span>: <span style=color:#e6db74>&#34;direct&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;tag&#34;</span>: <span style=color:#e6db74>&#34;cloudflare&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;address&#34;</span>: <span style=color:#e6db74>&#34;https://1.1.1.1/dns-query&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;strategy&#34;</span>: <span style=color:#e6db74>&#34;ipv4_only&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;detour&#34;</span>: <span style=color:#e6db74>&#34;proxy&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;tag&#34;</span>: <span style=color:#e6db74>&#34;block&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;address&#34;</span>: <span style=color:#e6db74>&#34;rcode://success&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;rules&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;outbound&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;any&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;server&#34;</span>: <span style=color:#e6db74>&#34;alidns&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;domain_suffix&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;.cn&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;server&#34;</span>: <span style=color:#e6db74>&#34;alidns&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;rule_set&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;geosite-cn&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;server&#34;</span>: <span style=color:#e6db74>&#34;alidns&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;rule_set&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;geosite-category-ads-all&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;server&#34;</span>: <span style=color:#e6db74>&#34;block&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;final&#34;</span>: <span style=color:#e6db74>&#34;cloudflare&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;strategy&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;disable_cache&#34;</span>: false,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;disable_expire&#34;</span>: false
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;inbounds&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;socks&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;tag&#34;</span>: <span style=color:#e6db74>&#34;socks-in&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;listen&#34;</span>: <span style=color:#e6db74>&#34;0.0.0.0&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;listen_port&#34;</span>: 1080,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;users&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;outbounds&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>   
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;tag&#34;</span>: <span style=color:#e6db74>&#34;proxy&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;server&#34;</span>: <span style=color:#e6db74>&#34;167.232&#34;</span>,  // æ”¹åœ°å€
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;server_port&#34;</span>: 449,   //æ”¹ç«¯å£
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;up_mbps&#34;</span>: 50, 
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;down_mbps&#34;</span>: 500,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;hysteria2&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;password&#34;</span>: <span style=color:#e6db74>&#34;iry&#34;</span>,  //æ”¹å¯†ç 
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;tls&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;insecure&#34;</span>: true,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;enabled&#34;</span>: true,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;server_name&#34;</span>: <span style=color:#e6db74>&#34;bing.com&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>,  
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;tcp_fast_open&#34;</span>: false
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;direct&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;tag&#34;</span>: <span style=color:#e6db74>&#34;direct&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;route&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;rules&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;action&#34;</span>: <span style=color:#e6db74>&#34;sniff&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;protocol&#34;</span>: <span style=color:#e6db74>&#34;dns&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;action&#34;</span>: <span style=color:#e6db74>&#34;hijack-dns&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ip_is_private&#34;</span>: true,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;outbound&#34;</span>: <span style=color:#e6db74>&#34;direct&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;domain_suffix&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;.cn&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;outbound&#34;</span>: <span style=color:#e6db74>&#34;direct&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;rule_set&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;geoip-cn&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;geosite-cn&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;geosite-private&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;outbound&#34;</span>: <span style=color:#e6db74>&#34;direct&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;rule_set&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;geosite-category-ads-all&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;action&#34;</span>: <span style=color:#e6db74>&#34;reject&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;rule_set&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;tag&#34;</span>: <span style=color:#e6db74>&#34;geoip-cn&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;remote&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;format&#34;</span>: <span style=color:#e6db74>&#34;binary&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;url&#34;</span>: <span style=color:#e6db74>&#34;https://raw.githubusercontent.com/SagerNet/sing-geoip/rule-set/geoip-cn.srs&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;download_detour&#34;</span>: <span style=color:#e6db74>&#34;proxy&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;tag&#34;</span>: <span style=color:#e6db74>&#34;geosite-cn&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;remote&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;format&#34;</span>: <span style=color:#e6db74>&#34;binary&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;url&#34;</span>: <span style=color:#e6db74>&#34;https://raw.githubusercontent.com/SagerNet/sing-geosite/rule-set/geosite-cn.srs&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;download_detour&#34;</span>: <span style=color:#e6db74>&#34;proxy&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;tag&#34;</span>: <span style=color:#e6db74>&#34;geosite-private&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;remote&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;format&#34;</span>: <span style=color:#e6db74>&#34;binary&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;url&#34;</span>: <span style=color:#e6db74>&#34;https://raw.githubusercontent.com/SagerNet/sing-geosite/rule-set/geosite-private.srs&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;download_detour&#34;</span>: <span style=color:#e6db74>&#34;proxy&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;tag&#34;</span>: <span style=color:#e6db74>&#34;geosite-category-ads-all&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;remote&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;format&#34;</span>: <span style=color:#e6db74>&#34;binary&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;url&#34;</span>: <span style=color:#e6db74>&#34;https://raw.githubusercontent.com/SagerNet/sing-geosite/rule-set/geosite-category-ads-all.srs&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;download_detour&#34;</span>: <span style=color:#e6db74>&#34;proxy&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;auto_detect_interface&#34;</span>: true,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;final&#34;</span>: <span style=color:#e6db74>&#34;proxy&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;experimental&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;cache_file&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;enabled&#34;</span>: true,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;path&#34;</span>: <span style=color:#e6db74>&#34;cache.db&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;cache_id&#34;</span>: <span style=color:#e6db74>&#34;mycacheid&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;store_fakeip&#34;</span>: true
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=6-è¿è¡Œ-sing-box>6. è¿è¡Œ Sing-Box</h2><p>é…ç½®å¥½åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ sing-boxï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># rootç”¨æˆ·</span>
</span></span><span style=display:flex><span>sing-box run -C /usr/local/etc/sing-box/
</span></span><span style=display:flex><span><span style=color:#75715e># æ™®é€šç”¨æˆ·</span>
</span></span><span style=display:flex><span>sing-box run -C ~/.usr/local/etc/sing-box/
</span></span></code></pre></div><h2 id=7-rootç”¨æˆ·ä¸‹è®¾ç½®ä¸ºæœåŠ¡å¯é€‰>7. rootç”¨æˆ·ä¸‹è®¾ç½®ä¸ºæœåŠ¡ï¼ˆå¯é€‰ï¼‰</h2><p>å¦‚æœä½ å¸Œæœ›å°† sing-box è®¾ç½®ä¸ºç³»ç»ŸæœåŠ¡ï¼Œæ–¹ä¾¿å¼€æœºå¯åŠ¨ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæœåŠ¡è„šæœ¬ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ rc.d æœåŠ¡è„šæœ¬ç¤ºä¾‹ï¼š</p><p>åˆ›å»ºæœåŠ¡è„šæœ¬æ–‡ä»¶ <code>/usr/local/etc/rc.d/sing-box</code>ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nano /usr/local/etc/rc.d/sing-box
</span></span></code></pre></div><p>æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><h2 id=æœ‰é‡å®šå‘æ—¥å¿—åŠŸèƒ½>æœ‰é‡å®šå‘æ—¥å¿—åŠŸèƒ½</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/sh
</span></span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># PROVIDE: sing_box</span>
</span></span><span style=display:flex><span><span style=color:#75715e># REQUIRE: NETWORKING</span>
</span></span><span style=display:flex><span><span style=color:#75715e># KEYWORD: shutdown</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>. /etc/rc.subr
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;sing_box&#34;</span>
</span></span><span style=display:flex><span>rcvar<span style=color:#f92672>=</span>sing_box_enable
</span></span><span style=display:flex><span>command<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/usr/local/bin/sing-box&#34;</span>
</span></span><span style=display:flex><span>pidfile<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/run/</span><span style=color:#e6db74>${</span>name<span style=color:#e6db74>}</span><span style=color:#e6db74>.pid&#34;</span>
</span></span><span style=display:flex><span>command_args<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;run -C /usr/local/etc/sing-box/ &gt;&gt; /var/log/singbox.log 2&gt;&amp;1 &amp; echo \$! &gt; </span><span style=color:#e6db74>${</span>pidfile<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>load_rc_config $name
</span></span><span style=display:flex><span>: <span style=color:#e6db74>${</span>sing_box_enable:=<span style=color:#e6db74>&#34;NO&#34;</span><span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>run_rc_command <span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><h2 id=æ— æ—¥å¿—é‡å®šå‘ç‰ˆæœ¬>æ— æ—¥å¿—é‡å®šå‘ç‰ˆæœ¬ï¼š</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/sh
</span></span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># PROVIDE: sing_box</span>
</span></span><span style=display:flex><span><span style=color:#75715e># REQUIRE: NETWORKING</span>
</span></span><span style=display:flex><span><span style=color:#75715e># KEYWORD: shutdown</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>. /etc/rc.subr
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;sing_box&#34;</span>
</span></span><span style=display:flex><span>rcvar<span style=color:#f92672>=</span>sing_box_enable
</span></span><span style=display:flex><span>command<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/usr/local/bin/sing-box&#34;</span>
</span></span><span style=display:flex><span>pidfile<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/run/</span><span style=color:#e6db74>${</span>name<span style=color:#e6db74>}</span><span style=color:#e6db74>.pid&#34;</span>
</span></span><span style=display:flex><span>command_args<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;run -C /usr/local/etc/sing-box/ &amp; echo \$! &gt; </span><span style=color:#e6db74>${</span>pidfile<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>load_rc_config $name
</span></span><span style=display:flex><span>: <span style=color:#e6db74>${</span>sing_box_enable:=<span style=color:#e6db74>&#34;NO&#34;</span><span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>run_rc_command <span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><p><code>load_rc_config $name</code> ç”¨äºåŠ è½½æœåŠ¡çš„é…ç½®æ–‡ä»¶ï¼Œè€Œ <code>${sing_box_enable:="NO"} </code>æ˜¯ä¸ºå˜é‡è®¾ç½®é»˜è®¤å€¼ã€‚è¿™é‡Œçš„é€»è¾‘æ˜¯ï¼š</p><p>â¦ å¿…é¡»æ·»åŠ ï¼šå¦åˆ™åœ¨ sing_box_enable æœªæ˜ç¡®è®¾ç½®ä¸º YES æ—¶ï¼Œè„šæœ¬ä¼šå› å˜é‡ç¼ºå¤±å¯¼è‡´å¯åŠ¨å¤±è´¥ï¼ˆå¦‚ /etc/rc é”™è¯¯æç¤ºï¼‰</p><h2 id=è®¾ç½®è„šæœ¬ä¸ºå¯æ‰§è¡Œ>è®¾ç½®è„šæœ¬ä¸ºå¯æ‰§è¡Œï¼š</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chmod +x /usr/local/etc/rc.d/sing-box
</span></span></code></pre></div><p>å¯ç”¨æœåŠ¡ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sysrc sing_box_enable<span style=color:#f92672>=</span>YES
</span></span></code></pre></div><p>å¯åŠ¨æœåŠ¡ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>service sing-box start
</span></span></code></pre></div><ol start=8><li>æ£€æŸ¥æœåŠ¡çŠ¶æ€
ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>service sing-box status
</span></span></code></pre></div><h2 id=æ™®é€šç”¨æˆ·å¯åŠ¨ç®¡ç†å¯é€‰>æ™®é€šç”¨æˆ·å¯åŠ¨ç®¡ç†ï¼ˆå¯é€‰ï¼‰</h2><br>FreeBSD ä¸‹çš„æ™®é€šç”¨æˆ·å¯ä»¥ä¸ºæ”¾åœ¨ç”¨æˆ·ç›®å½•ä¸‹çš„ sing-box è®¾ç½®ç”¨æˆ·çº§åˆ«çš„å¯åŠ¨æœåŠ¡ï¼Œæ›´æ ‡å‡†åšæ³•æ˜¯ä½¿ç”¨ cron @reboot æˆ– login.conf å¯åŠ¨æœºåˆ¶ã€‚<p>ä¸è¿‡ï¼ŒFreeBSD å¹¶ä¸åƒ Linuxï¼ˆæœ‰ systemd çš„ &ndash;user æ¨¡å¼ï¼‰é‚£æ ·å¯¹ç”¨æˆ·æœåŠ¡æ”¯æŒé‚£ä¹ˆæ ‡å‡†åŒ–ï¼Œä½†ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼å®ç°ï¼š</p><p>âœ… æ–¹æ³•ä¸€ï¼šä½¿ç”¨ crontab å®ç°å¼€æœºè‡ªå¯</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># ç³»ç»Ÿé»˜è®¤çš„æ˜¯vi</span>
</span></span><span style=display:flex><span>crontab -e
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># ä¸´æ—¶æŒ‡å®švimæ‰“å¼€crontab -e</span>
</span></span><span style=display:flex><span>EDITOR<span style=color:#f92672>=</span>vim crontab -e
</span></span></code></pre></div><p>æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼ˆç¡®ä¿ sing-box å¯æ‰§è¡Œï¼‰ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>@reboot sh -c <span style=color:#e6db74>&#39;$HOME/.usr/local/opt/go/bin/sing-box run -c $HOME/.usr/local/etc/sing-box/config.json &gt; $HOME/.sing-box.log 2&gt;&amp;1 &amp;&#39;</span>
</span></span></code></pre></div><p>è¿™ä¸ªæ–¹å¼ç®€å•æœ‰æ•ˆï¼Œæ— éœ€ root æƒé™ã€‚</p><p>âœ… æ–¹æ³•äºŒï¼šå†™ä¸ªç”¨æˆ·è‡ªå¯è„šæœ¬æ”¾åˆ° .login</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ ç™»å½•ä½¿ç”¨çš„æ˜¯ç»ˆç«¯ï¼Œå¯ä»¥åœ¨ ~/.login åŠ ä¸€è¡Œï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$HOME/.usr/local/opt/go/bin/sing-box run -c $HOME.usr/local/etc/sing-box/config.json &gt; $HOME/.sing-box.log 2&gt;&amp;<span style=color:#ae81ff>1</span> &amp;
</span></span></code></pre></div><h2 id=é™„æ™®é€šç”¨æˆ·å¯åŠ¨ç¨‹åºçŸ¥è¯†ç‚¹>é™„æ™®é€šç”¨æˆ·å¯åŠ¨ç¨‹åºçŸ¥è¯†ç‚¹ï¼š</h2><h4 id=æŸ¥çœ‹è¿›ç¨‹>æŸ¥çœ‹è¿›ç¨‹ï¼š</h4><pre tabindex=0><code>pgrep -a sing-box
</code></pre><p>å¦‚æœåœ¨è¿è¡Œä¼šçœ‹ç”¨IDï¼Œæ€è¡Œè¿›ç¨‹å‘½ä»¤ï¼š</p><pre tabindex=0><code>kill -9 ID
</code></pre><p>è¦å°†
<code>sing-box run -C ~/.usr/local/etc/sing-box</code>
å‘½ä»¤æ”¹ä¸º<strong>åå°è¿è¡Œ</strong>ï¼Œä½ å¯ä»¥æœ‰å‡ ç§æ–¹å¼é€‰æ‹©ï¼š</p><hr><h3 id=-æ–¹æ³•-1åŠ --ç›´æ¥åå°è¿è¡Œ>âœ… æ–¹æ³• 1ï¼šåŠ  <code>&</code> ç›´æ¥åå°è¿è¡Œ</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sing-box run -C ~/.usr/local/etc/sing-box &amp;
</span></span></code></pre></div><p>è¿™ä¼šå°†è¿›ç¨‹æ”¾åˆ°åå°è¿è¡Œï¼Œä½†<strong>å…³é—­ç»ˆç«¯åä¼šé€€å‡º</strong>ï¼Œä¸æ¨èç”¨äºé•¿æœŸæœåŠ¡ã€‚</p><hr><h3 id=-æ–¹æ³•-2ä½¿ç”¨-nohup-ä¿æŒåå°è¿è¡Œæ¨è>âœ… æ–¹æ³• 2ï¼šä½¿ç”¨ <code>nohup</code> ä¿æŒåå°è¿è¡Œï¼ˆæ¨èï¼‰</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>nohup sing-box run -C ~/.usr/local/etc/sing-box &gt; ~/sing-box.log 2&gt;&amp;<span style=color:#ae81ff>1</span> &amp;
</span></span></code></pre></div><p>è§£é‡Šï¼š</p><ul><li><code>nohup</code>ï¼šé˜²æ­¢è¿›ç¨‹éšç»ˆç«¯é€€å‡ºï¼›</li><li><code>> ~/sing-box.log</code>ï¼šå°†è¾“å‡ºä¿å­˜åˆ°æ—¥å¿—æ–‡ä»¶ï¼›</li><li><code>2>&amp;1</code>ï¼šåˆå¹¶æ ‡å‡†é”™è¯¯è¾“å‡ºï¼›</li><li><code>&</code>ï¼šåå°è¿è¡Œã€‚</li></ul><p><code>---</code></p><h3 id=-æ–¹æ³•-3ä½¿ç”¨-tmux-æˆ–-screen-ç®¡ç†åå°ä»»åŠ¡é€‚åˆè°ƒè¯•>âœ… æ–¹æ³• 3ï¼šä½¿ç”¨ <code>tmux</code> æˆ– <code>screen</code> ç®¡ç†åå°ä»»åŠ¡ï¼ˆé€‚åˆè°ƒè¯•ï¼‰</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>tmux new -s singbox
</span></span><span style=display:flex><span>sing-box run -C ~/.usr/local/etc/sing-box
</span></span><span style=display:flex><span><span style=color:#75715e># æŒ‰ Ctrl+B ç„¶å D å¯åå° detach</span>
</span></span></code></pre></div><p>è¿™æ ·ä½ å¯ä»¥éšæ—¶æ¢å¤æ§åˆ¶å°æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ã€‚</p><p><code>---</code></p><h3 id=-æ–¹æ³•-4å†™å…¥-crontab-reboot-å¯åŠ¨ä½ ä¹‹å‰æåˆ°è¿‡>âœ… æ–¹æ³• 4ï¼šå†™å…¥ <code>crontab @reboot</code> å¯åŠ¨ï¼ˆä½ ä¹‹å‰æåˆ°è¿‡ï¼‰</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>@reboot nohup $HOME/.usr/local/bin/sing-box run -C $HOME/.usr/local/etc/sing-box &gt; $HOME/sing-box.log 2&gt;&amp;<span style=color:#ae81ff>1</span> &amp;
</span></span></code></pre></div><p>`&mdash;</p><h2 id=æ€»ç»“>æ€»ç»“ï¼š</h2><p>å®‰è£…ä¾èµ–å·¥å…·ï¼ˆgit å’Œ goï¼‰ã€‚</p><p>å…‹éš† sing-box æºä»£ç å¹¶ç¼–è¯‘ã€‚</p><p>å°†äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…åˆ° /usr/local/bin/ã€‚</p><p>é…ç½®å¹¶è¿è¡Œ sing-boxã€‚</p><p>sing-box ä¸­ -C å’Œ -c æ˜¯ä¸åŒçš„å‚æ•°ï¼Œå®ƒä»¬çš„ä½œç”¨å¦‚ä¸‹ï¼š</p><h2 id=--c-æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„>âœ… -c <file>ï¼šæŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sing-box run -c /usr/local/etc/sing-box/config.json
</span></span></code></pre></div><p>è¿™æ˜¯æœ€å¸¸ç”¨çš„å‚æ•°ã€‚</p><p>ç›´æ¥å‘Šè¯‰ sing-box ä½ è¦ç”¨å“ªä¸ªé…ç½®æ–‡ä»¶æ¥å¯åŠ¨ã€‚</p><h1 id=é™„pfé˜²ç«å¢™å¯ç”¨>é™„ï¼šPFé˜²ç«å¢™å¯ç”¨ï½</h1><h2 id=ç¼–è¾‘-pf-é…ç½®æ–‡ä»¶>ç¼–è¾‘ pf é…ç½®æ–‡ä»¶</h2><p>æ‰“å¼€ <code>/etc/pf.conf</code> æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å®šä¹‰æ¥å£</span>
</span></span><span style=display:flex><span>ext_if <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;em0&#34;</span>  <span style=color:#75715e># ä½ çš„å¤–ç½‘æ¥å£åç§°ï¼Œé€šå¸¸ä¸º em0 æˆ–è€… eth0ï¼Œå…·ä½“çœ‹ä½ çš„ç³»ç»Ÿ</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å…è®¸æµé‡é€šè¿‡loopbackæ¥å£</span>
</span></span><span style=display:flex><span>set skip on lo0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é»˜è®¤æ‹’ç»æ‰€æœ‰å…¥ç«™è¿æ¥</span>
</span></span><span style=display:flex><span>block all
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å…è®¸æ‰€æœ‰å‡ºç«™æµé‡</span>
</span></span><span style=display:flex><span>pass out all
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å…è®¸æ¥è‡ªæœ¬åœ°ç½‘ç»œçš„æµé‡åˆ°è¾¾22ç«¯å£å’Œ1080ç«¯å£</span>
</span></span><span style=display:flex><span>pass in on $ext_if proto tcp from any to any port <span style=color:#ae81ff>22</span> keep state
</span></span><span style=display:flex><span>pass in on $ext_if proto tcp from any to any port <span style=color:#ae81ff>1080</span> keep state
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å…è®¸å…¶ä»–å·²ç»å»ºç«‹çš„è¿æ¥çš„æ•°æ®åŒ…é€šè¿‡</span>
</span></span><span style=display:flex><span>pass in all keep state
</span></span></code></pre></div><h2 id=å¯ç”¨-pf-é˜²ç«å¢™>å¯ç”¨ pf é˜²ç«å¢™</h2><p>é…ç½®æ–‡ä»¶å®Œæˆåï¼Œå¯ç”¨ pf é˜²ç«å¢™å¹¶åº”ç”¨è§„åˆ™ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pfctl -f /etc/pf.conf  <span style=color:#75715e># åŠ è½½ pf é…ç½®æ–‡ä»¶</span>
</span></span><span style=display:flex><span>pfctl -e              <span style=color:#75715e># å¯ç”¨ pf é˜²ç«å¢™</span>
</span></span></code></pre></div><h2 id=éªŒè¯-pf-é…ç½®>éªŒè¯ pf é…ç½®</h2><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥é˜²ç«å¢™è§„åˆ™æ˜¯å¦å·²æˆåŠŸåŠ è½½ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pfctl -sr
</span></span></code></pre></div><h2 id=ç¡®è®¤è¿æ¥>ç¡®è®¤è¿æ¥</h2><p><code>å…è®¸ 22 ç«¯å£</code>ï¼šä½ å¯ä»¥é€šè¿‡ ssh è¿æ¥åˆ°è¿™å°æœºå™¨ï¼Œç¡®è®¤ 22 ç«¯å£æ˜¯å¦å¼€æ”¾ã€‚</p><p><code>å…è®¸ 1080 ç«¯å£</code>ï¼šä½ å¯ä»¥é€šè¿‡ SOCKS å®¢æˆ·ç«¯è¿æ¥åˆ°ä½ çš„ SOCKS ä»£ç†ï¼Œç¡®è®¤ 1080 ç«¯å£æ˜¯å¦å¼€æ”¾ã€‚</p><p><code>å…¶ä»–ç«¯å£</code>ï¼šå…¶ä»–ç«¯å£çš„è¿æ¥ä¼šè¢«é˜»æ­¢ã€‚</p><h2 id=é…ç½®è§£é‡Š>é…ç½®è§£é‡Šï¼š</h2><h4 id=å…è®¸æ‰€æœ‰å‡ºç«™æµé‡>å…è®¸æ‰€æœ‰å‡ºç«™æµé‡ï¼š</h4><p>pass out all è§„åˆ™æ”¾è¡Œæ‰€æœ‰ä»æœ¬æœºå‡ºå»çš„æµé‡ã€‚è¿™æ ·ä½ å°±å¯ä»¥è‡ªç”±è®¿é—®å¤–éƒ¨ç½‘ç»œã€‚</p><h4 id=å…è®¸è¿›ç«™æµé‡çš„é™åˆ¶>å…è®¸è¿›ç«™æµé‡çš„é™åˆ¶ï¼š</h4><p>pass in on $ext_if proto tcp from any to any port 22 keep state åªå…è®¸å¤–éƒ¨è®¿é—® 22 ç«¯å£ï¼ˆSSHï¼‰ã€‚</p><p>pass in on $ext_if proto tcp from any to any port 1080 keep state åªå…è®¸å¤–éƒ¨è®¿é—® 1080 ç«¯å£ï¼ˆä½ çš„ SOCKS æœåŠ¡ï¼‰ã€‚</p><h4 id=é»˜è®¤é˜»æ­¢æ‰€æœ‰å…¥ç«™æµé‡>é»˜è®¤é˜»æ­¢æ‰€æœ‰å…¥ç«™æµé‡ï¼š</h4><p>block all è¿™æ¡è§„åˆ™é˜»æ­¢æ‰€æœ‰æœªè¢«æ˜ç¡®å…è®¸çš„å…¥ç«™æµé‡ï¼Œç¡®ä¿æœåŠ¡å™¨æ›´åŠ å®‰å…¨ã€‚</p><h4 id=ä¿æŒè¿æ¥çŠ¶æ€>ä¿æŒè¿æ¥çŠ¶æ€ï¼š</h4><p>keep state ä¿è¯äº†å…è®¸çš„è¿æ¥çŠ¶æ€ï¼ˆå¦‚ SSH å’Œ SOCKSï¼‰çš„æŒç»­æ€§ã€‚æ„å‘³ç€ä½ å»ºç«‹çš„è¿æ¥ä¸ä¼šå› ä¸ºé˜²ç«å¢™è§„åˆ™çš„å˜åŠ¨è€Œè¢«æ„å¤–ä¸­æ–­ã€‚</p><p>è¿™æ ·ï¼Œä½ çš„é˜²ç«å¢™ä¼šå…è®¸å¤–éƒ¨çš„ SSH å’Œ SOCKS æµé‡ï¼Œä½†æ‹’ç»å…¶ä»–ç«¯å£çš„è®¿é—®ï¼ŒåŒæ—¶å…è®¸æ‰€æœ‰çš„å‡ºç«™æµé‡ã€‚</p><div id=utterances-comments><script src=https://utteranc.es/client.js repo=hanigege/blog-comments issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><footer class=content__footer></footer></section><section class=page__aside><div class=aside__about><div class=aside__about><span class=about__logo role=img>ğŸš</span>&nbsp;<h1 class=about__title>bash&amp;sh</h1><p class=about__description>å€‹äººè‡ªç•™åœ°ï¼Œå¦‚æœèƒ½å¹«åˆ°ä½ ï¼Œæˆ‘ä¹Ÿæœƒå¾ˆé«˜èˆˆã€‚</p></div><ul class=aside__social-links><li><a href=mailto:purodn@gmail.com rel=me aria-label=Email title=Email><i class="fa-solid fa-envelope" aria-hidden=true></i></a>&nbsp;</li></ul></div><hr><div class=aside__content><p>2025-05-12</p><hr>On this page:<nav id=TableOfContents><ol><li><ol><li></li></ol></li><li><a href=#1-å®‰è£…ä¾èµ–å·¥å…·>1. å®‰è£…ä¾èµ–å·¥å…·</a></li><li><a href=#2-è·å–-sing-box-æºä»£ç >2. è·å– Sing-Box æºä»£ç </a></li><li><a href=#3-ç¼–è¯‘-sing-box>3. ç¼–è¯‘ Sing-Box</a></li><li><a href=#æˆ–è€…æ˜ç™½åŸç†è£…å“ªé‡Œå°±éšå¿ƒæ‰€æ¬²äº†>æˆ–è€…ï¼šï¼ˆæ˜ç™½åŸç†ï¼Œè£…å“ªé‡Œå°±éšå¿ƒæ‰€æ¬²äº†ï¼‰</a></li><li><a href=#4-é…ç½®-sing-box>4. é…ç½® Sing-Box</a></li><li><a href=#socksé…ç½®å®ä¾‹>socksé…ç½®å®ä¾‹ï¼š</a></li><li><a href=#6-è¿è¡Œ-sing-box>6. è¿è¡Œ Sing-Box</a></li><li><a href=#7-rootç”¨æˆ·ä¸‹è®¾ç½®ä¸ºæœåŠ¡å¯é€‰>7. rootç”¨æˆ·ä¸‹è®¾ç½®ä¸ºæœåŠ¡ï¼ˆå¯é€‰ï¼‰</a></li><li><a href=#æœ‰é‡å®šå‘æ—¥å¿—åŠŸèƒ½>æœ‰é‡å®šå‘æ—¥å¿—åŠŸèƒ½</a></li><li><a href=#æ— æ—¥å¿—é‡å®šå‘ç‰ˆæœ¬>æ— æ—¥å¿—é‡å®šå‘ç‰ˆæœ¬ï¼š</a></li><li><a href=#è®¾ç½®è„šæœ¬ä¸ºå¯æ‰§è¡Œ>è®¾ç½®è„šæœ¬ä¸ºå¯æ‰§è¡Œï¼š</a></li><li><a href=#æ™®é€šç”¨æˆ·å¯åŠ¨ç®¡ç†å¯é€‰>æ™®é€šç”¨æˆ·å¯åŠ¨ç®¡ç†ï¼ˆå¯é€‰ï¼‰</a></li><li><a href=#é™„æ™®é€šç”¨æˆ·å¯åŠ¨ç¨‹åºçŸ¥è¯†ç‚¹>é™„æ™®é€šç”¨æˆ·å¯åŠ¨ç¨‹åºçŸ¥è¯†ç‚¹ï¼š</a><ol><li></li><li><a href=#-æ–¹æ³•-1åŠ --ç›´æ¥åå°è¿è¡Œ>âœ… æ–¹æ³• 1ï¼šåŠ  <code>&</code> ç›´æ¥åå°è¿è¡Œ</a></li><li><a href=#-æ–¹æ³•-2ä½¿ç”¨-nohup-ä¿æŒåå°è¿è¡Œæ¨è>âœ… æ–¹æ³• 2ï¼šä½¿ç”¨ <code>nohup</code> ä¿æŒåå°è¿è¡Œï¼ˆæ¨èï¼‰</a></li><li><a href=#-æ–¹æ³•-3ä½¿ç”¨-tmux-æˆ–-screen-ç®¡ç†åå°ä»»åŠ¡é€‚åˆè°ƒè¯•>âœ… æ–¹æ³• 3ï¼šä½¿ç”¨ <code>tmux</code> æˆ– <code>screen</code> ç®¡ç†åå°ä»»åŠ¡ï¼ˆé€‚åˆè°ƒè¯•ï¼‰</a></li><li><a href=#-æ–¹æ³•-4å†™å…¥-crontab-reboot-å¯åŠ¨ä½ ä¹‹å‰æåˆ°è¿‡>âœ… æ–¹æ³• 4ï¼šå†™å…¥ <code>crontab @reboot</code> å¯åŠ¨ï¼ˆä½ ä¹‹å‰æåˆ°è¿‡ï¼‰</a></li></ol></li><li><a href=#æ€»ç»“>æ€»ç»“ï¼š</a></li><li><a href=#--c-æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„>âœ… -c ï¼šæŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„</a></li></ol><ol><li><a href=#ç¼–è¾‘-pf-é…ç½®æ–‡ä»¶>ç¼–è¾‘ pf é…ç½®æ–‡ä»¶</a></li><li><a href=#å¯ç”¨-pf-é˜²ç«å¢™>å¯ç”¨ pf é˜²ç«å¢™</a></li><li><a href=#éªŒè¯-pf-é…ç½®>éªŒè¯ pf é…ç½®</a></li><li><a href=#ç¡®è®¤è¿æ¥>ç¡®è®¤è¿æ¥</a></li><li><a href=#é…ç½®è§£é‡Š>é…ç½®è§£é‡Šï¼š</a><ol><li></li></ol></li></ol></nav></div></section><footer class=page__footer><p class=copyright>Â© <strong>felix</strong>.</p><p class=advertisement>Powered by <a>å¤§ä½¬å€‘</a>.</p></footer></div></body></html>