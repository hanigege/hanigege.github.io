<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Other on bash</title><link>https://hanigege.github.io/posts/other/</link><description>Recent content in Other on bash</description><generator>Hugo</generator><language>zh-CN</language><copyright>© **Gary**.</copyright><lastBuildDate>Sun, 11 May 2025 20:19:19 +0800</lastBuildDate><atom:link href="https://hanigege.github.io/posts/other/index.xml" rel="self" type="application/rss+xml"/><item><title>出国自建voip(一.2)FreePBX对接SMG4004网关实现SIP网络电话</title><link>https://hanigege.github.io/posts/other/voip-0/</link><pubDate>Sun, 11 May 2025 20:19:19 +0800</pubDate><guid>https://hanigege.github.io/posts/other/voip-0/</guid><description>&lt;h2 id="前言"&gt;前言&lt;/h2&gt;
&lt;p&gt;我个人搭建SIP的主要目的是因为我个人有很多手机卡，而手机只有2个卡槽，并且每年出国玩的时候手机带出去就是全球漫游，那基本不敢打电话。所以决定搭建一套自己的SIP Server来进行拨打接听电话，手机里只放一张流量卡，而且在不同地点可以在手机原理身边的时候在其他终端接听电话。还能研究学习一项新技术（笑）&lt;/p&gt;
&lt;p&gt;经过多放考虑最后我选择了Synway出品的SMG4004-4LC这款GOIP机器，支持全网通，4个卡槽（长期应该是够用了），SMS Over Email（虽然他也支持SMS Over SIP，但由于FreePBX官方不支持，而且本次我分机主要创建的是PJSIP，而这款机器的SMS是通过Chan SIP发送的，处理起来很麻烦，最后选择了使用Email接收的方式【稳定一些】，当然官方提供了大量API接口，应该是可以写一些机器人发送到如Telegram之类的【已解决，本站有提供】），而且国内还有代理商，可以很方便的买到。&lt;/p&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-11%20at%2020.21.31@2x.png" alt="CleanShot 2025-05-11 at 20.21.31@2x"&gt;
卡槽界面
&lt;img src="assets/CleanShot%202025-05-11%20at%2020.21.57@2x.png" alt="CleanShot 2025-05-11 at 20.21.57@2x"&gt;&lt;/p&gt;
&lt;h2 id="搭建freepbx"&gt;搭建FreePBX&lt;/h2&gt;
&lt;p&gt;我直接使用了官方ISO镜像（基于CentOS）进行默认搭建，搭完还升了个级，关于FreePBX设置的教程网上很多，上几个图大家也可以参照我图里的进行设置。
&lt;img src="assets/CleanShot%202025-05-11%20at%2020.23.06@2x.png" alt="CleanShot 2025-05-11 at 20.23.06@2x"&gt;&lt;/p&gt;
&lt;h2 id="还要设置-pjsip的udptcp协议开启"&gt;还要设置 PJSIP的UDP,TCP协议开启&lt;/h2&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-11%20at%2020.23.46@2x.png" alt="CleanShot 2025-05-11 at 20.23.46@2x"&gt;&lt;/p&gt;
&lt;h2 id="软路由开启端口"&gt;软路由开启端口&lt;/h2&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-11%20at%2020.24.22@2x.png" alt="CleanShot 2025-05-11 at 20.24.22@2x"&gt;&lt;/p&gt;
&lt;h2 id="对接网关"&gt;对接网关&lt;/h2&gt;
&lt;p&gt;首先要将网关整机注册到FreePBX实现SIP互通&lt;/p&gt;
&lt;h2 id="创建中继账号"&gt;创建中继账号&lt;/h2&gt;
&lt;p&gt;选择创建一个 &lt;code&gt;chan_sip&lt;/code&gt; 中继
&lt;img src="assets/CleanShot%202025-05-11%20at%2020.25.14@2x.png" alt="CleanShot 2025-05-11 at 20.25.14@2x"&gt;
首先仅填写中继名
&lt;img src="assets/CleanShot%202025-05-11%20at%2020.25.36@2x.png" alt="CleanShot 2025-05-11 at 20.25.36@2x"&gt;
路由规则写 X.
&lt;img src="assets/CleanShot%202025-05-11%20at%2020.25.54@2x.png" alt="CleanShot 2025-05-11 at 20.25.54@2x"&gt;
SIP设置页面填写中继名、和中继配置（可参考下方我的配置）
&lt;img src="assets/CleanShot%202025-05-11%20at%2020.26.17@2x.png" alt="CleanShot 2025-05-11 at 20.26.17@2x"&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;host&lt;span style="color:#f92672"&gt;=&lt;/span&gt;dynamic
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;port&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;5160&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;type&lt;span style="color:#f92672"&gt;=&lt;/span&gt;peer
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;secret&lt;span style="color:#f92672"&gt;=&lt;/span&gt;da*********************随便设置个密码
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;context&lt;span style="color:#f92672"&gt;=&lt;/span&gt;from-pstn
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;dtmfmode&lt;span style="color:#f92672"&gt;=&lt;/span&gt;rfc2833
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;insecure&lt;span style="color:#f92672"&gt;=&lt;/span&gt;no
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;qualify&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;3000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="设置出局线路"&gt;设置出局线路&lt;/h2&gt;
&lt;p&gt;设置完中继之后我们还需要设置一下出局线路让FreePBX的分机可以成功走网关进行拨打
&lt;img src="assets/CleanShot%202025-05-11%20at%2020.27.15@2x.png" alt="CleanShot 2025-05-11 at 20.27.15@2x"&gt;
设置一下匹配中继
&lt;img src="assets/CleanShot%202025-05-11%20at%2020.27.32@2x.png" alt="CleanShot 2025-05-11 at 20.27.32@2x"&gt;
设置匹配正则表达式为 X.
&lt;img src="assets/CleanShot%202025-05-11%20at%2020.27.49@2x.png" alt="CleanShot 2025-05-11 at 20.27.49@2x"&gt;&lt;/p&gt;</description></item><item><title>家庭聊天服务器系列（3）coturn服务搭建</title><link>https://hanigege.github.io/posts/other/%E5%AE%B6%E5%BA%AD%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B3%BB%E5%88%973coturn%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/</link><pubDate>Sun, 11 May 2025 16:42:06 +0800</pubDate><guid>https://hanigege.github.io/posts/other/%E5%AE%B6%E5%BA%AD%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B3%BB%E5%88%973coturn%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/</guid><description>&lt;h2 id="docker搭建coturn-turn服务器"&gt;docker搭建Coturn TURN服务器&lt;/h2&gt;
&lt;h2 id="共两种方案"&gt;共两种方案：&lt;/h2&gt;
&lt;h2 id="第一种方案要了解"&gt;第一种方案（要了解）&lt;/h2&gt;
&lt;h4 id="先建立一个文件夹"&gt;先建立一个文件夹&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;mkdir -p ~/data/docker_data/coturn/etc/coturn
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;mkdir -p ~/data/docker_data/coturn/var/run
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;mkdir -p ~/data/docker_data/coturn/var/log &lt;span style="color:#75715e"&gt;#如果用下面第一种方案这个才需要建立，第二种不需要&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cd ~/data/docker_data/coturn/etc/coturn
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;touch turnserver.conf
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cd ~/data/docker_data/coturn/var/run
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;touch turnserver.pid
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cd ../../
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;chmod &lt;span style="color:#ae81ff"&gt;777&lt;/span&gt; -R var
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;拉取镜像&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; docker pull coturn/coturn
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;直接host方式运行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; docker run -d --network&lt;span style="color:#f92672"&gt;=&lt;/span&gt;host &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; -v /root/data/docker_data/coturn/etc/coturn/turnserver.conf:/etc/coturn/turnserver.conf &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; -v /root/data/docker_data/coturn/etc/:/etc/ &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; -v /root/data/docker_data/coturn/var:/var &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; coturn/coturn
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;运行时不加 -d 先看输入有错误吗！
同时查看var下的log看相关的问题
调试启动命令：停止容器后会自动图删除容器，命令如下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;docker run --network&lt;span style="color:#f92672"&gt;=&lt;/span&gt;host &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; -v /root/data/docker_data/coturn/etc/coturn/turnserver.conf:/etc/coturn/turnserver.conf &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; -v /root/data/docker_data/coturn/etc/:/etc/ &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; -v /root/data/docker_data/coturn/var:/var &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; --rm &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; coturn/coturn
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;哪果去掉了配置文件里的指定log，停用cli功能，下面有说明，可以用下面的启动命令：&lt;/p&gt;</description></item><item><title>家庭聊天服务器系列（2）ntfy服务搭建</title><link>https://hanigege.github.io/posts/other/%E5%AE%B6%E5%BA%AD%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B3%BB%E5%88%972ntfy%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/</link><pubDate>Sun, 11 May 2025 16:34:01 +0800</pubDate><guid>https://hanigege.github.io/posts/other/%E5%AE%B6%E5%BA%AD%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B3%BB%E5%88%972ntfy%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/</guid><description>&lt;br&gt;
&lt;h3 id="ntfy-无需注册的通知服务"&gt;ntfy 无需注册的通知服务&lt;/h3&gt;
&lt;h4 id="最下面是恢复备份的方案"&gt;最下面是恢复备份的方案：&lt;/h4&gt;
&lt;p&gt;##​​ 什么是 ntfy ？
​ntfy​​​（发音：notify​​​）是一个简单的基于 HTTP​​​ 的 pub-sub​​​ 通知服务。它允许您通过任何计算机上的脚本向您的手机或桌面发送通知，完全无需注册或费用。&lt;/p&gt;
&lt;h4 id="官方提供了免费的版本httpsntfyshapp"&gt;官方提供了免费的版本：https://ntfy.sh/app&lt;/h4&gt;
&lt;h2 id="安装"&gt;安装&lt;/h2&gt;
&lt;p&gt;新建文件：docker-compose.yml
脚本如下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;services:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; ntfy:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; image: binwiederhier/ntfy:latest
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; container_name: ntfy
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; command:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - serve
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; environment:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - TZ&lt;span style="color:#f92672"&gt;=&lt;/span&gt;Asia/Shanghai
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; volumes:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - /root/data/docker_data/ntfy/data/cache:/var/cache/ntfy
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - /root/data/docker_data/ntfy/data/config:/etc/ntfy
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; ports:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - 12332:80
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; restart: unless-stopped
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; networks:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - matrix
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;networks:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; matrix:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; name: matrix
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;代码中的反向代理npm转发外出端口12332 。&lt;/p&gt;
&lt;p&gt;上面的代码中会自建 网络matrix.&lt;/p&gt;
&lt;h2 id="如果先行自己建立网络如"&gt;如果先行自己建立网络，如：&lt;/h2&gt;
&lt;p&gt;建立一个 docker network：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;docker network create matrix
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;那么您可以按照之前提到的建议在 Docker Compose 文件中将网络定义标记为外部网络，并且指定正确的网络名称。在您的 Docker Compose 文件中，您可以将网络定义修改为类似以下内容：&lt;/p&gt;</description></item><item><title>家庭聊天服务器系列（1）synapse搭建</title><link>https://hanigege.github.io/posts/other/%E5%AE%B6%E5%BA%AD%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B3%BB%E5%88%971synapse%E6%90%AD%E5%BB%BA/</link><pubDate>Sun, 11 May 2025 16:24:14 +0800</pubDate><guid>https://hanigege.github.io/posts/other/%E5%AE%B6%E5%BA%AD%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B3%BB%E5%88%971synapse%E6%90%AD%E5%BB%BA/</guid><description>&lt;br&gt;
&lt;h2 id="设计思路"&gt;设计思路&lt;/h2&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-11%20at%2016.27.38@2x.png" alt="CleanShot 2025-05-11 at 16.27.38@2x"&gt;&lt;/p&gt;
&lt;h3 id="服务器需要2台外网一台vps即可搭建coturn服务本地一台搭建synapse及ntfy服务所有服务均以docker的方式来搭建"&gt;服务器需要2台，外网一台vps即可，搭建coturn服务。本地一台，搭建synapse及ntfy服务，所有服务均以docker的方式来搭建&lt;/h3&gt;
&lt;h4 id="1-ntfy服务因为很多的限制导致消息无法传达类似于你消息来了确收不到通知提醒"&gt;1. ntfy服务：因为很多的限制导致消息无法传达，类似于你消息来了，确收不到通知提醒.&lt;/h4&gt;
&lt;h4 id="2-coturn-是一个-stunturn-服务器-实现主要用于-webrtcvoip视频会议等实时通信应用中解决nat-穿透问题coturn-同时实现了-stun--turn通常用作-webrtc-的中继服务器确保视频语音连接在各种复杂网络环境下都能建立"&gt;2. coturn 是一个 STUN/TURN 服务器 实现，主要用于 WebRTC、VoIP、视频会议等实时通信应用中，解决NAT 穿透问题。coturn 同时实现了 STUN + TURN，通常用作 WebRTC 的中继服务器，确保视频/语音连接在各种复杂网络环境下都能建立。&lt;/h4&gt;
&lt;h4 id="3-synapse聊天服务器主体支持文字语音在线语音电话在线视频文件传送是一套完整可持续的聊天服务"&gt;3. synapse聊天服务器主体，支持文字，语音，在线语音电话，在线视频，文件传送，是一套完整可持续的聊天服务。&lt;/h4&gt;
&lt;h4 id="4-客户端有很多种官网上都有介绍这里只推荐使用element客户端"&gt;4. 客户端有很多种，官网上都有介绍，这里只推荐使用Element客户端。&lt;/h4&gt;
&lt;p&gt;最最下面是备份恢复的方法，如何备份，把相关docker文件夹打包下载就可以了，需要恢复的时候，上传到相关的服务器，放在root文件夹下。&lt;/p&gt;
&lt;h4 id="切记synapae服务器不可以使用fakeip的dns代理上网只能用本地的网络不然会收不到消息ntfy会出问题"&gt;切记，SYNAPAE服务器不可以使用fakeip的DNS代理上网，只能用本地的网络，不然，会收不到消息NTFY会出问题！&lt;/h4&gt;
&lt;p&gt;前言
首先必须介绍下Matrix。Matrix是一个开源、可交互、去中心化的实时通信服务框架。使用Matrix可以搭建安全的通信服务器，配合支持 Matrix 的客户端可以实现个人、团队间的实时聊天交互。&lt;/p&gt;
&lt;p&gt;与常见的QQ、微信、钉钉相比，Matrix的特点就是开源，可私有化部署，保证通信的安全和隐私。与Rocket.chat、MatterMost相比，matrix的特点还要再加上去中心化。每个运行Matrix的服务器都是一个节点，用户可以选择在任意节点注册、连接，同一个节点内的用户可以任意通信。同时，节点与节点之间也可以通过联锁（Federation）机制进行通信，实现不同节点的用户之间进行通信。&lt;/p&gt;
&lt;p&gt;因为Matrix只是个框架，可以有很多实现，本文使用的synapse就是其中一个服务端实现。&lt;/p&gt;
&lt;p&gt;除了安装服务端，本文还有安装element web端的步骤。&lt;/p&gt;
&lt;p&gt;搭一个demo并不耗资源，加上postgresql数据库才用了200MB内存不到，如果用默认的sqlite数据库会更省内存。&lt;/p&gt;
&lt;h1 id="安装服务端"&gt;安装服务端&lt;/h1&gt;
&lt;h2 id="更新环境"&gt;更新环境&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;apt update -y &lt;span style="color:#f92672"&gt;&amp;amp;&amp;amp;&lt;/span&gt; apt upgrade -y &lt;span style="color:#f92672"&gt;&amp;amp;&amp;amp;&lt;/span&gt; apt install -y curl wget sudo socat
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="安装-docker"&gt;安装 Docker&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;curl -fsSL https://get.docker.com -o get-docker.sh &lt;span style="color:#f92672"&gt;&amp;amp;&amp;amp;&lt;/span&gt; sh get-docker.sh
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;curl -L &lt;span style="color:#e6db74"&gt;&amp;#34;https://github.com/docker/compose/releases/download/v2.16.0/docker-compose-&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;$(&lt;/span&gt;uname -s&lt;span style="color:#66d9ef"&gt;)&lt;/span&gt;&lt;span style="color:#e6db74"&gt;-&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;$(&lt;/span&gt;uname -m&lt;span style="color:#66d9ef"&gt;)&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; -o /usr/local/bin/docker-compose 
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;chmod +x /usr/local/bin/docker-compose
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="搭建synapse"&gt;搭建Synapse&lt;/h2&gt;
&lt;p&gt;按照教程建立/data/synapse/下的三个文件夹：&lt;/p&gt;</description></item><item><title>出国自建voip(二.2)三汇SMG4004-4LC的配置方法测试电话呼叫</title><link>https://hanigege.github.io/posts/other/sanhui-smg4004-4lc-set/</link><pubDate>Sun, 11 May 2025 11:29:46 +0800</pubDate><guid>https://hanigege.github.io/posts/other/sanhui-smg4004-4lc-set/</guid><description>&lt;h2 id="我使用的是三汇smg4004-4lc算是捡垃圾了这是以前的老款4口语音网关目前这款只能支持2g网络和短信我测试我这个地区只支持移动和联通不过也够用了"&gt;我使用的是三汇SMG4004-4LC（算是捡垃圾了，这是以前的老款），4口语音网关，目前这款只能支持2g网络和短信，我测试我这个地区只支持移动和联通。不过也够用了。&lt;/h2&gt;
&lt;h4 id="使用前需要先升能这款设备的固件相关升级文件本站有提供下载"&gt;使用前需要先升能这款设备的固件，相关升级文件，本站有提供下载。&lt;/h4&gt;
&lt;p&gt;照着下面设置，就可以测试电话呼叫了：
&lt;img src="assets/CleanShot%202025-05-11%20at%2011.31.37@2x.png" alt="CleanShot 2025-05-11 at 11.31.37@2x"&gt;
&lt;img src="assets/CleanShot%202025-05-11%20at%2011.31.50@2x.png" alt="CleanShot 2025-05-11 at 11.31.50@2x"&gt;
&lt;img src="assets/CleanShot%202025-05-11%20at%2011.32.01@2x.png" alt="CleanShot 2025-05-11 at 11.32.01@2x"&gt;&lt;/p&gt;</description></item><item><title>出国自建voip(二）创建 Telegram 机器人</title><link>https://hanigege.github.io/posts/other/sanhui-telegram-bot-4/</link><pubDate>Sun, 11 May 2025 11:19:47 +0800</pubDate><guid>https://hanigege.github.io/posts/other/sanhui-telegram-bot-4/</guid><description>&lt;p&gt;要通过 Telegram 机器人 对接 三汇语音网关（SMG4000-C1LC） 的短信功能，您需要完成以下几个步骤：&lt;/p&gt;
&lt;h2 id="步骤-1"&gt;步骤 1：&lt;/h2&gt;
&lt;p&gt;打开 Telegram，搜索并与 BotFather 聊天。&lt;/p&gt;
&lt;p&gt;发送命令 /newbot 来创建一个新的机器人。&lt;/p&gt;
&lt;p&gt;给机器人起个名字并设置用户名。&lt;/p&gt;
&lt;p&gt;BotFather 会给你一个 API Token，用来与 Telegram 机器人进行交互。保存好这个 &lt;code&gt;Token&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;步骤 2：配置三汇网关发送短信
三汇语音网关一般支持通过 HTTP API 或 SMTP 发送短信。首先，确保三汇网关的短信服务已经启用，并且能够通过接口发送短信。&lt;/p&gt;
&lt;p&gt;步骤 3：编写 Telegram 机器人和三汇网关的对接脚本 （本站有提供下载）
你需要编写一个脚本，使用 Telegram 机器人获取信息，并通过 HTTP 请求将短信发送到三汇网关。&lt;/p&gt;
&lt;p&gt;步骤 3.1：安装 Telegram Bot 库（例如 Python 的 python-telegram-bot）（详情，请看voip出国系列三）&lt;/p&gt;</description></item><item><title>出国自建voip(一)Freepbx16配置</title><link>https://hanigege.github.io/posts/other/freepbx16-set-all-1/</link><pubDate>Sun, 11 May 2025 06:43:58 +0800</pubDate><guid>https://hanigege.github.io/posts/other/freepbx16-set-all-1/</guid><description>&lt;br&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;为什么要建回家voip系统，出国后，电话就是国际长途，打电话收发短信都不方便，有没有办法可以做到通过网络传递语音和收发短信（利用telegram机器人），当然可以，手机卡可以放在国内的小设备上，自己手机上装一个sip软电话客户端，即可完全实现，接听拨打电话，收发短信，并且不会再受地域限制，仅限学习交流，友情提醒，不要做违反当地法律法规的事。
&lt;h1 id="开始操作"&gt;开始操作&lt;/h1&gt;
&lt;h4 id="架构"&gt;架构&lt;/h4&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-11%20at%2011.14.14@2x.png" alt="CleanShot 2025-05-11 at 11.14.14@2x"&gt;&lt;/p&gt;
&lt;h2 id="freepbx16首先修改ip为固定ip"&gt;freepbx16首先修改ip为固定ip&lt;/h2&gt;
&lt;p&gt;安装好后，系统其实是dhcp动态获得ip的，进入看了看，是Centos，我们不需要dhcp，把IP给固定死&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;vi &lt;span style="color:#f92672"&gt;/&lt;/span&gt;etc&lt;span style="color:#f92672"&gt;/&lt;/span&gt;sysconfig&lt;span style="color:#f92672"&gt;/&lt;/span&gt;network&lt;span style="color:#f92672"&gt;-&lt;/span&gt;scripts&lt;span style="color:#f92672"&gt;/&lt;/span&gt;ifcfg&lt;span style="color:#f92672"&gt;-&lt;/span&gt;eth0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;下面的内容跟实际配置文件里的内容相对替换，一一对应替换，原文件里的内容可能更多一些，只修改下面有的，没涉及的保持原来的，dns不可以用科学的，只允许用本地，不然会影响后面系统里nat-ip获取的准确性&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;TYPE=&amp;#34;Ethernet&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;BOOTPROTO=&amp;#34;static&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;IPADDR=10.8.2.60
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;NETMASK=255.255.255.0
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;GATEWAY=10.8.2.1
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;DNS1=114.114.114.114
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;DEFROUTE=&amp;#34;yes&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;NAME=&amp;#34;eth0&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;DEVICE=&amp;#34;eth0&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;ONBOOT=&amp;#34;yes&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;重启～&lt;/p&gt;
&lt;h1 id="freepbx16配置图例"&gt;freepbx16配置图例&lt;/h1&gt;
&lt;p&gt;freepbx16默认安装在pve系统上就好，登录系统后
：&lt;/p&gt;
&lt;h2 id="先进行asterisk-sip-设置"&gt;先进行asterisk sip 设置&lt;/h2&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-11%20at%2006.47.04@2x.png" alt="先进行asterisk sip 设置"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-11%20at%2006.56.27@2x.png" alt="CleanShot 2025-05-11 at 06.56.27@2x"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-11%20at%2006.59.32@2x.png" alt="CleanShot 2025-05-11 at 06.59.32@2x"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-11%20at%2007.03.35@2x.png" alt="CleanShot 2025-05-11 at 07.03.35@2x"&gt;&lt;/p&gt;
&lt;h2 id="现在开始设置系统中文地区时间"&gt;现在开始设置系统中文地区时间&lt;/h2&gt;
&lt;p&gt;选择高级设置：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-mysql" data-lang="mysql"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#960050;background-color:#1e0010"&gt;高级设置里一开始还有一个选项是启&lt;/span&gt;&lt;span style="color:#f92672"&gt;`&lt;/span&gt;chan_sip&lt;span style="color:#f92672"&gt;`&lt;/span&gt;,&lt;span style="color:#960050;background-color:#1e0010"&gt;这个记的要打开，不然后面设置中继或者是&lt;/span&gt;sip有些选项不显示
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-11%20at%2007.07.49@2x.png" alt="CleanShot 2025-05-11 at 07.07.49@2x"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-11%20at%2007.09.16@2x.png" alt="CleanShot 2025-05-11 at 07.09.16@2x"&gt;&lt;/p&gt;
&lt;h2 id="开启中继配置-这块设置是连接三汇语音网关的"&gt;开启中继配置 （这块设置是连接三汇语音网关的）&lt;/h2&gt;
&lt;p&gt;&lt;img src="assets/CleanShot%202025-05-11%20at%2007.12.25@2x.png" alt="CleanShot 2025-05-11 at 07.12.25@2x"&gt;
&lt;img src="assets/CleanShot%202025-05-11%20at%2007.13.45@2x.png" alt="CleanShot 2025-05-11 at 07.13.45@2x"&gt;
&lt;img src="assets/CleanShot%202025-05-11%20at%2007.13.57@2x.png" alt="CleanShot 2025-05-11 at 07.13.57@2x"&gt;
&lt;img src="assets/CleanShot%202025-05-11%20at%2007.14.08@2x.png" alt="CleanShot 2025-05-11 at 07.14.08@2x"&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;host&lt;span style="color:#f92672"&gt;=&lt;/span&gt;dynamic
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;port&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;5160&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;type&lt;span style="color:#f92672"&gt;=&lt;/span&gt;peer
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;secret&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;666&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;context&lt;span style="color:#f92672"&gt;=&lt;/span&gt;from&lt;span style="color:#f92672"&gt;-&lt;/span&gt;pstn
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;dtmfmode&lt;span style="color:#f92672"&gt;=&lt;/span&gt;rfc2833
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;insecure&lt;span style="color:#f92672"&gt;=&lt;/span&gt;no
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;qualify&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;3000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;照图填写就好，这里是内网传输使用的，端口不影响啥&lt;/p&gt;</description></item><item><title>出国自建voip(三.2）Telegram机器人连接程序自启动(补充篇)</title><link>https://hanigege.github.io/posts/other/telegram-sms-bot2/</link><pubDate>Sun, 11 May 2025 00:58:10 +0800</pubDate><guid>https://hanigege.github.io/posts/other/telegram-sms-bot2/</guid><description>&lt;h2 id="rootsms-source-myenvbinactivate"&gt;root@sms:~# source myenv/bin/activate&lt;/h2&gt;
&lt;h2 id="激活虚拟环境"&gt;激活虚拟环境&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;source myenv/bin/activate 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;(myenv) root@sms:~# nohup python sms.py &amp;gt; sms.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;后台启动sms.py&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;nohup python sms.py &amp;gt; sms.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;or
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;nohup python sms.py &amp;gt; sms.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;(myenv) root@sms:~#
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;上面的两条命令能不能做成脚本，设置为开机自启动&lt;/p&gt;
&lt;p&gt;可以的，你可以创建一个 systemd 服务 或者 编写一个 shell 脚本 来实现 Python 虚拟环境的激活 并 运行 sms.py 脚本，同时设置为 开机自启动。&lt;/p&gt;
&lt;p&gt;方法 1：使用 systemd (推荐)
适用于 Debian/Ubuntu 及大多数 Linux 发行版。&lt;/p&gt;
&lt;p&gt;步骤 1：创建 systemd 服务文件
运行以下命令，创建 sms.service：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;nano /etc/systemd/system/sms.service
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;填入以下内容：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;[Unit]
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Description=SMS Python Service
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;After=network.target
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;[Service]
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;User=root
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;WorkingDirectory=/root
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;ExecStart=/root/myenv/bin/python /root/sms.py
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Restart=always
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;StandardOutput=append:/root/sms.log
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;StandardError=append:/root/sms.log
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;[Install]
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;WantedBy=multi-user.target
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;⚠ 注意：&lt;/p&gt;</description></item><item><title>出国自建voip(三）连接Telegram机器人本地安装</title><link>https://hanigege.github.io/posts/other/telegram-sms-bot/</link><pubDate>Sun, 11 May 2025 00:39:56 +0800</pubDate><guid>https://hanigege.github.io/posts/other/telegram-sms-bot/</guid><description>&lt;h3 id="前提是telegram自己的机器人提前生成好并获取相应的密钥"&gt;前提是telegram自己的机器人提前生成好，并获取相应的密钥&lt;/h3&gt;
&lt;h1 id="打开一台虚拟机建议debian12"&gt;打开一台虚拟机（建议debian12)&lt;/h1&gt;
&lt;h2 id="方法-1使用虚拟环境"&gt;方法 1：使用虚拟环境&lt;/h2&gt;
&lt;p&gt;创建一个 Python 虚拟环境，并在其中安装所需的库。这样可以避免系统级 Python 环境的冲突。&lt;/p&gt;
&lt;p&gt;安装 python3-venv（如果未安装）&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;apt update
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;apt install python3&lt;span style="color:#f92672"&gt;-&lt;/span&gt;venv
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;创建一个新的虚拟环境&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; python3 &lt;span style="color:#f92672"&gt;-&lt;/span&gt;m venv myenv
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;激活虚拟环境&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;source myenv&lt;span style="color:#f92672"&gt;/&lt;/span&gt;bin&lt;span style="color:#f92672"&gt;/&lt;/span&gt;activate
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在虚拟环境中安装 python-telegram-bot&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;pip install python&lt;span style="color:#f92672"&gt;-&lt;/span&gt;telegram&lt;span style="color:#f92672"&gt;-&lt;/span&gt;bot smpplib
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;运行脚本：你可以在虚拟环境中运行你的 Telegram 机器人脚本,脚本&lt;code&gt;sms.py&lt;/code&gt;下载
命令：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;python sms&lt;span style="color:#f92672"&gt;.&lt;/span&gt;py
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;退出虚拟环境：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;deactivate
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="运行脚本有三种方案一种是运行在tmux虚拟窗口下二种是直接本地后台运行三种systemd进行管理-建议第三种"&gt;运行脚本有三种方案，一种是运行在tmux虚拟窗口下，二种是直接本地后台运行，三种systemd进行管理 （建议第三种）&lt;/h2&gt;
&lt;p&gt;以上要运行在虚拟窗口下，建议使用tmux&lt;/p&gt;
&lt;h4 id="1使用-tmux"&gt;1.使用 tmux&lt;/h4&gt;
&lt;p&gt;安装（如果未安装）：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;apt-get install tmux # Debian/Ubuntu 
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;yum install tmux # CentOS/RHEL
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;启动 Tmux 会话：
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;tmux&lt;/strong&gt;
按 Ctrl+B，然后按 D，会返回终端。&lt;/p&gt;
&lt;p&gt;关闭 SSH，程序继续运行。&lt;/p&gt;
&lt;p&gt;重新连接：&lt;/p&gt;
&lt;p&gt;列出会话：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;tmux ls
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;输出示例：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;0: 1 windows (created ...)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;恢复会话：&lt;/p&gt;</description></item></channel></rss>